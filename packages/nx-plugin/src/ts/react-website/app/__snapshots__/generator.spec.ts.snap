// Vitest Snapshot v1, https://vitest.dev/guide/snapshot.html

exports[`react-website generator > TailwindCSS integration > should configure vite with TailwindCSS plugin by default > vite.config.ts-with-tailwind 1`] = `
"import tailwindcss from '@tailwindcss/vite';
import tsconfigPaths from 'vite-tsconfig-paths';
import { resolve } from 'path';
import { tanstackRouter } from '@tanstack/router-plugin/vite';
/// <reference types='vitest' />
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { nxViteTsPaths } from '@nx/vite/plugins/nx-tsconfig-paths.plugin';
import { nxCopyAssetsPlugin } from '@nx/vite/plugins/nx-copy-assets.plugin';

export default defineConfig(() => ({
  define: {
    global: {},
  },
  root: __dirname,
  cacheDir: '../node_modules/.vite/test-app',
  server: {
    port: 4200,
    host: 'localhost',
  },
  preview: {
    port: 4300,
    host: 'localhost',
  },
  plugins: [
    tanstackRouter({
      routesDirectory: resolve(__dirname, 'src/routes'),
      generatedRouteTree: resolve(__dirname, 'src/routeTree.gen.ts'),
    }),
    react(),
    nxViteTsPaths(),
    nxCopyAssetsPlugin(['*.md']),
    tailwindcss(),
    tsconfigPaths(),
  ],
  build: {
    outDir: '../dist/test-app',
    emptyOutDir: true,
    reportCompressedSize: true,
    commonjsOptions: {
      transformMixedEsModules: true,
    },
  },
  test: {
    name: '@proj/test-app',
    watch: false,
    globals: true,
    environment: 'jsdom',
    include: ['{src,tests}/**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}'],
    reporters: ['default'],
    coverage: {
      reportsDirectory: '../coverage/test-app',
      provider: 'v8' as const,
    },
    passWithNoTests: true,
  },
}));
"
`;

exports[`react-website generator > TailwindCSS integration > should configure vite without TailwindCSS plugin when disabled > vite.config.ts-without-tailwind 1`] = `
"import tsconfigPaths from 'vite-tsconfig-paths';
import { resolve } from 'path';
import { tanstackRouter } from '@tanstack/router-plugin/vite';
/// <reference types='vitest' />
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { nxViteTsPaths } from '@nx/vite/plugins/nx-tsconfig-paths.plugin';
import { nxCopyAssetsPlugin } from '@nx/vite/plugins/nx-copy-assets.plugin';

export default defineConfig(() => ({
  define: {
    global: {},
  },
  root: __dirname,
  cacheDir: '../node_modules/.vite/test-app',
  server: {
    port: 4200,
    host: 'localhost',
  },
  preview: {
    port: 4300,
    host: 'localhost',
  },
  plugins: [
    tanstackRouter({
      routesDirectory: resolve(__dirname, 'src/routes'),
      generatedRouteTree: resolve(__dirname, 'src/routeTree.gen.ts'),
    }),
    react(),
    nxViteTsPaths(),
    nxCopyAssetsPlugin(['*.md']),
    tsconfigPaths(),
  ],
  build: {
    outDir: '../dist/test-app',
    emptyOutDir: true,
    reportCompressedSize: true,
    commonjsOptions: {
      transformMixedEsModules: true,
    },
  },
  test: {
    name: '@proj/test-app',
    watch: false,
    globals: true,
    environment: 'jsdom',
    include: ['{src,tests}/**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}'],
    reporters: ['default'],
    coverage: {
      reportsDirectory: '../coverage/test-app',
      provider: 'v8' as const,
    },
    passWithNoTests: true,
  },
}));
"
`;

exports[`react-website generator > TailwindCSS integration > should include TailwindCSS import in styles.css by default > styles.css-with-tailwind 1`] = `
"@import 'tailwindcss';
/* You can add global styles to this file, and also import other style files */
"
`;

exports[`react-website generator > TailwindCSS integration > should not include TailwindCSS import in styles.css when disabled > styles.css-without-tailwind 1`] = `
"/* You can add global styles to this file, and also import other style files */
"
`;

exports[`react-website generator > TailwindCSS integration > terraform iacProvider > should generate terraform files for static website and snapshot them > terraform-static-website-files 1`] = `
{
  "static-website.tf": "terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 6.0"
      configuration_aliases = [aws.us_east_1]
    }
    random = {
      source  = "hashicorp/random"
      version = "~> 3.1"
    }
  }
}

# Variables
variable "website_name" {
  description = "Name of the website"
  type        = string
}

variable "website_file_path" {
  description = "Path to the website files"
  type        = string
}


# Data sources
data "aws_caller_identity" "current" {}
data "aws_region" "current" {}


# KMS Key for encryption
resource "aws_kms_key" "website_key" {
  description             = "KMS key for \${var.website_name} website encryption"
  deletion_window_in_days = 7
  enable_key_rotation     = true

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Sid    = "Enable IAM User Permissions"
        Effect = "Allow"
        Principal = {
          AWS = "arn:aws:iam::\${data.aws_caller_identity.current.account_id}:root"
        }
        Action   = "kms:*"
        Resource = "*"
      },
      {
        Sid    = "Allow S3 Service"
        Effect = "Allow"
        Principal = {
          Service = "s3.amazonaws.com"
        }
        Action = [
          "kms:Decrypt",
          "kms:GenerateDataKey"
        ]
        Resource = "*"
      },
      {
        Sid    = "AllowCloudFrontServicePrincipalSSE-KMS"
        Effect = "Allow"
        Principal = {
          Service = "cloudfront.amazonaws.com"
        }
        Action = [
          "kms:Decrypt",
          "kms:Encrypt",
          "kms:GenerateDataKey*"
        ]
        Resource = "*"
        Condition = {
          StringEquals = {
            "AWS:SourceArn" = aws_cloudfront_distribution.website.arn
          }
        }
      }
    ]
  })

  tags = {
    Name = "\${lower(var.website_name)}-website-key-\${random_id.unique_suffix.hex}"
  }
}

resource "aws_kms_alias" "website_key_alias" {
  name          = "alias/\${lower(var.website_name)}-website-key-\${random_id.unique_suffix.hex}"
  target_key_id = aws_kms_key.website_key.key_id
}

# Access Logs Bucket
resource "aws_s3_bucket" "access_logs" {
  #checkov:skip=CKV2_AWS_61:Lifecycle configuration not required for access logs bucket
  #checkov:skip=CKV_AWS_144:Cross-region replication not required for access logs
  #checkov:skip=CKV2_AWS_62:Event notifications not required for access logs bucket
  #checkov:skip=CKV_AWS_21:Versioning disabled for access logs to reduce storage costs
  bucket        = "\${lower(var.website_name)}-access-logs-\${random_id.bucket_suffix.hex}"
  force_destroy = true

  tags = {
    Name = "\${lower(var.website_name)}-access-logs"
  }
}

resource "random_id" "unique_suffix" {
  byte_length = 4
}

resource "random_id" "bucket_suffix" {
  byte_length = 8
}

resource "aws_s3_bucket_versioning" "access_logs_versioning" {
  bucket = aws_s3_bucket.access_logs.id
  versioning_configuration {
    status = "Disabled"
  }
}

resource "aws_s3_bucket_server_side_encryption_configuration" "access_logs_encryption" {
  bucket = aws_s3_bucket.access_logs.id

  rule {
    apply_server_side_encryption_by_default {
      kms_master_key_id = aws_kms_key.website_key.arn
      sse_algorithm     = "aws:kms"
    }
  }
}

resource "aws_s3_bucket_public_access_block" "access_logs_pab" {
  bucket = aws_s3_bucket.access_logs.id

  block_public_acls       = true
  block_public_policy     = true
  ignore_public_acls      = true
  restrict_public_buckets = true
}

resource "aws_s3_bucket_policy" "access_logs_ssl_policy" {
  bucket = aws_s3_bucket.access_logs.id

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Sid       = "DenyInsecureConnections"
        Effect    = "Deny"
        Principal = "*"
        Action    = "s3:*"
        Resource = [
          aws_s3_bucket.access_logs.arn,
          "\${aws_s3_bucket.access_logs.arn}/*"
        ]
        Condition = {
          Bool = {
            "aws:SecureTransport" = "false"
          }
        }
      }
    ]
  })
}

# Website Bucket
resource "aws_s3_bucket" "website" {
  #checkov:skip=CKV2_AWS_61:Lifecycle configuration not required for static website content
  #checkov:skip=CKV_AWS_144:Cross-region replication not required for static website
  #checkov:skip=CKV2_AWS_62:Event notifications not required for static website bucket
  bucket        = "\${lower(var.website_name)}-website-\${random_id.bucket_suffix.hex}"
  force_destroy = true

  tags = {
    Name = "\${lower(var.website_name)}-website"
  }
}

resource "aws_s3_bucket_versioning" "website_versioning" {
  bucket = aws_s3_bucket.website.id
  versioning_configuration {
    status = "Enabled"
  }
}

resource "aws_s3_bucket_server_side_encryption_configuration" "website_encryption" {
  bucket = aws_s3_bucket.website.id

  rule {
    apply_server_side_encryption_by_default {
      kms_master_key_id = aws_kms_key.website_key.arn
      sse_algorithm     = "aws:kms"
    }
  }
}

resource "aws_s3_bucket_public_access_block" "website_pab" {
  bucket = aws_s3_bucket.website.id

  block_public_acls       = true
  block_public_policy     = true
  ignore_public_acls      = true
  restrict_public_buckets = true
}

resource "aws_s3_bucket_ownership_controls" "website_ownership" {
  bucket = aws_s3_bucket.website.id

  rule {
    object_ownership = "BucketOwnerEnforced"
  }
}

resource "aws_s3_bucket_logging" "website_logging" {
  bucket = aws_s3_bucket.website.id

  target_bucket = aws_s3_bucket.access_logs.id
  target_prefix = "website-access-logs/"
}


# Distribution Log Bucket
resource "aws_s3_bucket" "distribution_logs" {
  #checkov:skip=CKV2_AWS_61:Lifecycle configuration not required for CloudFront logs
  #checkov:skip=CKV_AWS_144:Cross-region replication not required for CloudFront logs
  #checkov:skip=CKV2_AWS_62:Event notifications not required for CloudFront logs bucket
  #checkov:skip=CKV_AWS_21:Versioning not required for CloudFront access logs
  bucket        = "\${lower(var.website_name)}-distribution-logs-\${random_id.bucket_suffix.hex}"
  force_destroy = true

  tags = {
    Name = "\${lower(var.website_name)}-distribution-logs"
  }
}

resource "aws_s3_bucket_server_side_encryption_configuration" "distribution_logs_encryption" {
  bucket = aws_s3_bucket.distribution_logs.id

  rule {
    apply_server_side_encryption_by_default {
      kms_master_key_id = aws_kms_key.website_key.arn
      sse_algorithm     = "aws:kms"
    }
  }
}

resource "aws_s3_bucket_public_access_block" "distribution_logs_pab" {
  bucket = aws_s3_bucket.distribution_logs.id

  block_public_acls       = true
  block_public_policy     = true
  ignore_public_acls      = true
  restrict_public_buckets = true
}

resource "aws_s3_bucket_ownership_controls" "distribution_logs_ownership" {
  #checkov:skip=CKV2_AWS_65:BucketOwnerPreferred required for CloudFront logging compatibility
  bucket = aws_s3_bucket.distribution_logs.id

  rule {
    object_ownership = "BucketOwnerPreferred"
  }
}


resource "aws_s3_bucket_logging" "distribution_logs_logging" {
  bucket = aws_s3_bucket.distribution_logs.id

  target_bucket = aws_s3_bucket.access_logs.id
  target_prefix = "distribution-access-logs/"
}

resource "aws_s3_bucket_policy" "distribution_logs_ssl_policy" {
  bucket = aws_s3_bucket.distribution_logs.id

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Sid       = "DenyInsecureConnections"
        Effect    = "Deny"
        Principal = "*"
        Action    = "s3:*"
        Resource = [
          aws_s3_bucket.distribution_logs.arn,
          "\${aws_s3_bucket.distribution_logs.arn}/*"
        ]
        Condition = {
          Bool = {
            "aws:SecureTransport" = "false"
          }
        }
      }
    ]
  })
}

# WAF Web ACL (must be in us-east-1 for CloudFront)
resource "aws_wafv2_web_acl" "cloudfront_waf" {
  #checkov:skip=CKV2_AWS_31:WAF logging disabled
  provider = aws.us_east_1
  name     = "\${lower(var.website_name)}-cloudfront-waf-\${random_id.unique_suffix.hex}"
  scope    = "CLOUDFRONT"

  default_action {
    allow {}
  }

  rule {
    name     = "CRSRule"
    priority = 0

    override_action {
      none {}
    }

    statement {
      managed_rule_group_statement {
        name        = "AWSManagedRulesCommonRuleSet"
        vendor_name = "AWS"
      }
    }

    visibility_config {
      cloudwatch_metrics_enabled = true
      metric_name                 = "MetricForWebACLCDK-CRS"
      sampled_requests_enabled    = true
    }
  }

  rule {
    name     = "KnownBadInputsRule"
    priority = 1

    override_action {
      none {}
    }

    statement {
      managed_rule_group_statement {
        name        = "AWSManagedRulesKnownBadInputsRuleSet"
        vendor_name = "AWS"
      }
    }

    visibility_config {
      cloudwatch_metrics_enabled = true
      metric_name                 = "MetricForWebACLCDK-KnownBadInputs"
      sampled_requests_enabled    = true
    }
  }

  visibility_config {
    cloudwatch_metrics_enabled = true
    metric_name                 = "\${lower(var.website_name)}-waf"
    sampled_requests_enabled    = true
  }

  tags = {
    Name = "\${lower(var.website_name)}-cloudfront-waf-\${random_id.unique_suffix.hex}"
  }

  lifecycle {
    create_before_destroy = true
  }
}


# Origin Access Control
resource "aws_cloudfront_origin_access_control" "website_oac" {
  name                              = "\${lower(var.website_name)}-oac-\${random_id.unique_suffix.hex}"
  description                       = "Origin Access Control for \${lower(var.website_name)}"
  origin_access_control_origin_type = "s3"
  signing_behavior                  = "always"
  signing_protocol                  = "sigv4"
}

# CloudFront Distribution
resource "aws_cloudfront_distribution" "website" {
  #checkov:skip=CKV_AWS_174:Using CloudFront default certificate which does not support TLS v1.2
  #checkov:skip=CKV_AWS_310:Origin failover not required for single S3 origin static website
  #checkov:skip=CKV_AWS_374:Geo restrictions not required for global web application
  #checkov:skip=CKV2_AWS_42:Custom SSL certificate not required for development - using CloudFront default
  #checkov:skip=CKV2_AWS_32:Response headers policy not required for basic static website
  #checkov:skip=CKV2_AWS_47:WAF includes AWSManagedRulesKnownBadInputsRuleSet which provides Log4j protection
  origin {
    domain_name              = aws_s3_bucket.website.bucket_regional_domain_name
    origin_access_control_id = aws_cloudfront_origin_access_control.website_oac.id
    origin_id                = "S3-\${aws_s3_bucket.website.bucket}"
  }

  enabled             = true
  is_ipv6_enabled     = true
  default_root_object = "index.html"
  web_acl_id          = aws_wafv2_web_acl.cloudfront_waf.arn

  logging_config {
    include_cookies = false
    bucket          = aws_s3_bucket.distribution_logs.bucket_regional_domain_name
  }

  default_cache_behavior {
    allowed_methods  = ["DELETE", "GET", "HEAD", "OPTIONS", "PATCH", "POST", "PUT"]
    cached_methods   = ["GET", "HEAD"]
    target_origin_id = "S3-\${aws_s3_bucket.website.bucket}"

    forwarded_values {
      query_string = false
      cookies {
        forward = "none"
      }
    }

    viewer_protocol_policy = "redirect-to-https"
    min_ttl                = 0
    default_ttl            = 3600
    max_ttl                = 86400
    compress               = true
  }

  # Custom error responses for SPA routing
  custom_error_response {
    error_code         = 404
    response_code      = 200
    response_page_path = "/index.html"
  }

  custom_error_response {
    error_code         = 403
    response_code      = 200
    response_page_path = "/index.html"
  }

  restrictions {
    geo_restriction {
      restriction_type = "none"
    }
  }

  viewer_certificate {
    cloudfront_default_certificate = true
  }

  tags = {
    Name = "\${lower(var.website_name)}-distribution-\${random_id.unique_suffix.hex}"
  }

  lifecycle {
    replace_triggered_by = [
      aws_wafv2_web_acl.cloudfront_waf
    ]
  }
}

# S3 Bucket Policy for CloudFront OAC
resource "aws_s3_bucket_policy" "website_cloudfront_policy" {
  bucket = aws_s3_bucket.website.id

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Sid       = "AllowCloudFrontServicePrincipal"
        Effect    = "Allow"
        Principal = {
          Service = "cloudfront.amazonaws.com"
        }
        Action   = "s3:GetObject"
        Resource = "\${aws_s3_bucket.website.arn}/*"
        Condition = {
          StringEquals = {
            "AWS:SourceArn" = aws_cloudfront_distribution.website.arn
          }
        }
      },
      {
        Sid       = "DenyInsecureConnections"
        Effect    = "Deny"
        Principal = "*"
        Action    = "s3:*"
        Resource = [
          aws_s3_bucket.website.arn,
          "\${aws_s3_bucket.website.arn}/*"
        ]
        Condition = {
          Bool = {
            "aws:SecureTransport" = "false"
          }
        }
      }
    ]
  })

  depends_on = [aws_cloudfront_distribution.website]
}

# Read runtime config using the reader module
module "runtime_config_reader" {
  source = "../runtime-config/read"
}

# Upload website files to S3
resource "null_resource" "upload_website_files" {
  triggers = {
    # Trigger on any change to the website directory
    website_path = var.website_file_path
    # Trigger if any file in the directory changes using directory hash
    directory_hash = sha256(join("", [for f in fileset(var.website_file_path, "**") : filesha256("\${var.website_file_path}/\${f}")]))
  }

  provisioner "local-exec" {
    command = <<-EOT
      cd "\${path.root}"
      uv run --with boto3 python3 -c "
import os
import sys
import boto3
import mimetypes
from pathlib import Path
from botocore.exceptions import ClientError, NoCredentialsError

def sync_to_s3(local_path, bucket_name):
    try:
        s3_client = boto3.client('s3')

        # Check if local directory exists
        if not os.path.isdir(local_path):
            print(f'Error: Website directory not found at {local_path}')
            sys.exit(1)

        # Get existing objects in bucket (for deletion)
        try:
            existing_objects = set()
            paginator = s3_client.get_paginator('list_objects_v2')
            for page in paginator.paginate(Bucket=bucket_name):
                if 'Contents' in page:
                    for obj in page['Contents']:
                        existing_objects.add(obj['Key'])
        except ClientError as e:
            if e.response['Error']['Code'] != 'NoSuchBucket':
                raise
            existing_objects = set()

        # Upload files
        uploaded_objects = set()
        local_path_obj = Path(local_path)

        for file_path in local_path_obj.rglob('*'):
            if file_path.is_file():
                # Skip runtime-config.json as it's handled separately
                if file_path.name == 'runtime-config.json':
                    continue

                # Calculate S3 key (relative path from local_path)
                relative_path = file_path.relative_to(local_path_obj)
                s3_key = str(relative_path).replace('\\\\\\\\', '/')
                uploaded_objects.add(s3_key)

                # Determine content type
                content_type, _ = mimetypes.guess_type(str(file_path))
                if content_type is None:
                    content_type = 'binary/octet-stream'

                # Upload file
                try:
                    s3_client.upload_file(
                        str(file_path),
                        bucket_name,
                        s3_key,
                        ExtraArgs={'ContentType': content_type}
                    )
                    print(f'Uploaded: {s3_key}')
                except ClientError as e:
                    print(f'Error uploading {s3_key}: {e}')
                    sys.exit(1)

        # Delete objects that no longer exist locally (excluding runtime-config.json)
        objects_to_delete = existing_objects - uploaded_objects - {'runtime-config.json'}
        if objects_to_delete:
            delete_objects = [{'Key': key} for key in objects_to_delete]
            try:
                s3_client.delete_objects(
                    Bucket=bucket_name,
                    Delete={'Objects': delete_objects}
                )
                for obj in delete_objects:
                    print(f'Deleted: {obj[\\"Key\\"]}')
            except ClientError as e:
                print(f'Error deleting objects: {e}')
                sys.exit(1)

        print(f'Website files synced to s3://{bucket_name}/')

    except NoCredentialsError:
        print('Error: AWS credentials not found')
        sys.exit(1)
    except Exception as e:
        print(f'Error: {e}')
        sys.exit(1)

# Execute sync
sync_to_s3('\${var.website_file_path}', '\${aws_s3_bucket.website.bucket}')
"
    EOT
  }

  depends_on = [aws_s3_bucket_policy.website_cloudfront_policy]
}

# Upload runtime config file
resource "aws_s3_object" "runtime_config" {
  bucket       = aws_s3_bucket.website.id
  key          = "runtime-config.json"
  content      = module.runtime_config_reader.config_json
  content_type = "application/json"
  etag         = md5(module.runtime_config_reader.config_json)

  depends_on = [null_resource.upload_website_files]
}

# Invalidate CloudFront cache after uploads
resource "null_resource" "cloudfront_invalidation" {
  triggers = {
    # Trigger when files or runtime config change
    files_trigger = null_resource.upload_website_files.id
    config_trigger = aws_s3_object.runtime_config.etag
  }

  provisioner "local-exec" {
    command = <<-EOT
      uv run --with boto3 python3 -c "
import boto3
import sys
from botocore.exceptions import ClientError, NoCredentialsError

def create_invalidation(distribution_id):
    try:
        cloudfront_client = boto3.client('cloudfront')

        # Create invalidation for all paths
        response = cloudfront_client.create_invalidation(
            DistributionId=distribution_id,
            InvalidationBatch={
                'Paths': {
                    'Quantity': 1,
                    'Items': ['/*']
                },
                'CallerReference': f'terraform-invalidation-{distribution_id}-{hash(distribution_id) % 1000000}'
            }
        )

        invalidation_id = response['Invalidation']['Id']
        print(f'CloudFront cache invalidation created: {invalidation_id}')
        print(f'Distribution: \${aws_cloudfront_distribution.website.id}')
        print(f'Status: {response[\\"Invalidation\\"][\\"Status\\"]}')

    except NoCredentialsError:
        print('Error: AWS credentials not found')
        sys.exit(1)
    except ClientError as e:
        print(f'Error creating CloudFront invalidation: {e}')
        sys.exit(1)
    except Exception as e:
        print(f'Error: {e}')
        sys.exit(1)

# Execute invalidation
create_invalidation('\${aws_cloudfront_distribution.website.id}')
"
    EOT
  }

  depends_on = [
    null_resource.upload_website_files,
    aws_s3_object.runtime_config
  ]
}

# Outputs
output "website_bucket_name" {
  description = "Name of the S3 bucket hosting the website"
  value       = aws_s3_bucket.website.bucket
}

output "website_bucket_arn" {
  description = "ARN of the S3 bucket hosting the website"
  value       = aws_s3_bucket.website.arn
}

output "cloudfront_distribution_id" {
  description = "ID of the CloudFront distribution"
  value       = aws_cloudfront_distribution.website.id
}

output "cloudfront_distribution_arn" {
  description = "ARN of the CloudFront distribution"
  value       = aws_cloudfront_distribution.website.arn
}

output "cloudfront_domain_name" {
  description = "Domain name of the CloudFront distribution"
  value       = aws_cloudfront_distribution.website.domain_name
}

output "waf_web_acl_arn" {
  description = "ARN of the WAF Web ACL"
  value       = aws_wafv2_web_acl.cloudfront_waf.arn
}",
  "test-app.tf": "terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 6.0"
      configuration_aliases = [aws.us_east_1]
    }
  }
}

# Static website module configured for the web package
module "static_website" {
  source = "../../../core/static-website"

  website_name      = "test-app"
  website_file_path = "\${path.module}/../../../../../../../dist/test-app/bundle"

  providers = {
    aws.us_east_1 = aws.us_east_1
  }
}

# Outputs
output "website_url" {
  description = "URL of the deployed website"
  value       = "https://\${module.static_website.cloudfront_domain_name}"
}

output "website_bucket_name" {
  description = "Name of the S3 bucket hosting the website"
  value       = module.static_website.website_bucket_name
}

output "cloudfront_distribution_id" {
  description = "ID of the CloudFront distribution"
  value       = module.static_website.cloudfront_distribution_id
}

output "cloudfront_domain_name" {
  description = "Domain name of the CloudFront distribution"
  value       = module.static_website.cloudfront_domain_name
}",
}
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > .gitignore 1`] = `
"vite.config.*.timestamp*
vitest.config.*.timestamp*

runtime-config.json"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > .prettierignore 1`] = `
"# Add files here to ignore them from prettier formatting
/dist
/coverage
/.nx/cache
/.nx/workspace-data"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > .prettierrc 1`] = `
"{ "singleQuote": true }
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > eslint.config.mjs 1`] = `
"import eslintPluginPrettierRecommended from 'eslint-plugin-prettier/recommended';
import nx from '@nx/eslint-plugin';

export default [
  eslintPluginPrettierRecommended,
  ...nx.configs['flat/base'],
  ...nx.configs['flat/typescript'],
  ...nx.configs['flat/javascript'],
  {
    ignores: [
      '**/dist',
      '**/vite.config.*.timestamp*',
      '**/vitest.config.*.timestamp*',
      '**/vite.config.ts.timestamp*',
    ],
  },
  {
    files: ['**/*.ts', '**/*.tsx', '**/*.js', '**/*.jsx'],
    rules: {
      '@nx/enforce-module-boundaries': [
        'error',
        {
          enforceBuildableLibDependency: true,
          allow: ['^.*/eslint(\\\\.base)?\\\\.config\\\\.[cm]?[jt]s$'],
          depConstraints: [
            {
              sourceTag: '*',
              onlyDependOnLibsWithTags: ['*'],
            },
          ],
        },
      ],
    },
  },
  {
    files: [
      '**/*.ts',
      '**/*.tsx',
      '**/*.cts',
      '**/*.mts',
      '**/*.js',
      '**/*.jsx',
      '**/*.cjs',
      '**/*.mjs',
    ],
    rules: {},
  },
];
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > nx.json 1`] = `
"{
  "affected": {
    "defaultBase": "main"
  },
  "targetDefaults": {
    "build": {
      "cache": true,
      "dependsOn": ["^build"],
      "inputs": ["default"]
    },
    "lint": {
      "cache": true,
      "configurations": {
        "fix": {
          "fix": true
        }
      },
      "inputs": [
        "default",
        "{workspaceRoot}/eslint.config.mjs",
        "{projectRoot}/eslint.config.mjs"
      ]
    },
    "@nx/eslint:lint": {
      "cache": true,
      "inputs": [
        "default",
        "{workspaceRoot}/.eslintrc.json",
        "{workspaceRoot}/.eslintignore",
        "{workspaceRoot}/eslint.config.mjs"
      ]
    },
    "@nx/vite:test": {
      "cache": true,
      "inputs": ["default", "^default"],
      "configurations": {
        "update-snapshot": {
          "args": "--update"
        }
      }
    },
    "@nx/vite:build": {
      "cache": true,
      "dependsOn": ["^build"],
      "inputs": ["default", "^default"]
    },
    "compile": {
      "cache": true,
      "inputs": ["default"]
    },
    "test": {
      "inputs": ["default"]
    }
  },
  "generators": {
    "@nx/react": {
      "application": {
        "babel": true,
        "style": "css",
        "linter": "eslint",
        "bundler": "vite"
      },
      "component": {
        "style": "css"
      },
      "library": {
        "style": "css",
        "linter": "eslint"
      }
    }
  },
  "plugins": [
    {
      "plugin": "@nx/js/typescript",
      "options": {
        "typecheck": {
          "targetName": "typecheck"
        },
        "build": {
          "targetName": "compile",
          "configName": "tsconfig.lib.json",
          "buildDepsName": "build-deps",
          "watchDepsName": "watch-deps"
        }
      }
    },
    {
      "plugin": "@nx/eslint/plugin",
      "options": {
        "targetName": "lint"
      }
    }
  ],
  "namedInputs": {
    "default": [
      {
        "dependentTasksOutputFiles": "**/*",
        "transitive": true
      }
    ]
  }
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > package.json 1`] = `
"{
  "name": "@proj/source",
  "dependencies": {
    "@cloudscape-design/board-components": "3.0.119",
    "@cloudscape-design/components": "3.0.1097",
    "@cloudscape-design/global-styles": "1.0.45",
    "aws-cdk-lib": "2.217.0",
    "constructs": "10.4.2",
    "react": "19.0.0",
    "react-dom": "19.0.0",
    "tailwindcss": "4.1.13"
  },
  "devDependencies": {
    "@eslint/js": "^9.8.0",
    "@nx/eslint": "21.5.3",
    "@nx/eslint-plugin": "21.5.3",
    "@nx/js": "21.5.3",
    "@nx/react": "21.5.3",
    "@nx/vite": "21.5.3",
    "@nx/web": "21.5.3",
    "@swc-node/register": "~1.9.1",
    "@swc/cli": "~0.6.0",
    "@swc/core": "~1.5.7",
    "@swc/helpers": "~0.5.11",
    "@tailwindcss/vite": "4.1.13",
    "@testing-library/dom": "10.4.0",
    "@testing-library/react": "16.1.0",
    "@types/node": "22.18.6",
    "@types/react": "19.0.0",
    "@types/react-dom": "19.0.0",
    "@vitejs/plugin-react": "^4.2.0",
    "@vitest/coverage-v8": "^3.0.5",
    "@vitest/ui": "^3.0.0",
    "eslint": "^9.8.0",
    "eslint-config-prettier": "^10.0.0",
    "eslint-plugin-import": "2.31.0",
    "eslint-plugin-jsx-a11y": "6.10.1",
    "eslint-plugin-prettier": "5.5.4",
    "eslint-plugin-react": "7.35.0",
    "eslint-plugin-react-hooks": "5.0.0",
    "jiti": "2.4.2",
    "jsdom": "~22.1.0",
    "jsonc-eslint-parser": "2.4.1",
    "prettier": "3.6.2",
    "typescript": "~5.9.2",
    "typescript-eslint": "^8.40.0",
    "vite": "^7.0.0",
    "vite-tsconfig-paths": "5.1.4",
    "vitest": "^3.0.0"
  },
  "type": "module"
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > packages/common/constructs/README.md 1`] = `
"# @proj/common-constructs

This library was generated with [@aws/nx-plugin](https://github.com/awslabs/nx-plugin-for-aws/).

## Building

Run \`npx nx build @proj/common-constructs [--skip-nx-cache]\` to build the application.

## Running unit tests

Run \`npx nx test @proj/common-constructs\` to execute the unit tests via Vitest.

### Updating snapshots

To update snapshots, run the following command:

\`npx nx test @proj/common-constructs --configuration=update-snapshot\`

## Run lint

Run \`npx nx lint @proj/common-constructs\`

### Fixable issues

You can also automatiaclly fix some lint errors by running the following command:

\`npx nx lint @proj/common-constructs --configuration=fix\`

## Useful links

- [common-constructs reference docs](TODO)
- [Learn more about NX](https://nx.dev/getting-started/intro)
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > packages/common/constructs/eslint.config.mjs 1`] = `
"import baseConfig from '../../../eslint.config.mjs';

export default [
  ...baseConfig,
  {
    files: ['**/*.json'],
    rules: {
      '@nx/dependency-checks': [
        'warn',
        {
          ignoredFiles: [
            '{projectRoot}/eslint.config.{js,cjs,mjs,ts,cts,mts}',
            '{projectRoot}/vite.config.{js,ts,mjs,mts}',
          ],
        },
      ],
    },
    languageOptions: {
      parser: await import('jsonc-eslint-parser'),
    },
  },
  {
    ignores: ['**/out-tsc'],
  },
];
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > packages/common/constructs/project.json 1`] = `
"{
  "name": "@proj/common-constructs",
  "$schema": "../../../node_modules/nx/schemas/project-schema.json",
  "sourceRoot": "packages/common/constructs/src",
  "projectType": "library",
  "tags": [],
  "targets": {
    "build": {
      "dependsOn": ["lint", "compile", "test", "@proj/test-app:build"]
    },
    "compile": {
      "executor": "nx:run-commands",
      "outputs": ["{workspaceRoot}/dist/packages/common/constructs/tsc"],
      "options": {
        "command": "tsc --build tsconfig.lib.json",
        "cwd": "{projectRoot}"
      }
    },
    "test": {
      "executor": "@nx/vite:test",
      "outputs": ["{options.reportsDirectory}"],
      "options": {
        "reportsDirectory": "../../../coverage/packages/common/constructs"
      }
    }
  },
  "metadata": {
    "generator": "ts#project"
  }
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > packages/common/constructs/src/app/index.ts 1`] = `
"export * from './static-websites/index.js';
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > packages/common/constructs/src/app/static-websites/index.ts 1`] = `
"export * from './test-app.js';
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > packages/common/constructs/src/app/static-websites/test-app.ts 1`] = `
"import * as url from 'url';
import { Construct } from 'constructs';
import { StaticWebsite } from '../../core/index.js';

export class TestApp extends StaticWebsite {
  constructor(scope: Construct, id: string) {
    super(scope, id, {
      websiteName: 'TestApp',
      websiteFilePath: url.fileURLToPath(
        new URL('../../../../../../dist/test-app/bundle', import.meta.url),
      ),
    });
  }
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > packages/common/constructs/src/core/app.ts 1`] = `
"import { App as _App, AppProps, Aspects, IAspect, Stack } from 'aws-cdk-lib';
import { IConstruct } from 'constructs';

export class App extends _App {
  constructor(props?: AppProps) {
    super(props);

    Aspects.of(this).add(new MetricsAspect());
  }
}

/**
 * Adds information to CloudFormation stack descriptions to provide usage metrics for @aws/nx-plugin
 */
class MetricsAspect implements IAspect {
  visit(node: IConstruct): void {
    if (node instanceof Stack) {
      const id = 'uksb-4wk0bqpg5s';
      const version = '0.0.0';
      const tags: string[] = ['g5'];
      node.templateOptions.description =
        \`\${node.templateOptions.description ?? ''} (\${id}) (version:\${version}) (tag:\${tags.join(',')})\`.trim();
    }
  }
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > packages/common/constructs/src/core/checkov.ts 1`] = `
"import { IConstruct } from 'constructs';
import { CfnResource } from 'aws-cdk-lib';

/**
 * Suppresses a set of rules for a construct tree.
 *
 * @param construct The root construct to suppress the rule for.
 * @param ids The ids of the rules to suppress.
 * @param comment The reason for suppressing the rule
 * @param predicate A predicate function that determines whether the rule should be suppressed for the given construct or any of its descendants.
 *
 * @example
 * The following example suppresses the CKV_AWS_XXX rule for the given construct.
 * suppressRules(construct, ['CKV_AWS_XXX'], 'Not required for this use case')
 *
 * @example
 * The following example suppresses the CKV_AWS_XXX rule for the construct or any of its descendants if it is an instance of Bucket:
 * suppressRules(construct, ['CKV_AWS_XXX'], 'Not required for this use case', (construct) => construct instanceof Bucket)
 */
export const suppressRules = (
  construct: IConstruct,
  ids: string[],
  comment: string,
  predicate?: (construct: IConstruct) => boolean,
) => {
  const resources = (
    predicate ? construct.node.findAll().filter(predicate) : [construct]
  )
    .map((resource) => {
      if (CfnResource.isCfnResource(resource)) {
        return resource;
      } else return resource.node.defaultChild;
    })
    .filter((resource) => CfnResource.isCfnResource(resource));

  resources.forEach((resource) => {
    const metadata = resource.getMetadata('checkov') || {};
    metadata['skip'] = [
      ...(metadata['skip'] ?? []),
      ...ids.map((id) => ({ id, comment })),
    ];
    resource.addMetadata('checkov', metadata);
  });
};
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > packages/common/constructs/src/core/index.ts 1`] = `
"export * from './static-website.js';
export * from './app.js';
export * from './checkov.js';
export * from './runtime-config.js';
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > packages/common/constructs/src/core/runtime-config.ts 1`] = `
"import { Stack, Stage } from 'aws-cdk-lib';
import { Construct } from 'constructs';

const RuntimeConfigKey = '__RuntimeConfig__';

export class RuntimeConfig extends Construct {
  private readonly _runtimeConfig: any = {};

  static ensure(scope: Construct): RuntimeConfig {
    const parent = Stage.of(scope) ?? Stack.of(scope);
    return (
      RuntimeConfig.of(scope) ?? new RuntimeConfig(parent, RuntimeConfigKey)
    );
  }

  static of(scope: Construct): RuntimeConfig | undefined {
    const parent = Stage.of(scope) ?? Stack.of(scope);
    return parent.node.tryFindChild(RuntimeConfigKey) as
      | RuntimeConfig
      | undefined;
  }

  constructor(scope: Construct, id: string) {
    super(scope, id);
  }

  get config(): any {
    return this._runtimeConfig;
  }
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > packages/common/constructs/src/core/static-website.ts 1`] = `
"import { CfnOutput, CfnResource, RemovalPolicy, Stack } from 'aws-cdk-lib';
import { Distribution, ViewerProtocolPolicy } from 'aws-cdk-lib/aws-cloudfront';
import { S3BucketOrigin } from 'aws-cdk-lib/aws-cloudfront-origins';
import {
  BlockPublicAccess,
  Bucket,
  BucketEncryption,
  IBucket,
  ObjectOwnership,
} from 'aws-cdk-lib/aws-s3';
import { BucketDeployment, Source } from 'aws-cdk-lib/aws-s3-deployment';
import { Construct } from 'constructs';
import { RuntimeConfig } from './runtime-config.js';
import { Key } from 'aws-cdk-lib/aws-kms';
import { CfnWebACL } from 'aws-cdk-lib/aws-wafv2';
import { suppressRules } from './checkov.js';

const DEFAULT_RUNTIME_CONFIG_FILENAME = 'runtime-config.json';

export interface StaticWebsiteProps {
  readonly websiteName: string;
  readonly websiteFilePath: string;
}

/**
 * Deploys a Static Website using by default a private S3 bucket as an origin and Cloudfront as the entrypoint.
 *
 * This construct configures a webAcl containing rules that are generally applicable to web applications. This
 * provides protection against exploitation of a wide range of vulnerabilities, including some of the high risk
 * and commonly occurring vulnerabilities described in OWASP publications such as OWASP Top 10.
 *
 */
export class StaticWebsite extends Construct {
  public readonly websiteBucket: IBucket;
  public readonly cloudFrontDistribution: Distribution;
  public readonly bucketDeployment: BucketDeployment;

  constructor(
    scope: Construct,
    id: string,
    { websiteFilePath, websiteName }: StaticWebsiteProps,
  ) {
    super(scope, id);
    this.node.setContext(
      '@aws-cdk/aws-s3:serverAccessLogsUseBucketPolicy',
      true,
    );

    const websiteKey = new Key(this, 'WebsiteKey', {
      enableKeyRotation: true,
    });

    const accessLogsBucket = new Bucket(this, 'AccessLogsBucket', {
      versioned: false,
      enforceSSL: true,
      autoDeleteObjects: true,
      removalPolicy: RemovalPolicy.DESTROY,
      encryption: BucketEncryption.KMS,
      encryptionKey: websiteKey,
      objectOwnership: ObjectOwnership.OBJECT_WRITER,
      publicReadAccess: false,
      blockPublicAccess: BlockPublicAccess.BLOCK_ALL,
    });
    suppressRules(
      accessLogsBucket,
      ['CKV_AWS_21'],
      'Access log bucket does not need versioning enabled',
    );
    suppressRules(
      accessLogsBucket,
      ['CKV_AWS_18'],
      'Access log bucket does not need an access log bucket',
    );

    // S3 Bucket to hold website files
    this.websiteBucket = new Bucket(this, 'WebsiteBucket', {
      versioned: true,
      enforceSSL: true,
      autoDeleteObjects: true,
      removalPolicy: RemovalPolicy.DESTROY,
      encryption: BucketEncryption.KMS,
      encryptionKey: websiteKey,
      objectOwnership: ObjectOwnership.BUCKET_OWNER_ENFORCED,
      publicReadAccess: false,
      blockPublicAccess: BlockPublicAccess.BLOCK_ALL,
      serverAccessLogsPrefix: 'website-access-logs',
      serverAccessLogsBucket: accessLogsBucket,
    });
    // Web ACL
    const wafStack = new CloudfrontWebAcl(this, 'waf');

    // Cloudfront Distribution
    const logBucket = new Bucket(this, 'DistributionLogBucket', {
      enforceSSL: true,
      autoDeleteObjects: true,
      removalPolicy: RemovalPolicy.DESTROY,
      encryption: BucketEncryption.KMS,
      encryptionKey: websiteKey,
      objectOwnership: ObjectOwnership.BUCKET_OWNER_PREFERRED,
      publicReadAccess: false,
      blockPublicAccess: BlockPublicAccess.BLOCK_ALL,
      serverAccessLogsPrefix: 'distribution-access-logs',
      serverAccessLogsBucket: accessLogsBucket,
    });
    suppressRules(
      logBucket,
      ['CKV_AWS_21'],
      'Distribution log bucket does not need versioning enabled',
    );

    const defaultRootObject = 'index.html';
    this.cloudFrontDistribution = new Distribution(
      this,
      'CloudfrontDistribution',
      {
        webAclId: wafStack.wafArn,
        enableLogging: true,
        logBucket: logBucket,
        defaultBehavior: {
          origin: S3BucketOrigin.withOriginAccessControl(this.websiteBucket),
          viewerProtocolPolicy: ViewerProtocolPolicy.REDIRECT_TO_HTTPS,
        },
        defaultRootObject,
        errorResponses: [
          {
            httpStatus: 404, // We need to redirect "key not found errors" to index.html for single page apps
            responseHttpStatus: 200,
            responsePagePath: \`/\${defaultRootObject}\`,
          },
          {
            httpStatus: 403, // We need to redirect reloads from paths (e.g. /foo/bar) to index.html for single page apps
            responseHttpStatus: 200,
            responsePagePath: \`/\${defaultRootObject}\`,
          },
        ],
      },
    );
    suppressRules(
      this.cloudFrontDistribution,
      ['CKV_AWS_174'],
      'Cloudfront default certificate does not use TLS 1.2',
    );

    // Deploy Website
    this.bucketDeployment = new BucketDeployment(this, 'WebsiteDeployment', {
      sources: [
        Source.asset(websiteFilePath),
        Source.jsonData(
          DEFAULT_RUNTIME_CONFIG_FILENAME,
          RuntimeConfig.ensure(this).config,
        ),
      ],
      destinationBucket: this.websiteBucket,
      // Files in the distribution's edge caches will be invalidated after files are uploaded to the destination bucket.
      distribution: this.cloudFrontDistribution,
      memoryLimit: 1024,
    });

    suppressRules(
      Stack.of(this),
      ['CKV_AWS_111'],
      'CDK Bucket Deployment uses wildcard to deploy arbitrary assets',
      (c) =>
        CfnResource.isCfnResource(c) &&
        c.cfnResourceType === 'AWS::IAM::Policy' &&
        c.node.path.includes(\`/Custom::CDKBucketDeployment\`),
    );

    new CfnOutput(this, 'DistributionDomainName', {
      value: this.cloudFrontDistribution.domainName,
    });
    new CfnOutput(this, \`\${websiteName}WebsiteBucketName\`, {
      value: this.websiteBucket.bucketName,
    });
  }
}

export class CloudfrontWebAcl extends Stack {
  public readonly wafArn;
  constructor(scope: Construct, id: string) {
    super(scope, id, {
      env: {
        region: 'us-east-1',
        account: Stack.of(scope).account,
      },
      crossRegionReferences: true,
    });

    this.wafArn = new CfnWebACL(this, 'WebAcl', {
      defaultAction: { allow: {} },
      scope: 'CLOUDFRONT',
      visibilityConfig: {
        cloudWatchMetricsEnabled: true,
        metricName: id,
        sampledRequestsEnabled: true,
      },
      rules: [
        {
          name: 'CRSRule',
          priority: 0,
          statement: {
            managedRuleGroupStatement: {
              name: 'AWSManagedRulesCommonRuleSet',
              vendorName: 'AWS',
            },
          },
          visibilityConfig: {
            cloudWatchMetricsEnabled: true,
            metricName: 'MetricForWebACLCDK-CRS',
            sampledRequestsEnabled: true,
          },
          overrideAction: {
            none: {},
          },
        },
        {
          name: 'KnownBadInputsRule',
          priority: 1,
          statement: {
            managedRuleGroupStatement: {
              name: 'AWSManagedRulesKnownBadInputsRuleSet',
              vendorName: 'AWS',
            },
          },
          visibilityConfig: {
            cloudWatchMetricsEnabled: true,
            metricName: 'MetricForWebACLCDK-CRS',
            sampledRequestsEnabled: true,
          },
          overrideAction: {
            none: {},
          },
        },
      ],
    }).attrArn;
  }
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > packages/common/constructs/src/index.ts 1`] = `
"export * from './app/index.js';
export * from './core/index.js';
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > packages/common/constructs/tsconfig.json 1`] = `
"{
  "extends": "../../../tsconfig.base.json",
  "files": [],
  "include": [],
  "references": [
    {
      "path": "./tsconfig.lib.json"
    },
    {
      "path": "./tsconfig.spec.json"
    }
  ],
  "compilerOptions": {}
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > packages/common/constructs/tsconfig.lib.json 1`] = `
"{
  "extends": "../../../tsconfig.base.json",
  "compilerOptions": {
    "rootDir": ".",
    "outDir": "../../../dist/packages/common/constructs/tsc",
    "tsBuildInfoFile": "../../../dist/packages/common/constructs/tsc/tsconfig.lib.tsbuildinfo",
    "emitDeclarationOnly": false,
    "module": "nodenext",
    "moduleResolution": "nodenext",
    "types": ["node"]
  },
  "include": ["src/**/*.ts"],
  "references": [],
  "exclude": [
    "vite.config.ts",
    "vite.config.mts",
    "vitest.config.ts",
    "vitest.config.mts",
    "src/**/*.test.ts",
    "src/**/*.spec.ts",
    "src/**/*.test.tsx",
    "src/**/*.spec.tsx",
    "src/**/*.test.js",
    "src/**/*.spec.js",
    "src/**/*.test.jsx",
    "src/**/*.spec.jsx"
  ]
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > packages/common/constructs/tsconfig.spec.json 1`] = `
"{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "outDir": "../../../dist/out-tsc",
    "types": [
      "vitest/globals",
      "vitest/importMeta",
      "vite/client",
      "node",
      "vitest"
    ],
    "module": "nodenext",
    "moduleResolution": "nodenext"
  },
  "include": [
    "vite.config.ts",
    "vite.config.mts",
    "vitest.config.ts",
    "vitest.config.mts",
    "src/**/*.test.ts",
    "src/**/*.spec.ts",
    "src/**/*.test.tsx",
    "src/**/*.spec.tsx",
    "src/**/*.test.js",
    "src/**/*.spec.js",
    "src/**/*.test.jsx",
    "src/**/*.spec.jsx",
    "src/**/*.d.ts"
  ],
  "references": [
    {
      "path": "./tsconfig.lib.json"
    }
  ]
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > packages/common/constructs/vite.config.ts 1`] = `
"import { defineConfig } from 'vite';
import { nxViteTsPaths } from '@nx/vite/plugins/nx-tsconfig-paths.plugin';
import { nxCopyAssetsPlugin } from '@nx/vite/plugins/nx-copy-assets.plugin';

export default defineConfig(() => ({
  root: __dirname,
  cacheDir: '../../../node_modules/.vite/packages/common/constructs',
  plugins: [nxViteTsPaths(), nxCopyAssetsPlugin(['*.md'])],
  // Uncomment this if you are using workers.
  // worker: {
  //  plugins: [ nxViteTsPaths() ],
  // },
  test: {
    name: '@proj/common-constructs',
    watch: false,
    globals: true,
    environment: 'jsdom',
    include: ['src/**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}'],
    reporters: ['default'],
    coverage: {
      reportsDirectory: '../../../coverage/packages/common/constructs',
      provider: 'v8' as const,
    },
    passWithNoTests: true,
  },
}));
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > pnpm-workspace.yaml 1`] = `
"packages:
  - 'packages/*'
  - 'test-app'
  - 'packages/common/*'
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > test-app/README.md 1`] = `
"# @proj/test-app

This library was generated with [@aws/nx-plugin](https://github.com/awslabs/nx-plugin-for-aws/).

## Building

Run \`npx nx build @proj/test-app [--skip-nx-cache]\` to build the application.

## Run dev server

Run \`npx nx serve @proj/test-app\`

## Running unit tests

Run \`npx nx test @proj/test-app\` to execute the unit tests via Vitest.

### Updating snapshots

To update snapshots, run the following command:

\`npx nx test @proj/test-app --configuration=update-snapshot\`

## Run lint

Run \`npx nx lint @proj/test-app\`

### Fixable issues

You can also automatically fix some lint errors by running the following command:

\`npx nx lint @proj/test-app --configuration=fix\`

### Runtime config

In order to integrate with cognito or trpc backends, you need to have a \`runtime-config.json\` file in your \`/public\` website directory. You can fetch this is follows:

\`npx nx run @proj/test-app:load:runtime-config\`

> [!IMPORTANT]
> Ensure you have AWS CLI and curl installed
> You have deployed your CDK infrastructure into the appropriate account
> You have assumed a role in the AWS account with sufficient permissions to call describe-stacks from cloudformation

## Useful links

- [React website reference docs](TODO)
- [Learn more about NX](https://nx.dev/getting-started/intro)
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > test-app/eslint.config.mjs 1`] = `
"import nx from '@nx/eslint-plugin';
import baseConfig from '../eslint.config.mjs';

export default [
  ...baseConfig,
  ...nx.configs['flat/react'],
  {
    files: ['**/*.ts', '**/*.tsx', '**/*.js', '**/*.jsx'],
    // Override or add rules here
    rules: {},
  },
];
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > test-app/index.html 1`] = `
"<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>TestApp</title>
    <base href="/" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="stylesheet" href="/src/styles.css" />
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > test-app/project.json 1`] = `
"{
  "name": "@proj/test-app",
  "$schema": "../node_modules/nx/schemas/project-schema.json",
  "sourceRoot": "test-app/src",
  "projectType": "application",
  "tags": [],
  "targets": {
    "build": {
      "dependsOn": ["lint", "compile", "bundle", "test"],
      "options": {
        "outputPath": "dist/test-app/bundle"
      }
    },
    "bundle": {
      "executor": "@nx/vite:build",
      "outputs": ["{options.outputPath}"],
      "defaultConfiguration": "production",
      "options": {
        "outputPath": "dist/test-app/bundle"
      },
      "configurations": {
        "development": {
          "mode": "development"
        },
        "production": {
          "mode": "production"
        }
      }
    },
    "compile": {
      "executor": "nx:run-commands",
      "outputs": ["{workspaceRoot}/dist/{projectRoot}/tsc"],
      "options": {
        "command": "tsc --build tsconfig.app.json",
        "cwd": "{projectRoot}"
      }
    },
    "lint": {
      "executor": "@nx/eslint:lint"
    },
    "load:runtime-config": {
      "executor": "nx:run-commands",
      "metadata": {
        "description": "Load runtime config from your deployed stack for dev purposes. You must set your AWS CLI credentials whilst calling 'pnpm exec nx run @proj/test-app:load:runtime-config'"
      },
      "options": {
        "command": "aws s3 cp s3://\`aws cloudformation describe-stacks --query \\"Stacks[?starts_with(StackName, 'proj-')][].Outputs[] | [?contains(OutputKey, 'TestAppWebsiteBucketName')].OutputValue\\" --output text\`/runtime-config.json './test-app/public/runtime-config.json'"
      }
    },
    "preview": {
      "dependsOn": ["build"],
      "executor": "@nx/vite:preview-server",
      "defaultConfiguration": "development",
      "options": {
        "buildTarget": "@proj/test-app:build"
      },
      "configurations": {
        "development": {
          "buildTarget": "@proj/test-app:build:development"
        },
        "production": {
          "buildTarget": "@proj/test-app:build:production"
        }
      }
    },
    "serve": {
      "executor": "@nx/vite:dev-server",
      "defaultConfiguration": "development",
      "options": {
        "buildTarget": "@proj/test-app:build"
      },
      "configurations": {
        "development": {
          "buildTarget": "@proj/test-app:build:development",
          "hmr": true
        },
        "production": {
          "buildTarget": "@proj/test-app:build:production",
          "hmr": false
        }
      }
    },
    "serve-local": {
      "executor": "@nx/vite:dev-server",
      "options": {
        "buildTarget": "@proj/test-app:build:development",
        "hmr": true,
        "mode": "serve-local"
      },
      "continuous": true
    },
    "serve-static": {
      "executor": "@nx/web:file-server",
      "dependsOn": ["build"],
      "options": {
        "buildTarget": "@proj/test-app:build",
        "spa": true
      }
    },
    "test": {
      "executor": "@nx/vite:test",
      "outputs": ["{options.reportsDirectory}"],
      "options": {
        "reportsDirectory": "../coverage/test-app"
      }
    }
  },
  "metadata": {
    "generator": "ts#react-website"
  }
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > test-app/public/favicon.ico 1`] = `
"    00     �%  6          �  �%       h  �6  (   0   \`           $                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  V/ V/ cV/ �V/ �V/ �V/ �V/ �W0 �Y1 '                                B# pH [�f ��i ��i ��i ��i ��i ��i a�j             �c �^ R�\\ ��Y ��U ��R �|N �xK uI &                                    V/ 
V/ �V/ �V/ �V/ �V/ �V/ �X1 �Y2 L                                d= 9_; �X ��l ��k ��k ��k ��k ��k �k H            �c 8�a �] ��Z ��W ��S �}P �zM �vI                                     V/ 
V/ �V/ �V/ �V/ �V/ �W0 �Y1 �Z3 L                            oD jA �\`; �_= ��c ��l ��k ��k ��k ��k ��k Þk     �j �f ��c ��\` ��] ��Y ��V ��R �}O C                                        V/ 
V/ �V/ �V/ �V/ �V/ �W0 �Z2 �[3 L                            oD [nD �iA �X7 �oI ��j ��k ��k ��k ��k ��k ��k ��m �k s�i ��f ��b ��_ ��[ ��W ��T �yL                                         V/ 
V/ �V/ �V/ �V/ �V/ �X1 �Z3 �\\4 M                        nD oE �qF �oE �f@ �X8 ��Z ��l ��k ��k ��k ��k ��k �k s�k ��k ��h ��d ��a ��] ��Y ˅W                                             V/ 
V/ �V/ �V/ �V/ �V/ �Y1 �[3 �\\4 P                    h= nD �pE �rG �sH �oF �a= �cA ��f ��k ��k ��k ��k ��k ��k ��k ��k ��j ��f ��b ��_ �\\ S                                                V/ 
V/ �V/ �V/ �V/ �W0 �Y2 �[4 �]5 Q                    mC 6oD �qF �sH �uJ �uJ �nF �]; �wO ��k ��k ��k ��k ��k ��k ��k ��k ��k ��h ��d ��\` ��\\                                         V/ 
V/ V/ 
V/ �V/ �V/ �V/ �W0 �Y2 �\\4 �]5 Q                kA 
mC �oD �qF �tH �vJ �xL �vK �kD �^= ��_ ��l ��k ��k ��k ��k ��k ��k ��k ��i ��e ؔb (                                        V/ 	V/ �V/ eV/ 
V/ �V/ �V/ �V/ �W0 �Z2 �\\4 �^6 Q                lA XmC �oE �rG �tI �wK �yM �zN �uK �eA �jF ��h ��k ��k ��k ��k ��k ��k ��k ��j ��g e                                            W0 V/ RV/ �V/ 
V/ �V/ �V/ �V/ �W0 �Z2 �\\4 �^6 Q            j@ kA �mC �pE �rG �uI �wK �yM �|O �{O �rJ �^= �|S ��k ��k ��k ��k ��k ��k ��k ��j ��h                                         �Z]5 iY1 �V/ GV/ 
V/ �V/ �V/ �V/ �X0 �Z2 �\\5 �^6 Q            i? kA �mC �pE �rG �uI �wK �zM �|O �}P �xN �eB �W: ��c ��k ��k ��k ��k ��k ��o���$W                                ��H��H��KHɦ9�f>�X1 �V/ �V/ 
V/ �V/ �V/ �V/ �X0 �Z2 �\\4 �^6 Q        g> 4i? �kA �mC �pE �rG �uI �wK �zM �|O �|P �vM �b@ �bA ��g ��k ��k ��k ��k ��k ��s	�ӵ]����                        ��H-��H���J���G���*�\`8�Y1 �V/ �V/ 
V/ �V/ �V/ �V/ �W0 �Z2 �\\4 �^6 Q    d; 	f= �h? �kA �mC �pE �rG �tI �wK �yM �{O �yN �mF �^> ��] ��l ��k ��k ��k ��k ��k ��l �ͫH��ڔ��ٛ�ؖ�ؖ�ؖ.�ؘr�֏���O�߾D���/��h�i@�]5 �Y1 �V/ �V/ 
V/ �V/ �V/ �V/ �W0 �Z2 �\\4 �^5 Q    d; Uf< �h> �j@ �mC �oE �rG �tH �wK �yL �xM �qI �_= �vO ��k ��k ��k ��k ��k ��k ��k ��j ������i��א��ؗ��ؘ��ؗ��֏���k���G��w�mC�e; �a8 �]5 �X1 �V/ ]V/ 
V/ �V/ �V/ �V/ �W0 �Y2 �\\4 �]5 Pb: c: �e< �h> �j@ �lB �oD �qF �rG DwK }wK �sI �d@ �cA ��f ��k ��k ��k ��k ��k ��k ��k ��k ��i���$���W���p���v���n���Y���I���*�rG�j@ �f< �a8 �\\4 �X1 �V/  V/ 
V/ �V/ �V/ �V/ �W0 �Y1 �[3 �\\5 Qa8 wb: �e< �g> �i@ �lB �nD �pE �oC uI }sH �iB �Z: ��Z ��l ��k ��k ��k ��k ��k ��k ��k ��j ��f ��e����Ω4�ܹA�޼B�״=���(�}R�nC �j@ �e< �\`8 �[4 �X1 �    V/ 
V/ �V/ �V/ �V/ �V/ �X1 �[3 �]5 �\`7 �b9 �d; �f= �i? �kA �mC �oD *    qG }kD �Z9 �oI ��j ��k ��k ��k ��k ��k ��k �k ��k ��i ��e ��a ��] ��_��g��g
��[�xK�rF �nC �i? �d; �_7 �[3 �X1     V/ 
V/ �V/ �V/ �V/ �V/ �X0 �Z2 �\\4 �_6 �a8 �c: �f< �h> �j@ �lB q        jB }_< �\\; ��c ��l ��k ��k ��k ��k ��k ۞k C�k ��j ��g ��c ��\` ��\\ ��X ��S �}O �yL �uI �qE �lA �g> �c: �^6 �[3 J        V/ 
V/ �V/ �V/ �V/ �V/ �W0 �Y2 �\\4 �^6 �\`8 �b: �e; �g= �i? �kA         \`; }U6 �U ��l ��k ��k ��k ��k ��k ��k l    �k $�h ��d ��a ��^ ��Z ��V ��S �}O �xK �tH �oD �j@ �f< �a9 �^6 ZS,         V/ 
V/ �V/ �V/ �V/ �V/ �V/ �X1 �[3 �]5 �_7 �a9 �d; �f< �g> M            T4 ~kE ��i ��k ��k ��k ��k ��k ��k ��k         �e �b ��_ �[ ��X ��T �Q �zM �vJ �rF �mB �i? �e; �a8 BW0             V/ 
V/ �V/ �V/ �V/ �V/ �V/ �W0 �Z2 �\\4 �^6 �\`8 �b: �d; �g=             iC ~�a ��k ��k ��k ��k ��k ��k �k :                �\` �] @�Y ��V ڀR �|O �xK �tH �pD �lA �h> he;                     V/ 
V/ �V/ �V/ �V/ �V/ �V/ �W0 �Y1 �[3 �]5 �_7 �a8 �c: .                xL ~Q ��R ��S ��T ��T ��U ��W ��o                         �W �T Q ={M TwJ YsG JoD +kA                             V/ 
V/ �V/ �V/ �V/ �V/ �V/ �V/ �X0 �Z2 �\\4 �^6 �\`7 w                    kA }lB �nC �oD �pF �rG �sH �sH �                                                                                        V/ 
V/ �V/ �V/ �V/ �V/ �V/ �V/ �W/ �X1 �Z3 �\\4 �^6                     j@ }kA �lB �nC �oD �pE �qF �rG �                                                                                        V/ 
V/ �V/ �V/ �V/ �V/ �V/ �V/ �V/ �W0 �Y2 �[3 R                        h> }i? �j@ �lB �mC �nC �oD �pE �                                                                                        V/ 
V/ �V/ �V/ �V/ �V/ �V/ �V/ �V/ �V/ �W0 �Z2                         f= }g= �h? �j@ �kA �lB �mB �mC �                                                                                        V/ 
V/ �V/ �V/ �V/ �V/ �V/ �V/ �V/ �V/ �V/ 2                            d; }e< �f= �g> �i? �j@ �j@ �kA �                                                                                        V/ 
V/ �V/ �V/ �V/ �V/ �V/ �V/ �V/ �V/ ~                                b9 }c: �d; �e< �f= �g> �h> �i? �                                                                                        V/ 
V/ �V/ �V/ �V/ �V/ �V/ �V/ �V/ �V/                                 \`7 }a8 �b9 �c: �d; �e< �f< �f= �                                                                                        V/ V/ TV/ pV/ nV/ nV/ nV/ nV/ oV/ :                                    _6 6\`7 oa8 nb9 nc: nd; nd; pe; C                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ������  ������  ������  ������  ������  ������  ������  ������  ������  ������  ������  ����  ���>�  ����  ����  �� �  ��  �  ��  �  ��  ?�  ��  �  ��  �  ��  ��  ��  �  ��  >   ��     ��\`    ��\`    � �    ��   ��   ��   ��?�  ��?��  ��?��  ��?��  ��?��  ��?��  �?�?��  ��?��  ��?��  ������  ������  ������  ������  ������  ������  ������  ������  (       @                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             V/ V/ XV/ \\V/ \\V/ ]X1 /                    L, ~S I�i \`�i _�i _�i [�i         �_ �\\ V�X \\�S \\{N ^wJ ,                        V/ KV/ �V/ �V/ �W0 �Y1 �                    d= BgA �b ��k ��k ��k ��k ��k �s �c ��_ ��Z ��U �}P �xL 6                        V/ KV/ �V/ �V/ �X1 �Z3 �                pE mC �b= �pJ ��j ��k ��k ��k �k J�k A�g �c ��] ��X ��T y                            V/ KV/ �V/ �V/ �Y1 �[3 �                oD fqF �nE �\`= ��Y ��l ��k ��k ��k Ϟk ˝j ��f ��\` ��[ ��V                             V/ KV/ �V/ �W/ �Z2 �\\4 �            mC #oD �rG �uI �lE �hD ��e ��k ��k ��k ��k ��k ��h ��c �^ F                        V/ V/ V/ KV/ �V/ �W0 �Z3 �]5 �        h> mC �pE �sH �wK �wL �hC �yP ��k ��k ��k ��k ��k ��i ��e ��[                         V/ *V/ zV/ KV/ �V/ �W0 �[3 �]5 �        kA @mB �pE �tI �xL �{N �wL �fC ��] ��l ��k ��k ��k ��j ͚g                         �w 	]5\\W0 oV/ KV/ �V/ �W0 �[3 �]5 �    g> j@ �mB �qF �tI �xL �|O �|P �hC �mI ��k ��k ��k ��l����                ��F��J ��NIĢ6�d<�V/ �V/ KV/ �V/ �W0 �[3 �]5 �    g= ci? �mB �pE �tH �xL �{N �wM �eB ��[ ��k ��k ��k ��j ���3��ڑU�ݩ�ڜ�ٜF��uk߾Dҽ�1��c�]5 �W0 �V/ KV/ �V/ �W0 �Z3 �]5 �d; e< �i? �lB �pE �sH �wK �wL �hC �vN ��j ��k ��k ��k ��j ��z�ܿ^��ֈ��׍��Ԃ���Z���!�mC�a8 �[4 �W0 �V/ KV/ �V/ �W/ �Z2 �\\4 �b9 �d; �h> �kA �oD �qF BuJ �mE �fB ��d ��k ��k ��k ��k ��k ��g ��{�Ϊ=�ܽM�ٸD���'�uJ�h> �b9 �[3 �W0 6V/ KV/ �V/ �V/ �Y1 �\\4 �\`8 �c: �g= �j@ �mC �zK lD �_< ��W ��l ��k ��k ��k ��k ؝j ��f ��_ ��_��e
��]	�wK�nC �g= �\`7 �[3 L' V/ KV/ �V/ �V/ �X1 �[3 �_6 �b9 �e< �h? �kA %    \\9 �mG ��i ��k ��k ��k ��k e�k 9�g Քb ��] ��W �Q �yL �sG �lA �e< �\`7 �[3     V/ KV/ �V/ �V/ �W0 �Z2 �]5 �a8 �d; �f= j       eA ��a ��l ��l ��k ��k ��k     �d .�_ ��Z �U �}O �vJ �pE �j? �d; v_7         V/ KV/ �V/ �V/ �V/ �X1 �\\4 �_7 �b9 �e;        |P ��Y ��Z ��[ ��\\ �a A            �\\ �W 7�R nzM �tH �nC \\i? !a9             V/ KV/ �V/ �V/ �V/ �W0 �Z2 �]5 �_7 G        j? lA �mC �oD �qF �sG �sH +                                                        V/ KV/ �V/ �V/ �V/ �V/ �X1 �[3 �\`7         b8 i? �j@ �mB �nD �pE �pE +                                                        V/ KV/ �V/ �V/ �V/ �V/ �V/ �X1 )            _6 f= �g> �i@ �kA �lB �mC +                                                        V/ LV/ �V/ �V/ �V/ �V/ �V/ q                ]4 c: �d; �f= �h> �i? �i? +                                                        V/ @V/ �V/ �V/ �V/ �V/ �V/                 [2 \`8 �b9 �c: �e; �f< �f= $                                                        V/ V/ V/ V/ V/ V/                         _6 \`7 a9 c: d; d;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ����������������������������������0��0��� ����������� �� ��   � � �00�p8�p?�����������������������������������(                                                                                                                                                                                                                                    V/ 'V/ ;W0 *Z3     ^: �] 2�k =�j %    �] #�V <{N (j?         V/ �V/ �X1 �\\4     h@ LvM �i ��k ʞk A�c ƉY �Q a            V/ �V/ �Z2 �[4 nC qF �lE ��Z ��l ��k �h ��\` ��V         V/ 	V/ �W0 �[3 �[4 mC rrG �wK �tL ��e ��k ��j�d8        ��(
\\5VV/ �W0 �[3 �f= 1kA �rG �zM �qI ��^ ��k ��z���z0��#��R^�}#�b:�V/ �W0 �Z3 �d; �j@ �qF �qH �zP ��j ��k ��r�ƤB�ڽ]㫆*�lC�[3 �V/ �V/ �Z2 �a8 �g> �jA GlF c ��l ��k ��e �a��^�sH�c: �[4 7V/ �V/ �X1 �^6 �c: �^: �T Œa ��d ��n 
�\` @�V �xK �mB �d; -    V/ �V/ �V/ �Z2 �_6  mB 
mC �pE �sG �        yL tH lA         V/ �V/ �V/ �W/ d    c: e< �h? �j@ �                            V/ RV/ |V/ hV/     _7 a9 ^d; }f< A                                                                                                                                                            ��  ��  ��  ��  O              c      ��  ��  ��  "
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > test-app/src/app.tsx 1`] = `
"import AppLayout from './components/AppLayout';
import {
  ContentLayout,
  Header,
  SpaceBetween,
  Container,
} from '@cloudscape-design/components';

export const App = () => (
  <AppLayout>
    <ContentLayout header={<Header>Welcome</Header>}>
      <SpaceBetween size="l">
        <Container>Welcome to your new React website!</Container>
      </SpaceBetween>
    </ContentLayout>
  </AppLayout>
);
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > test-app/src/components/AppLayout/index.tsx 1`] = `
"import * as React from 'react';
import { createContext, useCallback, useState } from 'react';
import Config from '../../config';

import { TopNavigation } from '@cloudscape-design/components';
import CloudscapeAppLayout, {
  AppLayoutProps,
} from '@cloudscape-design/components/app-layout';

export interface AppLayoutContext {
  appLayoutProps: AppLayoutProps;
  setAppLayoutProps: (props: AppLayoutProps) => void;
  displayHelpPanel: (helpContent: React.ReactNode) => void;
}

/**
 * Context for updating/retrieving the AppLayout.
 */
export const AppLayoutContext = createContext({
  appLayoutProps: {},
  // eslint-disable-next-line @typescript-eslint/no-empty-function
  setAppLayoutProps: (_: AppLayoutProps) => {},
  // eslint-disable-next-line @typescript-eslint/no-empty-function
  displayHelpPanel: (_: React.ReactNode) => {},
});

/**
 * Defines the App layout and contains logic for routing.
 */
const AppLayout: React.FC<React.PropsWithChildren> = ({ children }) => {
  const appLayout = React.useRef<AppLayoutProps.Ref>(null);
  const [appLayoutProps, setAppLayoutProps] = useState<AppLayoutProps>({});
  const setAppLayoutPropsSafe = useCallback(
    (props: AppLayoutProps) => {
      JSON.stringify(appLayoutProps) !== JSON.stringify(props) &&
        setAppLayoutProps(props);
    },
    [appLayoutProps],
  );

  return (
    <AppLayoutContext.Provider
      value={{
        appLayoutProps,
        setAppLayoutProps: setAppLayoutPropsSafe,
        displayHelpPanel: (helpContent: React.ReactNode) => {
          setAppLayoutPropsSafe({ tools: helpContent, toolsHide: false });
          appLayout.current?.openTools();
        },
      }}
    >
      <TopNavigation
        identity={{
          href: '/',
          title: Config.applicationName,
          logo: {
            src: Config.logo,
          },
        }}
      />
      <CloudscapeAppLayout
        ref={appLayout}
        navigationHide
        toolsHide
        content={children}
        {...appLayoutProps}
      />
    </AppLayoutContext.Provider>
  );
};

export default AppLayout;
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > test-app/src/config.ts 1`] = `
"export default {
  applicationName: 'test-app',
  logo: 'data:image/svg+xml;base64,PCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KDTwhLS0gVXBsb2FkZWQgdG86IFNWRyBSZXBvLCB3d3cuc3ZncmVwby5jb20sIFRyYW5zZm9ybWVkIGJ5OiBTVkcgUmVwbyBNaXhlciBUb29scyAtLT4KPHN2ZyBmaWxsPSIjMjQ4YmFlIiB3aWR0aD0iODAwcHgiIGhlaWdodD0iODAwcHgiIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHN0cm9rZT0iIzI0OGJhZSI+Cg08ZyBpZD0iU1ZHUmVwb19iZ0NhcnJpZXIiIHN0cm9rZS13aWR0aD0iMCIvPgoNPGcgaWQ9IlNWR1JlcG9fdHJhY2VyQ2FycmllciIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+Cg08ZyBpZD0iU1ZHUmVwb19pY29uQ2FycmllciI+Cg08dGl0bGU+aW9uaWNvbnMtdjVfbG9nb3M8L3RpdGxlPgoNPHBhdGggZD0iTTQxMC42NiwxODAuNzJoMHEtNy42Ny0yLjYyLTE1LjQ1LTQuODgsMS4yOS01LjI1LDIuMzgtMTAuNTZjMTEuNy01Ni45LDQuMDUtMTAyLjc0LTIyLjA2LTExNy44My0yNS0xNC40OC02NiwuNjEtMTA3LjM2LDM2LjY5cS02LjEsNS4zNC0xMS45NSwxMS0zLjktMy43Ni04LTcuMzZjLTQzLjM1LTM4LjU4LTg2LjgtNTQuODMtMTEyLjg4LTM5LjY5LTI1LDE0LjUxLTMyLjQzLDU3LjYtMjEuOSwxMTEuNTNxMS41OCw4LDMuNTUsMTUuOTNjLTYuMTUsMS43NS0xMi4wOSwzLjYyLTE3Ljc3LDUuNkM0OC40NiwxOTguOSwxNiwyMjYuNzMsMTYsMjU1LjU5YzAsMjkuODIsMzQuODQsNTkuNzIsODcuNzcsNzcuODVxNi40NCwyLjE5LDEzLDQuMDdRMTE0LjY0LDM0NiwxMTMsMzU0LjY4Yy0xMCw1My0yLjIsOTUuMDcsMjIuNzUsMTA5LjQ5LDI1Ljc3LDE0Ljg5LDY5LS40MSwxMTEuMTQtMzcuMzFxNS00LjM4LDEwLTkuMjUsNi4zMiw2LjExLDEzLDExLjg2YzQwLjgsMzUuMTgsODEuMDksNDkuMzksMTA2LDM0LjkzLDI1Ljc1LTE0Ljk0LDM0LjEyLTYwLjE0LDIzLjI1LTExNS4xM3EtMS4yNS02LjMtMi44OC0xMi44Niw0LjU2LTEuMzUsOC45My0yLjc5YzU1LTE4LjI3LDkwLjgzLTQ3LjgxLDkwLjgzLTc4QzQ5NiwyMjYuNjIsNDYyLjUsMTk4LjYxLDQxMC42NiwxODAuNzJabS0xMjktODEuMDhjMzUuNDMtMzAuOTEsNjguNTUtNDMuMTEsODMuNjUtMzQuMzloMGMxNi4wNyw5LjI5LDIyLjMyLDQ2Ljc1LDEyLjIyLDk1Ljg4cS0xLDQuOC0yLjE2LDkuNTdhNDg3LjgzLDQ4Ny44MywwLDAsMC02NC4xOC0xMC4xNiw0ODEuMjcsNDgxLjI3LDAsMCwwLTQwLjU3LTUwLjc1UTI3NiwxMDQuNTcsMjgxLjY0LDk5LjY0Wk0xNTcuNzMsMjgwLjI1cTYuNTEsMTIuNiwxMy42MSwyNC44OSw3LjIzLDEyLjU0LDE1LjA3LDI0LjcxYTQzNS4yOCw0MzUuMjgsMCwwLDEtNDQuMjQtNy4xM0MxNDYuNDEsMzA5LDE1MS42MywyOTQuNzUsMTU3LjczLDI4MC4yNVptMC00OC4zM2MtNi0xNC4xOS0xMS4wOC0yOC4xNS0xNS4yNS00MS42MywxMy43LTMuMDcsMjguMy01LjU4LDQzLjUyLTcuNDhxLTcuNjUsMTEuOTQtMTQuNzIsMjQuMjNUMTU3LjcsMjMxLjkyWm0xMC45LDI0LjE3cTkuNDgtMTkuNzcsMjAuNDItMzguNzhoMHExMC45My0xOSwyMy4yNy0zNy4xM2MxNC4yOC0xLjA4LDI4LjkyLTEuNjUsNDMuNzEtMS42NXMyOS41Mi41Nyw0My43OSwxLjY2cTEyLjIxLDE4LjA5LDIzLjEzLDM3dDIwLjY5LDM4LjZRMzM0LDI3NS42MywzMjMsMjk0LjczaDBxLTEwLjkxLDE5LTIzLDM3LjI0Yy0xNC4yNSwxLTI5LDEuNTUtNDQsMS41NXMtMjkuNDctLjQ3LTQzLjQ2LTEuMzhxLTEyLjQzLTE4LjE5LTIzLjQ2LTM3LjI5VDE2OC42LDI1Ni4wOVpNMzQwLjc1LDMwNXE3LjI1LTEyLjU4LDEzLjkyLTI1LjQ5aDBhNDQwLjQxLDQ0MC40MSwwLDAsMSwxNi4xMiw0Mi4zMkE0MzQuNDQsNDM0LjQ0LDAsMCwxLDMyNiwzMjkuNDhRMzMzLjYyLDMxNy4zOSwzNDAuNzUsMzA1Wm0xMy43Mi03My4wN3EtNi42NC0xMi42NS0xMy44MS0yNWgwcS03LTEyLjE4LTE0LjU5LTI0LjA2YzE1LjMxLDEuOTQsMzAsNC41Miw0My43Nyw3LjY3QTQzOS44OSw0MzkuODksMCwwLDEsMzU0LjQ3LDIzMS45M1pNMjU2LjIzLDEyNC40OGgwYTQzOS43NSw0MzkuNzUsMCwwLDEsMjguMjUsMzQuMThxLTI4LjM1LTEuMzUtNTYuNzQsMEMyMzcuMDcsMTQ2LjMyLDI0Ni42MiwxMzQuODcsMjU2LjIzLDEyNC40OFpNMTQ1LjY2LDY1Ljg2YzE2LjA2LTkuMzIsNTEuNTcsNCw4OSwzNy4yNywyLjM5LDIuMTMsNC44LDQuMzYsNy4yLDYuNjdBNDkxLjM3LDQ5MS4zNywwLDAsMCwyMDEsMTYwLjUxYTQ5OS4xMiw0OTkuMTIsMCwwLDAtNjQuMDYsMTBxLTEuODMtNy4zNi0zLjMtMTQuODJoMEMxMjQuNTksMTA5LjQ2LDEzMC41OCw3NC42MSwxNDUuNjYsNjUuODZaTTEyMi4yNSwzMTcuNzFxLTYtMS43MS0xMS44NS0zLjcxYy0yMy40LTgtNDIuNzMtMTguNDQtNTYtMjkuODFDNDIuNTIsMjc0LDM2LjUsMjYzLjgzLDM2LjUsMjU1LjU5YzAtMTcuNTEsMjYuMDYtMzkuODUsNjkuNTItNTVxOC4xOS0yLjg1LDE2LjUyLTUuMjFhNDkzLjU0LDQ5My41NCwwLDAsMCwyMy40LDYwLjc1QTUwMi40Niw1MDIuNDYsMCwwLDAsMTIyLjI1LDMxNy43MVptMTExLjEzLDkzLjY3Yy0xOC42MywxNi4zMi0zNy4yOSwyNy44OS01My43NCwzMy43MmgwYy0xNC43OCw1LjIzLTI2LjU1LDUuMzgtMzMuNjYsMS4yNy0xNS4xNC04Ljc1LTIxLjQ0LTQyLjU0LTEyLjg1LTg3Ljg2cTEuNTMtOCwzLjUtMTZhNDgwLjg1LDQ4MC44NSwwLDAsMCw2NC42OSw5LjM5LDUwMS4yLDUwMS4yLDAsMCwwLDQxLjIsNTFDMjM5LjU0LDQwNS44MywyMzYuNDksNDA4LjY1LDIzMy4zOCw0MTEuMzhabTIzLjQyLTIzLjIyYy05LjcyLTEwLjUxLTE5LjQyLTIyLjE0LTI4Ljg4LTM0LjY0cTEzLjc5LjU0LDI4LjA4LjU0YzkuNzgsMCwxOS40Ni0uMjEsMjktLjY0QTQzOS4zMyw0MzkuMzMsMCwwLDEsMjU2LjgsMzg4LjE2Wm0xMjQuNTIsMjguNTljLTIuODYsMTUuNDQtOC42MSwyNS43NC0xNS43MiwyOS44Ni0xNS4xMyw4Ljc4LTQ3LjQ4LTIuNjMtODIuMzYtMzIuNzItNC0zLjQ0LTgtNy4xMy0xMi4wNy0xMWE0ODQuNTQsNDg0LjU0LDAsMCwwLDQwLjIzLTUxLjIsNDc3Ljg0LDQ3Ny44NCwwLDAsMCw2NS0xMC4wNXExLjQ3LDUuOTQsMi42LDExLjY0aDBDMzgzLjgxLDM3Ny41OCwzODQuNSwzOTkuNTYsMzgxLjMyLDQxNi43NVptMTcuNC0xMDIuNjRoMGMtMi42Mi44Ny01LjMyLDEuNzEtOC4wNiwyLjUzYTQ4My4yNiw0ODMuMjYsMCwwLDAtMjQuMzEtNjAuOTQsNDgxLjUyLDQ4MS41MiwwLDAsMCwyMy4zNi02MC4wNmM0LjkxLDEuNDMsOS42OCwyLjkzLDE0LjI3LDQuNTIsNDQuNDIsMTUuMzIsNzEuNTIsMzgsNzEuNTIsNTUuNDNDNDc1LjUsMjc0LjE5LDQ0Ni4yMywyOTguMzMsMzk4LjcyLDMxNC4xMVoiLz4KDTxwYXRoIGQ9Ik0yNTYsMjk4LjU1YTQzLDQzLDAsMSwwLTQyLjg2LTQzQTQyLjkxLDQyLjkxLDAsMCwwLDI1NiwyOTguNTVaIi8+Cg08L2c+Cg08L3N2Zz4=',
};
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > test-app/src/hooks/useAppLayout.tsx 1`] = `
"import { useContext } from 'react';
import { AppLayoutContext } from '../components/AppLayout';

export const useAppLayout = (): AppLayoutContext =>
  useContext(AppLayoutContext);
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > test-app/src/main.tsx 1`] = `
"import React from 'react';
import { createRoot } from 'react-dom/client';
import { I18nProvider } from '@cloudscape-design/components/i18n';
import messages from '@cloudscape-design/components/i18n/messages/all.en';
import '@cloudscape-design/global-styles/index.css';
import { App } from './app';

const root = document.getElementById('root');
root &&
  createRoot(root).render(
    <React.StrictMode>
      <I18nProvider locale="en" messages={[messages]}>
        <App />
      </I18nProvider>
    </React.StrictMode>,
  );
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > test-app/src/styles.css 1`] = `
"@import 'tailwindcss';
/* You can add global styles to this file, and also import other style files */
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > test-app/tsconfig.app.json 1`] = `
"{
  "extends": "../tsconfig.base.json",
  "compilerOptions": {
    "outDir": "../dist/test-app/tsc",
    "tsBuildInfoFile": "../dist/test-app/tsc/tsconfig.lib.tsbuildinfo",
    "jsx": "react-jsx",
    "lib": ["DOM"],
    "types": [
      "node",
      "@nx/react/typings/cssmodule.d.ts",
      "@nx/react/typings/image.d.ts",
      "vite/client"
    ]
  },
  "exclude": [
    "src/**/*.spec.ts",
    "src/**/*.test.ts",
    "src/**/*.spec.tsx",
    "src/**/*.test.tsx",
    "src/**/*.spec.js",
    "src/**/*.test.js",
    "src/**/*.spec.jsx",
    "src/**/*.test.jsx",
    "vite.config.ts",
    "vite.config.mts",
    "vitest.config.ts",
    "vitest.config.mts"
  ],
  "include": ["src/**/*.js", "src/**/*.jsx", "src/**/*.ts", "src/**/*.tsx"]
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > test-app/tsconfig.json 1`] = `
"{
  "files": [],
  "include": [],
  "references": [
    {
      "path": "./tsconfig.app.json"
    },
    {
      "path": "./tsconfig.spec.json"
    }
  ],
  "extends": "../tsconfig.base.json",
  "compilerOptions": {
    "moduleResolution": "Bundler",
    "module": "Preserve"
  }
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > test-app/tsconfig.spec.json 1`] = `
"{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "outDir": "../dist/out-tsc",
    "types": [
      "vitest/globals",
      "vitest/importMeta",
      "vite/client",
      "node",
      "vitest",
      "@nx/react/typings/cssmodule.d.ts",
      "@nx/react/typings/image.d.ts"
    ]
  },
  "include": [
    "vite.config.ts",
    "vite.config.mts",
    "vitest.config.ts",
    "vitest.config.mts",
    "src/**/*.test.ts",
    "src/**/*.spec.ts",
    "src/**/*.test.tsx",
    "src/**/*.spec.tsx",
    "src/**/*.test.js",
    "src/**/*.spec.js",
    "src/**/*.test.jsx",
    "src/**/*.spec.jsx",
    "src/**/*.d.ts"
  ],
  "references": [
    {
      "path": "./tsconfig.app.json"
    }
  ]
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > test-app/vite.config.ts 1`] = `
"import tailwindcss from '@tailwindcss/vite';
import tsconfigPaths from 'vite-tsconfig-paths';
/// <reference types='vitest' />
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { nxViteTsPaths } from '@nx/vite/plugins/nx-tsconfig-paths.plugin';
import { nxCopyAssetsPlugin } from '@nx/vite/plugins/nx-copy-assets.plugin';

export default defineConfig(() => ({
  define: {
    global: {},
  },
  root: __dirname,
  cacheDir: '../node_modules/.vite/test-app',
  server: {
    port: 4200,
    host: 'localhost',
  },
  preview: {
    port: 4300,
    host: 'localhost',
  },
  plugins: [
    react(),
    nxViteTsPaths(),
    nxCopyAssetsPlugin(['*.md']),
    tailwindcss(),
    tsconfigPaths(),
  ],
  build: {
    outDir: '../dist/test-app',
    emptyOutDir: true,
    reportCompressedSize: true,
    commonjsOptions: {
      transformMixedEsModules: true,
    },
  },
  test: {
    name: '@proj/test-app',
    watch: false,
    globals: true,
    environment: 'jsdom',
    include: ['{src,tests}/**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}'],
    reporters: ['default'],
    coverage: {
      reportsDirectory: '../coverage/test-app',
      provider: 'v8' as const,
    },
    passWithNoTests: true,
  },
}));
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > tsconfig.base.json 1`] = `
"{
  "compilerOptions": {
    "paths": {
      ":proj/test-app": ["test-app/src/index.ts"],
      ":proj/common-constructs": ["packages/common/constructs/src/index.ts"]
    },
    "baseUrl": ".",
    "rootDir": "."
  }
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > tsconfig.json 1`] = `
"{
  "references": [
    {
      "path": "./test-app"
    },
    {
      "path": "./packages/common/constructs"
    }
  ]
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with no router correctly > vitest.workspace.ts 1`] = `
"export default [
  '**/vite.config.{mjs,js,ts,mts}',
  '**/vitest.config.{mjs,js,ts,mts}',
];
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > .gitignore 1`] = `
"vite.config.*.timestamp*
vitest.config.*.timestamp*

runtime-config.json"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > .prettierignore 1`] = `
"# Add files here to ignore them from prettier formatting
/dist
/coverage
/.nx/cache
/.nx/workspace-data"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > .prettierrc 1`] = `
"{ "singleQuote": true }
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > eslint.config.mjs 1`] = `
"import eslintPluginPrettierRecommended from 'eslint-plugin-prettier/recommended';
import nx from '@nx/eslint-plugin';

export default [
  eslintPluginPrettierRecommended,
  ...nx.configs['flat/base'],
  ...nx.configs['flat/typescript'],
  ...nx.configs['flat/javascript'],
  {
    ignores: [
      '**/dist',
      '**/vite.config.*.timestamp*',
      '**/vitest.config.*.timestamp*',
      '**/vite.config.ts.timestamp*',
    ],
  },
  {
    files: ['**/*.ts', '**/*.tsx', '**/*.js', '**/*.jsx'],
    rules: {
      '@nx/enforce-module-boundaries': [
        'error',
        {
          enforceBuildableLibDependency: true,
          allow: ['^.*/eslint(\\\\.base)?\\\\.config\\\\.[cm]?[jt]s$'],
          depConstraints: [
            {
              sourceTag: '*',
              onlyDependOnLibsWithTags: ['*'],
            },
          ],
        },
      ],
    },
  },
  {
    files: [
      '**/*.ts',
      '**/*.tsx',
      '**/*.cts',
      '**/*.mts',
      '**/*.js',
      '**/*.jsx',
      '**/*.cjs',
      '**/*.mjs',
    ],
    rules: {},
  },
];
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > nx.json 1`] = `
"{
  "affected": {
    "defaultBase": "main"
  },
  "targetDefaults": {
    "build": {
      "cache": true,
      "dependsOn": ["^build"],
      "inputs": ["default"]
    },
    "lint": {
      "cache": true,
      "configurations": {
        "fix": {
          "fix": true
        }
      },
      "inputs": [
        "default",
        "{workspaceRoot}/eslint.config.mjs",
        "{projectRoot}/eslint.config.mjs"
      ]
    },
    "@nx/eslint:lint": {
      "cache": true,
      "inputs": [
        "default",
        "{workspaceRoot}/.eslintrc.json",
        "{workspaceRoot}/.eslintignore",
        "{workspaceRoot}/eslint.config.mjs"
      ]
    },
    "@nx/vite:test": {
      "cache": true,
      "inputs": ["default", "^default"],
      "configurations": {
        "update-snapshot": {
          "args": "--update"
        }
      }
    },
    "@nx/vite:build": {
      "cache": true,
      "dependsOn": ["^build"],
      "inputs": ["default", "^default"]
    },
    "compile": {
      "cache": true,
      "inputs": ["default"]
    },
    "test": {
      "inputs": ["default"]
    }
  },
  "generators": {
    "@nx/react": {
      "application": {
        "babel": true,
        "style": "css",
        "linter": "eslint",
        "bundler": "vite"
      },
      "component": {
        "style": "css"
      },
      "library": {
        "style": "css",
        "linter": "eslint"
      }
    }
  },
  "plugins": [
    {
      "plugin": "@nx/js/typescript",
      "options": {
        "typecheck": {
          "targetName": "typecheck"
        },
        "build": {
          "targetName": "compile",
          "configName": "tsconfig.lib.json",
          "buildDepsName": "build-deps",
          "watchDepsName": "watch-deps"
        }
      }
    },
    {
      "plugin": "@nx/eslint/plugin",
      "options": {
        "targetName": "lint"
      }
    }
  ],
  "namedInputs": {
    "default": [
      {
        "dependentTasksOutputFiles": "**/*",
        "transitive": true
      }
    ]
  }
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > package.json 1`] = `
"{
  "name": "@proj/source",
  "dependencies": {
    "@cloudscape-design/board-components": "3.0.119",
    "@cloudscape-design/components": "3.0.1097",
    "@cloudscape-design/global-styles": "1.0.45",
    "@tanstack/react-router": "1.132.7",
    "aws-cdk-lib": "2.217.0",
    "constructs": "10.4.2",
    "react": "19.0.0",
    "react-dom": "19.0.0",
    "tailwindcss": "4.1.13"
  },
  "devDependencies": {
    "@eslint/js": "^9.8.0",
    "@nx/eslint": "21.5.3",
    "@nx/eslint-plugin": "21.5.3",
    "@nx/js": "21.5.3",
    "@nx/react": "21.5.3",
    "@nx/vite": "21.5.3",
    "@nx/web": "21.5.3",
    "@swc-node/register": "~1.9.1",
    "@swc/cli": "~0.6.0",
    "@swc/core": "~1.5.7",
    "@swc/helpers": "~0.5.11",
    "@tailwindcss/vite": "4.1.13",
    "@tanstack/router-generator": "1.132.7",
    "@tanstack/router-plugin": "1.132.7",
    "@tanstack/router-utils": "1.132.0",
    "@tanstack/virtual-file-routes": "1.132.0",
    "@testing-library/dom": "10.4.0",
    "@testing-library/react": "16.1.0",
    "@types/node": "22.18.6",
    "@types/react": "19.0.0",
    "@types/react-dom": "19.0.0",
    "@vitejs/plugin-react": "^4.2.0",
    "@vitest/coverage-v8": "^3.0.5",
    "@vitest/ui": "^3.0.0",
    "eslint": "^9.8.0",
    "eslint-config-prettier": "^10.0.0",
    "eslint-plugin-import": "2.31.0",
    "eslint-plugin-jsx-a11y": "6.10.1",
    "eslint-plugin-prettier": "5.5.4",
    "eslint-plugin-react": "7.35.0",
    "eslint-plugin-react-hooks": "5.0.0",
    "jiti": "2.4.2",
    "jsdom": "~22.1.0",
    "jsonc-eslint-parser": "2.4.1",
    "prettier": "3.6.2",
    "typescript": "~5.9.2",
    "typescript-eslint": "^8.40.0",
    "vite": "^7.0.0",
    "vite-tsconfig-paths": "5.1.4",
    "vitest": "^3.0.0"
  },
  "type": "module"
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > packages/common/constructs/README.md 1`] = `
"# @proj/common-constructs

This library was generated with [@aws/nx-plugin](https://github.com/awslabs/nx-plugin-for-aws/).

## Building

Run \`npx nx build @proj/common-constructs [--skip-nx-cache]\` to build the application.

## Running unit tests

Run \`npx nx test @proj/common-constructs\` to execute the unit tests via Vitest.

### Updating snapshots

To update snapshots, run the following command:

\`npx nx test @proj/common-constructs --configuration=update-snapshot\`

## Run lint

Run \`npx nx lint @proj/common-constructs\`

### Fixable issues

You can also automatiaclly fix some lint errors by running the following command:

\`npx nx lint @proj/common-constructs --configuration=fix\`

## Useful links

- [common-constructs reference docs](TODO)
- [Learn more about NX](https://nx.dev/getting-started/intro)
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > packages/common/constructs/eslint.config.mjs 1`] = `
"import baseConfig from '../../../eslint.config.mjs';

export default [
  ...baseConfig,
  {
    files: ['**/*.json'],
    rules: {
      '@nx/dependency-checks': [
        'warn',
        {
          ignoredFiles: [
            '{projectRoot}/eslint.config.{js,cjs,mjs,ts,cts,mts}',
            '{projectRoot}/vite.config.{js,ts,mjs,mts}',
          ],
        },
      ],
    },
    languageOptions: {
      parser: await import('jsonc-eslint-parser'),
    },
  },
  {
    ignores: ['**/out-tsc'],
  },
];
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > packages/common/constructs/project.json 1`] = `
"{
  "name": "@proj/common-constructs",
  "$schema": "../../../node_modules/nx/schemas/project-schema.json",
  "sourceRoot": "packages/common/constructs/src",
  "projectType": "library",
  "tags": [],
  "targets": {
    "build": {
      "dependsOn": ["lint", "compile", "test", "@proj/test-app:build"]
    },
    "compile": {
      "executor": "nx:run-commands",
      "outputs": ["{workspaceRoot}/dist/packages/common/constructs/tsc"],
      "options": {
        "command": "tsc --build tsconfig.lib.json",
        "cwd": "{projectRoot}"
      }
    },
    "test": {
      "executor": "@nx/vite:test",
      "outputs": ["{options.reportsDirectory}"],
      "options": {
        "reportsDirectory": "../../../coverage/packages/common/constructs"
      }
    }
  },
  "metadata": {
    "generator": "ts#project"
  }
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > packages/common/constructs/src/app/index.ts 1`] = `
"export * from './static-websites/index.js';
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > packages/common/constructs/src/app/static-websites/index.ts 1`] = `
"export * from './test-app.js';
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > packages/common/constructs/src/app/static-websites/test-app.ts 1`] = `
"import * as url from 'url';
import { Construct } from 'constructs';
import { StaticWebsite } from '../../core/index.js';

export class TestApp extends StaticWebsite {
  constructor(scope: Construct, id: string) {
    super(scope, id, {
      websiteName: 'TestApp',
      websiteFilePath: url.fileURLToPath(
        new URL('../../../../../../dist/test-app/bundle', import.meta.url),
      ),
    });
  }
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > packages/common/constructs/src/core/app.ts 1`] = `
"import { App as _App, AppProps, Aspects, IAspect, Stack } from 'aws-cdk-lib';
import { IConstruct } from 'constructs';

export class App extends _App {
  constructor(props?: AppProps) {
    super(props);

    Aspects.of(this).add(new MetricsAspect());
  }
}

/**
 * Adds information to CloudFormation stack descriptions to provide usage metrics for @aws/nx-plugin
 */
class MetricsAspect implements IAspect {
  visit(node: IConstruct): void {
    if (node instanceof Stack) {
      const id = 'uksb-4wk0bqpg5s';
      const version = '0.0.0';
      const tags: string[] = ['g5'];
      node.templateOptions.description =
        \`\${node.templateOptions.description ?? ''} (\${id}) (version:\${version}) (tag:\${tags.join(',')})\`.trim();
    }
  }
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > packages/common/constructs/src/core/checkov.ts 1`] = `
"import { IConstruct } from 'constructs';
import { CfnResource } from 'aws-cdk-lib';

/**
 * Suppresses a set of rules for a construct tree.
 *
 * @param construct The root construct to suppress the rule for.
 * @param ids The ids of the rules to suppress.
 * @param comment The reason for suppressing the rule
 * @param predicate A predicate function that determines whether the rule should be suppressed for the given construct or any of its descendants.
 *
 * @example
 * The following example suppresses the CKV_AWS_XXX rule for the given construct.
 * suppressRules(construct, ['CKV_AWS_XXX'], 'Not required for this use case')
 *
 * @example
 * The following example suppresses the CKV_AWS_XXX rule for the construct or any of its descendants if it is an instance of Bucket:
 * suppressRules(construct, ['CKV_AWS_XXX'], 'Not required for this use case', (construct) => construct instanceof Bucket)
 */
export const suppressRules = (
  construct: IConstruct,
  ids: string[],
  comment: string,
  predicate?: (construct: IConstruct) => boolean,
) => {
  const resources = (
    predicate ? construct.node.findAll().filter(predicate) : [construct]
  )
    .map((resource) => {
      if (CfnResource.isCfnResource(resource)) {
        return resource;
      } else return resource.node.defaultChild;
    })
    .filter((resource) => CfnResource.isCfnResource(resource));

  resources.forEach((resource) => {
    const metadata = resource.getMetadata('checkov') || {};
    metadata['skip'] = [
      ...(metadata['skip'] ?? []),
      ...ids.map((id) => ({ id, comment })),
    ];
    resource.addMetadata('checkov', metadata);
  });
};
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > packages/common/constructs/src/core/index.ts 1`] = `
"export * from './static-website.js';
export * from './app.js';
export * from './checkov.js';
export * from './runtime-config.js';
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > packages/common/constructs/src/core/runtime-config.ts 1`] = `
"import { Stack, Stage } from 'aws-cdk-lib';
import { Construct } from 'constructs';

const RuntimeConfigKey = '__RuntimeConfig__';

export class RuntimeConfig extends Construct {
  private readonly _runtimeConfig: any = {};

  static ensure(scope: Construct): RuntimeConfig {
    const parent = Stage.of(scope) ?? Stack.of(scope);
    return (
      RuntimeConfig.of(scope) ?? new RuntimeConfig(parent, RuntimeConfigKey)
    );
  }

  static of(scope: Construct): RuntimeConfig | undefined {
    const parent = Stage.of(scope) ?? Stack.of(scope);
    return parent.node.tryFindChild(RuntimeConfigKey) as
      | RuntimeConfig
      | undefined;
  }

  constructor(scope: Construct, id: string) {
    super(scope, id);
  }

  get config(): any {
    return this._runtimeConfig;
  }
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > packages/common/constructs/src/core/static-website.ts 1`] = `
"import { CfnOutput, CfnResource, RemovalPolicy, Stack } from 'aws-cdk-lib';
import { Distribution, ViewerProtocolPolicy } from 'aws-cdk-lib/aws-cloudfront';
import { S3BucketOrigin } from 'aws-cdk-lib/aws-cloudfront-origins';
import {
  BlockPublicAccess,
  Bucket,
  BucketEncryption,
  IBucket,
  ObjectOwnership,
} from 'aws-cdk-lib/aws-s3';
import { BucketDeployment, Source } from 'aws-cdk-lib/aws-s3-deployment';
import { Construct } from 'constructs';
import { RuntimeConfig } from './runtime-config.js';
import { Key } from 'aws-cdk-lib/aws-kms';
import { CfnWebACL } from 'aws-cdk-lib/aws-wafv2';
import { suppressRules } from './checkov.js';

const DEFAULT_RUNTIME_CONFIG_FILENAME = 'runtime-config.json';

export interface StaticWebsiteProps {
  readonly websiteName: string;
  readonly websiteFilePath: string;
}

/**
 * Deploys a Static Website using by default a private S3 bucket as an origin and Cloudfront as the entrypoint.
 *
 * This construct configures a webAcl containing rules that are generally applicable to web applications. This
 * provides protection against exploitation of a wide range of vulnerabilities, including some of the high risk
 * and commonly occurring vulnerabilities described in OWASP publications such as OWASP Top 10.
 *
 */
export class StaticWebsite extends Construct {
  public readonly websiteBucket: IBucket;
  public readonly cloudFrontDistribution: Distribution;
  public readonly bucketDeployment: BucketDeployment;

  constructor(
    scope: Construct,
    id: string,
    { websiteFilePath, websiteName }: StaticWebsiteProps,
  ) {
    super(scope, id);
    this.node.setContext(
      '@aws-cdk/aws-s3:serverAccessLogsUseBucketPolicy',
      true,
    );

    const websiteKey = new Key(this, 'WebsiteKey', {
      enableKeyRotation: true,
    });

    const accessLogsBucket = new Bucket(this, 'AccessLogsBucket', {
      versioned: false,
      enforceSSL: true,
      autoDeleteObjects: true,
      removalPolicy: RemovalPolicy.DESTROY,
      encryption: BucketEncryption.KMS,
      encryptionKey: websiteKey,
      objectOwnership: ObjectOwnership.OBJECT_WRITER,
      publicReadAccess: false,
      blockPublicAccess: BlockPublicAccess.BLOCK_ALL,
    });
    suppressRules(
      accessLogsBucket,
      ['CKV_AWS_21'],
      'Access log bucket does not need versioning enabled',
    );
    suppressRules(
      accessLogsBucket,
      ['CKV_AWS_18'],
      'Access log bucket does not need an access log bucket',
    );

    // S3 Bucket to hold website files
    this.websiteBucket = new Bucket(this, 'WebsiteBucket', {
      versioned: true,
      enforceSSL: true,
      autoDeleteObjects: true,
      removalPolicy: RemovalPolicy.DESTROY,
      encryption: BucketEncryption.KMS,
      encryptionKey: websiteKey,
      objectOwnership: ObjectOwnership.BUCKET_OWNER_ENFORCED,
      publicReadAccess: false,
      blockPublicAccess: BlockPublicAccess.BLOCK_ALL,
      serverAccessLogsPrefix: 'website-access-logs',
      serverAccessLogsBucket: accessLogsBucket,
    });
    // Web ACL
    const wafStack = new CloudfrontWebAcl(this, 'waf');

    // Cloudfront Distribution
    const logBucket = new Bucket(this, 'DistributionLogBucket', {
      enforceSSL: true,
      autoDeleteObjects: true,
      removalPolicy: RemovalPolicy.DESTROY,
      encryption: BucketEncryption.KMS,
      encryptionKey: websiteKey,
      objectOwnership: ObjectOwnership.BUCKET_OWNER_PREFERRED,
      publicReadAccess: false,
      blockPublicAccess: BlockPublicAccess.BLOCK_ALL,
      serverAccessLogsPrefix: 'distribution-access-logs',
      serverAccessLogsBucket: accessLogsBucket,
    });
    suppressRules(
      logBucket,
      ['CKV_AWS_21'],
      'Distribution log bucket does not need versioning enabled',
    );

    const defaultRootObject = 'index.html';
    this.cloudFrontDistribution = new Distribution(
      this,
      'CloudfrontDistribution',
      {
        webAclId: wafStack.wafArn,
        enableLogging: true,
        logBucket: logBucket,
        defaultBehavior: {
          origin: S3BucketOrigin.withOriginAccessControl(this.websiteBucket),
          viewerProtocolPolicy: ViewerProtocolPolicy.REDIRECT_TO_HTTPS,
        },
        defaultRootObject,
        errorResponses: [
          {
            httpStatus: 404, // We need to redirect "key not found errors" to index.html for single page apps
            responseHttpStatus: 200,
            responsePagePath: \`/\${defaultRootObject}\`,
          },
          {
            httpStatus: 403, // We need to redirect reloads from paths (e.g. /foo/bar) to index.html for single page apps
            responseHttpStatus: 200,
            responsePagePath: \`/\${defaultRootObject}\`,
          },
        ],
      },
    );
    suppressRules(
      this.cloudFrontDistribution,
      ['CKV_AWS_174'],
      'Cloudfront default certificate does not use TLS 1.2',
    );

    // Deploy Website
    this.bucketDeployment = new BucketDeployment(this, 'WebsiteDeployment', {
      sources: [
        Source.asset(websiteFilePath),
        Source.jsonData(
          DEFAULT_RUNTIME_CONFIG_FILENAME,
          RuntimeConfig.ensure(this).config,
        ),
      ],
      destinationBucket: this.websiteBucket,
      // Files in the distribution's edge caches will be invalidated after files are uploaded to the destination bucket.
      distribution: this.cloudFrontDistribution,
      memoryLimit: 1024,
    });

    suppressRules(
      Stack.of(this),
      ['CKV_AWS_111'],
      'CDK Bucket Deployment uses wildcard to deploy arbitrary assets',
      (c) =>
        CfnResource.isCfnResource(c) &&
        c.cfnResourceType === 'AWS::IAM::Policy' &&
        c.node.path.includes(\`/Custom::CDKBucketDeployment\`),
    );

    new CfnOutput(this, 'DistributionDomainName', {
      value: this.cloudFrontDistribution.domainName,
    });
    new CfnOutput(this, \`\${websiteName}WebsiteBucketName\`, {
      value: this.websiteBucket.bucketName,
    });
  }
}

export class CloudfrontWebAcl extends Stack {
  public readonly wafArn;
  constructor(scope: Construct, id: string) {
    super(scope, id, {
      env: {
        region: 'us-east-1',
        account: Stack.of(scope).account,
      },
      crossRegionReferences: true,
    });

    this.wafArn = new CfnWebACL(this, 'WebAcl', {
      defaultAction: { allow: {} },
      scope: 'CLOUDFRONT',
      visibilityConfig: {
        cloudWatchMetricsEnabled: true,
        metricName: id,
        sampledRequestsEnabled: true,
      },
      rules: [
        {
          name: 'CRSRule',
          priority: 0,
          statement: {
            managedRuleGroupStatement: {
              name: 'AWSManagedRulesCommonRuleSet',
              vendorName: 'AWS',
            },
          },
          visibilityConfig: {
            cloudWatchMetricsEnabled: true,
            metricName: 'MetricForWebACLCDK-CRS',
            sampledRequestsEnabled: true,
          },
          overrideAction: {
            none: {},
          },
        },
        {
          name: 'KnownBadInputsRule',
          priority: 1,
          statement: {
            managedRuleGroupStatement: {
              name: 'AWSManagedRulesKnownBadInputsRuleSet',
              vendorName: 'AWS',
            },
          },
          visibilityConfig: {
            cloudWatchMetricsEnabled: true,
            metricName: 'MetricForWebACLCDK-CRS',
            sampledRequestsEnabled: true,
          },
          overrideAction: {
            none: {},
          },
        },
      ],
    }).attrArn;
  }
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > packages/common/constructs/src/index.ts 1`] = `
"export * from './app/index.js';
export * from './core/index.js';
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > packages/common/constructs/tsconfig.json 1`] = `
"{
  "extends": "../../../tsconfig.base.json",
  "files": [],
  "include": [],
  "references": [
    {
      "path": "./tsconfig.lib.json"
    },
    {
      "path": "./tsconfig.spec.json"
    }
  ],
  "compilerOptions": {}
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > packages/common/constructs/tsconfig.lib.json 1`] = `
"{
  "extends": "../../../tsconfig.base.json",
  "compilerOptions": {
    "rootDir": ".",
    "outDir": "../../../dist/packages/common/constructs/tsc",
    "tsBuildInfoFile": "../../../dist/packages/common/constructs/tsc/tsconfig.lib.tsbuildinfo",
    "emitDeclarationOnly": false,
    "module": "nodenext",
    "moduleResolution": "nodenext",
    "types": ["node"]
  },
  "include": ["src/**/*.ts"],
  "references": [],
  "exclude": [
    "vite.config.ts",
    "vite.config.mts",
    "vitest.config.ts",
    "vitest.config.mts",
    "src/**/*.test.ts",
    "src/**/*.spec.ts",
    "src/**/*.test.tsx",
    "src/**/*.spec.tsx",
    "src/**/*.test.js",
    "src/**/*.spec.js",
    "src/**/*.test.jsx",
    "src/**/*.spec.jsx"
  ]
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > packages/common/constructs/tsconfig.spec.json 1`] = `
"{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "outDir": "../../../dist/out-tsc",
    "types": [
      "vitest/globals",
      "vitest/importMeta",
      "vite/client",
      "node",
      "vitest"
    ],
    "module": "nodenext",
    "moduleResolution": "nodenext"
  },
  "include": [
    "vite.config.ts",
    "vite.config.mts",
    "vitest.config.ts",
    "vitest.config.mts",
    "src/**/*.test.ts",
    "src/**/*.spec.ts",
    "src/**/*.test.tsx",
    "src/**/*.spec.tsx",
    "src/**/*.test.js",
    "src/**/*.spec.js",
    "src/**/*.test.jsx",
    "src/**/*.spec.jsx",
    "src/**/*.d.ts"
  ],
  "references": [
    {
      "path": "./tsconfig.lib.json"
    }
  ]
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > packages/common/constructs/vite.config.ts 1`] = `
"import { defineConfig } from 'vite';
import { nxViteTsPaths } from '@nx/vite/plugins/nx-tsconfig-paths.plugin';
import { nxCopyAssetsPlugin } from '@nx/vite/plugins/nx-copy-assets.plugin';

export default defineConfig(() => ({
  root: __dirname,
  cacheDir: '../../../node_modules/.vite/packages/common/constructs',
  plugins: [nxViteTsPaths(), nxCopyAssetsPlugin(['*.md'])],
  // Uncomment this if you are using workers.
  // worker: {
  //  plugins: [ nxViteTsPaths() ],
  // },
  test: {
    name: '@proj/common-constructs',
    watch: false,
    globals: true,
    environment: 'jsdom',
    include: ['src/**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}'],
    reporters: ['default'],
    coverage: {
      reportsDirectory: '../../../coverage/packages/common/constructs',
      provider: 'v8' as const,
    },
    passWithNoTests: true,
  },
}));
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > pnpm-workspace.yaml 1`] = `
"packages:
  - 'packages/*'
  - 'test-app'
  - 'packages/common/*'
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > test-app/README.md 1`] = `
"# @proj/test-app

This library was generated with [@aws/nx-plugin](https://github.com/awslabs/nx-plugin-for-aws/).

## Building

Run \`npx nx build @proj/test-app [--skip-nx-cache]\` to build the application.

## Run dev server

Run \`npx nx serve @proj/test-app\`

## Running unit tests

Run \`npx nx test @proj/test-app\` to execute the unit tests via Vitest.

### Updating snapshots

To update snapshots, run the following command:

\`npx nx test @proj/test-app --configuration=update-snapshot\`

## Run lint

Run \`npx nx lint @proj/test-app\`

### Fixable issues

You can also automatically fix some lint errors by running the following command:

\`npx nx lint @proj/test-app --configuration=fix\`

### Runtime config

In order to integrate with cognito or trpc backends, you need to have a \`runtime-config.json\` file in your \`/public\` website directory. You can fetch this is follows:

\`npx nx run @proj/test-app:load:runtime-config\`

> [!IMPORTANT]
> Ensure you have AWS CLI and curl installed
> You have deployed your CDK infrastructure into the appropriate account
> You have assumed a role in the AWS account with sufficient permissions to call describe-stacks from cloudformation

## Useful links

- [React website reference docs](TODO)
- [Learn more about NX](https://nx.dev/getting-started/intro)
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > test-app/eslint.config.mjs 1`] = `
"import nx from '@nx/eslint-plugin';
import baseConfig from '../eslint.config.mjs';

export default [
  ...baseConfig,
  ...nx.configs['flat/react'],
  {
    files: ['**/*.ts', '**/*.tsx', '**/*.js', '**/*.jsx'],
    // Override or add rules here
    rules: {},
  },
];
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > test-app/index.html 1`] = `
"<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>TestApp</title>
    <base href="/" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="stylesheet" href="/src/styles.css" />
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > test-app/project.json 1`] = `
"{
  "name": "@proj/test-app",
  "$schema": "../node_modules/nx/schemas/project-schema.json",
  "sourceRoot": "test-app/src",
  "projectType": "application",
  "tags": [],
  "targets": {
    "build": {
      "dependsOn": ["lint", "compile", "bundle", "test"],
      "options": {
        "outputPath": "dist/test-app/bundle"
      }
    },
    "bundle": {
      "executor": "@nx/vite:build",
      "outputs": ["{options.outputPath}"],
      "defaultConfiguration": "production",
      "options": {
        "outputPath": "dist/test-app/bundle"
      },
      "configurations": {
        "development": {
          "mode": "development"
        },
        "production": {
          "mode": "production"
        }
      }
    },
    "compile": {
      "executor": "nx:run-commands",
      "outputs": ["{workspaceRoot}/dist/{projectRoot}/tsc"],
      "options": {
        "command": "tsc --build tsconfig.app.json",
        "cwd": "{projectRoot}"
      }
    },
    "lint": {
      "executor": "@nx/eslint:lint"
    },
    "load:runtime-config": {
      "executor": "nx:run-commands",
      "metadata": {
        "description": "Load runtime config from your deployed stack for dev purposes. You must set your AWS CLI credentials whilst calling 'pnpm exec nx run @proj/test-app:load:runtime-config'"
      },
      "options": {
        "command": "aws s3 cp s3://\`aws cloudformation describe-stacks --query \\"Stacks[?starts_with(StackName, 'proj-')][].Outputs[] | [?contains(OutputKey, 'TestAppWebsiteBucketName')].OutputValue\\" --output text\`/runtime-config.json './test-app/public/runtime-config.json'"
      }
    },
    "preview": {
      "dependsOn": ["build"],
      "executor": "@nx/vite:preview-server",
      "defaultConfiguration": "development",
      "options": {
        "buildTarget": "@proj/test-app:build"
      },
      "configurations": {
        "development": {
          "buildTarget": "@proj/test-app:build:development"
        },
        "production": {
          "buildTarget": "@proj/test-app:build:production"
        }
      }
    },
    "serve": {
      "executor": "@nx/vite:dev-server",
      "defaultConfiguration": "development",
      "options": {
        "buildTarget": "@proj/test-app:build"
      },
      "configurations": {
        "development": {
          "buildTarget": "@proj/test-app:build:development",
          "hmr": true
        },
        "production": {
          "buildTarget": "@proj/test-app:build:production",
          "hmr": false
        }
      }
    },
    "serve-local": {
      "executor": "@nx/vite:dev-server",
      "options": {
        "buildTarget": "@proj/test-app:build:development",
        "hmr": true,
        "mode": "serve-local"
      },
      "continuous": true
    },
    "serve-static": {
      "executor": "@nx/web:file-server",
      "dependsOn": ["build"],
      "options": {
        "buildTarget": "@proj/test-app:build",
        "spa": true
      }
    },
    "test": {
      "executor": "@nx/vite:test",
      "outputs": ["{options.reportsDirectory}"],
      "options": {
        "reportsDirectory": "../coverage/test-app"
      }
    }
  },
  "metadata": {
    "generator": "ts#react-website"
  }
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > test-app/public/favicon.ico 1`] = `
"    00     �%  6          �  �%       h  �6  (   0   \`           $                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  V/ V/ cV/ �V/ �V/ �V/ �V/ �W0 �Y1 '                                B# pH [�f ��i ��i ��i ��i ��i ��i a�j             �c �^ R�\\ ��Y ��U ��R �|N �xK uI &                                    V/ 
V/ �V/ �V/ �V/ �V/ �V/ �X1 �Y2 L                                d= 9_; �X ��l ��k ��k ��k ��k ��k �k H            �c 8�a �] ��Z ��W ��S �}P �zM �vI                                     V/ 
V/ �V/ �V/ �V/ �V/ �W0 �Y1 �Z3 L                            oD jA �\`; �_= ��c ��l ��k ��k ��k ��k ��k Þk     �j �f ��c ��\` ��] ��Y ��V ��R �}O C                                        V/ 
V/ �V/ �V/ �V/ �V/ �W0 �Z2 �[3 L                            oD [nD �iA �X7 �oI ��j ��k ��k ��k ��k ��k ��k ��m �k s�i ��f ��b ��_ ��[ ��W ��T �yL                                         V/ 
V/ �V/ �V/ �V/ �V/ �X1 �Z3 �\\4 M                        nD oE �qF �oE �f@ �X8 ��Z ��l ��k ��k ��k ��k ��k �k s�k ��k ��h ��d ��a ��] ��Y ˅W                                             V/ 
V/ �V/ �V/ �V/ �V/ �Y1 �[3 �\\4 P                    h= nD �pE �rG �sH �oF �a= �cA ��f ��k ��k ��k ��k ��k ��k ��k ��k ��j ��f ��b ��_ �\\ S                                                V/ 
V/ �V/ �V/ �V/ �W0 �Y2 �[4 �]5 Q                    mC 6oD �qF �sH �uJ �uJ �nF �]; �wO ��k ��k ��k ��k ��k ��k ��k ��k ��k ��h ��d ��\` ��\\                                         V/ 
V/ V/ 
V/ �V/ �V/ �V/ �W0 �Y2 �\\4 �]5 Q                kA 
mC �oD �qF �tH �vJ �xL �vK �kD �^= ��_ ��l ��k ��k ��k ��k ��k ��k ��k ��i ��e ؔb (                                        V/ 	V/ �V/ eV/ 
V/ �V/ �V/ �V/ �W0 �Z2 �\\4 �^6 Q                lA XmC �oE �rG �tI �wK �yM �zN �uK �eA �jF ��h ��k ��k ��k ��k ��k ��k ��k ��j ��g e                                            W0 V/ RV/ �V/ 
V/ �V/ �V/ �V/ �W0 �Z2 �\\4 �^6 Q            j@ kA �mC �pE �rG �uI �wK �yM �|O �{O �rJ �^= �|S ��k ��k ��k ��k ��k ��k ��k ��j ��h                                         �Z]5 iY1 �V/ GV/ 
V/ �V/ �V/ �V/ �X0 �Z2 �\\5 �^6 Q            i? kA �mC �pE �rG �uI �wK �zM �|O �}P �xN �eB �W: ��c ��k ��k ��k ��k ��k ��o���$W                                ��H��H��KHɦ9�f>�X1 �V/ �V/ 
V/ �V/ �V/ �V/ �X0 �Z2 �\\4 �^6 Q        g> 4i? �kA �mC �pE �rG �uI �wK �zM �|O �|P �vM �b@ �bA ��g ��k ��k ��k ��k ��k ��s	�ӵ]����                        ��H-��H���J���G���*�\`8�Y1 �V/ �V/ 
V/ �V/ �V/ �V/ �W0 �Z2 �\\4 �^6 Q    d; 	f= �h? �kA �mC �pE �rG �tI �wK �yM �{O �yN �mF �^> ��] ��l ��k ��k ��k ��k ��k ��l �ͫH��ڔ��ٛ�ؖ�ؖ�ؖ.�ؘr�֏���O�߾D���/��h�i@�]5 �Y1 �V/ �V/ 
V/ �V/ �V/ �V/ �W0 �Z2 �\\4 �^5 Q    d; Uf< �h> �j@ �mC �oE �rG �tH �wK �yL �xM �qI �_= �vO ��k ��k ��k ��k ��k ��k ��k ��j ������i��א��ؗ��ؘ��ؗ��֏���k���G��w�mC�e; �a8 �]5 �X1 �V/ ]V/ 
V/ �V/ �V/ �V/ �W0 �Y2 �\\4 �]5 Pb: c: �e< �h> �j@ �lB �oD �qF �rG DwK }wK �sI �d@ �cA ��f ��k ��k ��k ��k ��k ��k ��k ��k ��i���$���W���p���v���n���Y���I���*�rG�j@ �f< �a8 �\\4 �X1 �V/  V/ 
V/ �V/ �V/ �V/ �W0 �Y1 �[3 �\\5 Qa8 wb: �e< �g> �i@ �lB �nD �pE �oC uI }sH �iB �Z: ��Z ��l ��k ��k ��k ��k ��k ��k ��k ��j ��f ��e����Ω4�ܹA�޼B�״=���(�}R�nC �j@ �e< �\`8 �[4 �X1 �    V/ 
V/ �V/ �V/ �V/ �V/ �X1 �[3 �]5 �\`7 �b9 �d; �f= �i? �kA �mC �oD *    qG }kD �Z9 �oI ��j ��k ��k ��k ��k ��k ��k �k ��k ��i ��e ��a ��] ��_��g��g
��[�xK�rF �nC �i? �d; �_7 �[3 �X1     V/ 
V/ �V/ �V/ �V/ �V/ �X0 �Z2 �\\4 �_6 �a8 �c: �f< �h> �j@ �lB q        jB }_< �\\; ��c ��l ��k ��k ��k ��k ��k ۞k C�k ��j ��g ��c ��\` ��\\ ��X ��S �}O �yL �uI �qE �lA �g> �c: �^6 �[3 J        V/ 
V/ �V/ �V/ �V/ �V/ �W0 �Y2 �\\4 �^6 �\`8 �b: �e; �g= �i? �kA         \`; }U6 �U ��l ��k ��k ��k ��k ��k ��k l    �k $�h ��d ��a ��^ ��Z ��V ��S �}O �xK �tH �oD �j@ �f< �a9 �^6 ZS,         V/ 
V/ �V/ �V/ �V/ �V/ �V/ �X1 �[3 �]5 �_7 �a9 �d; �f< �g> M            T4 ~kE ��i ��k ��k ��k ��k ��k ��k ��k         �e �b ��_ �[ ��X ��T �Q �zM �vJ �rF �mB �i? �e; �a8 BW0             V/ 
V/ �V/ �V/ �V/ �V/ �V/ �W0 �Z2 �\\4 �^6 �\`8 �b: �d; �g=             iC ~�a ��k ��k ��k ��k ��k ��k �k :                �\` �] @�Y ��V ڀR �|O �xK �tH �pD �lA �h> he;                     V/ 
V/ �V/ �V/ �V/ �V/ �V/ �W0 �Y1 �[3 �]5 �_7 �a8 �c: .                xL ~Q ��R ��S ��T ��T ��U ��W ��o                         �W �T Q ={M TwJ YsG JoD +kA                             V/ 
V/ �V/ �V/ �V/ �V/ �V/ �V/ �X0 �Z2 �\\4 �^6 �\`7 w                    kA }lB �nC �oD �pF �rG �sH �sH �                                                                                        V/ 
V/ �V/ �V/ �V/ �V/ �V/ �V/ �W/ �X1 �Z3 �\\4 �^6                     j@ }kA �lB �nC �oD �pE �qF �rG �                                                                                        V/ 
V/ �V/ �V/ �V/ �V/ �V/ �V/ �V/ �W0 �Y2 �[3 R                        h> }i? �j@ �lB �mC �nC �oD �pE �                                                                                        V/ 
V/ �V/ �V/ �V/ �V/ �V/ �V/ �V/ �V/ �W0 �Z2                         f= }g= �h? �j@ �kA �lB �mB �mC �                                                                                        V/ 
V/ �V/ �V/ �V/ �V/ �V/ �V/ �V/ �V/ �V/ 2                            d; }e< �f= �g> �i? �j@ �j@ �kA �                                                                                        V/ 
V/ �V/ �V/ �V/ �V/ �V/ �V/ �V/ �V/ ~                                b9 }c: �d; �e< �f= �g> �h> �i? �                                                                                        V/ 
V/ �V/ �V/ �V/ �V/ �V/ �V/ �V/ �V/                                 \`7 }a8 �b9 �c: �d; �e< �f< �f= �                                                                                        V/ V/ TV/ pV/ nV/ nV/ nV/ nV/ oV/ :                                    _6 6\`7 oa8 nb9 nc: nd; nd; pe; C                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ������  ������  ������  ������  ������  ������  ������  ������  ������  ������  ������  ����  ���>�  ����  ����  �� �  ��  �  ��  �  ��  ?�  ��  �  ��  �  ��  ��  ��  �  ��  >   ��     ��\`    ��\`    � �    ��   ��   ��   ��?�  ��?��  ��?��  ��?��  ��?��  ��?��  �?�?��  ��?��  ��?��  ������  ������  ������  ������  ������  ������  ������  ������  (       @                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             V/ V/ XV/ \\V/ \\V/ ]X1 /                    L, ~S I�i \`�i _�i _�i [�i         �_ �\\ V�X \\�S \\{N ^wJ ,                        V/ KV/ �V/ �V/ �W0 �Y1 �                    d= BgA �b ��k ��k ��k ��k ��k �s �c ��_ ��Z ��U �}P �xL 6                        V/ KV/ �V/ �V/ �X1 �Z3 �                pE mC �b= �pJ ��j ��k ��k ��k �k J�k A�g �c ��] ��X ��T y                            V/ KV/ �V/ �V/ �Y1 �[3 �                oD fqF �nE �\`= ��Y ��l ��k ��k ��k Ϟk ˝j ��f ��\` ��[ ��V                             V/ KV/ �V/ �W/ �Z2 �\\4 �            mC #oD �rG �uI �lE �hD ��e ��k ��k ��k ��k ��k ��h ��c �^ F                        V/ V/ V/ KV/ �V/ �W0 �Z3 �]5 �        h> mC �pE �sH �wK �wL �hC �yP ��k ��k ��k ��k ��k ��i ��e ��[                         V/ *V/ zV/ KV/ �V/ �W0 �[3 �]5 �        kA @mB �pE �tI �xL �{N �wL �fC ��] ��l ��k ��k ��k ��j ͚g                         �w 	]5\\W0 oV/ KV/ �V/ �W0 �[3 �]5 �    g> j@ �mB �qF �tI �xL �|O �|P �hC �mI ��k ��k ��k ��l����                ��F��J ��NIĢ6�d<�V/ �V/ KV/ �V/ �W0 �[3 �]5 �    g= ci? �mB �pE �tH �xL �{N �wM �eB ��[ ��k ��k ��k ��j ���3��ڑU�ݩ�ڜ�ٜF��uk߾Dҽ�1��c�]5 �W0 �V/ KV/ �V/ �W0 �Z3 �]5 �d; e< �i? �lB �pE �sH �wK �wL �hC �vN ��j ��k ��k ��k ��j ��z�ܿ^��ֈ��׍��Ԃ���Z���!�mC�a8 �[4 �W0 �V/ KV/ �V/ �W/ �Z2 �\\4 �b9 �d; �h> �kA �oD �qF BuJ �mE �fB ��d ��k ��k ��k ��k ��k ��g ��{�Ϊ=�ܽM�ٸD���'�uJ�h> �b9 �[3 �W0 6V/ KV/ �V/ �V/ �Y1 �\\4 �\`8 �c: �g= �j@ �mC �zK lD �_< ��W ��l ��k ��k ��k ��k ؝j ��f ��_ ��_��e
��]	�wK�nC �g= �\`7 �[3 L' V/ KV/ �V/ �V/ �X1 �[3 �_6 �b9 �e< �h? �kA %    \\9 �mG ��i ��k ��k ��k ��k e�k 9�g Քb ��] ��W �Q �yL �sG �lA �e< �\`7 �[3     V/ KV/ �V/ �V/ �W0 �Z2 �]5 �a8 �d; �f= j       eA ��a ��l ��l ��k ��k ��k     �d .�_ ��Z �U �}O �vJ �pE �j? �d; v_7         V/ KV/ �V/ �V/ �V/ �X1 �\\4 �_7 �b9 �e;        |P ��Y ��Z ��[ ��\\ �a A            �\\ �W 7�R nzM �tH �nC \\i? !a9             V/ KV/ �V/ �V/ �V/ �W0 �Z2 �]5 �_7 G        j? lA �mC �oD �qF �sG �sH +                                                        V/ KV/ �V/ �V/ �V/ �V/ �X1 �[3 �\`7         b8 i? �j@ �mB �nD �pE �pE +                                                        V/ KV/ �V/ �V/ �V/ �V/ �V/ �X1 )            _6 f= �g> �i@ �kA �lB �mC +                                                        V/ LV/ �V/ �V/ �V/ �V/ �V/ q                ]4 c: �d; �f= �h> �i? �i? +                                                        V/ @V/ �V/ �V/ �V/ �V/ �V/                 [2 \`8 �b9 �c: �e; �f< �f= $                                                        V/ V/ V/ V/ V/ V/                         _6 \`7 a9 c: d; d;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ����������������������������������0��0��� ����������� �� ��   � � �00�p8�p?�����������������������������������(                                                                                                                                                                                                                                    V/ 'V/ ;W0 *Z3     ^: �] 2�k =�j %    �] #�V <{N (j?         V/ �V/ �X1 �\\4     h@ LvM �i ��k ʞk A�c ƉY �Q a            V/ �V/ �Z2 �[4 nC qF �lE ��Z ��l ��k �h ��\` ��V         V/ 	V/ �W0 �[3 �[4 mC rrG �wK �tL ��e ��k ��j�d8        ��(
\\5VV/ �W0 �[3 �f= 1kA �rG �zM �qI ��^ ��k ��z���z0��#��R^�}#�b:�V/ �W0 �Z3 �d; �j@ �qF �qH �zP ��j ��k ��r�ƤB�ڽ]㫆*�lC�[3 �V/ �V/ �Z2 �a8 �g> �jA GlF c ��l ��k ��e �a��^�sH�c: �[4 7V/ �V/ �X1 �^6 �c: �^: �T Œa ��d ��n 
�\` @�V �xK �mB �d; -    V/ �V/ �V/ �Z2 �_6  mB 
mC �pE �sG �        yL tH lA         V/ �V/ �V/ �W/ d    c: e< �h? �j@ �                            V/ RV/ |V/ hV/     _7 a9 ^d; }f< A                                                                                                                                                            ��  ��  ��  ��  O              c      ��  ��  ��  "
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > test-app/src/components/AppLayout/index.tsx 1`] = `
"import * as React from 'react';
import { createContext, useCallback, useEffect, useState } from 'react';
import Config from '../../config';

import {
  BreadcrumbGroup,
  BreadcrumbGroupProps,
  SideNavigation,
  TopNavigation,
} from '@cloudscape-design/components';
import CloudscapeAppLayout, {
  AppLayoutProps,
} from '@cloudscape-design/components/app-layout';
import { matchByPath, useLocation, useNavigate } from '@tanstack/react-router';

const getBreadcrumbs = (
  pathName: string,
  search: string,
  defaultBreadcrumb: string,
  availableRoutes?: string[],
) => {
  const segments = [
    defaultBreadcrumb,
    ...pathName.split('/').filter((segment) => segment !== ''),
  ];

  return segments.map((segment, i) => {
    const href =
      i === 0
        ? '/'
        : \`/\${segments
            .slice(1, i + 1)
            .join('/')
            .replace('//', '/')}\`;

    const matched =
      !availableRoutes || availableRoutes.find((r) => matchByPath(r, href, {}));

    return {
      href: matched ? \`\${href}\${search}\` : '#',
      text: segment,
    };
  });
};

export interface AppLayoutContext {
  appLayoutProps: AppLayoutProps;
  setAppLayoutProps: (props: AppLayoutProps) => void;
  displayHelpPanel: (helpContent: React.ReactNode) => void;
}

/**
 * Context for updating/retrieving the AppLayout.
 */
export const AppLayoutContext = createContext({
  appLayoutProps: {},
  // eslint-disable-next-line @typescript-eslint/no-empty-function
  setAppLayoutProps: (_: AppLayoutProps) => {},
  // eslint-disable-next-line @typescript-eslint/no-empty-function
  displayHelpPanel: (_: React.ReactNode) => {},
});

/**
 * Defines the App layout and contains logic for routing.
 */
const AppLayout: React.FC<React.PropsWithChildren> = ({ children }) => {
  const appLayout = React.useRef<AppLayoutProps.Ref>(null);
  const [appLayoutProps, setAppLayoutProps] = useState<AppLayoutProps>({});
  const setAppLayoutPropsSafe = useCallback(
    (props: AppLayoutProps) => {
      JSON.stringify(appLayoutProps) !== JSON.stringify(props) &&
        setAppLayoutProps(props);
    },
    [appLayoutProps],
  );

  const navigate = useNavigate();
  const [activeBreadcrumbs, setActiveBreadcrumbs] = useState<
    BreadcrumbGroupProps.Item[]
  >([{ text: '/', href: '/' }]);
  const { pathname, search } = useLocation();

  useEffect(() => {
    const breadcrumbs = getBreadcrumbs(
      pathname,
      Object.entries(search).reduce((p, [k, v]) => p + \`\${k}=\${v}\`, ''),
      '/',
    );
    setActiveBreadcrumbs(breadcrumbs);
  }, [pathname, search]);

  const onNavigate = useCallback(
    (e: CustomEvent<{ href: string; external?: boolean }>) => {
      if (!e.detail.external) {
        e.preventDefault();
        setAppLayoutPropsSafe({
          contentType: undefined,
        });
        navigate({ to: e.detail.href });
      }
    },
    [navigate, setAppLayoutPropsSafe],
  );

  return (
    <AppLayoutContext.Provider
      value={{
        appLayoutProps,
        setAppLayoutProps: setAppLayoutPropsSafe,
        displayHelpPanel: (helpContent: React.ReactNode) => {
          setAppLayoutPropsSafe({ tools: helpContent, toolsHide: false });
          appLayout.current?.openTools();
        },
      }}
    >
      <TopNavigation
        identity={{
          href: '/',
          title: Config.applicationName,
          logo: {
            src: Config.logo,
          },
        }}
      />
      <CloudscapeAppLayout
        ref={appLayout}
        breadcrumbs={
          <BreadcrumbGroup onFollow={onNavigate} items={activeBreadcrumbs} />
        }
        navigation={
          <SideNavigation
            header={{ text: Config.applicationName, href: '/' }}
            activeHref={pathname}
            onFollow={onNavigate}
            items={[{ text: 'Home', type: 'link', href: '/' }]}
          />
        }
        toolsHide
        content={children}
        {...appLayoutProps}
      />
    </AppLayoutContext.Provider>
  );
};

export default AppLayout;
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > test-app/src/config.ts 1`] = `
"export default {
  applicationName: 'test-app',
  logo: 'data:image/svg+xml;base64,PCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KDTwhLS0gVXBsb2FkZWQgdG86IFNWRyBSZXBvLCB3d3cuc3ZncmVwby5jb20sIFRyYW5zZm9ybWVkIGJ5OiBTVkcgUmVwbyBNaXhlciBUb29scyAtLT4KPHN2ZyBmaWxsPSIjMjQ4YmFlIiB3aWR0aD0iODAwcHgiIGhlaWdodD0iODAwcHgiIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHN0cm9rZT0iIzI0OGJhZSI+Cg08ZyBpZD0iU1ZHUmVwb19iZ0NhcnJpZXIiIHN0cm9rZS13aWR0aD0iMCIvPgoNPGcgaWQ9IlNWR1JlcG9fdHJhY2VyQ2FycmllciIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+Cg08ZyBpZD0iU1ZHUmVwb19pY29uQ2FycmllciI+Cg08dGl0bGU+aW9uaWNvbnMtdjVfbG9nb3M8L3RpdGxlPgoNPHBhdGggZD0iTTQxMC42NiwxODAuNzJoMHEtNy42Ny0yLjYyLTE1LjQ1LTQuODgsMS4yOS01LjI1LDIuMzgtMTAuNTZjMTEuNy01Ni45LDQuMDUtMTAyLjc0LTIyLjA2LTExNy44My0yNS0xNC40OC02NiwuNjEtMTA3LjM2LDM2LjY5cS02LjEsNS4zNC0xMS45NSwxMS0zLjktMy43Ni04LTcuMzZjLTQzLjM1LTM4LjU4LTg2LjgtNTQuODMtMTEyLjg4LTM5LjY5LTI1LDE0LjUxLTMyLjQzLDU3LjYtMjEuOSwxMTEuNTNxMS41OCw4LDMuNTUsMTUuOTNjLTYuMTUsMS43NS0xMi4wOSwzLjYyLTE3Ljc3LDUuNkM0OC40NiwxOTguOSwxNiwyMjYuNzMsMTYsMjU1LjU5YzAsMjkuODIsMzQuODQsNTkuNzIsODcuNzcsNzcuODVxNi40NCwyLjE5LDEzLDQuMDdRMTE0LjY0LDM0NiwxMTMsMzU0LjY4Yy0xMCw1My0yLjIsOTUuMDcsMjIuNzUsMTA5LjQ5LDI1Ljc3LDE0Ljg5LDY5LS40MSwxMTEuMTQtMzcuMzFxNS00LjM4LDEwLTkuMjUsNi4zMiw2LjExLDEzLDExLjg2YzQwLjgsMzUuMTgsODEuMDksNDkuMzksMTA2LDM0LjkzLDI1Ljc1LTE0Ljk0LDM0LjEyLTYwLjE0LDIzLjI1LTExNS4xM3EtMS4yNS02LjMtMi44OC0xMi44Niw0LjU2LTEuMzUsOC45My0yLjc5YzU1LTE4LjI3LDkwLjgzLTQ3LjgxLDkwLjgzLTc4QzQ5NiwyMjYuNjIsNDYyLjUsMTk4LjYxLDQxMC42NiwxODAuNzJabS0xMjktODEuMDhjMzUuNDMtMzAuOTEsNjguNTUtNDMuMTEsODMuNjUtMzQuMzloMGMxNi4wNyw5LjI5LDIyLjMyLDQ2Ljc1LDEyLjIyLDk1Ljg4cS0xLDQuOC0yLjE2LDkuNTdhNDg3LjgzLDQ4Ny44MywwLDAsMC02NC4xOC0xMC4xNiw0ODEuMjcsNDgxLjI3LDAsMCwwLTQwLjU3LTUwLjc1UTI3NiwxMDQuNTcsMjgxLjY0LDk5LjY0Wk0xNTcuNzMsMjgwLjI1cTYuNTEsMTIuNiwxMy42MSwyNC44OSw3LjIzLDEyLjU0LDE1LjA3LDI0LjcxYTQzNS4yOCw0MzUuMjgsMCwwLDEtNDQuMjQtNy4xM0MxNDYuNDEsMzA5LDE1MS42MywyOTQuNzUsMTU3LjczLDI4MC4yNVptMC00OC4zM2MtNi0xNC4xOS0xMS4wOC0yOC4xNS0xNS4yNS00MS42MywxMy43LTMuMDcsMjguMy01LjU4LDQzLjUyLTcuNDhxLTcuNjUsMTEuOTQtMTQuNzIsMjQuMjNUMTU3LjcsMjMxLjkyWm0xMC45LDI0LjE3cTkuNDgtMTkuNzcsMjAuNDItMzguNzhoMHExMC45My0xOSwyMy4yNy0zNy4xM2MxNC4yOC0xLjA4LDI4LjkyLTEuNjUsNDMuNzEtMS42NXMyOS41Mi41Nyw0My43OSwxLjY2cTEyLjIxLDE4LjA5LDIzLjEzLDM3dDIwLjY5LDM4LjZRMzM0LDI3NS42MywzMjMsMjk0LjczaDBxLTEwLjkxLDE5LTIzLDM3LjI0Yy0xNC4yNSwxLTI5LDEuNTUtNDQsMS41NXMtMjkuNDctLjQ3LTQzLjQ2LTEuMzhxLTEyLjQzLTE4LjE5LTIzLjQ2LTM3LjI5VDE2OC42LDI1Ni4wOVpNMzQwLjc1LDMwNXE3LjI1LTEyLjU4LDEzLjkyLTI1LjQ5aDBhNDQwLjQxLDQ0MC40MSwwLDAsMSwxNi4xMiw0Mi4zMkE0MzQuNDQsNDM0LjQ0LDAsMCwxLDMyNiwzMjkuNDhRMzMzLjYyLDMxNy4zOSwzNDAuNzUsMzA1Wm0xMy43Mi03My4wN3EtNi42NC0xMi42NS0xMy44MS0yNWgwcS03LTEyLjE4LTE0LjU5LTI0LjA2YzE1LjMxLDEuOTQsMzAsNC41Miw0My43Nyw3LjY3QTQzOS44OSw0MzkuODksMCwwLDEsMzU0LjQ3LDIzMS45M1pNMjU2LjIzLDEyNC40OGgwYTQzOS43NSw0MzkuNzUsMCwwLDEsMjguMjUsMzQuMThxLTI4LjM1LTEuMzUtNTYuNzQsMEMyMzcuMDcsMTQ2LjMyLDI0Ni42MiwxMzQuODcsMjU2LjIzLDEyNC40OFpNMTQ1LjY2LDY1Ljg2YzE2LjA2LTkuMzIsNTEuNTcsNCw4OSwzNy4yNywyLjM5LDIuMTMsNC44LDQuMzYsNy4yLDYuNjdBNDkxLjM3LDQ5MS4zNywwLDAsMCwyMDEsMTYwLjUxYTQ5OS4xMiw0OTkuMTIsMCwwLDAtNjQuMDYsMTBxLTEuODMtNy4zNi0zLjMtMTQuODJoMEMxMjQuNTksMTA5LjQ2LDEzMC41OCw3NC42MSwxNDUuNjYsNjUuODZaTTEyMi4yNSwzMTcuNzFxLTYtMS43MS0xMS44NS0zLjcxYy0yMy40LTgtNDIuNzMtMTguNDQtNTYtMjkuODFDNDIuNTIsMjc0LDM2LjUsMjYzLjgzLDM2LjUsMjU1LjU5YzAtMTcuNTEsMjYuMDYtMzkuODUsNjkuNTItNTVxOC4xOS0yLjg1LDE2LjUyLTUuMjFhNDkzLjU0LDQ5My41NCwwLDAsMCwyMy40LDYwLjc1QTUwMi40Niw1MDIuNDYsMCwwLDAsMTIyLjI1LDMxNy43MVptMTExLjEzLDkzLjY3Yy0xOC42MywxNi4zMi0zNy4yOSwyNy44OS01My43NCwzMy43MmgwYy0xNC43OCw1LjIzLTI2LjU1LDUuMzgtMzMuNjYsMS4yNy0xNS4xNC04Ljc1LTIxLjQ0LTQyLjU0LTEyLjg1LTg3Ljg2cTEuNTMtOCwzLjUtMTZhNDgwLjg1LDQ4MC44NSwwLDAsMCw2NC42OSw5LjM5LDUwMS4yLDUwMS4yLDAsMCwwLDQxLjIsNTFDMjM5LjU0LDQwNS44MywyMzYuNDksNDA4LjY1LDIzMy4zOCw0MTEuMzhabTIzLjQyLTIzLjIyYy05LjcyLTEwLjUxLTE5LjQyLTIyLjE0LTI4Ljg4LTM0LjY0cTEzLjc5LjU0LDI4LjA4LjU0YzkuNzgsMCwxOS40Ni0uMjEsMjktLjY0QTQzOS4zMyw0MzkuMzMsMCwwLDEsMjU2LjgsMzg4LjE2Wm0xMjQuNTIsMjguNTljLTIuODYsMTUuNDQtOC42MSwyNS43NC0xNS43MiwyOS44Ni0xNS4xMyw4Ljc4LTQ3LjQ4LTIuNjMtODIuMzYtMzIuNzItNC0zLjQ0LTgtNy4xMy0xMi4wNy0xMWE0ODQuNTQsNDg0LjU0LDAsMCwwLDQwLjIzLTUxLjIsNDc3Ljg0LDQ3Ny44NCwwLDAsMCw2NS0xMC4wNXExLjQ3LDUuOTQsMi42LDExLjY0aDBDMzgzLjgxLDM3Ny41OCwzODQuNSwzOTkuNTYsMzgxLjMyLDQxNi43NVptMTcuNC0xMDIuNjRoMGMtMi42Mi44Ny01LjMyLDEuNzEtOC4wNiwyLjUzYTQ4My4yNiw0ODMuMjYsMCwwLDAtMjQuMzEtNjAuOTQsNDgxLjUyLDQ4MS41MiwwLDAsMCwyMy4zNi02MC4wNmM0LjkxLDEuNDMsOS42OCwyLjkzLDE0LjI3LDQuNTIsNDQuNDIsMTUuMzIsNzEuNTIsMzgsNzEuNTIsNTUuNDNDNDc1LjUsMjc0LjE5LDQ0Ni4yMywyOTguMzMsMzk4LjcyLDMxNC4xMVoiLz4KDTxwYXRoIGQ9Ik0yNTYsMjk4LjU1YTQzLDQzLDAsMSwwLTQyLjg2LTQzQTQyLjkxLDQyLjkxLDAsMCwwLDI1NiwyOTguNTVaIi8+Cg08L2c+Cg08L3N2Zz4=',
};
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > test-app/src/hooks/useAppLayout.tsx 1`] = `
"import { useContext } from 'react';
import { AppLayoutContext } from '../components/AppLayout';

export const useAppLayout = (): AppLayoutContext =>
  useContext(AppLayoutContext);
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > test-app/src/main.tsx 1`] = `
"import React from 'react';
import { createRoot } from 'react-dom/client';
import { I18nProvider } from '@cloudscape-design/components/i18n';
import messages from '@cloudscape-design/components/i18n/messages/all.en';
import '@cloudscape-design/global-styles/index.css';
import { RouterProvider, createRouter } from '@tanstack/react-router';
import { routeTree } from './routeTree.gen';

// eslint-disable-next-line @typescript-eslint/no-empty-object-type
export type RouterProviderContext = {};

const router = createRouter({
  routeTree,
  context: {},
});

// Register the router instance for type safety
declare module '@tanstack/react-router' {
  interface Register {
    router: typeof router;
  }
}

const App = () => {
  return <RouterProvider router={router} context={{}} />;
};

const root = document.getElementById('root');
root &&
  createRoot(root).render(
    <React.StrictMode>
      <I18nProvider locale="en" messages={[messages]}>
        <App />
      </I18nProvider>
    </React.StrictMode>,
  );
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > test-app/src/routeTree.gen.ts 1`] = `
"/* eslint-disable */

// @ts-nocheck

// noinspection JSUnusedGlobalSymbols

// This file was automatically generated by TanStack Router.
// You should NOT make any changes in this file as it will be overwritten.
// Additionally, you should also exclude this file from your linter and/or formatter to prevent it from being checked or modified.

// Import Routes

import { Route as rootRoute } from './routes/__root';
import { Route as IndexImport } from './routes/index';
import { Route as WelcomeIndexImport } from './routes/welcome/index';

// Create/Update Routes

const IndexRoute = IndexImport.update({
  id: '/',
  path: '/',
  getParentRoute: () => rootRoute,
} as any);

const WelcomeIndexRoute = WelcomeIndexImport.update({
  id: '/welcome/',
  path: '/welcome/',
  getParentRoute: () => rootRoute,
} as any);

// Populate the FileRoutesByPath interface

declare module '@tanstack/react-router' {
  interface FileRoutesByPath {
    '/': {
      id: '/';
      path: '/';
      fullPath: '/';
      preLoaderRoute: typeof IndexImport;
      parentRoute: typeof rootRoute;
    };
    '/welcome/': {
      id: '/welcome/';
      path: '/welcome';
      fullPath: '/welcome';
      preLoaderRoute: typeof WelcomeIndexImport;
      parentRoute: typeof rootRoute;
    };
  }
}

// Create and export the route tree

export interface FileRoutesByFullPath {
  '/': typeof IndexRoute;
  '/welcome': typeof WelcomeIndexRoute;
}

export interface FileRoutesByTo {
  '/': typeof IndexRoute;
  '/welcome': typeof WelcomeIndexRoute;
}

export interface FileRoutesById {
  __root__: typeof rootRoute;
  '/': typeof IndexRoute;
  '/welcome/': typeof WelcomeIndexRoute;
}

export interface FileRouteTypes {
  fileRoutesByFullPath: FileRoutesByFullPath;
  fullPaths: '/' | '/welcome';
  fileRoutesByTo: FileRoutesByTo;
  to: '/' | '/welcome';
  id: '__root__' | '/' | '/welcome/';
  fileRoutesById: FileRoutesById;
}

export interface RootRouteChildren {
  IndexRoute: typeof IndexRoute;
  WelcomeIndexRoute: typeof WelcomeIndexRoute;
}

const rootRouteChildren: RootRouteChildren = {
  IndexRoute: IndexRoute,
  WelcomeIndexRoute: WelcomeIndexRoute,
};

export const routeTree = rootRoute
  ._addFileChildren(rootRouteChildren)
  ._addFileTypes<FileRouteTypes>();

/* ROUTE_MANIFEST_START
{
  "routes": {
    "__root__": {
      "filePath": "__root.tsx",
      "children": [
        "/",
        "/welcome/"
      ]
    },
    "/": {
      "filePath": "index.tsx"
    },
    "/welcome/": {
      "filePath": "welcome/index.tsx"
    }
  }
}
ROUTE_MANIFEST_END */
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > test-app/src/routes/__root.tsx 1`] = `
"import { createRootRouteWithContext } from '@tanstack/react-router';
import AppLayout from '../components/AppLayout';
import { RouterProviderContext } from '../main';
import { Outlet } from '@tanstack/react-router';

export const Route = createRootRouteWithContext<RouterProviderContext>()({
  component: () => (
    <AppLayout>
      <Outlet />
    </AppLayout>
  ),
});
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > test-app/src/routes/index.tsx 1`] = `
"import {
  ContentLayout,
  Header,
  SpaceBetween,
  Container,
} from '@cloudscape-design/components';
import { createFileRoute } from '@tanstack/react-router';

export const Route = createFileRoute('/')({
  component: RouteComponent,
});

function RouteComponent() {
  return (
    <ContentLayout header={<Header>Welcome</Header>}>
      <SpaceBetween size="l">
        <Container>Welcome to your new React website!</Container>
      </SpaceBetween>
    </ContentLayout>
  );
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > test-app/src/styles.css 1`] = `
"@import 'tailwindcss';
/* You can add global styles to this file, and also import other style files */
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > test-app/tsconfig.app.json 1`] = `
"{
  "extends": "../tsconfig.base.json",
  "compilerOptions": {
    "outDir": "../dist/test-app/tsc",
    "tsBuildInfoFile": "../dist/test-app/tsc/tsconfig.lib.tsbuildinfo",
    "jsx": "react-jsx",
    "lib": ["DOM"],
    "types": [
      "node",
      "@nx/react/typings/cssmodule.d.ts",
      "@nx/react/typings/image.d.ts",
      "vite/client"
    ]
  },
  "exclude": [
    "src/**/*.spec.ts",
    "src/**/*.test.ts",
    "src/**/*.spec.tsx",
    "src/**/*.test.tsx",
    "src/**/*.spec.js",
    "src/**/*.test.js",
    "src/**/*.spec.jsx",
    "src/**/*.test.jsx",
    "vite.config.ts",
    "vite.config.mts",
    "vitest.config.ts",
    "vitest.config.mts"
  ],
  "include": ["src/**/*.js", "src/**/*.jsx", "src/**/*.ts", "src/**/*.tsx"]
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > test-app/tsconfig.json 1`] = `
"{
  "files": [],
  "include": [],
  "references": [
    {
      "path": "./tsconfig.app.json"
    },
    {
      "path": "./tsconfig.spec.json"
    }
  ],
  "extends": "../tsconfig.base.json",
  "compilerOptions": {
    "moduleResolution": "Bundler",
    "module": "Preserve"
  }
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > test-app/tsconfig.spec.json 1`] = `
"{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "outDir": "../dist/out-tsc",
    "types": [
      "vitest/globals",
      "vitest/importMeta",
      "vite/client",
      "node",
      "vitest",
      "@nx/react/typings/cssmodule.d.ts",
      "@nx/react/typings/image.d.ts"
    ]
  },
  "include": [
    "vite.config.ts",
    "vite.config.mts",
    "vitest.config.ts",
    "vitest.config.mts",
    "src/**/*.test.ts",
    "src/**/*.spec.ts",
    "src/**/*.test.tsx",
    "src/**/*.spec.tsx",
    "src/**/*.test.js",
    "src/**/*.spec.js",
    "src/**/*.test.jsx",
    "src/**/*.spec.jsx",
    "src/**/*.d.ts"
  ],
  "references": [
    {
      "path": "./tsconfig.app.json"
    }
  ]
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > test-app/vite.config.ts 1`] = `
"import tailwindcss from '@tailwindcss/vite';
import tsconfigPaths from 'vite-tsconfig-paths';
import { resolve } from 'path';
import { tanstackRouter } from '@tanstack/router-plugin/vite';
/// <reference types='vitest' />
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { nxViteTsPaths } from '@nx/vite/plugins/nx-tsconfig-paths.plugin';
import { nxCopyAssetsPlugin } from '@nx/vite/plugins/nx-copy-assets.plugin';

export default defineConfig(() => ({
  define: {
    global: {},
  },
  root: __dirname,
  cacheDir: '../node_modules/.vite/test-app',
  server: {
    port: 4200,
    host: 'localhost',
  },
  preview: {
    port: 4300,
    host: 'localhost',
  },
  plugins: [
    tanstackRouter({
      routesDirectory: resolve(__dirname, 'src/routes'),
      generatedRouteTree: resolve(__dirname, 'src/routeTree.gen.ts'),
    }),
    react(),
    nxViteTsPaths(),
    nxCopyAssetsPlugin(['*.md']),
    tailwindcss(),
    tsconfigPaths(),
  ],
  build: {
    outDir: '../dist/test-app',
    emptyOutDir: true,
    reportCompressedSize: true,
    commonjsOptions: {
      transformMixedEsModules: true,
    },
  },
  test: {
    name: '@proj/test-app',
    watch: false,
    globals: true,
    environment: 'jsdom',
    include: ['{src,tests}/**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}'],
    reporters: ['default'],
    coverage: {
      reportsDirectory: '../coverage/test-app',
      provider: 'v8' as const,
    },
    passWithNoTests: true,
  },
}));
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > tsconfig.base.json 1`] = `
"{
  "compilerOptions": {
    "paths": {
      ":proj/test-app": ["test-app/src/index.ts"],
      ":proj/common-constructs": ["packages/common/constructs/src/index.ts"]
    },
    "baseUrl": ".",
    "rootDir": "."
  }
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > tsconfig.json 1`] = `
"{
  "references": [
    {
      "path": "./test-app"
    },
    {
      "path": "./packages/common/constructs"
    }
  ]
}
"
`;

exports[`react-website generator > Tanstack router integration > should generate website with router correctly > vitest.workspace.ts 1`] = `
"export default [
  '**/vite.config.{mjs,js,ts,mts}',
  '**/vitest.config.{mjs,js,ts,mts}',
];
"
`;

exports[`react-website generator > should configure TypeScript correctly > tsconfig.json 1`] = `
{
  "compilerOptions": {
    "module": "Preserve",
    "moduleResolution": "Bundler",
  },
  "extends": "../tsconfig.base.json",
  "files": [],
  "include": [],
  "references": [
    {
      "path": "./tsconfig.app.json",
    },
    {
      "path": "./tsconfig.spec.json",
    },
  ],
}
`;

exports[`react-website generator > should configure vite correctly > vite.config.ts 1`] = `
"import tailwindcss from '@tailwindcss/vite';
import tsconfigPaths from 'vite-tsconfig-paths';
import { resolve } from 'path';
import { tanstackRouter } from '@tanstack/router-plugin/vite';
/// <reference types='vitest' />
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { nxViteTsPaths } from '@nx/vite/plugins/nx-tsconfig-paths.plugin';
import { nxCopyAssetsPlugin } from '@nx/vite/plugins/nx-copy-assets.plugin';

export default defineConfig(() => ({
  define: {
    global: {},
  },
  root: __dirname,
  cacheDir: '../node_modules/.vite/test-app',
  server: {
    port: 4200,
    host: 'localhost',
  },
  preview: {
    port: 4300,
    host: 'localhost',
  },
  plugins: [
    tanstackRouter({
      routesDirectory: resolve(__dirname, 'src/routes'),
      generatedRouteTree: resolve(__dirname, 'src/routeTree.gen.ts'),
    }),
    react(),
    nxViteTsPaths(),
    nxCopyAssetsPlugin(['*.md']),
    tailwindcss(),
    tsconfigPaths(),
  ],
  build: {
    outDir: '../dist/test-app',
    emptyOutDir: true,
    reportCompressedSize: true,
    commonjsOptions: {
      transformMixedEsModules: true,
    },
  },
  test: {
    name: '@proj/test-app',
    watch: false,
    globals: true,
    environment: 'jsdom',
    include: ['{src,tests}/**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}'],
    reporters: ['default'],
    coverage: {
      reportsDirectory: '../coverage/test-app',
      provider: 'v8' as const,
    },
    passWithNoTests: true,
  },
}));
"
`;

exports[`react-website generator > should generate base files and structure > app-layout.tsx 1`] = `
"import * as React from 'react';
import { createContext, useCallback, useEffect, useState } from 'react';
import Config from '../../config';

import {
  BreadcrumbGroup,
  BreadcrumbGroupProps,
  SideNavigation,
  TopNavigation,
} from '@cloudscape-design/components';
import CloudscapeAppLayout, {
  AppLayoutProps,
} from '@cloudscape-design/components/app-layout';
import { matchByPath, useLocation, useNavigate } from '@tanstack/react-router';

const getBreadcrumbs = (
  pathName: string,
  search: string,
  defaultBreadcrumb: string,
  availableRoutes?: string[],
) => {
  const segments = [
    defaultBreadcrumb,
    ...pathName.split('/').filter((segment) => segment !== ''),
  ];

  return segments.map((segment, i) => {
    const href =
      i === 0
        ? '/'
        : \`/\${segments
            .slice(1, i + 1)
            .join('/')
            .replace('//', '/')}\`;

    const matched =
      !availableRoutes || availableRoutes.find((r) => matchByPath(r, href, {}));

    return {
      href: matched ? \`\${href}\${search}\` : '#',
      text: segment,
    };
  });
};

export interface AppLayoutContext {
  appLayoutProps: AppLayoutProps;
  setAppLayoutProps: (props: AppLayoutProps) => void;
  displayHelpPanel: (helpContent: React.ReactNode) => void;
}

/**
 * Context for updating/retrieving the AppLayout.
 */
export const AppLayoutContext = createContext({
  appLayoutProps: {},
  // eslint-disable-next-line @typescript-eslint/no-empty-function
  setAppLayoutProps: (_: AppLayoutProps) => {},
  // eslint-disable-next-line @typescript-eslint/no-empty-function
  displayHelpPanel: (_: React.ReactNode) => {},
});

/**
 * Defines the App layout and contains logic for routing.
 */
const AppLayout: React.FC<React.PropsWithChildren> = ({ children }) => {
  const appLayout = React.useRef<AppLayoutProps.Ref>(null);
  const [appLayoutProps, setAppLayoutProps] = useState<AppLayoutProps>({});
  const setAppLayoutPropsSafe = useCallback(
    (props: AppLayoutProps) => {
      JSON.stringify(appLayoutProps) !== JSON.stringify(props) &&
        setAppLayoutProps(props);
    },
    [appLayoutProps],
  );

  const navigate = useNavigate();
  const [activeBreadcrumbs, setActiveBreadcrumbs] = useState<
    BreadcrumbGroupProps.Item[]
  >([{ text: '/', href: '/' }]);
  const { pathname, search } = useLocation();

  useEffect(() => {
    const breadcrumbs = getBreadcrumbs(
      pathname,
      Object.entries(search).reduce((p, [k, v]) => p + \`\${k}=\${v}\`, ''),
      '/',
    );
    setActiveBreadcrumbs(breadcrumbs);
  }, [pathname, search]);

  const onNavigate = useCallback(
    (e: CustomEvent<{ href: string; external?: boolean }>) => {
      if (!e.detail.external) {
        e.preventDefault();
        setAppLayoutPropsSafe({
          contentType: undefined,
        });
        navigate({ to: e.detail.href });
      }
    },
    [navigate, setAppLayoutPropsSafe],
  );

  return (
    <AppLayoutContext.Provider
      value={{
        appLayoutProps,
        setAppLayoutProps: setAppLayoutPropsSafe,
        displayHelpPanel: (helpContent: React.ReactNode) => {
          setAppLayoutPropsSafe({ tools: helpContent, toolsHide: false });
          appLayout.current?.openTools();
        },
      }}
    >
      <TopNavigation
        identity={{
          href: '/',
          title: Config.applicationName,
          logo: {
            src: Config.logo,
          },
        }}
      />
      <CloudscapeAppLayout
        ref={appLayout}
        breadcrumbs={
          <BreadcrumbGroup onFollow={onNavigate} items={activeBreadcrumbs} />
        }
        navigation={
          <SideNavigation
            header={{ text: Config.applicationName, href: '/' }}
            activeHref={pathname}
            onFollow={onNavigate}
            items={[{ text: 'Home', type: 'link', href: '/' }]}
          />
        }
        toolsHide
        content={children}
        {...appLayoutProps}
      />
    </AppLayoutContext.Provider>
  );
};

export default AppLayout;
"
`;

exports[`react-website generator > should generate base files and structure > config.ts 1`] = `
"export default {
  applicationName: 'test-app',
  logo: 'data:image/svg+xml;base64,PCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KDTwhLS0gVXBsb2FkZWQgdG86IFNWRyBSZXBvLCB3d3cuc3ZncmVwby5jb20sIFRyYW5zZm9ybWVkIGJ5OiBTVkcgUmVwbyBNaXhlciBUb29scyAtLT4KPHN2ZyBmaWxsPSIjMjQ4YmFlIiB3aWR0aD0iODAwcHgiIGhlaWdodD0iODAwcHgiIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHN0cm9rZT0iIzI0OGJhZSI+Cg08ZyBpZD0iU1ZHUmVwb19iZ0NhcnJpZXIiIHN0cm9rZS13aWR0aD0iMCIvPgoNPGcgaWQ9IlNWR1JlcG9fdHJhY2VyQ2FycmllciIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+Cg08ZyBpZD0iU1ZHUmVwb19pY29uQ2FycmllciI+Cg08dGl0bGU+aW9uaWNvbnMtdjVfbG9nb3M8L3RpdGxlPgoNPHBhdGggZD0iTTQxMC42NiwxODAuNzJoMHEtNy42Ny0yLjYyLTE1LjQ1LTQuODgsMS4yOS01LjI1LDIuMzgtMTAuNTZjMTEuNy01Ni45LDQuMDUtMTAyLjc0LTIyLjA2LTExNy44My0yNS0xNC40OC02NiwuNjEtMTA3LjM2LDM2LjY5cS02LjEsNS4zNC0xMS45NSwxMS0zLjktMy43Ni04LTcuMzZjLTQzLjM1LTM4LjU4LTg2LjgtNTQuODMtMTEyLjg4LTM5LjY5LTI1LDE0LjUxLTMyLjQzLDU3LjYtMjEuOSwxMTEuNTNxMS41OCw4LDMuNTUsMTUuOTNjLTYuMTUsMS43NS0xMi4wOSwzLjYyLTE3Ljc3LDUuNkM0OC40NiwxOTguOSwxNiwyMjYuNzMsMTYsMjU1LjU5YzAsMjkuODIsMzQuODQsNTkuNzIsODcuNzcsNzcuODVxNi40NCwyLjE5LDEzLDQuMDdRMTE0LjY0LDM0NiwxMTMsMzU0LjY4Yy0xMCw1My0yLjIsOTUuMDcsMjIuNzUsMTA5LjQ5LDI1Ljc3LDE0Ljg5LDY5LS40MSwxMTEuMTQtMzcuMzFxNS00LjM4LDEwLTkuMjUsNi4zMiw2LjExLDEzLDExLjg2YzQwLjgsMzUuMTgsODEuMDksNDkuMzksMTA2LDM0LjkzLDI1Ljc1LTE0Ljk0LDM0LjEyLTYwLjE0LDIzLjI1LTExNS4xM3EtMS4yNS02LjMtMi44OC0xMi44Niw0LjU2LTEuMzUsOC45My0yLjc5YzU1LTE4LjI3LDkwLjgzLTQ3LjgxLDkwLjgzLTc4QzQ5NiwyMjYuNjIsNDYyLjUsMTk4LjYxLDQxMC42NiwxODAuNzJabS0xMjktODEuMDhjMzUuNDMtMzAuOTEsNjguNTUtNDMuMTEsODMuNjUtMzQuMzloMGMxNi4wNyw5LjI5LDIyLjMyLDQ2Ljc1LDEyLjIyLDk1Ljg4cS0xLDQuOC0yLjE2LDkuNTdhNDg3LjgzLDQ4Ny44MywwLDAsMC02NC4xOC0xMC4xNiw0ODEuMjcsNDgxLjI3LDAsMCwwLTQwLjU3LTUwLjc1UTI3NiwxMDQuNTcsMjgxLjY0LDk5LjY0Wk0xNTcuNzMsMjgwLjI1cTYuNTEsMTIuNiwxMy42MSwyNC44OSw3LjIzLDEyLjU0LDE1LjA3LDI0LjcxYTQzNS4yOCw0MzUuMjgsMCwwLDEtNDQuMjQtNy4xM0MxNDYuNDEsMzA5LDE1MS42MywyOTQuNzUsMTU3LjczLDI4MC4yNVptMC00OC4zM2MtNi0xNC4xOS0xMS4wOC0yOC4xNS0xNS4yNS00MS42MywxMy43LTMuMDcsMjguMy01LjU4LDQzLjUyLTcuNDhxLTcuNjUsMTEuOTQtMTQuNzIsMjQuMjNUMTU3LjcsMjMxLjkyWm0xMC45LDI0LjE3cTkuNDgtMTkuNzcsMjAuNDItMzguNzhoMHExMC45My0xOSwyMy4yNy0zNy4xM2MxNC4yOC0xLjA4LDI4LjkyLTEuNjUsNDMuNzEtMS42NXMyOS41Mi41Nyw0My43OSwxLjY2cTEyLjIxLDE4LjA5LDIzLjEzLDM3dDIwLjY5LDM4LjZRMzM0LDI3NS42MywzMjMsMjk0LjczaDBxLTEwLjkxLDE5LTIzLDM3LjI0Yy0xNC4yNSwxLTI5LDEuNTUtNDQsMS41NXMtMjkuNDctLjQ3LTQzLjQ2LTEuMzhxLTEyLjQzLTE4LjE5LTIzLjQ2LTM3LjI5VDE2OC42LDI1Ni4wOVpNMzQwLjc1LDMwNXE3LjI1LTEyLjU4LDEzLjkyLTI1LjQ5aDBhNDQwLjQxLDQ0MC40MSwwLDAsMSwxNi4xMiw0Mi4zMkE0MzQuNDQsNDM0LjQ0LDAsMCwxLDMyNiwzMjkuNDhRMzMzLjYyLDMxNy4zOSwzNDAuNzUsMzA1Wm0xMy43Mi03My4wN3EtNi42NC0xMi42NS0xMy44MS0yNWgwcS03LTEyLjE4LTE0LjU5LTI0LjA2YzE1LjMxLDEuOTQsMzAsNC41Miw0My43Nyw3LjY3QTQzOS44OSw0MzkuODksMCwwLDEsMzU0LjQ3LDIzMS45M1pNMjU2LjIzLDEyNC40OGgwYTQzOS43NSw0MzkuNzUsMCwwLDEsMjguMjUsMzQuMThxLTI4LjM1LTEuMzUtNTYuNzQsMEMyMzcuMDcsMTQ2LjMyLDI0Ni42MiwxMzQuODcsMjU2LjIzLDEyNC40OFpNMTQ1LjY2LDY1Ljg2YzE2LjA2LTkuMzIsNTEuNTcsNCw4OSwzNy4yNywyLjM5LDIuMTMsNC44LDQuMzYsNy4yLDYuNjdBNDkxLjM3LDQ5MS4zNywwLDAsMCwyMDEsMTYwLjUxYTQ5OS4xMiw0OTkuMTIsMCwwLDAtNjQuMDYsMTBxLTEuODMtNy4zNi0zLjMtMTQuODJoMEMxMjQuNTksMTA5LjQ2LDEzMC41OCw3NC42MSwxNDUuNjYsNjUuODZaTTEyMi4yNSwzMTcuNzFxLTYtMS43MS0xMS44NS0zLjcxYy0yMy40LTgtNDIuNzMtMTguNDQtNTYtMjkuODFDNDIuNTIsMjc0LDM2LjUsMjYzLjgzLDM2LjUsMjU1LjU5YzAtMTcuNTEsMjYuMDYtMzkuODUsNjkuNTItNTVxOC4xOS0yLjg1LDE2LjUyLTUuMjFhNDkzLjU0LDQ5My41NCwwLDAsMCwyMy40LDYwLjc1QTUwMi40Niw1MDIuNDYsMCwwLDAsMTIyLjI1LDMxNy43MVptMTExLjEzLDkzLjY3Yy0xOC42MywxNi4zMi0zNy4yOSwyNy44OS01My43NCwzMy43MmgwYy0xNC43OCw1LjIzLTI2LjU1LDUuMzgtMzMuNjYsMS4yNy0xNS4xNC04Ljc1LTIxLjQ0LTQyLjU0LTEyLjg1LTg3Ljg2cTEuNTMtOCwzLjUtMTZhNDgwLjg1LDQ4MC44NSwwLDAsMCw2NC42OSw5LjM5LDUwMS4yLDUwMS4yLDAsMCwwLDQxLjIsNTFDMjM5LjU0LDQwNS44MywyMzYuNDksNDA4LjY1LDIzMy4zOCw0MTEuMzhabTIzLjQyLTIzLjIyYy05LjcyLTEwLjUxLTE5LjQyLTIyLjE0LTI4Ljg4LTM0LjY0cTEzLjc5LjU0LDI4LjA4LjU0YzkuNzgsMCwxOS40Ni0uMjEsMjktLjY0QTQzOS4zMyw0MzkuMzMsMCwwLDEsMjU2LjgsMzg4LjE2Wm0xMjQuNTIsMjguNTljLTIuODYsMTUuNDQtOC42MSwyNS43NC0xNS43MiwyOS44Ni0xNS4xMyw4Ljc4LTQ3LjQ4LTIuNjMtODIuMzYtMzIuNzItNC0zLjQ0LTgtNy4xMy0xMi4wNy0xMWE0ODQuNTQsNDg0LjU0LDAsMCwwLDQwLjIzLTUxLjIsNDc3Ljg0LDQ3Ny44NCwwLDAsMCw2NS0xMC4wNXExLjQ3LDUuOTQsMi42LDExLjY0aDBDMzgzLjgxLDM3Ny41OCwzODQuNSwzOTkuNTYsMzgxLjMyLDQxNi43NVptMTcuNC0xMDIuNjRoMGMtMi42Mi44Ny01LjMyLDEuNzEtOC4wNiwyLjUzYTQ4My4yNiw0ODMuMjYsMCwwLDAtMjQuMzEtNjAuOTQsNDgxLjUyLDQ4MS41MiwwLDAsMCwyMy4zNi02MC4wNmM0LjkxLDEuNDMsOS42OCwyLjkzLDE0LjI3LDQuNTIsNDQuNDIsMTUuMzIsNzEuNTIsMzgsNzEuNTIsNTUuNDNDNDc1LjUsMjc0LjE5LDQ0Ni4yMywyOTguMzMsMzk4LjcyLDMxNC4xMVoiLz4KDTxwYXRoIGQ9Ik0yNTYsMjk4LjU1YTQzLDQzLDAsMSwwLTQyLjg2LTQzQTQyLjkxLDQyLjkxLDAsMCwwLDI1NiwyOTguNTVaIi8+Cg08L2c+Cg08L3N2Zz4=',
};
"
`;

exports[`react-website generator > should generate base files and structure > index.tsx 1`] = `
"import {
  ContentLayout,
  Header,
  SpaceBetween,
  Container,
} from '@cloudscape-design/components';
import { createFileRoute } from '@tanstack/react-router';

export const Route = createFileRoute('/')({
  component: RouteComponent,
});

function RouteComponent() {
  return (
    <ContentLayout header={<Header>Welcome</Header>}>
      <SpaceBetween size="l">
        <Container>Welcome to your new React website!</Container>
      </SpaceBetween>
    </ContentLayout>
  );
}
"
`;

exports[`react-website generator > should generate base files and structure > main.tsx 1`] = `
"import React from 'react';
import { createRoot } from 'react-dom/client';
import { I18nProvider } from '@cloudscape-design/components/i18n';
import messages from '@cloudscape-design/components/i18n/messages/all.en';
import '@cloudscape-design/global-styles/index.css';
import { RouterProvider, createRouter } from '@tanstack/react-router';
import { routeTree } from './routeTree.gen';

// eslint-disable-next-line @typescript-eslint/no-empty-object-type
export type RouterProviderContext = {};

const router = createRouter({
  routeTree,
  context: {},
});

// Register the router instance for type safety
declare module '@tanstack/react-router' {
  interface Register {
    router: typeof router;
  }
}

const App = () => {
  return <RouterProvider router={router} context={{}} />;
};

const root = document.getElementById('root');
root &&
  createRoot(root).render(
    <React.StrictMode>
      <I18nProvider locale="en" messages={[messages]}>
        <App />
      </I18nProvider>
    </React.StrictMode>,
  );
"
`;

exports[`react-website generator > should generate shared constructs > common/constructs-app-index.ts 1`] = `
"export * from './test-app.js';
"
`;

exports[`react-website generator > should generate shared constructs > common/constructs-core-index.ts 1`] = `
"export * from './static-website.js';
export * from './app.js';
export * from './checkov.js';
export * from './runtime-config.js';
"
`;

exports[`react-website generator > should generate shared constructs > common/constructs-core-static-website.ts 1`] = `
"import { CfnOutput, CfnResource, RemovalPolicy, Stack } from 'aws-cdk-lib';
import { Distribution, ViewerProtocolPolicy } from 'aws-cdk-lib/aws-cloudfront';
import { S3BucketOrigin } from 'aws-cdk-lib/aws-cloudfront-origins';
import {
  BlockPublicAccess,
  Bucket,
  BucketEncryption,
  IBucket,
  ObjectOwnership,
} from 'aws-cdk-lib/aws-s3';
import { BucketDeployment, Source } from 'aws-cdk-lib/aws-s3-deployment';
import { Construct } from 'constructs';
import { RuntimeConfig } from './runtime-config.js';
import { Key } from 'aws-cdk-lib/aws-kms';
import { CfnWebACL } from 'aws-cdk-lib/aws-wafv2';
import { suppressRules } from './checkov.js';

const DEFAULT_RUNTIME_CONFIG_FILENAME = 'runtime-config.json';

export interface StaticWebsiteProps {
  readonly websiteName: string;
  readonly websiteFilePath: string;
}

/**
 * Deploys a Static Website using by default a private S3 bucket as an origin and Cloudfront as the entrypoint.
 *
 * This construct configures a webAcl containing rules that are generally applicable to web applications. This
 * provides protection against exploitation of a wide range of vulnerabilities, including some of the high risk
 * and commonly occurring vulnerabilities described in OWASP publications such as OWASP Top 10.
 *
 */
export class StaticWebsite extends Construct {
  public readonly websiteBucket: IBucket;
  public readonly cloudFrontDistribution: Distribution;
  public readonly bucketDeployment: BucketDeployment;

  constructor(
    scope: Construct,
    id: string,
    { websiteFilePath, websiteName }: StaticWebsiteProps,
  ) {
    super(scope, id);
    this.node.setContext(
      '@aws-cdk/aws-s3:serverAccessLogsUseBucketPolicy',
      true,
    );

    const websiteKey = new Key(this, 'WebsiteKey', {
      enableKeyRotation: true,
    });

    const accessLogsBucket = new Bucket(this, 'AccessLogsBucket', {
      versioned: false,
      enforceSSL: true,
      autoDeleteObjects: true,
      removalPolicy: RemovalPolicy.DESTROY,
      encryption: BucketEncryption.KMS,
      encryptionKey: websiteKey,
      objectOwnership: ObjectOwnership.OBJECT_WRITER,
      publicReadAccess: false,
      blockPublicAccess: BlockPublicAccess.BLOCK_ALL,
    });
    suppressRules(
      accessLogsBucket,
      ['CKV_AWS_21'],
      'Access log bucket does not need versioning enabled',
    );
    suppressRules(
      accessLogsBucket,
      ['CKV_AWS_18'],
      'Access log bucket does not need an access log bucket',
    );

    // S3 Bucket to hold website files
    this.websiteBucket = new Bucket(this, 'WebsiteBucket', {
      versioned: true,
      enforceSSL: true,
      autoDeleteObjects: true,
      removalPolicy: RemovalPolicy.DESTROY,
      encryption: BucketEncryption.KMS,
      encryptionKey: websiteKey,
      objectOwnership: ObjectOwnership.BUCKET_OWNER_ENFORCED,
      publicReadAccess: false,
      blockPublicAccess: BlockPublicAccess.BLOCK_ALL,
      serverAccessLogsPrefix: 'website-access-logs',
      serverAccessLogsBucket: accessLogsBucket,
    });
    // Web ACL
    const wafStack = new CloudfrontWebAcl(this, 'waf');

    // Cloudfront Distribution
    const logBucket = new Bucket(this, 'DistributionLogBucket', {
      enforceSSL: true,
      autoDeleteObjects: true,
      removalPolicy: RemovalPolicy.DESTROY,
      encryption: BucketEncryption.KMS,
      encryptionKey: websiteKey,
      objectOwnership: ObjectOwnership.BUCKET_OWNER_PREFERRED,
      publicReadAccess: false,
      blockPublicAccess: BlockPublicAccess.BLOCK_ALL,
      serverAccessLogsPrefix: 'distribution-access-logs',
      serverAccessLogsBucket: accessLogsBucket,
    });
    suppressRules(
      logBucket,
      ['CKV_AWS_21'],
      'Distribution log bucket does not need versioning enabled',
    );

    const defaultRootObject = 'index.html';
    this.cloudFrontDistribution = new Distribution(
      this,
      'CloudfrontDistribution',
      {
        webAclId: wafStack.wafArn,
        enableLogging: true,
        logBucket: logBucket,
        defaultBehavior: {
          origin: S3BucketOrigin.withOriginAccessControl(this.websiteBucket),
          viewerProtocolPolicy: ViewerProtocolPolicy.REDIRECT_TO_HTTPS,
        },
        defaultRootObject,
        errorResponses: [
          {
            httpStatus: 404, // We need to redirect "key not found errors" to index.html for single page apps
            responseHttpStatus: 200,
            responsePagePath: \`/\${defaultRootObject}\`,
          },
          {
            httpStatus: 403, // We need to redirect reloads from paths (e.g. /foo/bar) to index.html for single page apps
            responseHttpStatus: 200,
            responsePagePath: \`/\${defaultRootObject}\`,
          },
        ],
      },
    );
    suppressRules(
      this.cloudFrontDistribution,
      ['CKV_AWS_174'],
      'Cloudfront default certificate does not use TLS 1.2',
    );

    // Deploy Website
    this.bucketDeployment = new BucketDeployment(this, 'WebsiteDeployment', {
      sources: [
        Source.asset(websiteFilePath),
        Source.jsonData(
          DEFAULT_RUNTIME_CONFIG_FILENAME,
          RuntimeConfig.ensure(this).config,
        ),
      ],
      destinationBucket: this.websiteBucket,
      // Files in the distribution's edge caches will be invalidated after files are uploaded to the destination bucket.
      distribution: this.cloudFrontDistribution,
      memoryLimit: 1024,
    });

    suppressRules(
      Stack.of(this),
      ['CKV_AWS_111'],
      'CDK Bucket Deployment uses wildcard to deploy arbitrary assets',
      (c) =>
        CfnResource.isCfnResource(c) &&
        c.cfnResourceType === 'AWS::IAM::Policy' &&
        c.node.path.includes(\`/Custom::CDKBucketDeployment\`),
    );

    new CfnOutput(this, 'DistributionDomainName', {
      value: this.cloudFrontDistribution.domainName,
    });
    new CfnOutput(this, \`\${websiteName}WebsiteBucketName\`, {
      value: this.websiteBucket.bucketName,
    });
  }
}

export class CloudfrontWebAcl extends Stack {
  public readonly wafArn;
  constructor(scope: Construct, id: string) {
    super(scope, id, {
      env: {
        region: 'us-east-1',
        account: Stack.of(scope).account,
      },
      crossRegionReferences: true,
    });

    this.wafArn = new CfnWebACL(this, 'WebAcl', {
      defaultAction: { allow: {} },
      scope: 'CLOUDFRONT',
      visibilityConfig: {
        cloudWatchMetricsEnabled: true,
        metricName: id,
        sampledRequestsEnabled: true,
      },
      rules: [
        {
          name: 'CRSRule',
          priority: 0,
          statement: {
            managedRuleGroupStatement: {
              name: 'AWSManagedRulesCommonRuleSet',
              vendorName: 'AWS',
            },
          },
          visibilityConfig: {
            cloudWatchMetricsEnabled: true,
            metricName: 'MetricForWebACLCDK-CRS',
            sampledRequestsEnabled: true,
          },
          overrideAction: {
            none: {},
          },
        },
        {
          name: 'KnownBadInputsRule',
          priority: 1,
          statement: {
            managedRuleGroupStatement: {
              name: 'AWSManagedRulesKnownBadInputsRuleSet',
              vendorName: 'AWS',
            },
          },
          visibilityConfig: {
            cloudWatchMetricsEnabled: true,
            metricName: 'MetricForWebACLCDK-CRS',
            sampledRequestsEnabled: true,
          },
          overrideAction: {
            none: {},
          },
        },
      ],
    }).attrArn;
  }
}
"
`;

exports[`react-website generator > should generate shared constructs > test-app.ts 1`] = `
"import * as url from 'url';
import { Construct } from 'constructs';
import { StaticWebsite } from '../../core/index.js';

export class TestApp extends StaticWebsite {
  constructor(scope: Construct, id: string) {
    super(scope, id, {
      websiteName: 'TestApp',
      websiteFilePath: url.fileURLToPath(
        new URL('../../../../../../dist/test-app/bundle', import.meta.url),
      ),
    });
  }
}
"
`;

exports[`react-website generator > should handle custom directory option > custom-dir-main.tsx 1`] = `
"import React from 'react';
import { createRoot } from 'react-dom/client';
import { I18nProvider } from '@cloudscape-design/components/i18n';
import messages from '@cloudscape-design/components/i18n/messages/all.en';
import '@cloudscape-design/global-styles/index.css';
import { RouterProvider, createRouter } from '@tanstack/react-router';
import { routeTree } from './routeTree.gen';

// eslint-disable-next-line @typescript-eslint/no-empty-object-type
export type RouterProviderContext = {};

const router = createRouter({
  routeTree,
  context: {},
});

// Register the router instance for type safety
declare module '@tanstack/react-router' {
  interface Register {
    router: typeof router;
  }
}

const App = () => {
  return <RouterProvider router={router} context={{}} />;
};

const root = document.getElementById('root');
root &&
  createRoot(root).render(
    <React.StrictMode>
      <I18nProvider locale="en" messages={[messages]}>
        <App />
      </I18nProvider>
    </React.StrictMode>,
  );
"
`;

exports[`react-website generator > should handle npm scope prefix correctly > scoped-dependencies 1`] = `
{
  "@cloudscape-design/board-components": "3.0.119",
  "@cloudscape-design/components": "3.0.1097",
  "@cloudscape-design/global-styles": "1.0.45",
  "@tanstack/react-router": "1.132.7",
  "aws-cdk-lib": "2.217.0",
  "constructs": "10.4.2",
  "react": "19.0.0",
  "react-dom": "19.0.0",
  "tailwindcss": "4.1.13",
}
`;
