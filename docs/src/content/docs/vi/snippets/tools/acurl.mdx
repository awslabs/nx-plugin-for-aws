---
title: "AWS Sigv4 Curl"
---

import { Tabs, TabItem } from '@astrojs/starlight/components';

<Tabs>
  <TabItem label="Bash/Linux/macOS">
Bạn có thể thêm script sau vào file `.bashrc` của mình (và `source` nó) hoặc dán trực tiếp vào terminal mà bạn muốn chạy lệnh.
```bash
// ~/.bashrc
acurl () {
    REGION=$1
    SERVICE=$2
    shift; shift;
    curl --aws-sigv4 "aws:amz:$REGION:$SERVICE" --user "$(aws configure get aws_access_key_id):$(aws configure get aws_secret_access_key)" -H "X-Amz-Security-Token: $(aws configure get aws_session_token)" "$@"
}
```

Để thực hiện một yêu cầu curl được xác thực `sigv4`, hãy gọi `acurl` như sau:

```bash
acurl <region> <service> <other-curl-arguments>
```

Ví dụ:

###### API Gateway
```bash
acurl ap-southeast-2 execute-api -X GET https://xxx
```

###### Streaming Lambda function url
```bash
acurl ap-southeast-2 lambda -N -X POST https://xxx
```
  </TabItem>
  <TabItem label="Windows PowerShell">
Bạn có thể thêm hàm sau vào PowerShell profile của mình hoặc dán trực tiếp vào phiên PowerShell mà bạn muốn chạy lệnh.
```powershell
# PowerShell profile or current session
function acurl {
    param(
        [Parameter(Mandatory=$true)][string]$Region,
        [Parameter(Mandatory=$true)][string]$Service,
        [Parameter(ValueFromRemainingArguments=$true)][string[]]$CurlArgs
    )

    $AccessKey = aws configure get aws_access_key_id
    $SecretKey = aws configure get aws_secret_access_key
    $SessionToken = aws configure get aws_session_token

    & curl --aws-sigv4 "aws:amz:$Region`:$Service" --user "$AccessKey`:$SecretKey" -H "X-Amz-Security-Token: $SessionToken" @CurlArgs
}
```

Để thực hiện một yêu cầu curl được xác thực `sigv4`, hãy gọi `acurl` bằng các ví dụ sau:

###### API Gateway
```powershell
acurl ap-southeast-2 execute-api -X GET https://xxx
```

###### Streaming Lambda function url
```powershell
acurl ap-southeast-2 lambda -N -X POST https://xxx
```
  </TabItem>
</Tabs>

:::caution
Hỗ trợ AWS Signature v4 đã được thêm vào trong các phiên bản gần đây của `curl`, và đã có một số sửa lỗi trong hỗ trợ này trong những năm gần đây. Khuyến nghị bạn nên cài đặt `curl` phiên bản 8.17.0 hoặc cao hơn. Phiên bản được phân phối cùng hệ điều hành của bạn có thể đã lỗi thời.
:::