---
title: "XÃ¢y dá»±ng giao diá»‡n ngÆ°á»i dÃ¹ng"
description: "HÆ°á»›ng dáº«n chi tiáº¿t cÃ¡ch xÃ¢y dá»±ng trÃ² chÆ¡i phiÃªu lÆ°u háº§m ngá»¥c Ä‘Æ°á»£c há»— trá»£ bá»Ÿi AI tÃ¡c nhÃ¢n sá»­ dá»¥ng @aws/nx-plugin."
---

import { Aside, Code, FileTree, Steps, Tabs, TabItem } from '@astrojs/starlight/components';
import { Image } from 'astro:assets';
import Drawer from '@components/drawer.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import InstallCommand from '@components/install-command.astro';
import E2ECode from '@components/e2e-code.astro';
import E2EDiff from '@components/e2e-diff.astro';

import dungeonAdventureArchitecturePng from '@assets/dungeon-game-architecture.png'
import dungeonAdventureErPng from '@assets/dungeon-adventure-er.png'
import baselineWebsitePng from '@assets/baseline-website.png'
import baselineGamePng from '@assets/baseline-game.png'
import nxGraphPng from '@assets/nx-graph.png'
import gameSelectPng from '@assets/game-select.png'
import gameConversationPng from '@assets/game-conversation.png'

## Nhiá»‡m vá»¥ 1: Cáº¥u hÃ¬nh mÃ¡y chá»§ phÃ¡t triá»ƒn cá»¥c bá»™

Äá»ƒ báº¯t Ä‘áº§u xÃ¢y dá»±ng giao diá»‡n ngÆ°á»i dÃ¹ng, chÃºng ta cáº§n cáº¥u hÃ¬nh mÃ¡y chá»§ phÃ¡t triá»ƒn cá»¥c bá»™ Ä‘á»ƒ trá» Ä‘áº¿n sandbox Ä‘Ã£ triá»ƒn khai cá»§a chÃºng ta. Äá»ƒ thá»±c hiá»‡n Ä‘iá»u nÃ y, hÃ£y cháº¡y lá»‡nh sau:

<NxCommands commands={["run @dungeon-adventure/game-ui:load:runtime-config"]} />

Lá»‡nh nÃ y sáº½ táº£i xuá»‘ng file `runtime-config.json` Ä‘Ã£ Ä‘Æ°á»£c triá»ƒn khai vÃ  lÆ°u trá»¯ nÃ³ cá»¥c bá»™ trong thÆ° má»¥c `packages/game-ui/public`.

Äá»ƒ khá»Ÿi Ä‘á»™ng mÃ¡y chá»§ phÃ¡t triá»ƒn, hÃ£y cháº¡y lá»‡nh sau:

<NxCommands commands={["run @dungeon-adventure/game-ui:serve"]} />

Má»Ÿ trang web cá»¥c bá»™ cá»§a báº¡n trong trÃ¬nh duyá»‡t, nÆ¡i báº¡n sáº½ Ä‘Æ°á»£c nháº¯c Ä‘Äƒng nháº­p vÃ  lÃ m theo cÃ¡c hÆ°á»›ng dáº«n Ä‘á»ƒ táº¡o ngÆ°á»i dÃ¹ng má»›i. Sau khi hoÃ n táº¥t, báº¡n sáº½ tháº¥y trang web cÆ¡ báº£n:

<Image src={baselineWebsitePng} alt="baseline-website.png" width="800" height="600" />

<Aside type="caution">
ChÃºng tÃ´i khuyáº¿n nghá»‹ giá»¯ mÃ¡y chá»§ phÃ¡t triá»ƒn cháº¡y trong suá»‘t pháº§n cÃ²n láº¡i cá»§a module nÃ y vÃ¬ nÃ³ sáº½ tá»± Ä‘á»™ng táº£i láº¡i báº¥t ká»³ thay Ä‘á»•i nÃ o chÃºng ta thá»±c hiá»‡n.
</Aside>

:::tip
Báº¡n cÃ³ thá»ƒ cháº¡y cÃ¡c lá»‡nh Nx thay tháº¿ Ä‘á»ƒ khá»Ÿi Ä‘á»™ng báº¥t ká»³ mÃ¡y chá»§ API cá»¥c bá»™ nÃ o Ä‘Æ°á»£c káº¿t ná»‘i, cho phÃ©p báº¡n láº·p láº¡i cáº£ tRPC API vÃ  trang web cá»§a báº¡n cÃ¹ng nhau. <NxCommands commands={["run @dungeon-adventure/game-ui:serve-local"]} /> 
:::

## Nhiá»‡m vá»¥ 2: Táº¡o route '/game' má»›i

HÃ£y giá»›i thiá»‡u cÃ¡c kháº£ nÄƒng cá»§a `@tanstack/react-router` báº±ng cÃ¡ch táº¡o má»™t route an toÃ n kiá»ƒu má»›i.
Äá»ƒ thá»±c hiá»‡n Ä‘iá»u nÃ y, hÃ£y táº¡o má»™t file trá»‘ng táº¡i vá»‹ trÃ­ sau: `packages/game-ui/src/routes/game/index.tsx`. Báº¡n sáº½ nháº­n tháº¥y file Ä‘Æ°á»£c cáº­p nháº­t ngay láº­p tá»©c.

`@tanstack/react-router` tá»± Ä‘á»™ng cáº¥u hÃ¬nh route má»›i cá»§a báº¡n vÃ  file báº¡n vá»«a táº¡o Ä‘Ã£ Ä‘Æ°á»£c Ä‘iá»n sáºµn vá»›i Ä‘Æ°á»ng dáº«n route:

```tsx
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/game/')({
  component: RouteComponent,
})

function RouteComponent() {
  return <div>Hello "/game/"!</div>
}
```

Náº¿u báº¡n Ä‘iá»u hÆ°á»›ng Ä‘áº¿n `http://localhost:4200/game`, báº¡n sáº½ tháº¥y trang má»›i cá»§a báº¡n Ä‘Ã£ Ä‘Æ°á»£c hiá»ƒn thá»‹.

<Image src={baselineGamePng} alt="baseline-game.png" width="800" height="600" />

Cáº­p nháº­t file `index.tsx` Ä‘á»ƒ táº£i route `/game` má»›i cá»§a chÃºng ta theo máº·c Ä‘á»‹nh. Khi báº¡n cáº­p nháº­t trÆ°á»ng `to`, báº¡n cÃ³ danh sÃ¡ch cÃ¡c route an toÃ n kiá»ƒu Ä‘á»ƒ chá»n.

<Tabs>
<TabItem label="routes/index.tsx">
<E2EDiff before="dungeon-adventure/4/routes/index.tsx.old.template" after="dungeon-adventure/4/routes/index.tsx.template" lang="tsx" />
</TabItem>
</Tabs>

Báº¡n cÃ³ thá»ƒ xÃ³a thÆ° má»¥c `packages/game-ui/src/routes/welcome/` vÃ¬ nÃ³ khÃ´ng cÃ²n cáº§n thiáº¿t ná»¯a.

## Nhiá»‡m vá»¥ 3: Cáº­p nháº­t layout

Layout máº·c Ä‘á»‹nh Ä‘Æ°á»£c cáº¥u hÃ¬nh giá»‘ng vá»›i á»©ng dá»¥ng kinh doanh kiá»ƒu SaaS hÆ¡n lÃ  má»™t trÃ² chÆ¡i.
Äá»ƒ cáº¥u hÃ¬nh láº¡i layout vÃ  thay Ä‘á»•i theme Ä‘á»ƒ giá»‘ng vá»›i trÃ² chÆ¡i kiá»ƒu háº§m ngá»¥c hÆ¡n, hÃ£y thá»±c hiá»‡n cÃ¡c thay Ä‘á»•i sau Ä‘á»‘i vá»›i `packages/game-ui/src`:

<Tabs>
<TabItem label="config.ts">
<E2EDiff before="dungeon-adventure/4/config.ts.old.template" after="dungeon-adventure/4/config.ts.template" lang="typescript" />
</TabItem>
<TabItem label="components/AppLayout/index.tsx">
<E2ECode path="dungeon-adventure/4/AppLayout/index.tsx.template" lang="tsx" />
</TabItem>
<TabItem label="styles.css">
<E2ECode path="dungeon-adventure/4/styles.css.template" lang="css" />
</TabItem>
</Tabs>

XÃ³a file `packages/game-ui/src/hooks/useAppLayout.tsx` vÃ¬ nÃ³ khÃ´ng Ä‘Æ°á»£c sá»­ dá»¥ng.

## Nhiá»‡m vá»¥ 4: TÃ­ch há»£p Story Agent

HÃ£y táº¡o má»™t hook Ä‘á»ƒ khá»Ÿi táº¡o client cho viá»‡c tÆ°Æ¡ng tÃ¡c vá»›i Story Agent cá»§a chÃºng ta.

<Tabs>
<TabItem label="hooks/useStoryAgent.tsx">
<E2ECode path="dungeon-adventure/4/hooks/useStoryAgent.tsx.template" lang="tsx" />
</TabItem>
</Tabs>

Hook nÃ y:

- Truy xuáº¥t Agent ARN tá»« `runtime-config.json`,
- XÃ¢y dá»±ng URL gá»i AgentCore Runtime tá»« ARN,
- Gá»i Agent vá»›i JWT token cá»§a ngÆ°á»i dÃ¹ng Ä‘Ã£ Ä‘Äƒng nháº­p vÃ  má»™t session ID ngáº«u nhiÃªn, vÃ 
- Tráº£ vá» má»™t async iterator Ä‘á»ƒ tiÃªu thá»¥ cÃ¡c chunk thÃ´ng Ä‘iá»‡p agent Ä‘Æ°á»£c stream.

:::tip
TÃ­ch há»£p vá»›i Game API cá»§a chÃºng ta Ä‘Ã£ Ä‘Æ°á»£c cáº¥u hÃ¬nh sáºµn, vÃ¬ chÃºng ta Ä‘Ã£ sá»­ dá»¥ng generator `api-connection`. Náº¿u báº¡n muá»‘n cÃ³ tráº£i nghiá»‡m tÆ°Æ¡ng tá»± cho cÃ¡c agent, hÃ£y +1 [GitHub issue nÃ y](https://github.com/awslabs/nx-plugin-for-aws/issues/326).
:::

## Nhiá»‡m vá»¥ 5: Táº¡o cÃ¡c trang Game

Äá»ƒ táº¡o cÃ¡c trang Game sáº½ gá»i API cá»§a chÃºng ta vÃ  hoÃ n thiá»‡n viá»‡c triá»ƒn khai trÃ² chÆ¡i, hÃ£y cáº­p nháº­t cÃ¡c file sau trong `packages/game-ui/src/routes/game`:

<Tabs>
<TabItem label="index.tsx">
<E2ECode path="dungeon-adventure/4/routes/game/index.tsx.template" lang="tsx" />
</TabItem>
<TabItem label="$playerName.tsx">

<E2ECode path="dungeon-adventure/4/routes/game/$playerName.tsx.template" lang="tsx" />

<Aside type="tip">
CÃº phÃ¡p `$playerName` sáº½ hÆ°á»›ng dáº«n `@tanstack/react-router` xá»­ lÃ½ `playerName` nhÆ° má»™t [path param](https://tanstack.com/router/v1/docs/framework/react/guide/path-params). NgoÃ i ra, chÃºng ta triá»ƒn khai phÆ°Æ¡ng thá»©c `validateSearch` Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng tham sá»‘ truy váº¥n `genre` Ä‘Æ°á»£c Ä‘á»‹nh kiá»ƒu máº¡nh theo enum genre cá»§a chÃºng ta.
</Aside>
</TabItem>
</Tabs>

Sau khi báº¡n thá»±c hiá»‡n nhá»¯ng thay Ä‘á»•i nÃ y, mÃ¡y chá»§ phÃ¡t triá»ƒn cá»¥c bá»™ cá»§a báº¡n (http://localhost:4200/) giá» Ä‘Ã¢y sáº½ cÃ³ trÃ² chÆ¡i sáºµn sÃ ng Ä‘á»ƒ chÆ¡i.

<Drawer title="Build vÃ  Deploy" trigger="Báº¡n cÅ©ng cÃ³ thá»ƒ build & deploy code cá»§a mÃ¬nh lÃªn Cloudfront náº¿u muá»‘n.">

## Nhiá»‡m vá»¥ 6: Build vÃ  deploy

### Build code cá»§a báº¡n
Äá»ƒ build code cá»§a báº¡n, hÃ£y cháº¡y lá»‡nh sau:

<NxCommands commands={['run-many --target build --all']} />

### Deploy á»©ng dá»¥ng cá»§a báº¡n
Äá»ƒ deploy á»©ng dá»¥ng cá»§a báº¡n, hÃ£y cháº¡y lá»‡nh sau:

<NxCommands commands={['run @dungeon-adventure/infra:deploy dungeon-adventure-infra-sandbox/*']} />

Sau khi deploy, hÃ£y Ä‘iá»u hÆ°á»›ng Ä‘áº¿n URL Cloudfront cá»§a báº¡n. Äá»ƒ tÃ¬m URL nÃ y, hÃ£y kiá»ƒm tra cÃ¡c Ä‘áº§u ra deploy cá»§a CDK.

</Drawer>

<Image src={gameSelectPng} alt="game-select.png" width="500" height="400" />
<div style="margin-top: -100px; margin-left: 100px;">
<Image src={gameConversationPng} alt="game-conversation.png" width="500" height="400" />
</div>

ChÃºc má»«ng. Báº¡n Ä‘Ã£ xÃ¢y dá»±ng vÃ  triá»ƒn khai TrÃ² chÆ¡i PhiÃªu lÆ°u Háº§m ngá»¥c vá»›i Agent cá»§a mÃ¬nh!  ğŸ‰ğŸ‰ğŸ‰