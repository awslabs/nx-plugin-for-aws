---
title: Python Lambda Functions
description: Reference documentation for Python Lambda Functions
---

import { FileTree } from '@astrojs/starlight/components';
import RunGenerator from '@components/run-generator.astro';
import GeneratorParameters from '@components/generator-parameters.astro';
import schema from '../../../../../packages/nx-plugin/src/py/lambda-function/schema.json';

The Python Lambda Function generator provides the ability to add a lambda function to an existing python project.

This generator creates a new python lambda handler with AWS CDK infrastructure setup. The generated backend uses AWS Lambda for serverless deployment, with optional support for lambda [event sources](https://docs.powertools.aws.dev/lambda/python/stage/utilities/data_classes/). It sets up [AWS Lambda Powertools](https://docs.powertools.aws.dev/lambda/python/latest/) for observability, including logging, AWS X-Ray tracing and Cloudwatch Metrics.

## Usage

### Generate a Lambda Function

You can generate a new Lambda Function in two ways:

<RunGenerator generator="py#lambda-function" />

### Options

<GeneratorParameters schema={schema} />

## Generator Output

The generator will add the following files to your project:

<FileTree>

- \<module-name>
  - \<lambda-function>.py Function implementation

</FileTree>

If the `functionPath` option is provided, the generater will add the necessary files to the specified path:

<FileTree>

- \<module-name>
  - \<custom-path>
    - \<function-name>.py Function implementation

</FileTree>

The generator will also create CDK constructs which can be used to deploy your Function, which reside in the packages/common/constructs directory.

## Implementing your Function

The main function implementation is in `<function-name>.py`. Here's an example:

```python
from aws_lambda_powertools.utilities.typing import LambdaContext
from aws_lambda_powertools import Logger, Metrics, Tracer
from aws_lambda_powertools.metrics import MetricUnit


os.environ["POWERTOOLS_METRICS_NAMESPACE"] = "MyFunction"
os.environ["POWERTOOLS_SERVICE_NAME"] = "MyFunction"

logger: Logger = Logger()
metrics: Metrics = Metrics()
tracer: Tracer = Tracer()

@tracer.capture_lambda_handler
@metrics.log_metrics
def lambda_handler(event: dict, context: LambdaContext):
    logger.info("Received event", extra={"event": event})
    metrics.add_metric(name="InvocationCount", unit=MetricUnit.Count, value=1)

    try:
        metrics.add_metric(name="SuccessCount", unit=MetricUnit.Count, value=1)
        return ....
    except Exception as e:
        metrics.add_metric(name="ErrorCount", unit=MetricUnit.Count, value=1)
        return ....

```

The generator sets up several features automatically:

1. AWS Lambda Powertools integration for observability
2. Metrics collection

### Observability with AWS Lambda Powertools

#### Logging

The generator configures structured logging using AWS Lambda Powertools.

```python
from aws_lambda_powertools import Logger


os.environ["POWERTOOLS_SERVICE_NAME"] = "MyFunction"

logger: Logger = Logger()

def lambda_handler(event: dict, context: LambdaContext):
    logger.info("Received event", extra={"event": event})
```

:::tip
It is recommended to set the correlation id for all unique requests for easier debugging and monitoring. Please refer to the [aws powertools logger](https://docs.powertools.aws.dev/lambda/python/2.22.0/core/logger/#setting-a-correlation-id) documentation for correlation id best practices.
:::

The logger automatically includes:

- Event requests
- Lambda context information
- Cold start indicators

#### Tracing

AWS X-Ray tracing is configured automatically. You can add custom subsegments to your traces:

```python
from aws_lambda_powertools import Tracer


os.environ["POWERTOOLS_SERVICE_NAME"] = "MyFunction"

tracer: Tracer = Tracer()

@tracer.capture_method
def lambda_handler(event: dict, context: LambdaContext):
    # Creates a new subsegment
    with tracer.provider.in_subsegment("function-subset"):
        # Your logic here
        return ....
```

#### Metrics

CloudWatch metrics are collected automatically for each request. You can add custom metrics:

```python
from aws_lambda_powertools import Metrics


os.environ["POWERTOOLS_METRICS_NAMESPACE"] = "MyFunction"
os.environ["POWERTOOLS_SERVICE_NAME"] = "MyFunction"

metrics: Metrics = Metrics()

@metrics.log_metrics
def lambda_handler(event: dict, context: LambdaContext):
    metrics.add_metric(name="NewMetric", unit=MetricUnit.Count, value=1)
    return ...
```

Default metrics include:

- Invocation counts
- Success/failure counts
- Cold start metrics

## Deploying your Function

The Python Lambda Function generator creates a CDK construct for deploying your function in the `common/constructs` folder. You can use this in a CDK application:

```ts
import { MyFunction } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    // Add the function to your stack
    const function = new MyFunction(this, 'MyFunction');
  }
}
```

This sets up:

1. AWS Lambda function running your FastAPI application
2. CloudWatch log group
3. X-Ray tracing configuration
4. CloudWatch metrics namespace

This function can then be used as a target for any lambda [event source](https://docs.powertools.aws.dev/lambda/python/stage/utilities/data_classes/):

:::note
Ensure the event source matches the selected `eventSource` option to ensure the event is properly handled within your handler function.
:::

```ts
import { EventPattern, Rule, Schedule } from 'aws-cdk-lib/aws-events';
import { LambdaFunction } from 'aws-cdk-lib/aws-events-targets';
import { MyFunction } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    // Add the function to your stack
    const function = new MyFunction(this, 'MyFunction');

    // Add the function to an EventBridge task
    const eventRule = new Rule(this, 'MyFunctionScheduleRule', {
      schedule: Schedule.cron({ minute: '15' }),
      targets: [new LambdaFunction(function)],
    });
  }
}
```
