---
title: "파이썬 스트랜드 에이전트"
description: "도구를 사용하여 AI 에이전트를 구축하고 Amazon Bedrock AgentCore 런타임에 배포하기 위한 파이썬 스트랜드 에이전트 생성"
---

import { FileTree } from '@astrojs/starlight/components';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import Link from '@components/link.astro';
import Snippet from '@components/snippet.astro';
import Infrastructure from '@components/infrastructure.astro';
import GeneratorParameters from '@components/generator-parameters.astro';
import Drawer from '@components/drawer.astro';

도구를 갖춘 AI 에이전트를 구축하고 [Amazon Bedrock AgentCore Runtime](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/)에 배포할 수 있는 Python [Strands Agent](https://strandsagents.com/)를 생성합니다.

## Strands란?

[Strands](https://strandsagents.com/latest/documentation/docs/)는 AI 에이전트 구축을 위한 가볍고 프로덕션 준비가 된 Python 프레임워크입니다. 주요 기능은 다음과 같습니다:

- **가볍고 사용자 정의 가능**: 간단한 에이전트 루프로 개발자 방해 최소화
- **프로덕션 준비 완료**: 완전한 관측성, 추적 및 확장을 위한 배포 옵션
- **모델 및 제공자 독립적**: 다양한 제공자의 여러 모델 지원
- **커뮤니티 주도 도구**: 강력한 커뮤니티 기여 도구 세트
- **다중 에이전트 지원**: 에이전트 팀 및 자율 에이전트와 같은 고급 기법
- **유연한 상호작용 모드**: 대화형, 스트리밍 및 비스트리밍 지원

## 사용 방법

### Strands 에이전트 생성

두 가지 방법으로 Python Strands 에이전트를 생성할 수 있습니다:

<RunGenerator generator="py#strands-agent" />

:::tip
먼저 <Link path="/guides/python-project">`py#project`</Link> 생성기를 사용하여 Strands 에이전트를 추가할 프로젝트를 생성하세요.
:::

### 옵션

<GeneratorParameters generator="py#strands-agent" />

## 생성기 출력

생성기는 기존 Python 프로젝트에 다음 파일들을 추가합니다:

<FileTree>
  - your-project/
    - your_module/
      - agent/ (지정한 경우 사용자 정의 이름 사용)
        - \_\_init\_\_.py 파이썬 패키지 초기화
        - agent.py 샘플 도구가 포함된 주요 에이전트 정의
        - main.py Bedrock AgentCore Runtime용 진입점
        - agentcore_mcp_client.py Bedrock AgentCore Runtime에 호스팅된 MCP 서버 호출에 유용한 클라이언트 팩토리
        - Dockerfile 에이전트 호스팅용 도커 파일 (`computeType`이 `None`으로 설정된 경우 제외)
    - pyproject.toml Strands 종속성으로 업데이트
    - project.json 에이전트 서빙 타겟으로 업데이트
</FileTree>

### 인프라

:::note
`computeType`으로 `None`을 선택한 경우 생성기는 인프라스트럭처 코드를 제공하지 않습니다.
:::

<Snippet name="shared-constructs" />

Strands 에이전트 배포를 위해 다음 파일들이 생성됩니다:

<Infrastructure>
<Fragment slot="cdk">
<FileTree>
  - packages/common/constructs/src
    - app
      - agents
        - \<project-name>
          - \<project-name>.ts 에이전트 배포용 CDK 컨스트럭트
          - Dockerfile CDK 컨스트럭트에서 사용하는 도커 파일
</FileTree>
</Fragment>
<Fragment slot="terraform">
<FileTree>
  - packages/common/terraform/src
    - app
      - agents
        - \<project-name>
          - \<project-name>.tf 에이전트 배포용 테라폼 모듈
    - core
      - agent-core
        - runtime.tf Bedrock AgentCore Runtime 배포용 일반 모듈
</FileTree>
</Fragment>
</Infrastructure>

## Strands 에이전트 작업

### 도구 추가

도구는 AI 에이전트가 작업 수행을 위해 호출할 수 있는 함수입니다. Strands 프레임워크는 도구 정의를 위해 간단한 데코레이터 기반 접근 방식을 사용합니다.

[`agent.py`](packages/nx-plugin/src/py/strands-agent/files/agent.py.template:6) 파일에 새 도구를 추가할 수 있습니다:

```python
from strands import Agent, tool

@tool
def calculate_sum(numbers: list[int]) -> int:
    """숫자 리스트의 합계 계산"""
    return sum(numbers)

@tool
def get_weather(city: str) -> str:
    """도시의 날씨 정보 조회"""
    # 날씨 API 통합 구현
    return f"Weather in {city}: Sunny, 25°C"

# 에이전트에 도구 추가
agent = Agent(
    system_prompt="다양한 도구에 접근 가능한 유용한 어시스턴트입니다.",
    tools=[calculate_sum, get_weather],
)
```

Strands 프레임워크는 다음을 자동으로 처리합니다:
- 함수 타입 힌트 기반 타입 검증
- 도구 호출을 위한 JSON 스키마 생성
- 오류 처리 및 응답 포맷팅

### 사전 제작 도구 사용

Strands는 `strands-tools` 패키지를 통해 사전 제작된 도구 컬렉션을 제공합니다:

```python
from strands_tools import current_time, http_request, file_read

agent = Agent(
    system_prompt="유용한 어시스턴트입니다.",
    tools=[current_time, http_request, file_read],
)
```

### 모델 구성

기본적으로 Strands 에이전트는 Claude 4 Sonnet을 사용하지만 모델 제공자를 사용자 정의할 수 있습니다. 구성 옵션은 [Strands 모델 제공자 문서](https://strandsagents.com/latest/documentation/docs/user-guide/quickstart/#model-providers)를 참조하세요:

```python
from strands import Agent
from strands.models import BedrockModel

# BedrockModel 생성
bedrock_model = BedrockModel(
    model_id="anthropic.claude-sonnet-4-20250514-v1:0",
    region_name="us-west-2",
    temperature=0.3,
)

agent = Agent(model=bedrock_model)
```

### MCP 서버 사용

Strands 에이전트에 [MCP 서버 도구 추가](https://strandsagents.com/latest/documentation/docs/user-guide/concepts/tools/mcp-tools/)가 가능합니다.

<Link path="/guides/py-mcp-server">`py#mcp-server`</Link> 또는 <Link path="/guides/ts-mcp-server">`ts#mcp-server`</Link> 생성기(또는 Bedrock AgentCore Runtime에 호스팅된 기타 서버)를 사용하여 생성한 MCP 서버의 경우, `agentcore_mcp_client.py`에 클라이언트 팩토리가 생성됩니다.

`agent.py`의 `get_agent` 메서드를 업데이트하여 MCP 클라이언트를 생성하고 도구를 추가할 수 있습니다. 다음 예제는 IAM(SigV4) 인증을 사용하는 방법을 보여줍니다:

```python
# agent.py
import os
from contextlib import contextmanager

import boto3
from strands import Agent

from .agentcore_mcp_client import AgentCoreMCPClient

# 리전 및 자격 증명 획득
region = os.environ["AWS_REGION"]
boto_session = boto3.Session(region_name=region)
credentials = boto_session.get_credentials()

@contextmanager
def get_agent(session_id: str):
    mcp_client = AgentCoreMCPClient.with_iam_auth(
        agent_runtime_arn=os.environ["MCP_AGENTCORE_RUNTIME_ARN"],
        credentials=credentials,
        region=region,
        session_id=session_id,
    )

    with mcp_client:
        mcp_tools = mcp_client.list_tools_sync()

        yield Agent(
            system_prompt="..."
            tools=[*mcp_tools],
        )
```

:::tip
대상 MCP 서버가 JWT 인증을 사용하는 경우 `AgentCoreMCPClient.with_jwt_auth` 메서드를 대신 사용할 수 있습니다.
:::

위 IAM 인증 예제를 사용하려면 인프라스트럭처에서 두 가지를 구성해야 합니다. 먼저 MCP 서버의 AgentCore Runtime ARN을 위한 환경 변수를 추가하고, 두 번째로 에이전트에 MCP 서버 호출 권한을 부여해야 합니다. 이는 다음과 같이 구현할 수 있습니다:

<Infrastructure>
<Fragment slot="cdk">
```ts {9, 13}
import { MyProjectAgent, MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    const mcpServer = new MyProjectMcpServer(this, 'MyProjectMcpServer');

    const agent = new MyProjectAgent(this, 'MyProjectAgent', {
      environmentVariables: {
        MCP_AGENTCORE_RUNTIME_ARN: mcpServer.agentCoreRuntime.agentRuntimeArn,
      },
    });

    mcpServer.agentCoreRuntime.grantInvoke(agent.agentCoreRuntime);
  }
}
```
</Fragment>
<Fragment slot="terraform">
```terraform
# MCP 서버
module "my_project_mcp_server" {
  source = "../../common/terraform/src/app/mcp-servers/my-project-mcp-server"
}

# 에이전트
module "my_project_agent" {
  source = "../../common/terraform/src/app/agents/my-project-agent"

  env = {
    MCP_AGENTCORE_RUNTIME_ARN = module.my_project_mcp_server.agent_core_runtime_arn
  }

  additional_iam_policy_statements = [
    {
      Effect = "Allow"
      Action = [
        "bedrock-agentcore:InvokeAgentRuntime"
      ]
      Resource = [
        module.my_project_mcp_server.agent_core_runtime_arn,
        "${module.my_project_mcp_server.agent_core_runtime_arn}/*"
      ]
    }
  ]
}
```
</Fragment>
</Infrastructure>

### 추가 정보

Strands 에이전트 작성에 대한 심층 가이드는 [Strands 문서](https://strandsagents.com/latest/documentation/docs/)를 참조하세요.

## FastAPI 서버

생성기는 [FastAPI](https://fastapi.tiangolo.com/)를 사용하여 Strands 에이전트용 HTTP 서버를 생성합니다. FastAPI는 자동 API 문서화 및 타입 검증 기능을 갖춘 Python API 구축을 위한 현대적이고 빠른 웹 프레임워크를 제공합니다.

생성된 서버에는 다음이 포함됩니다:
- CORS 미들웨어가 포함된 FastAPI 애플리케이션 설정
- 오류 처리 미들웨어
- OpenAPI 스키마 생성
- 헬스 체크 엔드포인트 (`/ping`)
- 에이전트 호출 엔드포인트 (`/invocations`)

### Pydantic을 사용한 호출 입력 및 출력 사용자 정의

에이전트의 호출 엔드포인트는 [Pydantic](https://docs.pydantic.dev/) 모델을 사용하여 요청 및 응답 스키마를 정의하고 검증합니다. `main.py`에서 이러한 모델을 에이전트의 요구사항에 맞게 사용자 정의할 수 있습니다.

#### 입력 모델 정의

기본 `InvokeInput` 모델은 프롬프트와 세션 ID를 받습니다.

```python
from pydantic import BaseModel

class InvokeInput(BaseModel):
    prompt: str
    session_id: str
```

에이전트에 필요한 추가 필드를 포함하도록 이 모델을 확장할 수 있습니다.

:::caution
사용자가 에이전트를 직접 호출하는 경우 호출자로부터 세션 ID의 일부 또는 전체를 추상화하는 것이 좋습니다. 예를 들어 인증된 사용자 ID를 세션 ID의 일부로 사용할 수 있습니다.

또한 사용 사례에 따라 세션에 대한 권한 부여를 구현해야 할 수 있습니다. 예를 들어 사용자가 자신의 세션에만 접근하고 다른 사용자의 세션에는 접근할 수 없도록 보장하는 것입니다.
:::

#### 출력 모델 정의

스트리밍 응답의 경우 생성기는 `JsonStreamingResponse`를 제공하며, 이는 Pydantic 모델을 JSON Lines 형식(`application/jsonl`)으로 자동 직렬화합니다. 이 형식은 OpenAPI 3.2의 스트리밍 사양과 호환되며 생성된 TypeScript 클라이언트와 원활하게 작동합니다.

기본적으로 에이전트는 에이전트의 응답 텍스트를 포함하는 `StreamChunk` 객체를 yield합니다:

```python
class StreamChunk(BaseModel):
    content: str
```

필요에 맞게 `StreamChunk` 모델을 사용자 정의할 수 있습니다:

```python
from pydantic import BaseModel

class StreamChunk(BaseModel):
    content: str
    timestamp: str
    token_count: int
```

:::note
FastAPI가 현재 스트리밍 응답에 대한 OpenAPI 사양 생성을 지원하지 않으므로, 각 스트리밍 작업에 대해 응답 모델을 명시적으로 설정해야 합니다:

```python
@app.post(
    "/invocations",
    response_class=JsonStreamingResponse,
    responses={200: JsonStreamingResponse.openapi_response(StreamChunk)},
)
async def invoke(input: InvokeInput) -> JsonStreamingResponse:
    return JsonStreamingResponse(handle_invoke(input))
```
:::

FastAPI의 네이티브 지원을 위한 [기능 요청이 진행 중](https://github.com/fastapi/fastapi/discussions/14362)입니다.

## Bedrock AgentCore Python SDK

생성기는 `PingStatus` 상수를 위해 [Bedrock AgentCore Python SDK](https://github.com/aws/bedrock-agentcore-sdk-python)에 대한 종속성을 포함합니다. 원하는 경우 FastAPI 대신 `BedrockAgentCoreApp`을 사용하는 것도 간단하지만, 타입 안전성이 손실된다는 점에 유의하세요.

SDK 기능에 대한 자세한 내용은 [문서](https://aws.github.io/bedrock-agentcore-starter-toolkit/user-guide/runtime/quickstart.html)에서 확인할 수 있습니다.

:::note
생성기가 에이전트 배포를 관리하는 CDK 또는 Terraform 인프라를 제공하므로 문서에 언급된 `bedrock-agentcore-starter-toolkit`을 사용할 필요가 없습니다.
:::

## Strands 에이전트 실행

### 로컬 개발

생성기는 개발 및 테스트를 위해 Strands 에이전트를 로컬에서 시작하는 `<your-agent-name>-serve` 타겟을 구성합니다.

<NxCommands commands={['run your-project:agent-serve']} />

이 명령은 [Bedrock AgentCore Python SDK](https://github.com/aws/bedrock-agentcore-sdk-python)를 사용하여 Strands 에이전트를 실행하기 위해 `uv run`을 사용합니다.

## Bedrock AgentCore Runtime에 Strands 에이전트 배포

<Snippet name="agent/bedrock-deployment" parentHeading="Bedrock AgentCore Runtime에 Strands 에이전트 배포" />

### 번들 및 도커 타겟

Bedrock AgentCore Runtime용 Strands 에이전트 빌드를 위해 프로젝트에 `bundle` 타겟이 추가됩니다. 이 타겟은:

- `uv export`를 사용하여 Python 종속성을 `requirements.txt` 파일로 내보냄
- 대상 플랫폼(`aarch64-manylinux2014`)용 종속성을 `uv pip install`로 설치

또한 Strands 에이전트 전용 `docker` 타겟이 추가되어:

- [AgentCore 런타임 계약](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/runtime-service-contract.html)에 따라 에이전트를 실행하는 `Dockerfile`에서 도커 이미지 빌드

:::tip
도커 이미지는 태그(예: `my-scope-my-project-agent:latest`)를 사용하여 빌드되며, 이는 CDK 또는 Terraform 인프라에서 참조되어 Strands 에이전트 프로젝트와 함께 `Dockerfile`을 배치할 수 있게 합니다.
:::

### 인증

#### IAM

기본적으로 Strands 에이전트는 IAM 인증으로 보호되며, 인수 없이 배포할 수 있습니다:

<Infrastructure>
<Fragment slot="cdk">
```ts {5}
import { MyProjectAgent } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    new MyProjectAgent(this, 'MyProjectAgent');
  }
}
```

에이전트 호출 권한을 부여하려면 `grantInvoke` 메서드를 사용할 수 있습니다. 예시:

```ts {8}
import { MyProjectAgent } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    const agent = new MyProjectAgent(this, 'MyProjectAgent');
    const lambdaFunction = new Function(this, ...);

    agent.agentCoreRuntime.grantInvoke(lambdaFunction);
  }
}
```
</Fragment>
<Fragment slot="terraform">
```terraform
# 에이전트
module "my_project_agent" {
  # common/terraform 프로젝트 내 생성된 모듈 상대 경로
  source = "../../common/terraform/src/app/agents/my-project-agent"
}
```

에이전트 호출 권한을 부여하려면 `module.my_project_agent.agent_core_runtime_arn` 출력을 참조하는 다음과 같은 정책을 추가해야 합니다:

```terraform
{
  Effect = "Allow"
  Action = [
    "bedrock-agentcore:InvokeAgentRuntime"
  ]
  Resource = [
    module.my_project_agent.agent_core_runtime_arn,
    "${module.my_project_agent.agent_core_runtime_arn}/*"
  ]
}
```
</Fragment>
</Infrastructure>

#### Cognito JWT 인증

다음은 에이전트에 Cognito 인증을 구성하는 방법을 보여줍니다.

<Infrastructure>
<Fragment slot="cdk">
Cognito를 사용한 JWT 인증을 구성하려면 `RuntimeAuthorizerConfiguration.usingCognito()` 팩토리 메서드를 사용하세요:

```ts {13-16}
import { MyProjectAgent } from ':my-scope/common-constructs';
import { RuntimeAuthorizerConfiguration } from '@aws-cdk/aws-bedrock-agentcore-alpha';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    const userPool = new UserPool(this, 'UserPool');
    const client = userPool.addClient('Client', {
      authFlows: {
        userPassword: true,
      },
    });

    new MyProjectAgent(this, 'MyProjectAgent', {
      authorizerConfiguration: RuntimeAuthorizerConfiguration.usingCognito(
        userPool,
        [client],
      ),
    });
  }
}
```

또는 자체 OIDC 제공자를 사용한 사용자 정의 JWT 인증의 경우 `RuntimeAuthorizerConfiguration.usingJWT()`를 사용하세요:

```ts {6-10}
import { MyProjectAgent } from ':my-scope/common-constructs';
import { RuntimeAuthorizerConfiguration } from '@aws-cdk/aws-bedrock-agentcore-alpha';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    new MyProjectAgent(this, 'MyProjectAgent', {
      authorizerConfiguration: RuntimeAuthorizerConfiguration.usingJWT(
        'https://example.com/.well-known/openid-configuration',
        ['client1', 'client2'], // 허용된 클라이언트 ID (선택 사항)
        ['audience1'],          // 허용된 오디언스 (선택 사항)
      ),
    });
  }
}
```
</Fragment>
<Fragment slot="terraform">
JWT 인증을 구성하려면 에이전트 모듈의 `authorizer_configuration` 변수를 다음과 같이 편집할 수 있습니다:

```terraform {18-23}
# packages/common/terraform/src/app/agents/my-project-agent/my-project-agent.tf

data "aws_region" "current" {}

locals {
  aws_region = data.aws_region.current.id

  # 사용자 풀 및 클라이언트 ID로 교체하거나 변수로 노출
  user_pool_id = "xxx"
  user_pool_client_ids = ["yyy"]
}

module "agent_core_runtime" {
  source = "../../../core/agent-core"
  agent_runtime_name = "MyProjectAgent"
  docker_image_tag = "my-scope-my-project-agent:latest"
  server_protocol = "HTTP"
  authorizer_configuration = {
    custom_jwt_authorizer = {
      discovery_url = "https://cognito-idp.${local.aws_region}.amazonaws.com/${local.user_pool_id}/.well-known/openid-configuration"
      allowed_clients = local.user_pool_client_ids
    }
  }
  env = var.env
  additional_iam_policy_statements = var.additional_iam_policy_statements
  tags = var.tags
}
```
</Fragment>
</Infrastructure>

### 관측성

에이전트는 [AWS Distro for Open Telemetry](https://aws.amazon.com/otel/)(ADOT)를 사용하여 `Dockerfile`의 자동 계측 구성으로 관측성이 자동 구성됩니다.

CloudWatch AWS 콘솔에서 "GenAI Observability"를 선택하여 추적을 찾을 수 있습니다. 추적이 표시되려면 [트랜잭션 검색](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-Transaction-Search.html)을 활성화해야 합니다.

자세한 내용은 [AgentCore 관측성 문서](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/observability-configure.html)를 참조하세요.

## Strands 에이전트 호출

### 로컬 서버 호출

`<your-agent-name>-serve` 타겟을 통해 로컬에서 실행 중인 에이전트를 호출하려면 로컬 에이전트가 실행 중인 포트의 `/invocations`로 간단한 POST 요청을 보낼 수 있습니다. 예를 들어 `curl`을 사용하면:

```bash
curl -N -X POST http://localhost:8081/invocations \
  -d '{"prompt": "what is 3 + 5?", "session_id": "abcdefghijklmnopqrstuvwxyz0123456789"}' \
  -H "Content-Type: application/json"
```

:::note
`curl`에 제공된 `-N` 인수는 출력 스트림 버퍼링을 비활성화하여 실시간으로 스트리밍 응답을 볼 수 있게 합니다.
:::

### 배포된 에이전트 호출

<Snippet name="agent/runtime-arn" parentHeading="배포된 에이전트 호출" />

#### IAM 인증

IAM 인증의 경우 AWS Signature Version 4(SigV4)를 사용하여 요청에 서명해야 합니다.

```bash
acurl <region> bedrock-agentcore -N -X POST \
'https://bedrock
-agentcore.<region>.amazonaws.com/runtimes/<url-encoded-arn>/invocations' \
-d '{"prompt": "what is 3 + 5?", "session_id": "abcdefghijklmnopqrstuvwxyz0123456789"}' \
-H 'Content-Type: application/json'
```

<Drawer title="Sigv4 활성화 curl" trigger="위 acurl 명령 구성에 대한 자세한 내용은 여기를 클릭하세요">
<Snippet name="tools/acurl" />
</Drawer>

#### JWT / Cognito 인증

Cognito 인증의 경우 `Authorization` 헤더에 Cognito 액세스 토큰을 전달합니다:

```bash
curl -N -X POST 'https://bedrock
-agentcore.<region>.amazonaws.com/runtimes/<url-encoded-arn>/invocations' \
  -d '{"prompt": "what is 3 + 5?", "session_id": "abcdefghijklmnopqrstuvwxyz0123456789"}' \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <access-token>"
```

AWS CLI의 `cognito-idp admin-initiate-auth` 명령을 사용하여 액세스 토큰을 얻을 수 있습니다. 예를 들어:

```bash
aws cognito-idp admin-initiate-auth \
  --user-pool-id <user-pool-id> \
  --client-id <user-pool-client-id> \
  --auth-flow ADMIN_NO_SRP_AUTH \
  --auth-parameters USERNAME=<username>,PASSWORD=<password> \
  --region <region> \
  --query 'AuthenticationResult.AccessToken' \
  --output text
```