---
title: "TypeScript Strands 에이전트"
description: "도구를 사용하여 AI 에이전트를 구축하기 위한 TypeScript Strands 에이전트를 생성하고 Amazon Bedrock AgentCore Runtime에 배포합니다"
---

import { FileTree } from '@astrojs/starlight/components';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import Link from '@components/link.astro';
import Snippet from '@components/snippet.astro';
import Infrastructure from '@components/infrastructure.astro';
import GeneratorParameters from '@components/generator-parameters.astro';
import PackageManagerExecCommand from '@components/package-manager-exec-command.astro';

도구를 사용하여 AI 에이전트를 구축하기 위한 TypeScript [Strands Agent](https://strandsagents.com/)를 생성하고, 선택적으로 [Amazon Bedrock AgentCore Runtime](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/)에 배포합니다. 이 생성기는 WebSocket을 통한 [tRPC](https://trpc.io/)를 사용하여 [AgentCore의 양방향 스트리밍 지원](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/runtime-get-started-websocket.html)을 활용하여 실시간 타입 안전 통신을 제공합니다.

## Strands란 무엇인가요?

[Strands](https://strandsagents.com/latest/documentation/docs/)는 AI 에이전트를 구축하기 위한 경량 프레임워크입니다. 주요 기능은 다음과 같습니다:

- **경량 및 커스터마이징 가능**: 방해받지 않는 간단한 에이전트 루프
- **프로덕션 준비 완료**: 확장을 위한 완전한 관찰성, 추적 및 배포 옵션
- **모델 및 제공업체 독립적**: 다양한 제공업체의 여러 모델 지원
- **커뮤니티 기반 도구**: 커뮤니티가 기여한 강력한 도구 세트
- **다중 에이전트 지원**: 에이전트 팀 및 자율 에이전트와 같은 고급 기술
- **유연한 상호작용 모드**: 대화형, 스트리밍 및 비스트리밍 지원

## 사용법

### Strands Agent 생성

두 가지 방법으로 TypeScript Strands Agent를 생성할 수 있습니다:

<RunGenerator generator="ts#strands-agent" />

:::tip
먼저 <Link path="/guides/typescript-project">`ts#project`</Link> 생성기를 사용하여 Strands Agent를 추가할 프로젝트를 생성하세요.
:::

### 옵션

<GeneratorParameters generator="ts#strands-agent" />

## 생성기 출력

생성기는 기존 TypeScript 프로젝트에 다음 파일을 추가합니다:

<FileTree>
  - your-project/
    - src/
      - agent/ (또는 지정된 경우 사용자 정의 이름)
        - index.ts Bedrock AgentCore Runtime의 진입점
        - init.ts tRPC 초기화
        - router.ts 에이전트 프로시저가 포함된 tRPC 라우터
        - agent.ts 샘플 도구가 포함된 메인 에이전트 정의
        - client.ts 에이전트를 호출하기 위한 제공된 클라이언트
        - agent-core-trpc-client.ts AgentCore Runtime의 에이전트에 연결하기 위한 클라이언트 팩토리
        - agent-core-mcp-client.ts AgentCore Runtime의 MCP 서버에 연결하기 위한 클라이언트 팩토리
        - Dockerfile 에이전트 호스팅을 위한 진입점 (`computeType`이 `None`으로 설정된 경우 제외)
    - package.json Strands 종속성으로 업데이트됨
    - project.json 에이전트 서브 타겟으로 업데이트됨
</FileTree>

### 인프라

:::note
`computeType`에 대해 `None`을 선택한 경우, 생성기는 코드로서의 인프라를 제공하지 않습니다.
:::

<Snippet name="shared-constructs" />

Strands Agent 배포를 위해 다음 파일이 생성됩니다:

<Infrastructure>
<Fragment slot="cdk">
<FileTree>
  - packages/common/constructs/src
    - app
      - agents
        - \<project-name>
          - \<project-name>.ts 에이전트 배포를 위한 CDK 구성
          - Dockerfile CDK 구성에서 사용하는 패스스루 도커 파일
</FileTree>
</Fragment>
<Fragment slot="terraform">
<FileTree>
  - packages/common/terraform/src
    - app
      - agents
        - \<project-name>
          - \<project-name>.tf 에이전트 배포를 위한 모듈
    - core
      - agent-core
        - runtime.tf Bedrock AgentCore Runtime에 배포하기 위한 일반 모듈
</FileTree>
</Fragment>
</Infrastructure>

## Strands Agent 작업하기

### WebSocket을 통한 tRPC

TypeScript Strands Agent는 WebSocket을 통한 [tRPC](https://trpc.io/)를 사용하여 [AgentCore의 양방향 스트리밍 지원](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/runtime-get-started-websocket.html)을 활용하여 클라이언트와 에이전트 간의 실시간 타입 안전 통신을 가능하게 합니다.

tRPC는 WebSocket을 통한 Query, Mutation 및 Subscription 프로시저를 지원하므로 원하는 수의 프로시저를 정의할 수 있습니다. 기본적으로 `router.ts`에 `invoke`라는 단일 구독 프로시저가 정의되어 있습니다.

### 도구 추가

도구는 AI 에이전트가 작업을 수행하기 위해 호출할 수 있는 함수입니다. `agent.ts` 파일에 새 도구를 추가할 수 있습니다:

```typescript
import { Agent, tool } from '@strands-agents/sdk';
import z from 'zod';

const letterCounter = tool({
  name: 'letter_counter',
  description: 'Count occurrences of a specific letter in a word',
  inputSchema: z.object({
    word: z.string().describe('The input word to search in'),
    letter: z.string().length(1).describe('The specific letter to count'),
  }),
  callback: (input) => {
    const { word, letter } = input;
    const count = word.toLowerCase().split(letter.toLowerCase()).length - 1;
    return `The letter '${letter}' appears ${count} time(s) in '${word}'`;
  },
});

// Add tools to your agent
export const agent = new Agent({
  systemPrompt: 'You are a helpful assistant with access to various tools.',
  tools: [letterCounter],
});
```

Strands 프레임워크는 다음을 자동으로 처리합니다:
- Zod 스키마를 사용한 입력 검증
- 도구 호출을 위한 JSON 스키마 생성
- 오류 처리 및 응답 포맷팅

### 모델 구성

기본적으로 Strands 에이전트는 Claude 4 Sonnet을 사용하지만, 모델 제공업체 간에 쉽게 전환할 수 있습니다:

```typescript
import { Agent } from '@strands-agents/sdk';
import { BedrockModel } from '@strands-agents/sdk/models/bedrock';
import { OpenAIModel } from '@strands-agents/sdk/models/openai';

// Use Bedrock
const bedrockModel = new BedrockModel({
  modelId: 'anthropic.claude-sonnet-4-20250514-v1:0',
});
let agent = new Agent({ model: bedrockModel });
let response = await agent.invoke('What can you help me with?');

// Alternatively, use OpenAI by just switching model provider
const openaiModel = new OpenAIModel({
  apiKey: process.env.OPENAI_API_KEY,
  modelId: 'gpt-4o',
});
agent = new Agent({ model: openaiModel });
response = await agent.invoke('What can you help me with?');
```

더 많은 구성 옵션은 [모델 제공업체에 대한 Strands 문서](https://strandsagents.com/latest/documentation/docs/user-guide/quickstart/#model-providers)를 참조하세요.

### MCP 서버 사용

Strands 에이전트에 [MCP 서버의 도구를 추가](https://strandsagents.com/latest/documentation/docs/user-guide/concepts/tools/mcp-tools/)할 수 있습니다.

<Link path="/guides/py-mcp-server">`py#mcp-server`</Link> 또는 <Link path="/guides/ts-mcp-server">`ts#mcp-server`</Link> 생성기를 사용하여 생성한 MCP 서버(또는 Bedrock AgentCore Runtime에 호스팅된 다른 서버)를 사용하려면 `agent-core-mcp-client.ts`에 클라이언트 팩토리가 생성됩니다.

`agent.ts`에서 에이전트 초기화를 업데이트하여 MCP 클라이언트를 생성하고 도구를 추가할 수 있습니다. 다음 예제는 IAM (SigV4) 인증으로 이를 수행하는 방법을 보여줍니다:

```typescript
// agent.ts
import { Agent } from '@strands-agents/sdk';
import { AgentCoreMcpClient } from './agent-core-mcp-client.js';

const mcpClient = AgentCoreMcpClient.withIamAuth({
  agentRuntimeArn: process.env.MCP_AGENTCORE_RUNTIME_ARN!,
  region: process.env.AWS_REGION || 'us-west-2',
  sessionId: 'my-session-id',
});

export const agent = new Agent({
  systemPrompt: '...',
  tools: [mcpClient],
});
```

:::tip
대상 MCP 서버가 JWT 인증을 사용하는 경우 대신 `AgentCoreMcpClient.withJwtAuth` 메서드를 사용하여 클라이언트를 생성할 수 있습니다.
:::

위의 IAM 인증 예제에서는 인프라에서 두 가지를 구성해야 합니다. 첫째, MCP 서버의 AgentCore Runtime ARN에 대해 에이전트가 사용하는 환경 변수를 추가해야 하고, 둘째 에이전트에 MCP 서버를 호출할 수 있는 권한을 부여해야 합니다. 이는 다음과 같이 수행할 수 있습니다:

<Infrastructure>
<Fragment slot="cdk">
```ts {9, 13}
import { MyProjectAgent, MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    const mcpServer = new MyProjectMcpServer(this, 'MyProjectMcpServer');

    const agent = new MyProjectAgent(this, 'MyProjectAgent', {
      environmentVariables: {
        MCP_AGENTCORE_RUNTIME_ARN: mcpServer.agentCoreRuntime.agentRuntimeArn,
      },
    });

    mcpServer.agentCoreRuntime.grantInvoke(agent.agentCoreRuntime);
  }
}
```
</Fragment>
<Fragment slot="terraform">
```terraform
# MCP Server
module "my_project_mcp_server" {
  source = "../../common/terraform/src/app/mcp-servers/my-project-mcp-server"
}

# Agent
module "my_project_agent" {
  source = "../../common/terraform/src/app/agents/my-project-agent"

  env = {
    MCP_AGENTCORE_RUNTIME_ARN = module.my_project_mcp_server.agent_core_runtime_arn
  }

  additional_iam_policy_statements = [
    {
      Effect = "Allow"
      Action = [
        "bedrock-agentcore:InvokeAgentRuntime"
      ]
      Resource = [
        module.my_project_mcp_server.agent_core_runtime_arn,
        "${module.my_project_mcp_server.agent_core_runtime_arn}/*"
      ]
    }
  ]
}
```
</Fragment>
</Infrastructure>

### 더 보기

Strands 에이전트 작성에 대한 더 심층적인 가이드는 [Strands 문서](https://strandsagents.com/latest/documentation/docs/)를 참조하세요.

## Strands Agent 실행

### 로컬 개발

생성기는 `<your-agent-name>-serve`라는 타겟을 구성하여 개발 및 테스트를 위해 Strands Agent를 로컬에서 시작합니다.

<NxCommands commands={['run your-project:agent-serve']} />

이 명령은 `tsx --watch`를 사용하여 파일이 변경될 때 서버를 자동으로 재시작합니다. 에이전트는 `http://localhost:8081`(또는 여러 에이전트가 있는 경우 할당된 포트)에서 사용할 수 있습니다.

## Strands Agent를 Bedrock AgentCore Runtime에 배포

<Snippet name="agent/bedrock-deployment" parentHeading="Strands Agent를 Bedrock AgentCore Runtime에 배포" />

### 번들 타겟

<Snippet name="ts-bundle" />

번들 타겟은 Bedrock AgentCore Runtime에서 호스팅할 WebSocket 서버의 진입점으로 `index.ts`를 사용합니다.

### Docker 타겟

생성기는 [AgentCore 런타임 계약](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/runtime-service-contract.html)에 따라 포트 `8080`에서 번들된 WebSocket 서버를 실행하는 `<your-agent-name>-docker` 타겟을 구성합니다.

:::tip
도커 이미지는 태그(예: `my-scope-my-project-agent:latest`)를 사용하여 빌드되며, 이는 CDK 또는 Terraform 인프라에서 참조되므로 `Dockerfile`을 Strands Agent 프로젝트와 함께 배치할 수 있습니다.
:::

여러 에이전트가 정의된 경우 모든 에이전트에 대한 도커 빌드를 실행하는 `docker` 타겟도 생성됩니다.

### 관찰성

에이전트는 `Dockerfile`에서 자동 계측을 구성하여 [AWS Distro for Open Telemetry](https://aws.amazon.com/otel/) (ADOT)를 사용한 관찰성으로 자동 구성됩니다.

CloudWatch AWS 콘솔에서 메뉴의 "GenAI Observability"를 선택하여 추적을 찾을 수 있습니다. 추적이 채워지려면 [Transaction Search](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-Transaction-Search.html)를 활성화해야 합니다.

자세한 내용은 [관찰성에 대한 AgentCore 문서](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/observability-configure.html)를 참조하세요.

## Strands Agent 호출

에이전트 통신은 WebSocket을 통한 tRPC를 통해 전송됩니다. 따라서 `client.ts`에 생성된 타입 안전 클라이언트 팩토리를 사용하는 것이 좋습니다.

### 로컬 서버 호출

클라이언트 팩토리의 `.local` 팩토리 메서드를 사용하여 로컬에서 실행 중인 에이전트를 호출할 수 있습니다.

예를 들어 워크스페이스에 클라이언트를 가져오는 `scripts/test.ts`라는 파일을 생성할 수 있습니다:

```typescript
// scripts/test.ts
import { AgentClient } from '../packages/<project>/src/agent/client.js';

const client = AgentClient.local({ url: 'http://localhost:8081/ws' });

client.invoke.subscribe({ message: 'what is 1 plus 1?' }, { onData: console.log });
```

:::tip
에이전트를 빠르게 테스트하는 방법으로 `tsx`로 실행하세요.

<PackageManagerExecCommand commands={['tsx scripts/test.ts']} />
:::

### 배포된 에이전트 호출

<Snippet name="agent/runtime-arn" parentHeading="배포된 에이전트 호출" />

#### NodeJS

생성된 `client.ts` 파일에는 배포된 에이전트를 호출하는 데 사용할 수 있는 타입 안전 클라이언트 팩토리가 포함되어 있습니다.

:::caution
클라이언트 팩토리는 WebSocket 핸드셰이크에서 HTTP 헤더를 사용하여 Bedrock AgentCore Runtime에 대한 요청을 인증합니다. 이는 브라우저에서는 불가능하므로 이 클라이언트는 브라우저 환경에 적합하지 않습니다. 브라우저에서의 호출에 대한 자세한 내용은 아래 "브라우저" 섹션을 참조하세요.
:::

##### IAM 인증

`withIamAuth` 팩토리 메서드에 ARN을 전달하여 배포된 에이전트를 호출할 수 있습니다:

```typescript
import { AgentClient } from './agent/client.js';

const client = AgentClient.withIamAuth({
  agentRuntimeArn: 'arn:aws:bedrock-agentcore:us-west-2:123456789012:runtime/my-agent',
});

client.invoke.subscribe({ message: 'what is 1 plus 1?' }, {
  onData: (message) => console.log(message),
  onError: (error) => console.error(error),
  onComplete: () => console.log('Done'),
});
```

:::note
이는 기본 AWS 자격 증명 공급자 체인을 사용하여 요청을 인증하므로, 위 코드가 실행되는 환경에는 런타임을 호출할 수 있는 액세스 권한이 있는 AWS 자격 증명이 구성되어 있어야 합니다.
:::

##### JWT / Cognito 인증

JWT / Cognito 액세스 토큰으로 인증하려면 `withJwtAuth` 팩토리 메서드를 사용하세요.

```typescript
const client = AgentClient.withJwtAuth({
  agentRuntimeArn: 'arn:aws:bedrock-agentcore:us-west-2:123456789012:runtime/my-agent',
  accessTokenProvider: async () => `<access-token>`,
});

client.invoke.subscribe({ message: 'what is 1 plus 1?' }, {
  onData: console.log,
});
```

`accessTokenProvider`는 요청을 인증하는 데 사용되는 토큰을 반환해야 합니다. 예를 들어 이 메서드 내에서 토큰을 가져와 tRPC가 WebSocket 연결을 재시작할 때 새로운 자격 증명이 재사용되도록 할 수 있습니다. 아래는 AWS SDK를 사용하여 Cognito에서 토큰을 가져오는 방법을 보여줍니다:

```typescript
import { CognitoIdentityProvider } from "@aws-sdk/client-cognito-identity-provider";

const cognito = new CognitoIdentityProvider();

const jwtClient = AgentClient.withJwtAuth({
  agentRuntimeArn: 'arn:aws:bedrock-agentcore:us-west-2:123456789012:runtime/my-agent',
  accessTokenProvider: async () => {
    const response = await cognito.adminInitiateAuth({
      UserPoolId: '<user-pool-id>',
      ClientId: '<user-pool-client-id>',
      AuthFlow: 'ADMIN_NO_SRP_AUTH',
      AuthParameters: {
        USERNAME: '<username>',
        PASSWORD: '<password>',
      },
    });
    return response.AuthenticationResult!.AccessToken!;
  },
});
```

#### 브라우저

브라우저의 WebSocket은 헤더 지정을 지원하지 않으므로(`Sec-WebSocket-Protocol` 제외), `client.ts`에 생성된 클라이언트 팩토리는 브라우저에서 사용할 수 없습니다(실제로 `WebSocket` 생성자가 NodeJS에서처럼 헤더를 허용하지 않으므로 컴파일 오류가 발생합니다).

##### JWT / Cognito 인증

:::caution
이 문서 작성 시점에 Bedrock AgentCore Runtime은 JWT 토큰이 `Authorization` 헤더에 전달되어야 하므로 브라우저는 JWT 인증을 사용하여 Bedrock AgentCore Runtime으로 인증할 수 없습니다. 사전 서명된 URL을 통한 AWS Signature Version 4 (SigV4) 인증만 지원됩니다.

향후 지원이 추가되면 이 문서를 업데이트하도록 노력하겠습니다.
:::

##### IAM 인증

브라우저에서 에이전트를 호출하려면 AWS SigV4를 사용하여 사전 서명된 WebSocket URL을 생성해야 합니다.

아래 예제는 자격 증명 가져오기, 사전 서명된 URL 생성 및 에이전트 호출의 엔드 투 엔드 흐름을 보여줍니다:

```typescript
import { createTRPCClient, createWSClient, wsLink } from '@trpc/client';
import { AwsClient } from 'aws4fetch';
import { CognitoIdentityClient } from '@aws-sdk/client-cognito-identity';
import { fromCognitoIdentityPool } from '@aws-sdk/credential-provider-cognito-identity';
import type { AppRouter } from './your-agent/router';

// Build a presigned WebSocket URL
async function buildSignedUrl(
  agentRuntimeArn: string,
  idToken: string,
  region: string = 'us-west-2'
): Promise<string> {
  // Get credentials from a Cognito Identity Pool (or other source)
  const credentials = fromCognitoIdentityPool({
    client: new CognitoIdentityClient({ region }),
    identityPoolId: 'us-west-2:xxxxx',
    logins: {
      [`cognito-idp.${region}.amazonaws.com/us-west-2_xxxxx`]: idToken,
    },
  });

  const cognitoIdentity = new CognitoIdentityClient({ credentials });
  const credential = await cognitoIdentity.config.credentials();

  // Create AWS SigV4 client
  const awsClient = new AwsClient({
    ...credential,
    service: 'bedrock-agentcore',
  });

  // Build WebSocket URL from ARN
  const wsUrl = `wss://bedrock-agentcore.${region}.amazonaws.com/runtimes/${agentRuntimeArn.replace(/:/g, '%3A').replace(/\//g, '%2F')}/ws`;

  // Create presigned URL
  const signedRequest = await awsClient.sign(wsUrl, {
    method: 'GET',
    aws: { signQuery: true },
  });

  return signedRequest.url;
}

// Create tRPC client with presigned WebSocket URL
const agentRuntimeArn = 'arn:aws:bedrock-agentcore:us-west-2:123456789012:runtime/my-agent';
const idToken = '<your-id-token>';

const wsClient = createWSClient({
  url: async () => buildSignedUrl(agentRuntimeArn, idToken),
});

const trpcClient = createTRPCClient<AppRouter>({
  links: [wsLink({ client: wsClient })],
});

// Invoke the agent
trpcClient.invoke.subscribe({ message: 'what is 1 plus 1?' }, {
  onData: (message) => console.log(message),
});
```

:::tip
에이전트를 위한 <Link path="/guides/connection">API 연결 생성기</Link>와 유사한 경험을 원하시면 [이 GitHub 이슈](https://github.com/awslabs/nx-plugin-for-aws/issues/326)에 +1을 눌러주세요.
:::