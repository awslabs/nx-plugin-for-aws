---
title: "React 웹사이트"
description: "React 웹사이트를 위한 참조 문서"
---

import { FileTree, Steps } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import RunGenerator from '@components/run-generator.astro';
import GeneratorParameters from '@components/generator-parameters.astro';
import NxCommands from '@components/nx-commands.astro';
import Infrastructure from '@components/infrastructure.astro';
import Snippet from '@components/snippet.astro';

이 생성기는 기본적으로 [Cloudscape](http://cloudscape.design/)이 구성된 새로운 [React](https://react.dev/) 웹사이트와 S3에 호스팅된 정적 웹사이트를 [CloudFront](https://aws.amazon.com/cloudfront/)로 서비스하고 [WAF](https://aws.amazon.com/waf/)로 보호하는 클라우드 배포 인프라를 AWS CDK 또는 Terraform으로 생성합니다.

생성된 애플리케이션은 빌드 도구 및 번들러로 [Vite](https://vite.dev/)를 사용하며, 타입 안전 라우팅을 위해 [TanStack Router](https://tanstack.com/router/v1)를 사용합니다.

:::note
이 생성기는 기본적으로 [Cloudscape](http://cloudscape.design/)를 설정하지만, 다른 컴포넌트 라이브러리나 디자인 시스템을 사용하려면 `uxProvider`로 `None`을 선택할 수 있습니다.
:::

## 사용 방법

### React 웹사이트 생성

새로운 React 웹사이트를 두 가지 방법으로 생성할 수 있습니다:

<RunGenerator generator="ts#react-website" />

### 옵션

<GeneratorParameters generator="ts#react-website" />

## 생성기 출력 결과

생성기는 `<directory>/<name>` 디렉토리에 다음 프로젝트 구조를 생성합니다:

<FileTree>
  - index.html HTML 진입점
  - public 정적 에셋
  - src
    - main.tsx React 설정이 포함된 애플리케이션 진입점
    - config.ts 애플리케이션 구성 (예: 로고)
    - components
      - AppLayout 전체 레이아웃 및 네비게이션 바를 위한 컴포넌트
    - hooks
      - useAppLayout.tsx 중첩 컴포넌트에서 Cloudscape AppLayout 조정을 위한 훅 (UX Provider가 Cloudscape로 설정된 경우)
    - routes
      - index.tsx TanStack Router용 예제 라우트(페이지)
    - styles.css 전역 스타일
  - vite.config.ts Vite 및 Vitest 구성
  - tsconfig.json 소스 및 테스트용 기본 TypeScript 구성
  - tsconfig.app.json 소스 코드용 TypeScript 구성 
  - tsconfig.spec.json 테스트용 TypeScript 구성
</FileTree>

:::note
[TanStack Router](https://tanstack.com/router/v1) 사용을 선택하지 않은 경우, `routes` 디렉토리 대신 간단한 `src/app.tsx` 파일이 애플리케이션 진입점으로 제공됩니다.
:::

### 인프라

<Snippet name="shared-constructs" />

생성기는 선택한 `iacProvider` 기반으로 웹사이트 배포를 위한 인프라 코드를 생성합니다:

<Infrastructure>
<Fragment slot="cdk">
<FileTree>
  - packages/common/constructs/src
    - app
      - static-websites
        - \<name>.ts 웹사이트 전용 인프라
    - core
      - static-website.ts 일반 StaticWebsite construct
</FileTree>
</Fragment>
<Fragment slot="terraform">
<FileTree>
  - packages/common/terraform/src
    - app
      - static-websites
        - \<name>
          - \<name>.tf 웹사이트 전용 모듈
    - core
      - static-website
        - static-website.tf 일반 정적 웹사이트 모듈
</FileTree>
</Fragment>
</Infrastructure>

## React 웹사이트 구현

[React 문서](https://react.dev/learn)는 React 개발 기초를 배우기에 좋은 시작점입니다. [Cloudscape 문서](https://cloudscape.design/components/)에서 사용 가능한 컴포넌트와 사용 방법을 확인할 수 있습니다.

### 라우트

#### 라우트/페이지 생성

Cloudscape 웹사이트는 기본적으로 [TanStack Router](https://tanstack.com/router/v1)가 구성되어 있습니다. 새로운 라우트 추가가 간편합니다:

<Steps>
  1. [로컬 개발 서버 실행](#local-development-server)
  2. `src/routes`에 새 `<page-name>.tsx` 파일 생성 (파일 트리 위치가 경로를 나타냄)
  3. 자동 생성된 `Route` 및 `RouteComponent`를 확인하고 페이지 개발 시작!
</Steps>

#### 페이지 간 네비게이션

페이지 간 이동에는 `Link` 컴포넌트나 `useNavigate` 훅을 사용할 수 있습니다:

```tsx {1, 4, 8-9, 14}
import { Link, useNavigate } from '@tanstack/react-router';

export const MyComponent = () => {
  const navigate = useNavigate();

  const submit = async () => {
    const id = await ...
    // 비동기 액션 후 리다이렉트 시 `navigate` 사용
    navigate({ to: '/products/$id', { params: { id }} });
  };

  return (
    <>
      <Link to="/products">취소</Link>
      <Button onClick={submit}>제출</Button>
    </>
  )
};
```

자세한 내용은 [TanStack Router](https://tanstack.com/router/latest/docs/framework/react/overview) 문서를 참조하세요.

## 런타임 구성

인프라의 구성 정보는 런타임 구성을 통해 웹사이트에 제공됩니다. 이를 통해 배포 시점에만 알 수 있는 API URL 등의 정보에 접근할 수 있습니다.

### 인프라

<Infrastructure>
<Fragment slot="cdk">
`RuntimeConfig` CDK construct를 사용하여 CDK 인프라에 구성 값을 추가하고 조회할 수 있습니다. `@aws/nx-plugin` 생성기(<Link path="guides/trpc">`ts#trpc-api`</Link>, <Link path="guides/fastapi">`py#fast-api`</Link> 등)로 생성된 CDK construct는 자동으로 `RuntimeConfig`에 적절한 값을 추가합니다.

웹사이트 CDK construct는 런타임 구성을 S3 버킷 루트에 `runtime-config.json` 파일로 배포합니다.

```ts title="packages/infra/src/stacks/application-stack.ts" {9-12,14-15}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    // RuntimeConfig에 값 자동 추가
    new MyApi(this, 'MyApi', {
      integrations: MyApi.defaultIntegrations(this).build(),
    });

    // runtime-config.json으로 런타임 구성 자동 배포
    new MyWebsite(this, 'MyWebsite');
  }
}
```

:::caution
`runtime-config.json` 파일에 누락을 방지하려면 `RuntimeConfig`에 값을 추가하는 construct를 웹사이트 construct보다 먼저 선언해야 합니다.
:::
</Fragment>
<Fragment slot="terraform">
Terraform의 경우 런타임 구성은 runtime-config 모듈을 통해 관리됩니다. `@aws/nx-plugin` 생성기(<Link path="guides/trpc">`ts#trpc-api`</Link>, <Link path="guides/fastapi">`py#fast-api`</Link> 등)로 생성된 Terraform 모듈은 런타임 구성에 적절한 값을 자동으로 추가합니다.

웹사이트 Terraform 모듈은 런타임 구성을 S3 버킷 루트에 `runtime-config.json` 파일로 배포합니다.

```hcl title="packages/infra/src/main.tf" {14-15}
# 런타임 구성에 값 자동 추가
module "my_api" {
  source = "../../common/terraform/src/app/apis/my-api"
}

# runtime-config.json으로 런타임 구성 자동 배포
module "my_website" {
  source = "../../common/terraform/src/app/static-websites/my-website"

  providers = {
    aws.us_east_1 = aws.us_east_1
  }

  # API가 런타임 구성 추가를 먼저 완료하도록 보장
  depends_on = [module.my_api]
}
```

:::caution
`runtime-config.json` 파일 누락을 방지하려면 런타임 구성을 추가하는 모듈을 웹사이트 모듈보다 먼저 선언하고 적절한 `depends_on`을 설정해야 합니다.
:::
</Fragment>
</Infrastructure>

### 웹사이트 코드

웹사이트에서는 `useRuntimeConfig` 훅을 사용해 런타임 구성 값을 조회할 수 있습니다:

```tsx {1,4}
import { useRuntimeConfig } from '../hooks/useRuntimeConfig';

const MyComponent = () => {
  const runtimeConfig = useRuntimeConfig();

  // 런타임 구성 값 접근 예시
  const apiUrl = runtimeConfig.apis.MyApi;
};
```

### 로컬 런타임 구성

[로컬 개발 서버](#local-development-server) 실행 시 백엔드 URL, 인증 구성 등을 위해 `public` 디렉토리에 `runtime-config.json` 파일이 필요합니다.

웹사이트 프로젝트는 배포된 애플리케이션에서 `runtime-config.json` 파일을 가져오는 `load:runtime-config` 타겟을 포함하고 있습니다:

<NxCommands commands={['run <my-website>:"load:runtime-config"']} />

:::note
<Infrastructure>
<Fragment slot="cdk">
인프라 프로젝트의 `src/main.ts`에서 스테이지 이름 접두사를 변경한 경우 웹사이트의 `project.json` 파일에서 `load:runtime-config` 타겟을 수정해야 합니다.

또한 `load:runtime-config` 타겟은 단일 스테이지가 AWS 자격 증명 환경에 배포되었다고 가정합니다. 동일 계정/리전에 여러 스테이지를 배포한 경우 명령어를 조정해야 합니다.
</Fragment>
<Fragment slot="terraform">
Terraform 프로젝트의 경우 `load:runtime-config` 타겟은 최근 로컬 `terraform apply`로 생성된 `runtime-config.json` 파일을 복사합니다.
</Fragment>
</Infrastructure>
:::

## 로컬 개발 서버

`serve` 또는 `serve-local` 타겟을 사용해 로컬 개발 서버를 실행할 수 있습니다.

### Serve 타겟

`serve` 타겟은 웹사이트의 로컬 개발 서버를 시작합니다. 이 타겟은 웹사이트가 상호작용하는 지원 인프라의 배포와 [로컬 런타임 구성 로드](#local-runtime-config)가 필요합니다.

다음 명령어로 실행할 수 있습니다:

<NxCommands commands={['run <my-website>:serve']} />

이 타겟은 "실제" 배포된 API 및 인프라를 사용하면서 웹사이트 변경 작업 시 유용합니다.

### Serve-local 타겟

`serve-local` 타겟은 [Vite `MODE`](https://vite.dev/guide/env-and-mode)를 `serve-local`로 설정한 로컬 개발 서버를 시작하며, <Link path="/guides/connection">API 연결 생성기</Link>로 연결된 API의 로컬 서버도 함께 실행합니다.

이 타겟으로 서버를 실행하면 `runtime-config.json`이 자동으로 로컬 API URL을 가리키도록 재정의됩니다.

다음 명령어로 실행할 수 있습니다:

<NxCommands commands={['run <my-website>:serve-local']} />

이 타겟은 웹사이트와 API를 동시에 작업하며 빠른 반복을 원할 때 유용합니다.

:::warning
이 모드에서 실행 시 `runtime-config.json`이 없고 <Link path="/guides/react-website-auth">`ts#react-website#auth` 생성기</Link>로 Cognito 인증을 구성한 경우, 로그인이 생략되며 로컬 서버 요청에 인증 헤더가 포함되지 않습니다.

`serve-local`에서 로그인 및 인증을 사용하려면 인프라를 배포하고 런타임 구성을 로드해야 합니다.
:::

:::tip
`serve-local` 실행 시 API가 다른 배포된 AWS 리소스를 가리키도록 필요한 환경 변수를 지정할 수 있습니다. 예를 들어:

<NxCommands env={{DYNAMODB_TABLE_NAME: 'xxxxx'}} commands={['run <my-website>:serve-local']} />

로컬 API 서버는 로컬에 구성된 AWS 자격 증명으로 실행됩니다.
:::

## 빌드

`build` 타겟을 사용해 웹사이트를 빌드할 수 있습니다. 이는 Vite를 사용해 루트 `dist/packages/<my-website>/bundle` 디렉토리에 프로덕션 번들을 생성하며 타입 검사, 컴파일, 린팅을 수행합니다.

<NxCommands commands={['run <my-website>:build']} />

## 테스트

웹사이트 테스트는 일반 TypeScript 프로젝트 테스트 작성과 유사하므로 자세한 내용은 <Link path="guides/typescript-project#testing">TypeScript 프로젝트 가이드</Link>를 참조하세요.

React 전용 테스트를 위해 React Testing Library가 설치되어 있습니다. 사용법은 [React Testing Library 문서](https://testing-library.com/docs/react-testing-library/example-intro)를 참조하세요.

`test` 타겟으로 테스트를 실행할 수 있습니다:

<NxCommands commands={['run <my-website>:test']} />

## 웹사이트 배포

React 웹사이트 생성기는 선택한 `iacProvider` 기반으로 CDK 또는 Terraform 인프라 코드를 생성합니다. 이를 통해 웹사이트를 배포할 수 있습니다.

<Infrastructure>
<Fragment slot="cdk">
웹사이트 배포를 위해 CDK 애플리케이션 생성 시 <Link path="guides/typescript-infrastructure">`ts#infra` 생성기</Link> 사용을 권장합니다.

`packages/common/constructs`에 생성된 CDK construct를 사용해 웹사이트를 배포할 수 있습니다.

```ts title="packages/infra/src/stacks/application-stack.ts" {3, 9}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    new MyWebsite(this, 'MyWebsite');
  }
}
```

이 설정은 다음을 구성합니다:

1. 정적 웹사이트 파일 호스팅을 위한 S3 버킷
2. 글로벌 콘텐츠 전송을 위한 CloudFront 배포
3. 보안 보호를 위한 WAF Web ACL 
4. 안전한 S3 접근을 위한 Origin Access Control
5. 웹사이트 파일 및 런타임 구성 자동 배포
</Fragment>
<Fragment slot="terraform">
웹사이트 배포를 위해 Terraform 프로젝트 생성 시 <Link path="guides/terraform-infrastructure">`terraform#project` 생성기</Link> 사용을 권장합니다.

`packages/common/terraform`에 생성된 Terraform 모듈을 사용해 웹사이트를 배포할 수 있습니다.

```hcl title="packages/infra/src/main.tf" {3}
# 웹사이트 배포
module "my_website" {
  source = "../../common/terraform/src/app/static-websites/my-website"

  providers = {
    aws.us_east_1 = aws.us_east_1
  }
}
```

이 설정은 다음을 구성합니다:

1. 정적 웹사이트 파일 호스팅을 위한 S3 버킷
2. 글로벌 콘텐츠 전송을 위한 CloudFront 배포
3. 보안 보호를 위한 WAF Web ACL (us-east-1에 배포)
4. 안전한 S3 접근을 위한 Origin Access Control
5. 웹사이트 파일 및 런타임 구성 자동 배포

:::note
CloudFront 및 WAF 리소스는 us-east-1 리전에 배포되어야 하므로 `aws.us_east_1` provider가 필요합니다. Terraform 구성에 다음 provider가 포함되었는지 확인하세요:

```hcl title="packages/infra/src/providers.tf"
provider "aws" {
  alias  = "us_east_1"
  region = "us-east-1"
}
```
:::
</Fragment>
</Infrastructure>