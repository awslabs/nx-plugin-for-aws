---
title: "타입스크립트 람다 함수"
description: "타입스크립트 람다 함수 생성"
---



import { FileTree } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import RunGenerator from '@components/run-generator.astro';
import GeneratorParameters from '@components/generator-parameters.astro';
import NxCommands from '@components/nx-commands.astro';
import Infrastructure from '@components/infrastructure.astro';
import Snippet from '@components/snippet.astro';

TypeScript Lambda Function 생성기는 기존 TypeScript 프로젝트에 람다 함수를 추가할 수 있는 기능을 제공합니다.

이 생성기는 AWS CDK 또는 Terraform 인프라 설정과 함께 새로운 TypeScript 람다 핸들러를 생성합니다. 생성된 핸들러는 [AWS Lambda Powertools for TypeScript](https://docs.powertools.aws.dev/lambda/typescript/latest/)를 사용하여 로깅, AWS X-Ray 추적, CloudWatch 메트릭과 같은 관측 가능성을 제공하며, [AWS Lambda Powertools의 Parser](https://docs.powertools.aws.dev/lambda/typescript/latest/utilities/parser/)를 통해 이벤트에 대한 타입 안전성도 선택적으로 제공합니다.

## 사용 방법

### TypeScript 람다 함수 생성

다음 두 가지 방법으로 람다 함수를 생성할 수 있습니다:

<RunGenerator generator="ts#lambda-function" />

### 옵션

<GeneratorParameters generator="ts#lambda-function" />

## 생성기 출력 결과

생성기는 프로젝트에 다음 파일들을 추가합니다:

<FileTree>

- \<project-name>
  - src/
    - \<lambda-function>.ts 함수 구현

</FileTree>

`functionPath` 옵션이 제공된 경우, 생성기는 프로젝트 소스 디렉토리 내 지정된 경로에 핸들러를 추가합니다:

<FileTree>

- \<project-name>
  - src/
    - \<custom-path>/
      - \<function-name>.ts 함수 구현

</FileTree>

### 인프라

<Snippet name="shared-constructs" />

생성기는 선택한 `iacProvider` 기반으로 함수 배포를 위한 인프라 코드를 생성합니다:

<Infrastructure>
<Fragment slot="cdk">
생성기는 `packages/common/constructs/src/app/lambda-functions` 디렉토리에 위치한 CDK 구문을 생성하며, 이를 통해 함수를 배포할 수 있습니다.
</Fragment>
<Fragment slot="terraform">
생성기는 `packages/common/terraform/src/app/lambda-functions/<function-name>` 디렉토리에 위치한 Terraform 모듈을 생성하며, 이를 통해 함수를 배포할 수 있습니다.
</Fragment>
</Infrastructure>

## 함수 구현

주요 함수 구현은 `<function-name>.ts` 파일에 있습니다. 예시:

```typescript
import { parser } from '@aws-lambda-powertools/parser/middleware';
import { EventBridgeSchema } from '@aws-lambda-powertools/parser/schemas';
import middy from '@middy/core';
import { Tracer } from '@aws-lambda-powertools/tracer';
import { captureLambdaHandler } from '@aws-lambda-powertools/tracer/middleware';
import { injectLambdaContext } from '@aws-lambda-powertools/logger/middleware';
import { Logger } from '@aws-lambda-powertools/logger';
import { Metrics } from '@aws-lambda-powertools/metrics';
import { logMetrics } from '@aws-lambda-powertools/metrics/middleware';
import { z } from 'zod';

process.env.POWERTOOLS_METRICS_NAMESPACE = 'MyFunction';
process.env.POWERTOOLS_SERVICE_NAME = 'MyFunction';

const tracer = new Tracer();
const logger = new Logger();
const metrics = new Metrics();

export const myFunction = async (
  event: z.infer<typeof EventBridgeSchema>,
): Promise<void> => {
  logger.info('Received event', event);

  // TODO: 구현 필요
};

export const handler = middy()
  .use(captureLambdaHandler(tracer))
  .use(injectLambdaContext(logger))
  .use(logMetrics(metrics))
  .use(parser({ schema: EventBridgeSchema }))
  .handler(myFunction);

```

생성기는 자동으로 다음과 같은 기능을 설정합니다:

1. 향상된 Lambda 기능을 위한 **Middy 미들웨어 스택**
2. 관측 가능성을 위한 **AWS Lambda Powertools 통합**
3. CloudWatch를 통한 **메트릭 수집**
4. 파서 미들웨어를 사용한 **타입 안전성**
5. 최적화된 배포 패키지를 위한 **Rolldown 번들링**

### AWS Lambda Powertools를 통한 관측 가능성

#### 로깅

생성기는 Middy 미들웨어를 통해 자동 컨텍스트 주입이 가능한 AWS Lambda Powertools 구조화 로깅을 구성합니다.

```typescript
export const handler = middy()
  .use(injectLambdaContext(logger))
  .handler(myFunction);
```

#### 추적

AWS X-Ray 추적은 `captureLambdaHandler` 미들웨어를 통해 자동 구성됩니다. 추적에 커스텀 서브세그먼트를 추가할 수 있습니다:

```typescript
const tracer = new Tracer();

export const myFunction = async (
  event: z.infer<typeof EventBridgeSchema>,
): Promise<void> => {
  // 새로운 서브세그먼트 생성
  const subsegment = tracer.getSegment()?.addNewSubsegment('custom-operation');
  try {
    // 로직 구현
  } catch (error) {
    subsegment?.addError(error as Error);
    throw error;
  } finally {
    subsegment?.close();
  }
};

export const handler = middy()
  .use(captureLambdaHandler(tracer))
  .handler(myFunction);
```

#### 메트릭

`logMetrics` 미들웨어를 통해 각 요청에 대한 CloudWatch 메트릭이 자동 수집됩니다. 커스텀 메트릭 추가 가능:

```typescript
const metrics = new Metrics();

export const myFunction = async (
  event: z.infer<typeof EventBridgeSchema>,
): Promise<void> => {
  metrics.addMetric("CustomMetric", MetricUnit.Count, 1);
  metrics.addMetric("ProcessingTime", MetricUnit.Milliseconds, processingTime);
};

export const handler = middy()
  .use(logMetrics(metrics))
  .handler(myFunction);
```

### 타입 안전성

람다 함수 생성 시 `eventSource`를 선택한 경우, [AWS Lambda Powertools의 `parser` 미들웨어](https://docs.powertools.aws.dev/lambda/typescript/latest/utilities/parser/)가 함수에 적용됩니다. 예시:

```typescript {4}
export const myFunction = async (
  event: z.infer<typeof EventBridgeSchema>,
): Promise<void> => {
  event.detail // <- IDE 자동 완성 지원 타입 안전성
};

export const handler = middy()
  .use(parser({ schema: EventBridgeSchema }))
  .handler(myFunction);
```

이를 통해 컴파일 타임 타입 안전성과 런타임 이벤트 유효성 검증이 제공됩니다.

:::caution
이벤트가 스키마를 준수하지 않을 때 핸들러가 오류를 발생시키지 않도록 하려면 [`safeParse` 옵션](https://docs.powertools.aws.dev/lambda/typescript/latest/utilities/parser/#safe-parsing)을 사용할 수 있습니다.
:::

:::tip
DynamoDB 스트림 또는 EventBridge 이벤트와 같이 이벤트 내 중첩된 커스텀 데이터가 있는 경우, [Envelopes](https://docs.powertools.aws.dev/lambda/typescript/latest/utilities/parser/#envelopes)를 사용하여 해당 데이터에 대한 타입 안전성을 제공받을 수 있습니다.
:::

이벤트 타입을 지정하지 않으려면 `eventSource`로 `Any`를 선택하면 이벤트 매개변수가 `any` 타입으로 설정됩니다.

## 번들링

<Snippet name="ts-bundle" />

## 함수 배포

<Snippet name="lambda-function/deploying-your-function" parentHeading="Deploying your Function" />