---
title: "Python 람다 함수"
description: "Python 람다 함수에 대한 참조 문서"
---



import { FileTree } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import RunGenerator from '@components/run-generator.astro';
import GeneratorParameters from '@components/generator-parameters.astro';
import Infrastructure from '@components/infrastructure.astro';
import Snippet from '@components/snippet.astro';
import NxCommands from '@components/nx-commands.astro';

Python Lambda Function 생성기는 기존 Python 프로젝트에 람다 함수를 추가할 수 있는 기능을 제공합니다.

이 생성기는 AWS CDK 또는 Terraform 인프라 설정과 함께 새로운 Python 람다 핸들러를 생성합니다. 생성된 백엔드는 서버리스 배포를 위해 AWS Lambda를 사용하며, [AWS Lambda Powertools의 Parser](https://docs.powertools.aws.dev/lambda/python/latest/utilities/parser/)를 활용한 선택적 타입 안전성을 제공합니다. 로깅, AWS X-Ray 추적 및 Cloudwatch 메트릭을 포함한 관측 가능성을 위해 [AWS Lambda Powertools](https://docs.powertools.aws.dev/lambda/python/latest/)를 설정합니다.

## 사용 방법

### Lambda Function 생성

다음 두 가지 방법으로 새로운 Lambda Function을 생성할 수 있습니다:

<RunGenerator generator="py#lambda-function" />

### 옵션

<GeneratorParameters generator="py#lambda-function" />

## 생성기 출력

생성기는 프로젝트에 다음 파일들을 추가합니다:

<FileTree>

- \<module-name>
  - \<lambda-function>.py 함수 구현

</FileTree>

`functionPath` 옵션이 제공된 경우, 생성기는 지정된 경로에 필요한 파일들을 추가합니다:

<FileTree>

- \<module-name>
  - \<custom-path>
    - \<function-name>.py 함수 구현

</FileTree>

### 인프라

<Snippet name="shared-constructs" />

생성기는 선택한 `iacProvider` 기반으로 함수를 배포하기 위한 인프라 코드를 생성합니다:

<Infrastructure>
<Fragment slot="cdk">
생성기는 `packages/common/constructs` 디렉터리에 위치한 CDK 구성을 생성합니다.
</Fragment>
<Fragment slot="terraform">
생성기는 `packages/common/terraform/src/app/lambda-functions/<function-name>` 디렉터리에 위치한 Terraform 모듈을 생성합니다.
</Fragment>
</Infrastructure>

## 함수 구현

주요 함수 구현은 `<function-name>.py`에 있습니다. 예시:

```python
import os

from aws_lambda_powertools import Logger, Metrics, Tracer
from aws_lambda_powertools.metrics import MetricUnit
from aws_lambda_powertools.utilities.parser import event_parser
from aws_lambda_powertools.utilities.parser.models import EventBridgeModel
from aws_lambda_powertools.utilities.typing import LambdaContext

os.environ["POWERTOOLS_METRICS_NAMESPACE"] = "Foo"
os.environ["POWERTOOLS_SERVICE_NAME"] = "Foo"

logger: Logger = Logger()
metrics: Metrics = Metrics()
tracer: Tracer = Tracer()

@tracer.capture_lambda_handler
@metrics.log_metrics
@event_parser(model=EventBridgeModel)
def lambda_handler(event: EventBridgeModel, context: LambdaContext):
    logger.info("Received event", extra={"event": event.model_dump() })
    metrics.add_metric(name="InvocationCount", unit=MetricUnit.Count, value=1)

    try:
        # TODO: 구현 필요
        metrics.add_metric(name="SuccessCount", unit=MetricUnit.Count, value=1)
        # TODO: 필요시 성공 응답 구현
    except Exception as e:
        logger.exception(e)
        metrics.add_metric(name="ErrorCount", unit=MetricUnit.Count, value=1)
        # TODO: 필요시 오류 응답 구현
```

생성기는 자동으로 다음 기능들을 설정합니다:

1. 관측 가능성을 위한 AWS Lambda Powertools 통합
2. 메트릭 수집
3. `@event_parser`를 사용한 타입 안전성

### AWS Lambda Powertools를 이용한 관측 가능성

#### 로깅

생성기는 AWS Lambda Powertools를 사용한 구조화된 로깅을 구성합니다.

```python
def lambda_handler(event: EventBridgeModel, context: LambdaContext):
    logger.info("Received event", extra={"event": event.model_dump()})
```

:::tip
디버깅 및 모니터링을 용이하게 하기 위해 모든 고유 요청에 대해 상관 ID를 설정하는 것이 좋습니다. 상관 ID 모범 사례는 [aws powertools logger](https://docs.powertools.aws.dev/lambda/python/2.22.0/core/logger/#setting-a-correlation-id) 문서를 참조하세요.
:::

로거는 자동으로 다음을 포함합니다:
- 이벤트 요청
- Lambda 컨텍스트 정보
- 콜드 스타트 표시기

#### 추적

AWS X-Ray 추적이 자동으로 구성됩니다. 추적에 커스텀 하위 세그먼트를 추가할 수 있습니다:

```python
def lambda_handler(event: EventBridgeModel, context: LambdaContext):
    # 새로운 하위 세그먼트 생성
    with tracer.provider.in_subsegment("function-subsegment"):
        # 여기에 로직 구현
        return ....
```

#### 메트릭

CloudWatch 메트릭이 각 요청마다 자동으로 수집됩니다. 커스텀 메트릭을 추가할 수 있습니다:

```python
def lambda_handler(event: EventBridgeModel, context: LambdaContext):
    metrics.add_metric(name="NewMetric", unit=MetricUnit.Count, value=1)
    return ...
```

기본 메트릭 포함 사항:
- 호출 횟수
- 성공/실패 횟수
- 콜드 스타트 메트릭

### 타입 안전성

람다 함수 생성 시 `eventSource`를 선택한 경우, [AWS Lambda Powertools의 `@event_parser`](https://docs.powertools.aws.dev/lambda/python/latest/utilities/parser/)로 함수가 계측됩니다. 예시:

```python {3}
@event_parser(model=EventBridgeModel)
def lambda_handler(event: EventBridgeModel, context: LambdaContext):
    event.detail_type # <- IDE 자동 완성 지원 타입 안전성
```

이를 통해 <Link path="guides/fastapi">Fast API</Link> 작업과 유사하게 [Pydantic](https://docs.pydantic.dev/latest/)을 사용해 데이터 모델을 정의할 수 있습니다.

:::tip
DynamoDB 스트림 또는 EventBridge 이벤트와 같이 이벤트 내에 중첩된 커스텀 데이터가 있는 경우, [Envelopes](https://docs.powertools.aws.dev/lambda/python/latest/utilities/parser/#envelopes)를 사용해 해당 데이터에 대한 타입 안전성을 제공할 수 있습니다.
:::

이벤트 타입을 지정하지 않으려면 `eventSource`로 `Any`를 선택하면 됩니다.

## 번들링

생성기는 [uv](https://docs.astral.sh/uv/)를 사용해 Lambda 배포 패키지에 대한 Python 번들링을 자동으로 구성합니다:

<NxCommands commands={['run <project-name>:bundle']} />

:::note
이것은 배포 패키지로 전체 프로젝트를 번들링합니다. 배포 크기를 최소화하려면 <Link path="guides/python-project">`py#project`</Link> 생성기로 생성된 여러 Python 프로젝트에 걸쳐 람다 함수를 분할할 수 있습니다.
:::

이 프로세스는 다음을 사용합니다:
1. Python 종속성을 `requirements.txt` 파일로 내보내기 위한 [`uv export`](https://docs.astral.sh/uv/reference/cli/#uv-export)
2. Lambda 배포를 위한 대상 플랫폼(`x86_64-manylinux2014`)에 종속성을 설치하기 위한 [`uv pip install`](https://docs.astral.sh/uv/reference/cli/#uv-pip-install)

:::note
[람다 아키텍처를 ARM으로 변경](https://docs.aws.amazon.com/lambda/latest/dg/foundation-arch.html)하는 경우 번들 대상을 `aarch64-manylinux2014`로 수정해야 합니다.
:::

## 함수 배포

<Snippet name="lambda-function/deploying-your-function" parentHeading="Deploying your Function" />