---
title: "Story ì—ì´ì „íŠ¸ êµ¬í˜„ ë° êµ¬ì„±"
description: "@aws/nx-pluginì„ ì‚¬ìš©í•˜ì—¬ ì—ì´ì „íŠ¸í˜• AI ê¸°ë°˜ ë˜ì „ ëª¨í—˜ ê²Œì„ì„ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ì•ˆë‚´"
---

import { Aside, Code, FileTree, Steps, Tabs, TabItem } from '@astrojs/starlight/components';
import { Image } from 'astro:assets';
import Drawer from '@components/drawer.astro';
import Link from '@components/link.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import PackageManagerShortCommand from '@components/package-manager-short-command.astro';
import InstallCommand from '@components/install-command.astro';
import E2ECode from '@components/e2e-code.astro';
import E2EDiff from '@components/e2e-diff.astro';

import dungeonAdventureArchitecturePng from '@assets/dungeon-game-architecture.png'
import dungeonAdventureErPng from '@assets/dungeon-adventure-er.png'
import baselineWebsitePng from '@assets/baseline-website.png'
import baselineGamePng from '@assets/baseline-game.png'
import nxGraphPng from '@assets/nx-graph.png'
import gameSelectPng from '@assets/game-select.png'
import gameConversationPng from '@assets/game-conversation.png'

## ì‘ì—… 1: ìŠ¤í† ë¦¬ ì—ì´ì „íŠ¸ êµ¬í˜„

ìŠ¤í† ë¦¬ ì—ì´ì „íŠ¸ëŠ” [Strands](https://strandsagents.com/) ì—ì´ì „íŠ¸ë¡œ, `Game`ê³¼ ì»¨í…ìŠ¤íŠ¸ìš© `Action` ëª©ë¡ì„ ì…ë ¥ë°›ì•„ ìŠ¤í† ë¦¬ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤. ì´ ì—ì´ì „íŠ¸ë¥¼ ì¸ë²¤í† ë¦¬ MCP ì„œë²„ì™€ ì—°ë™í•˜ë„ë¡ êµ¬ì„±í•˜ì—¬ í”Œë ˆì´ì–´ì˜ ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´í…œì„ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

:::note
ë³¸ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” ê° í˜¸ì¶œì´ ì „ì²´ ë©”ì‹œì§€ ê¸°ë¡ì„ í¬í•¨í•˜ëŠ” ë…ë¦½ ì„¸ì…˜ì¸ "ìƒíƒœ ë¹„ì €ì¥" ë°©ì‹ìœ¼ë¡œ ì—ì´ì „íŠ¸ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤. í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” [Bedrock AgentCore ë©”ëª¨ë¦¬](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/memory.html) í†µí•©ì„ ê³ ë ¤í•˜ì„¸ìš”. ìì„¸í•œ ë‚´ìš©ì€ [Strandsì™€ AgentCore ë©”ëª¨ë¦¬ ì‚¬ìš©](https://github.com/aws/bedrock-agentcore-sdk-python/tree/main/src/bedrock_agentcore/memory/integrations/strands) í˜ì´ì§€ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.
:::

### ì—ì´ì „íŠ¸ êµ¬í˜„

ì—ì´ì „íŠ¸ë¥¼ êµ¬í˜„í•˜ë ¤ë©´ `packages/story/dungeon_adventure_story/agent` ë‚´ ë‹¤ìŒ íŒŒì¼ë“¤ì„ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”:

<Tabs>
  <TabItem label="main.py">
<E2EDiff lang="python" before="dungeon-adventure/3/main.py.old.template" after="dungeon-adventure/3/main.py.template" />
  </TabItem>
  <TabItem label="agent.py">
<E2EDiff lang="python" before="dungeon-adventure/3/agent.py.old.template" after="dungeon-adventure/3/agent.py.template" />
  </TabItem>
</Tabs>

ì´ êµ¬ì„±ì€ ë‹¤ìŒì„ ì„¤ì •í•©ë‹ˆë‹¤:

- ì—ì´ì „íŠ¸ í˜ì´ë¡œë“œì—ì„œ í”Œë ˆì´ì–´, ì¥ë¥´, ì•¡ì…˜ ì¶”ì¶œ,
- SigV4 ì¸ì¦ìœ¼ë¡œ MCP ì„œë²„ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” í´ë¼ì´ì–¸íŠ¸ êµ¬ì„±, ê·¸ë¦¬ê³ 
- ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ì™€ MCP ì„œë²„ ë„êµ¬ë¥¼ í¬í•¨í•œ ì—ì´ì „íŠ¸ êµ¬ì„±.

## ì‘ì—… 2: ë°°í¬ ë° í…ŒìŠ¤íŠ¸

### ì½”ë“œ ë¹Œë“œ

ì½”ë“œë¥¼ ë¹Œë“œí•˜ë ¤ë©´:

<PackageManagerShortCommand commands={["build"]} />

<Aside type="tip">
ë¦°íŠ¸ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ ìë™ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<PackageManagerShortCommand commands={["lint"]} />
</Aside>

### ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬
ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•˜ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”:

<NxCommands commands={['deploy infra "dungeon-adventure-infra-sandbox/*"']} />

ë°°í¬ëŠ” ì•½ 2ë¶„ ì •ë„ ì†Œìš”ë©ë‹ˆë‹¤.

ë°°í¬ê°€ ì™„ë£Œë˜ë©´ ë‹¤ìŒê³¼ ìœ ì‚¬í•œ ì¶œë ¥ì´ í‘œì‹œë©ë‹ˆë‹¤ _(ì¼ë¶€ ê°’ì€ í¸ì§‘ë¨)_:

```bash
dungeon-adventure-infra-sandbox-Application
dungeon-adventure-infra-sandbox-Application: deploying... [2/2]

 âœ…  dungeon-adventure-infra-sandbox-Application

âœ¨  Deployment time: 354s

Outputs:
dungeon-adventure-infra-sandbox-Application.ElectroDbTableTableNameXXX = dungeon-adventure-infra-sandbox-Application-ElectroDbTableXXX-YYY
dungeon-adventure-infra-sandbox-Application.GameApiEndpointXXX = https://xxx.execute-api.region.amazonaws.com/prod/
dungeon-adventure-infra-sandbox-Application.GameUIDistributionDomainNameXXX = xxx.cloudfront.net
dungeon-adventure-infra-sandbox-Application.InventoryMcpArn = arn:aws:bedrock-agentcore:region:xxxxxxx:runtime/dungeonadventureventoryMcpServerXXXX-YYYY
dungeon-adventure-infra-sandbox-Application.StoryAgentArn = arn:aws:bedrock-agentcore:region:xxxxxxx:runtime/dungeonadventurecationStoryAgentXXXX-YYYY
dungeon-adventure-infra-sandbox-Application.UserIdentityUserIdentityIdentityPoolIdXXX = region:xxx
dungeon-adventure-infra-sandbox-Application.UserIdentityUserIdentityUserPoolIdXXX = region_xxx
```

### ì—ì´ì „íŠ¸ í…ŒìŠ¤íŠ¸

ë‹¤ìŒ ë°©ë²• ì¤‘ í•˜ë‚˜ë¡œ ì—ì´ì „íŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
<ul>
<li>ì—ì´ì „íŠ¸ ì„œë²„ ë¡œì»¬ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹œì‘í•˜ê³  `curl`ë¡œ í˜¸ì¶œí•˜ê±°ë‚˜,</li>
<li>JWT í† í°ì„ ì‚¬ìš©í•˜ì—¬ ë°°í¬ëœ APIë¥¼ curlë¡œ í˜¸ì¶œí•©ë‹ˆë‹¤.</li>
</ul>

<Tabs>
  <TabItem label="Local">
  ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ ë¡œì»¬ ì—ì´ì „íŠ¸ ì„œë²„ë¥¼ ì‹œì‘í•˜ì„¸ìš”:
    <NxCommands highlights={['arn:aws:bedrock-agentcore:region:xxxxxxx:runtime/dungeonadventureventoryMcpServerXXXX-YYYY', 'region']} env={{INVENTORY_MCP_ARN:"arn:aws:bedrock-agentcore:region:xxxxxxx:runtime/dungeonadventureventoryMcpServerXXXX-YYYY", AWS_REGION: '<region>'}} commands={["run dungeon_adventure.story:agent-serve"]} />

    :::caution
    ìœ„ ëª…ë ¹ì–´ì—ì„œ CDK ë°°í¬ ì¶œë ¥ê°’ `InventoryMcpArn`ì„ ì‚¬ìš©í•˜ê³  ëŒ€ìƒ `AWS_REGION`ì„ ì§€ì •í•˜ì„¸ìš”.
    :::

    ì—ì´ì „íŠ¸ ì„œë²„ê°€ ì‹¤í–‰ë˜ë©´(ì½˜ì†”ì— ì¶œë ¥ë˜ì§€ ì•ŠìŒ) ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ í˜¸ì¶œí•˜ì„¸ìš”:

    ```bash
    curl -N -X POST http://127.0.0.1:8081/invocations \
      -d '{"genre":"superhero", "actions":[], "playerName":"UnnamedHero"}' \
      -H "Content-Type: application/json"
    ```
  </TabItem>
  <TabItem label="Deployed">
    ë°°í¬ëœ ì—ì´ì „íŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ Cognitoë¡œ ì¸ì¦ í›„ JWT í† í°ì„ íšë“í•´ì•¼ í•©ë‹ˆë‹¤. ë¨¼ì € í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ì„¸ìš”:

    ```bash
    # CDK ì¶œë ¥ì—ì„œ Cognito User Pool IDì™€ Client ID ì„¤ì •
    export POOL_ID="<CDK ì¶œë ¥ì˜ UserPoolId>"
    export CLIENT_ID="<CDK ì¶œë ¥ì˜ UserPoolClientId>"
    export REGION="<ë¦¬ì „>"
    ```

    í…ŒìŠ¤íŠ¸ ì‚¬ìš©ìë¥¼ ìƒì„±í•˜ê³  ì¸ì¦ í† í°ì„ íšë“í•˜ì„¸ìš”:

    ```bash
    # ì‚¬ìš©ì ìƒì„±ì„ ê°„ì†Œí™”í•˜ê¸° ìœ„í•´ MFA ë¹„í™œì„±í™”
    aws cognito-idp set-user-pool-mfa-config \
      --mfa-configuration OFF \
      --user-pool-id $POOL_ID

    # ì‚¬ìš©ì ìƒì„±
    aws cognito-idp admin-create-user \
      --user-pool-id $POOL_ID \
      --username "test" \
      --temporary-password "TempPass123-" \
      --region $REGION \
      --message-action SUPPRESS > /dev/null

    # ì˜êµ¬ ë¹„ë°€ë²ˆí˜¸ ì„¤ì •(ë” ì•ˆì „í•œ ë¹„ë°€ë²ˆí˜¸ë¡œ êµì²´ ê¶Œì¥)
    aws cognito-idp admin-set-user-password \
      --user-pool-id $POOL_ID \
      --username "test" \
      --password "PermanentPass123-" \
      --region $REGION \
      --permanent > /dev/null

    # ì‚¬ìš©ì ì¸ì¦ ë° ì•¡ì„¸ìŠ¤ í† í° íšë“
    export BEARER_TOKEN=$(aws cognito-idp initiate-auth \
      --client-id "$CLIENT_ID" \
      --auth-flow USER_PASSWORD_AUTH \
      --auth-parameters USERNAME='test',PASSWORD='PermanentPass123-' \
      --region $REGION \
      --query "AuthenticationResult.AccessToken" \
      --output text)
    ```

    Bedrock AgentCore ëŸ°íƒ€ì„ URLì„ ì‚¬ìš©í•˜ì—¬ ë°°í¬ëœ ì—ì´ì „íŠ¸ë¥¼ í˜¸ì¶œí•˜ì„¸ìš”:

    ```bash
    # CDK ì¶œë ¥ì—ì„œ Story Agent ARN ì„¤ì •
    export AGENT_ARN="<CDK ì¶œë ¥ì˜ StoryAgentArn>"

    # ARN URL ì¸ì½”ë”©
    export ENCODED_ARN=$(echo $AGENT_ARN | sed 's/:/%3A/g' | sed 's/\//%2F/g')

    # í˜¸ì¶œ URL êµ¬ì„±
    export AGENT_URL="https://bedrock-agentcore.$REGION.amazonaws.com/runtimes/$ENCODED_ARN/invocations?qualifier=DEFAULT"

    # ì—ì´ì „íŠ¸ í˜¸ì¶œ
    curl -N -X POST "$AGENT_URL" \
      -H "authorization: Bearer $BEARER_TOKEN" \
      -H "Content-Type: application/json" \
      -H "X-Amzn-Bedrock-AgentCore-Runtime-Session-Id: abcdefghijklmnopqrstuvwxyz-123456789" \
      -d '{"genre":"superhero", "actions":[], "playerName":"UnnamedHero"}'
    ```

    :::note
    ARNì„ Bedrock AgentCore API ì—”ë“œí¬ì¸íŠ¸ì— ë§ê²Œ ì˜¬ë°”ë¥´ê²Œ í¬ë§·í•˜ë ¤ë©´ URL ì¸ì½”ë”©ì´ í•„ìš”í•©ë‹ˆë‹¤.
    :::
  </TabItem>
</Tabs>

ëª…ë ¹ì´ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë˜ë©´ ì´ˆê¸° ìŠ¤í† ë¦¬ í…ìŠ¤íŠ¸ê°€ JSON Lines í˜•ì‹ìœ¼ë¡œ ìŠ¤íŠ¸ë¦¬ë°ë˜ê¸° ì‹œì‘í•©ë‹ˆë‹¤:

```
{"content":"You are "}
{"content":"a new superhero "}
{"content":"in the bustling metropolis of Metro City..."}
```

ì¶•í•˜í•©ë‹ˆë‹¤. Bedrock AgentCore ëŸ°íƒ€ì„ì— ì²« ë²ˆì§¸ Strands ì—ì´ì „íŠ¸ë¥¼ êµ¬ì¶•í•˜ê³  ë°°í¬í–ˆìŠµë‹ˆë‹¤! ğŸ‰ğŸ‰ğŸ‰