---
title: "ê²Œì„ API ë° ì¸ë²¤í† ë¦¬ MCP ì„œë²„ êµ¬í˜„"
description: "@aws/nx-pluginì„ ì‚¬ìš©í•˜ì—¬ ì—ì´ì „íŠ¸í˜• AI ê¸°ë°˜ ë˜ì „ ëª¨í—˜ ê²Œì„ì„ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ì•ˆë‚´"
---

import { Aside, Code, FileTree, Steps, Tabs, TabItem } from '@astrojs/starlight/components';
import { Image } from 'astro:assets';
import Link from '@components/link.astro';
import Drawer from '@components/drawer.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import InstallCommand from '@components/install-command.astro';
import E2EDiff from '@components/e2e-diff.astro';
import E2ECode from '@components/e2e-code.astro';
import Snippet from '@components/snippet.astro';

import dungeonAdventureArchitecturePng from '@assets/dungeon-game-architecture.png'
import dungeonAdventureErPng from '@assets/dungeon-adventure-er.png'
import baselineWebsitePng from '@assets/baseline-website.png'
import baselineGamePng from '@assets/baseline-game.png'
import nxGraphPng from '@assets/nx-graph.png'
import gameSelectPng from '@assets/game-select.png'
import gameConversationPng from '@assets/game-conversation.png'

import { getDungeonAdventureElectroDbDependencies } from '../../../../../../../../e2e/src/utils';

## ì‘ì—… 1: Game API êµ¬í˜„

ì´ ì„¹ì…˜ì—ì„œëŠ” ë‹¤ìŒ APIë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤:

1. `saveGame` - ê²Œì„ ìƒì„± ë˜ëŠ” ì—…ë°ì´íŠ¸
2. `queryGames` - ì €ì¥ëœ ê²Œì„ ëª©ë¡ì„ í˜ì´ì§€ë„¤ì´ì…˜ìœ¼ë¡œ ë°˜í™˜
3. `saveAction` - íŠ¹ì • ê²Œì„ì— ëŒ€í•œ ì•¡ì…˜ ì €ì¥
4. `queryActions` - ê²Œì„ ê´€ë ¨ ëª¨ë“  ì•¡ì…˜ì˜ í˜ì´ì§€ë„¤ì´ì…˜ ëª©ë¡ ë°˜í™˜
5. `queryInventory` - í”Œë ˆì´ì–´ ì¸ë²¤í† ë¦¬ ì•„ì´í…œ ëª©ë¡ì„ í˜ì´ì§€ë„¤ì´ì…˜ìœ¼ë¡œ ë°˜í™˜

### API ìŠ¤í‚¤ë§ˆ

[Zod](https://zod.dev/)ë¥¼ ì‚¬ìš©í•˜ì—¬ API ì…ë ¥/ì¶œë ¥ ìŠ¤í‚¤ë§ˆë¥¼ `packages/game-api/src/schema/index.ts` íŒŒì¼ì— ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜í•©ë‹ˆë‹¤:

<E2EDiff lang="typescript" before="dungeon-adventure/2/schema/index.ts.old.template" after="dungeon-adventure/2/schema/index.ts.template" />

ì´ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•˜ì§€ ì•Šì„ `packages/game-api/src/schema/echo.ts` íŒŒì¼ì€ ì‚­ì œí•©ë‹ˆë‹¤.

<Aside type="tip">
ê° Zod ìŠ¤í‚¤ë§ˆ ì •ì˜ì— `z.TypeOf` êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ í•¨ê»˜ ë‚´ë³´ëƒ…ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ì¤‘ë³µ ì‘ì—… ì—†ì´ Zod ì •ì˜ë¥¼ TypeScript ì¸í„°í˜ì´ìŠ¤ë¡œ ë³€í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
</Aside>

### ì—”í‹°í‹° ëª¨ë¸ë§

ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ER ë‹¤ì´ì–´ê·¸ë¨ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

<Image class="centered-image white-bg" src={dungeonAdventureErPng} alt="dungeon-adventure-er.png" width="400" height="300" />

{/* Generated from the following PlantUML: */}
{/*
@startuml Game API Entity Relationship Diagram

!theme plain

skinparam linetype ortho
skinparam roundcorner 10

entity "Game" as game {
  + playerName : string <<PK>>
  --
  genre : string
  lastUpdated : string
}

entity "Action" as action {
  + playerName : string <<PK>>
  + timestamp : string <<SK>>
  --
  role : string
  content : string
}

entity "Item" as item {
  + playerName : string <<PK>>
  + itemName : string
  --
  emoji : string (optional)
  lastUpdated : string
  quantity : number
}

game ||--o{ action
game ||--o{ item

@enduml
*/}

DynamoDBì— ë°ì´í„°ë² ì´ìŠ¤ë¥¼ êµ¬í˜„í•  ê²ƒì´ë©°, [ElectroDB](https://electrodb.dev/en/core-concepts/introduction/) DynamoDB í´ë¼ì´ì–¸íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‘ì—…ì„ ë‹¨ìˆœí™”í•©ë‹ˆë‹¤. `electrodb`ì™€ DynamoDB í´ë¼ì´ì–¸íŠ¸ë¥¼ ì„¤ì¹˜í•˜ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤:

<InstallCommand pkg={getDungeonAdventureElectroDbDependencies()} />

<Aside>
ëª¨ë“  ì¢…ì†ì„±ì€ ë£¨íŠ¸ `package.json`ì— ì¶”ê°€ë©ë‹ˆë‹¤. `@aws/nx-plugin`ì€ [ë‹¨ì¼ ë²„ì „ ì •ì±…](https://nx.dev/concepts/decisions/dependency-management#single-version-policy) ì›ì¹™ì„ ë”°ë¦…ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ <Link path="guides/typescript-project#dependencies">TypeScript í”„ë¡œì íŠ¸ ê°€ì´ë“œ</Link>ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.
</Aside>

ER ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ ElectroDB ì—”í‹°í‹°ë¥¼ ì •ì˜í•˜ê¸° ìœ„í•´ `packages/game-api/src/entities/index.ts` íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤:

<E2ECode lang="typescript" path="dungeon-adventure/2/entities/index.ts.template" />

ElectroDBë¥¼ ì‚¬ìš©í•˜ë©´ íƒ€ì… ì •ì˜ë¿ë§Œ ì•„ë‹ˆë¼ íƒ€ì„ìŠ¤íƒ¬í”„ì™€ ê°™ì€ íŠ¹ì • ê°’ì— ëŒ€í•œ ê¸°ë³¸ê°’ì„ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ElectroDBëŠ” DynamoDB ì‚¬ìš© ì‹œ ê¶Œì¥ë˜ëŠ” [ë‹¨ì¼ í…Œì´ë¸” ë””ìì¸](https://electrodb.dev/en/core-concepts/single-table-relationships/)ì„ ë”°ë¦…ë‹ˆë‹¤.

<Aside>
ElectroDBëŠ” [ì»¬ë ‰ì…˜](https://electrodb.dev/en/modeling/collections/)ì„ ì§€ì›í•˜ì§€ë§Œ, ë³¸ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” ê°„ê²°ì„±ì„ ìœ„í•´ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
</Aside>

MCP ì„œë²„ê°€ ì¸ë²¤í† ë¦¬ì™€ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆë„ë¡ `packages/game-api/src/index.ts`ì—ì„œ ì¸ë²¤í† ë¦¬ ì—”í‹°í‹°ë¥¼ ë‚´ë³´ë‚´ì•¼ í•©ë‹ˆë‹¤:

<Tabs>
<TabItem label="packages/game-api/src/index.ts">
<E2EDiff lang="typescript" before="dungeon-adventure/2/index.ts.old.template" after="dungeon-adventure/2/index.ts.template" />
</TabItem>
</Tabs>

:::note
MCP ì„œë²„ê°€ APIì— ì˜ì¡´í•˜ì§€ ì•Šë„ë¡ ì—”í‹°í‹°ë¥¼ ë³„ë„ì˜ ê³µìœ  í”„ë¡œì íŠ¸ë¡œ ë¦¬íŒ©í† ë§í•˜ë©´ íŒ¨í‚¤ì§€ êµ¬ì¡°ê°€ ë” ê°œì„ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
:::

### í”„ë¡œì‹œì € ì •ì˜

API ë©”ì„œë“œë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ `packages/game-api/src/procedures` ë‚´ì—ì„œ ë‹¤ìŒ ë³€ê²½ì‚¬í•­ì„ ì ìš©í•©ë‹ˆë‹¤:

<Tabs>
  <TabItem label="actions.ts">
<E2ECode lang="typescript" path="dungeon-adventure/2/procedures/actions.ts.template" />
  </TabItem>
  <TabItem label="games.ts">
<E2ECode lang="typescript" path="dungeon-adventure/2/procedures/games.ts.template" />
  </TabItem>
  <TabItem label="inventory.ts">
<E2ECode lang="typescript" path="dungeon-adventure/2/procedures/inventory.ts.template" />
  </TabItem>
</Tabs>

ì´ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•˜ì§€ ì•Šì„ `echo.ts` íŒŒì¼(`packages/game-api/src/procedures` ë‚´)ì€ ì‚­ì œí•©ë‹ˆë‹¤.

### ë¼ìš°í„° ì„¤ì •

í”„ë¡œì‹œì €ë¥¼ ì •ì˜í•œ í›„ APIì— ì—°ê²°í•˜ê¸° ìœ„í•´ ë‹¤ìŒ íŒŒì¼ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤:

<Tabs>
  <TabItem label="packages/game-api/src/router.ts">
<E2EDiff lang="typescript" before="dungeon-adventure/2/router.ts.old.template" after="dungeon-adventure/2/router.ts.template" />
</TabItem>
</Tabs>

## ì‘ì—… 2: ì¸ë²¤í† ë¦¬ MCP ì„œë²„ ìƒì„±

ì—ì´ì „íŠ¸ê°€ í”Œë ˆì´ì–´ ì¸ë²¤í† ë¦¬ ì•„ì´í…œì„ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” MCP ì„œë²„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

ì—ì´ì „íŠ¸ë¥¼ ìœ„í•´ ë‹¤ìŒ ë„êµ¬ë“¤ì„ ì •ì˜í•©ë‹ˆë‹¤:

- `list-inventory-items`: í”Œë ˆì´ì–´ì˜ í˜„ì¬ ì¸ë²¤í† ë¦¬ ì•„ì´í…œ ì¡°íšŒ
- `add-to-inventory`: ì¸ë²¤í† ë¦¬ì— ì•„ì´í…œ ì¶”ê°€
- `remove-from-inventory`: ì¸ë²¤í† ë¦¬ì—ì„œ ì•„ì´í…œ ì œê±°

ì‹œê°„ ì ˆì•½ì„ ìœ„í•´ ëª¨ë“  ë„êµ¬ë¥¼ ì¸ë¼ì¸ìœ¼ë¡œ ì •ì˜í•©ë‹ˆë‹¤:

<Tabs>
  <TabItem label="packages/inventory/src/mcp-server/server.ts">
<E2EDiff lang="typescript" before="dungeon-adventure/2/mcp/server.ts.old.template" after="dungeon-adventure/2/mcp/server.ts.template" />
</TabItem>
</Tabs>

ë„êµ¬ ìˆ˜ê°€ ì¦ê°€í•˜ë©´ ë³„ë„ íŒŒì¼ë¡œ ë¦¬íŒ©í† ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì‚¬ìš©ë˜ì§€ ì•Šì„ `packages/inventory/src/mcp-server` ë‚´ì˜ `tools` ë° `resources` ë””ë ‰í† ë¦¬ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.

## ì‘ì—… 3: ì¸í”„ë¼ ì—…ë°ì´íŠ¸

ë§ˆì§€ë§‰ ë‹¨ê³„ë¡œ DynamoDB í…Œì´ë¸”ì„ ìƒì„±í•˜ê³  Game APIì—ì„œ ì‘ì—… ê¶Œí•œì„ ë¶€ì—¬í•˜ê¸° ìœ„í•´ ì¸í”„ë¼ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
ì´ë¥¼ ìœ„í•´ `packages/infra/src`ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•©ë‹ˆë‹¤:

<Tabs>
  <TabItem label="constructs/electrodb-table.ts">
<E2ECode lang="typescript" path="dungeon-adventure/2/constructs/electrodb-table.ts.template" />
  </TabItem>
  <TabItem label="stacks/application-stack.ts">
<E2EDiff lang="typescript" before="dungeon-adventure/1/application-stack.ts.template" after="dungeon-adventure/2/stacks/application-stack.ts.template" />

:::note
ê° í”„ë¡œì‹œì €ëŠ” ê°œë³„ ëŒë‹¤ í•¨ìˆ˜ì—ì„œ ì œê³µë˜ë¯€ë¡œ ìµœì†Œ ê¶Œí•œ ì›ì¹™ì— ë”°ë¼ í”„ë¡œì‹œì € êµ¬í˜„ì— í•„ìš”í•œ ì½ê¸°/ì“°ê¸° ê¶Œí•œë§Œ í• ë‹¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
:::
  </TabItem>
</Tabs>

## ì‘ì—… 4: ë°°í¬ ë° í…ŒìŠ¤íŠ¸

ë¨¼ì € ë¦°íŠ¸ ë¬¸ì œë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤:

<NxCommands commands={['run-many --target lint --configuration=fix --all']} />

ê·¸ëŸ° ë‹¤ìŒ ì½”ë“œë² ì´ìŠ¤ë¥¼ ë¹Œë“œí•©ë‹ˆë‹¤:

<NxCommands commands={['run-many --target build --all']} />

### ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬
ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•˜ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤:

<NxCommands commands={['deploy infra "dungeon-adventure-infra-sandbox/*"']} />

:::caution
AWS ê³„ì •ì„ ë¨¼ì € ë¶€íŠ¸ìŠ¤íŠ¸ë©í•˜ë ¤ë©´ ë‹¤ìŒì„ ì‹¤í–‰í•˜ì„¸ìš”:

<NxCommands commands={['bootstrap infra']} />
:::

ì²« ë°°í¬ëŠ” ì•½ 8ë¶„ ì •ë„ ì†Œìš”ë©ë‹ˆë‹¤. ì´í›„ ë°°í¬ëŠ” ì•½ 2ë¶„ ì •ë„ ê±¸ë¦½ë‹ˆë‹¤.

:::tip
ëŒë‹¤ í•¨ìˆ˜ ì½”ë“œ ë³€ê²½ì„ ë°˜ë³µí•˜ëŠ” ê²½ìš° ì½”ë“œë² ì´ìŠ¤ ë¹Œë“œ í›„ `--hotswap` í”Œë˜ê·¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°°í¬ ì‹œê°„ì„ í¬ê²Œ ë‹¨ì¶•(2-3ì´ˆ)í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<NxCommands commands={['run @dungeon-adventure/infra:deploy "dungeon-adventure-infra-sandbox/*" --hotswap']} />
:::

ë°°í¬ê°€ ì™„ë£Œë˜ë©´ ë‹¤ìŒê³¼ ìœ ì‚¬í•œ ì¶œë ¥ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ _(ì¼ë¶€ ê°’ì€ í¸ì§‘ë¨)_:

```bash
dungeon-adventure-sandbox-Application
dungeon-adventure-sandbox-Application: deploying... [2/2]

 âœ…  dungeon-adventure-sandbox-Application

âœ¨  Deployment time: 354s

Outputs:
dungeon-adventure-sandbox-Application.ElectroDbTableTableNameXXX = dungeon-adventure-sandbox-Application-ElectroDbTableXXX-YYY
dungeon-adventure-sandbox-Application.GameApiEndpointXXX = https://xxx.execute-api.region.amazonaws.com/prod/
dungeon-adventure-sandbox-Application.GameUIDistributionDomainNameXXX = xxx.cloudfront.net
dungeon-adventure-sandbox-Application.StoryApiEndpointXXX = https://xxx.execute-api.region.amazonaws.com/prod/
dungeon-adventure-sandbox-Application.UserIdentityUserIdentityIdentityPoolIdXXX = region:xxx
dungeon-adventure-sandbox-Application.UserIdentityUserIdentityUserPoolIdXXX = region_xxx
```
### API í…ŒìŠ¤íŠ¸
ë‹¤ìŒ ë°©ë²•ìœ¼ë¡œ APIë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
<ul>
<li>tRPC ë°±ì—”ë“œ ë¡œì»¬ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹œì‘í•˜ê³  `curl`ë¡œ API í˜¸ì¶œ</li>
<li>
<Drawer title="Sigv4 í™œì„±í™”ëœ curl" trigger="ë°°í¬ëœ APIë¥¼ Sigv4 í™œì„±í™”ëœ curlë¡œ í˜¸ì¶œ">
<Snippet name="tools/acurl" />
</Drawer>
</li>
</ul>


<Tabs>
  <TabItem label="ë¡œì»¬">
    ë¡œì»¬ `game-api` ì„œë²„ë¥¼ ì‹œì‘í•˜ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤:

    <NxCommands highlights={['dungeon-adventure-infra-sandbox-Application-ElectroDbTableXXX-YYY']} env={{TABLE_NAME:"dungeon-adventure-infra-sandbox-Application-ElectroDbTableXXX-YYY"}} commands={["run @dungeon-adventure/game-api:serve"]} />

    <Aside type="caution">
    CDK ë°°í¬ ì¶œë ¥ ê°’ `dungeon-adventure-infra-sandbox-Application.ElectroDbTableTableNameXXX`ì„ ì‚¬ìš©í•˜ì—¬ í•˜ì´ë¼ì´íŠ¸ëœ í”Œë ˆì´ìŠ¤í™€ë”ë¥¼ ëŒ€ì²´í•˜ì„¸ìš”.
    </Aside>

    ì„œë²„ê°€ ì‹¤í–‰ë˜ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

    ```bash
    curl -X GET 'http://localhost:2022/games.query?input=%7B%7D'
    ```
  </TabItem>
  <TabItem label="ë°°í¬ëœ í™˜ê²½">
```bash "https://xxx.execute-api.ap-southeast-2.amazonaws.com/prod/" "ap-southeast-2"
acurl ap-southeast-2 execute-api -X GET 'https://xxx.execute-api.ap-southeast-2.amazonaws.com/prod/games.query?input=%7B%7D'
```
    <Aside type="caution">
    CDK ë°°í¬ ì¶œë ¥ ê°’ `dungeon-adventure-infra-sandbox-Application.GameApiGameApiEndpointXXX`ì„ ì‚¬ìš©í•˜ì—¬ í•˜ì´ë¼ì´íŠ¸ëœ í”Œë ˆì´ìŠ¤í™€ë”ë¥¼ ëŒ€ì²´í•˜ê³  ë¦¬ì „ì„ ì ì ˆíˆ ì„¤ì •í•˜ì„¸ìš”.
    </Aside>
  </TabItem>
</Tabs>

:::note
API í…ŒìŠ¤íŠ¸ ì‹œ ì „ë‹¬í•˜ëŠ” `%7B%7D`ëŠ” URI ì¸ì½”ë”©ëœ ë¹ˆ JSON ê°ì²´(`{}`)ì…ë‹ˆë‹¤.
:::

ëª…ë ¹ì–´ê°€ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì‘ë‹µì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```json
{"result":{"data":{"items":[],"cursor":null}}}
```

ì¶•í•˜í•©ë‹ˆë‹¤! tRPCë¥¼ ì‚¬ìš©í•˜ì—¬ ì²« ë²ˆì§¸ APIë¥¼ êµ¬ì¶•í•˜ê³  ë°°í¬í–ˆìŠµë‹ˆë‹¤! ğŸ‰ğŸ‰ğŸ‰