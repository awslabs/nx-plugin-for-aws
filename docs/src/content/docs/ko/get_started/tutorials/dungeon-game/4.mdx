---
title: "UI 구축"
description: "@aws/nx-plugin을 사용하여 에이전트형 AI 기반 던전 모험 게임을 구축하는 방법에 대한 안내"
---

import { Aside, Code, FileTree, Steps, Tabs, TabItem } from '@astrojs/starlight/components';
import { Image } from 'astro:assets';
import Drawer from '@components/drawer.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import InstallCommand from '@components/install-command.astro';
import E2ECode from '@components/e2e-code.astro';
import E2EDiff from '@components/e2e-diff.astro';

import dungeonAdventureArchitecturePng from '@assets/dungeon-game-architecture.png'
import dungeonAdventureErPng from '@assets/dungeon-adventure-er.png'
import baselineWebsitePng from '@assets/baseline-website.png'
import baselineGamePng from '@assets/baseline-game.png'
import nxGraphPng from '@assets/nx-graph.png'
import gameSelectPng from '@assets/game-select.png'
import gameConversationPng from '@assets/game-conversation.png'

## 작업 1: 로컬 개발 서버 구성

UI 구성을 시작하려면 로컬 개발 서버를 배포된 샌드박스로 연결해야 합니다. 다음 명령어를 실행하세요:

<NxCommands commands={["run @dungeon-adventure/game-ui:load:runtime-config"]} />

이 명령은 배포된 `runtime-config.json` 파일을 가져와 `packages/game-ui/public` 폴더에 로컬로 저장합니다.

개발 서버를 시작하려면 다음 명령어를 실행하세요:

<NxCommands commands={["run @dungeon-adventure/game-ui:serve"]} />

브라우저에서 로컬 웹사이트를 열면 로그인 프롬프트가 표시되고 새 사용자 생성 절차를 따라 진행할 수 있습니다. 완료되면 기본 웹사이트가 표시됩니다:

<Image src={baselineWebsitePng} alt="baseline-website.png" width="800" height="600" />

<Aside type="caution">
이 모듈의 나머지 부분을 진행하는 동안 개발 서버를 계속 실행 상태로 유지하는 것을 권장합니다. 변경 사항이 자동으로 핫 리로드됩니다.
</Aside>

:::tip
대신 Nx 명령을 실행하여 연결된 API 로컬 서버를 시작할 수 있으며, 이를 통해 tRPC API와 웹사이트를 동시에 반복 개발할 수 있습니다. <NxCommands commands={["run @dungeon-adventure/game-ui:serve-local"]} /> 
:::

## 작업 2: 새로운 '/game' 라우트 생성

타입 안전한 새 라우트를 생성하여 `@tanstack/react-router`의 기능을 활용해 보겠습니다.
이를 위해 다음 위치에 빈 파일을 생성하세요: `packages/game-ui/src/routes/game/index.tsx`. 파일이 즉시 업데이트되는 것을 확인할 수 있습니다.

`@tanstack/react-router`가 자동으로 새 라우트를 구성하며, 방금 생성한 파일에 이미 라우트 경로가 입력되어 있습니다:

```tsx
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/game/')({
  component: RouteComponent,
})

function RouteComponent() {
  return <div>Hello "/game/"!</div>
}
```

`http://localhost:4200/game`으로 이동하면 새 페이지가 렌더링된 것을 확인할 수 있습니다.

<Image src={baselineGamePng} alt="baseline-game.png" width="800" height="600" />

기본적으로 새 `/game` 라우트를 로드하도록 `index.tsx` 파일을 업데이트하세요. `to` 필드를 수정할 때 타입 안전한 라우트 목록에서 선택할 수 있습니다.

<Tabs>
<TabItem label="routes/index.tsx">
<E2EDiff before="dungeon-adventure/4/routes/index.tsx.old.template" after="dungeon-adventure/4/routes/index.tsx.template" lang="tsx" />
</TabItem>
</Tabs>

더 이상 필요하지 않으므로 `packages/game-ui/src/routes/welcome/` 폴더를 삭제할 수 있습니다.

## 작업 3: 레이아웃 업데이트

기본 구성된 레이아웃은 게임보다는 SaaS 스타일 비즈니스 애플리케이션에 더 가깝습니다.
레이아웃을 재구성하고 던전 스타일 게임에 더 어울리도록 테마를 변경하려면 `packages/game-ui/src`에서 다음 변경 사항을 적용하세요:

<Tabs>
<TabItem label="config.ts">
<E2EDiff before="dungeon-adventure/4/config.ts.old.template" after="dungeon-adventure/4/config.ts.template" lang="typescript" />
</TabItem>
<TabItem label="components/AppLayout/index.tsx">
<E2ECode path="dungeon-adventure/4/AppLayout/index.tsx.template" lang="tsx" />
</TabItem>
<TabItem label="styles.css">
<E2ECode path="dungeon-adventure/4/styles.css.template" lang="css" />
</TabItem>
</Tabs>

사용되지 않는 `packages/game-ui/src/hooks/useAppLayout.tsx` 파일을 삭제하세요.

## 작업 4: 스토리 에이전트 통합

스토리 에이전트와 상호작용할 클라이언트를 초기화하는 훅을 생성하겠습니다.

<Tabs>
<TabItem label="hooks/useStoryAgent.tsx">
<E2ECode path="dungeon-adventure/4/hooks/useStoryAgent.tsx.template" lang="tsx" />
</TabItem>
</Tabs>

이 훅은 다음 작업을 수행합니다:

- `runtime-config.json`에서 에이전트 ARN을 검색하고,
- ARN으로부터 AgentCore 런타임 호출 URL을 구성하며,
- 로그인한 사용자의 JWT 토큰과 임의 세션 ID로 에이전트를 호출하고,
- 스트리밍된 에이전트 메시지 청크를 소비하기 위한 비동기 이터레이터를 반환합니다.

:::tip
`api-connection` 제너레이터를 사용했기 때문에 Game API 통합이 이미 구성되어 있습니다. 에이전트에 대해서도 유사한 경험을 원하시면 [이 GitHub 이슈](https://github.com/awslabs/nx-plugin-for-aws/issues/326)에 +1을 남겨주세요.
:::

## 작업 5: 게임 페이지 생성

API를 호출하고 게임 구현을 완성할 게임 페이지를 생성하려면 `packages/game-ui/src/routes/game`에서 다음 파일들을 업데이트하세요:

<Tabs>
<TabItem label="index.tsx">
<E2ECode path="dungeon-adventure/4/routes/game/index.tsx.template" lang="tsx" />
</TabItem>
<TabItem label="$playerName.tsx">

<E2ECode path="dungeon-adventure/4/routes/game/$playerName.tsx.template" lang="tsx" />

<Aside type="tip">
`$playerName` 구문은 `@tanstack/react-router`에게 `playerName`을 [경로 파라미터](https://tanstack.com/router/v1/docs/framework/react/guide/path-params)로 처리하도록 지시합니다. 또한 `validateSearch` 메서드를 구현하여 `genre` 쿼리 파라미터가 장르 열거형에 강력하게 타입 지정되도록 합니다.
</Aside>
</TabItem>
</Tabs>

이러한 변경 사항을 적용하면 로컬 개발 서버(http://localhost:4200/)에서 게임을 플레이할 준비가 완료됩니다.

<Drawer title="빌드 및 배포" trigger="원하시면 코드를 빌드하여 Cloudfront에 배포할 수도 있습니다.">

## 작업 6: 빌드 및 배포

### 코드 빌드
코드를 빌드하려면 다음 명령어를 실행하세요:

<NxCommands commands={['run-many --target build --all']} />

### 애플리케이션 배포
애플리케이션을 배포하려면 다음 명령어를 실행하세요:

<NxCommands commands={['run @dungeon-adventure/infra:deploy dungeon-adventure-infra-sandbox/*']} />

배포가 완료되면 Cloudfront URL로 이동하세요. 이 URL을 찾으려면 CDK 배포 출력을 확인하세요.

</Drawer>

<Image src={gameSelectPng} alt="game-select.png" width="500" height="400" />
<div style="margin-top: -100px; margin-left: 100px;">
<Image src={gameConversationPng} alt="game-conversation.png" width="500" height="400" />
</div>

축하합니다. 에이전트 기반 던전 어드벤처 게임을 성공적으로 구축하고 배포하셨습니다! 🎉🎉🎉