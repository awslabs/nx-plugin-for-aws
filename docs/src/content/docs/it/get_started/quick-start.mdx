---
title: "Guida di Avvio Rapido"
description: "Un avvio rapido su come utilizzare @aws/nx-plugin."
---



import { Steps } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import Snippet from '@components/snippet.astro';
import CreateNxWorkspaceCommand from '@components/create-nx-workspace-command.astro';
import InstallCommand from '@components/install-command.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import Infrastructure from '@components/infrastructure.astro';

Questa guida ti accompagna attraverso le basi per installare e utilizzare `@aws/nx-plugin` per costruire rapidamente progetti su AWS.

:::tip
Per un tutorial pi√π approfondito sulla creazione di un'applicazione full-stack, consulta il <Link path="get_started/tutorials/dungeon-game/overview">Tutorial dell'Avventura nel Dungeon</Link>.
:::

## Prerequisiti

Le seguenti dipendenze globali sono necessarie prima di procedere:

<Snippet name="prerequisites" />

## Passaggio 1: Inizializzare una nuova workspace Nx

Esegui il seguente comando per creare una workspace Nx con il package manager preferito:

<CreateNxWorkspaceCommand workspace="my-project" />

:::tip
Ti verr√† chiesto di selezionare un provider per l'infrastruttura as code (IaC), [CDK](https://docs.aws.amazon.com/cdk/) o [Terraform](https://developer.hashicorp.com/terraform). Puoi saltare la selezione aggiungendo `--iacProvider` al comando, ad esempio:

<Infrastructure>
<Fragment slot="cdk">
<CreateNxWorkspaceCommand workspace="my-project" iacProvider="CDK" />
</Fragment>
<Fragment slot="terraform">
<CreateNxWorkspaceCommand workspace="my-project" iacProvider="Terraform" />
</Fragment>
</Infrastructure>
:::

Al termine, accedi alla directory del progetto:

```sh
cd my-project
```

## Passaggio 2: Utilizzare i generatori per impostare il progetto

In questa guida rapida aggiungeremo un'API tRPC, un sito React, autenticazione Cognito e infrastruttura CDK/Terraform. A seconda del tipo di progetto, puoi combinare diversi generatori per configurare rapidamente il tuo progetto. Consulta le __Guide__ nella barra di navigazione a sinistra per l'elenco completo delle opzioni.

### Aggiungere un'API tRPC

<RunGenerator generator="ts#trpc-api" requiredParameters={{ name: 'demo-api', auth: 'IAM' }} />

Questo creer√† l'API nella cartella `packages/demo-api`.

### Aggiungere un sito React

<RunGenerator generator="ts#react-website" requiredParameters={{ name: 'demo-website' }} />

Questo impalca un nuovo sito React in `packages/demo-website`.

### Aggiungere autenticazione Cognito

<RunGenerator generator="ts#react-website#auth" requiredParameters={{ project: '@my-project/demo-website', cognitoDomain: 'my-demo' }} />

Questo configura l'infrastruttura necessaria e il codice React per aggiungere l'autenticazione Cognito al tuo sito.

### Collegare frontend e backend

<RunGenerator generator="api-connection" requiredParameters={{ sourceProject: '@my-project/demo-website', targetProject: '@my-project/demo-api' }} />

Questo configura i provider necessari per permettere al sito di chiamare l'API tRPC.

### Aggiungere l'infrastruttura

Aggiungi il progetto infrastruttura in base al provider IaC scelto.

<Infrastructure>
<Fragment slot="cdk">
<RunGenerator generator="ts#infra" requiredParameters={{ name: 'infra' }} />

Questo configura un'app CDK che puoi utilizzare per distribuire la tua infrastruttura su AWS.
</Fragment>
<Fragment slot="terraform">
<RunGenerator generator="terraform#project" requiredParameters={{ name: 'infra' }} />

Questo configura un progetto Terraform che puoi utilizzare per distribuire la tua infrastruttura su AWS.
</Fragment>
</Infrastructure>

## Passaggio 3: Eseguire il sito e l'API in locale

Utilizza il seguente comando per avviare i server di sviluppo locali per il sito e le API collegate:

<NxCommands commands={['run demo-website:serve-local']} />

Il sito sar√† disponibile all'indirizzo `http://localhost:4200`.

Le modifiche al sito e all'API si rifletteranno in tempo reale grazie al hot-reload dei server locali.

## Passaggio 4: Definire le risorse cloud e distribuire su AWS

<Infrastructure>
<Fragment slot="cdk">
Apri `packages/infra/src/stacks/application-stack.ts` e aggiungi il seguente codice:

```typescript
import * as cdk from 'aws-cdk-lib';
import { DemoApi, DemoWebsite, UserIdentity } from ':my-project/common-constructs';
import { Construct } from 'constructs';

export class ApplicationStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    const identity = new UserIdentity(this, 'identity');
    const api = new DemoApi(this, 'api', {
      integrations: DemoApi.defaultIntegrations(this).build(),
    });
    api.grantInvokeAccess(identity.identityPool.authenticatedRole);

    new DemoWebsite(this, 'website');
  }
}
```

Questo √® tutto il codice CDK necessario per distribuire la nostra applicazione full-stack.
</Fragment>
<Fragment slot="terraform">
Apri `packages/infra/src/main.tf` e aggiungi il seguente codice:

```hcl
# Include metrics tracking for @aws/nx-plugin usage
module "metrics" {
  source = "../../common/terraform/src/metrics"
}

# Deploy user identity
module "user_identity" {
  source = "../../common/terraform/src/core/user-identity"
}

# Deploy API
module "demo_api" {
  source = "../../common/terraform/src/app/apis/demo-api"
}

# Grant authenticated users access to invoke the API
resource "aws_iam_policy" "api_invoke_policy" {
  name        = "DemoApiInvokePolicy"
  description = "Policy to allow authenticated users to invoke the API"

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Effect = "Allow"
        Action = "execute-api:Invoke"
        Resource = "${module.demo_api.api_execution_arn}/*/*"
      }
    ]
  })
}

resource "aws_iam_role_policy_attachment" "authenticated_api_access" {
  role       = module.user_identity.authenticated_role_name
  policy_arn = aws_iam_policy.api_invoke_policy.arn
}

# Deploy website
provider "aws" {
  alias  = "us_east_1"
  region = "us-east-1"
}

module "demo_website" {
  source = "../../common/terraform/src/app/static-websites/demo-website"

  providers = {
    aws.us_east_1 = aws.us_east_1
  }

  depends_on = [module.user_identity, module.demo_api]
}
```

Questo √® tutto il codice Terraform necessario per distribuire la nostra applicazione full-stack.
</Fragment>
</Infrastructure>

### Compilare e distribuire l'infrastruttura

Esegui il seguente comando per compilare il progetto:

<NxCommands commands={['run-many --target build --all']} />

:::tip
Se incontri errori di linting, puoi eseguire questo comando per correggerli automaticamente:

<NxCommands commands={['run-many --target lint --configuration=fix --all']} />
:::

Esegui il bootstrap dell'infrastruttura:

<Infrastructure>
<Fragment slot="cdk">
<NxCommands commands={['run infra:bootstrap']} />

:::tip
Il bootstrap CDK √® necessario sia per la regione AWS di destinazione che per `us-east-1` per consentire la distribuzione del WebACL AWS WAF per il sito.
:::
</Fragment>
<Fragment slot="terraform">
<NxCommands commands={['run infra:bootstrap']} />

:::tip
Il bootstrap Terraform crea un bucket S3 per memorizzare gli stati di Terraform. Questo va eseguito una sola volta per combinazione account/regione AWS.
:::
</Fragment>
</Infrastructure>

Distribuisci il progetto:

<Infrastructure>
<Fragment slot="cdk">
<NxCommands commands={['run infra:deploy my-project-sandbox/*']} />
</Fragment>
<Fragment slot="terraform">
<NxCommands commands={['run infra:apply']} />

:::tip
Questo comando eseguir√† prima `terraform plan` per mostrare le modifiche pianificate, poi le applicher√† per distribuire l'infrastruttura.
:::
</Fragment>
</Infrastructure>

## Passaggio 5: Testare il sito con le risorse cloud distribuite

<Steps>
1. Recupera il file `runtime-config.json`:

    <NxCommands commands={['run demo-website:load:runtime-config']} />

2. Avvia il server locale del sito

    <NxCommands commands={['run demo-website:serve']} />
</Steps>

Il sito sar√† disponibile all'indirizzo `http://localhost:4200` e punter√† alle risorse distribuite per l'API e l'autenticazione.

---

Complimenti! üéâ Hai distribuito con successo un'applicazione full-stack utilizzando `@aws/nx-plugin`!