---
title: "Costruisci l'UI"
description: "Una guida dettagliata su come costruire un gioco di avventura in dungeon alimentato da IA agentiva utilizzando @aws/nx-plugin."
---

import { Aside, Code, FileTree, Steps, Tabs, TabItem } from '@astrojs/starlight/components';
import { Image } from 'astro:assets';
import Drawer from '@components/drawer.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import InstallCommand from '@components/install-command.astro';
import E2ECode from '@components/e2e-code.astro';
import E2EDiff from '@components/e2e-diff.astro';

import dungeonAdventureArchitecturePng from '@assets/dungeon-game-architecture.png'
import dungeonAdventureErPng from '@assets/dungeon-adventure-er.png'
import baselineWebsitePng from '@assets/baseline-website.png'
import baselineGamePng from '@assets/baseline-game.png'
import nxGraphPng from '@assets/nx-graph.png'
import gameSelectPng from '@assets/game-select.png'
import gameConversationPng from '@assets/game-conversation.png'

## Task 1: Configurare il server di sviluppo locale

Per iniziare a costruire l'interfaccia utente, dobbiamo configurare il server di sviluppo locale per puntare alla sandbox distribuita. Esegui il seguente comando:

<NxCommands commands={["run @dungeon-adventure/game-ui:load:runtime-config"]} />

Questo comando scaricher√† il file `runtime-config.json` distribuito e lo memorizzer√† localmente nella cartella `packages/game-ui/public`.

Per avviare il server di sviluppo, esegui il seguente comando:

<NxCommands commands={["run @dungeon-adventure/game-ui:serve"]} />

Apri il sito locale nel browser, dove ti verr√† chiesto di effettuare l'accesso e seguire le istruzioni per creare un nuovo utente. Una volta completato, dovresti vedere il sito base:

<Image src={baselineWebsitePng} alt="baseline-website.png" width="800" height="600" />

<Aside type="caution">
Consigliamo di mantenere il server di sviluppo in esecuzione per tutto il resto di questo modulo, poich√© ricaricher√† automaticamente tutte le modifiche apportate.
</Aside>

:::tip
Puoi eseguire comandi Nx per avviare anche eventuali server API locali collegati, permettendoti di lavorare simultaneamente sulla tua API tRPC e sul sito web. <NxCommands commands={["run @dungeon-adventure/game-ui:serve-local"]} /> 
:::

## Task 2: Creare una nuova route '/game'

Mostriamo le capacit√† di `@tanstack/react-router` creando una nuova route type-safe. 
Per fare questo, crea un file vuoto in questa posizione: `packages/game-ui/src/routes/game/index.tsx`. Noterai che il file viene aggiornato immediatamente.

Il `@tanstack/react-router` configura automaticamente la tua nuova route e il file appena creato √® gi√† popolato con il percorso della route:

```tsx
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/game/')({
  component: RouteComponent,
})

function RouteComponent() {
  return <div>Hello "/game/"!</div>
}
```

Se navighi su `http://localhost:4200/game`, vedrai renderizzata la tua nuova pagina.

<Image src={baselineGamePng} alt="baseline-game.png" width="800" height="600" />

Aggiorna il file `index.tsx` per caricare la nuova route `/game` come predefinita. Quando aggiorni il campo `to`, hai a disposizione un elenco di route type-safe tra cui scegliere.

<Tabs>
<TabItem label="routes/index.tsx">
<E2EDiff before="dungeon-adventure/4/routes/index.tsx.old.template" after="dungeon-adventure/4/routes/index.tsx.template" lang="tsx" />
</TabItem>
</Tabs>

Puoi eliminare la cartella `packages/game-ui/src/routes/welcome/` poich√© non √® pi√π necessaria.

## Task 3: Aggiornare il layout

Il layout predefinito configurato √® pi√π simile a un'applicazione aziendale in stile SaaS che a un gioco. 
Per riconfigurare il layout e applicare un tema pi√π consono a un gioco in stile dungeon, apporta le seguenti modifiche a `packages/game-ui/src`:

<Tabs>
<TabItem label="config.ts">
<E2EDiff before="dungeon-adventure/4/config.ts.old.template" after="dungeon-adventure/4/config.ts.template" lang="typescript" />
</TabItem>
<TabItem label="components/AppLayout/index.tsx">
<E2ECode path="dungeon-adventure/4/AppLayout/index.tsx.template" lang="tsx" />
</TabItem>
<TabItem label="styles.css">
<E2ECode path="dungeon-adventure/4/styles.css.template" lang="css" />
</TabItem>
</Tabs>

Elimina il file `packages/game-ui/src/hooks/useAppLayout.tsx` poich√© non viene utilizzato.

## Task 4: Integrare lo Story Agent

Creiamo un hook per inizializzare un client per interagire con il nostro Story Agent.

<Tabs>
<TabItem label="hooks/useStoryAgent.tsx">
<E2ECode path="dungeon-adventure/4/hooks/useStoryAgent.tsx.template" lang="tsx" />
</TabItem>
</Tabs>

Questo hook:

- Recupera l'ARN dell'Agent da `runtime-config.json`,
- Costruisce l'URL di invocazione di AgentCore Runtime dall'ARN,
- Invoca l'Agent con il token JWT dell'utente autenticato e un ID sessione casuale, e
- Restituisce un iteratore asincrono per consumare i chunk di messaggi streamati dall'agente.

:::tip
L'integrazione con la nostra Game API √® gi√† configurata, grazie al generatore `api-connection`. Se desideri un'esperienza simile per gli agenti, vota [questa issue su GitHub](https://github.com/awslabs/nx-plugin-for-aws/issues/326).
:::

## Task 5: Creare le pagine del gioco

Per creare le pagine del gioco che chiameranno le nostre API e completeranno l'implementazione del gioco, aggiorna i seguenti file in `packages/game-ui/src/routes/game`:

<Tabs>
<TabItem label="index.tsx">
<E2ECode path="dungeon-adventure/4/routes/game/index.tsx.template" lang="tsx" />
</TabItem>
<TabItem label="$playerName.tsx">

<E2ECode path="dungeon-adventure/4/routes/game/$playerName.tsx.template" lang="tsx" />

<Aside type="tip">
La sintassi `$playerName` indica a `@tanstack/react-router` di trattare `playerName` come un [parametro di percorso](https://tanstack.com/router/v1/docs/framework/react/guide/path-params). Inoltre, implementiamo il metodo `validateSearch` che assicura che il parametro di query `genre` sia tipizzato correttamente secondo il nostro enum dei generi.
</Aside>
</TabItem>
</Tabs>

Dopo aver apportato queste modifiche, il server di sviluppo locale (http://localhost:4200/) dovrebbe ora avere il gioco pronto per essere giocato.

<Drawer title="Costruisci e Distribuisci" trigger="Puoi anche compilare e distribuire il codice su Cloudfront se preferisci.">

## Task 6: Compilare e distribuire

### Compila il codice
Per compilare il codice, esegui il seguente comando:

<NxCommands commands={['run-many --target build --all']} />

### Distribuisci l'applicazione
Per distribuire l'applicazione, esegui il seguente comando:

<NxCommands commands={['run @dungeon-adventure/infra:deploy dungeon-adventure-infra-sandbox/*']} />

Una volta distribuito, naviga verso l'URL di Cloudfront. Per trovare questo URL, ispeziona gli output del deploy CDK.

</Drawer>

<Image src={gameSelectPng} alt="game-select.png" width="500" height="400" />
<div style="margin-top: -100px; margin-left: 100px;">
<Image src={gameConversationPng} alt="game-conversation.png" width="500" height="400" />
</div>

Complimenti. Hai costruito e distribuito il tuo Gioco di Avventura Agentico nel Dungeon!  üéâüéâüéâ