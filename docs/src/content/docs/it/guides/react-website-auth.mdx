---
title: "Autenticazione del Sito Web React"
description: "Documentazione di riferimento per l'Autenticazione del Sito Web React"
---



import { FileTree } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import RunGenerator from '@components/run-generator.astro';
import GeneratorParameters from '@components/generator-parameters.astro';
import NxCommands from '@components/nx-commands.astro';
import Infrastructure from '@components/infrastructure.astro';
import Snippet from '@components/snippet.astro';

Il generatore di autenticazione per React Website aggiunge l'autenticazione al tuo sito React utilizzando [Amazon Cognito](https://aws.amazon.com/cognito/).

Questo generatore configura l'infrastruttura CDK o Terraform per creare un Cognito User Pool e un Identity Pool associato, oltre a un'interfaccia utente ospitata per gestire i flussi di login degli utenti e la sua integrazione con il tuo sito React.

## Utilizzo

### Aggiungere l'autenticazione al tuo sito React

Puoi aggiungere l'autenticazione al tuo sito React in due modi:

<RunGenerator generator="ts#react-website#auth" />

### Opzioni

<GeneratorParameters generator="ts#react-website#auth" />

## Output del Generatore

Troverai le seguenti modifiche nel tuo sito React:

<FileTree>
  - src
    - components
      - CognitoAuth
        - index.tsx Componente principale per l'autenticazione
    - main.tsx Aggiornato per integrare il componente CognitoAuth
</FileTree>

### Infrastruttura

<Snippet name="shared-constructs" />

Troverai anche il seguente codice infrastrutturale generato in base al `iacProvider` selezionato:

<Infrastructure>
<Fragment slot="cdk">
<FileTree>
  - packages/common/constructs/src
    - core
      - user-identity.ts Construct che definisce il user pool e identity pool
</FileTree>
</Fragment>
<Fragment slot="terraform">
<FileTree>
  - packages/common/terraform/src
    - core
      - user-identity
        - main.tf Modulo wrapper per la configurazione dell'identità
        - identity
          - identity.tf Infrastruttura principale dell'identità inclusi Cognito User Pool e Identity Pool
        - add-callback-url
          - add-callback-url.tf Modulo per aggiungere URL di callback ai client esistenti del user pool
</FileTree>
</Fragment>
</Infrastructure>

## Utilizzo dell'Infrastruttura

<Infrastructure>
<Fragment slot="cdk">
Dovrai aggiungere l'infrastruttura per l'identità utente al tuo stack, dichiarandola _prima_ del sito web:

```ts title="packages/infra/src/stacks/application-stack.ts" {3,9}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite, UserIdentity } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    new UserIdentity(this, 'Identity');

    new MyWebsite(this, 'MyWebsite');
  }
}
```

Il construct `UserIdentity` aggiunge automaticamente la necessaria <Link path="guides/react-website#runtime-configuration">Configurazione Runtime</Link> per garantire che il tuo sito possa puntare al corretto Cognito User Pool per l'autenticazione.
</Fragment>
<Fragment slot="terraform">
Dovrai aggiungere il modulo per l'identità utente e assicurarti che il tuo sito web dipenda da esso:

```hcl title="packages/infra/src/main.tf" {2-4,14-15}
# Distribuisci prima l'identità utente per aggiungerla alla configurazione runtime
module "user_identity" {
  source = "../../common/terraform/src/core/user-identity"
}

# Distribuisci il sito web dopo l'identità per includere la configurazione runtime
module "my_website" {
  source = "../../common/terraform/src/app/static-websites/my-website"

  providers = {
    aws.us_east_1 = aws.us_east_1
  }

  # Assicura che l'identità sia distribuita prima
  depends_on = [module.user_identity]
}
```

Il modulo per l'identità utente aggiunge automaticamente la necessaria <Link path="guides/react-website#runtime-configuration">Configurazione Runtime</Link> per garantire che il tuo sito possa puntare al corretto Cognito User Pool per l'autenticazione.
</Fragment>
</Infrastructure>

### Concessione Accesso agli Utenti Autenticati

Per concedere agli utenti autenticati l'accesso a determinate azioni, come concedere permessi per invocare un'API, puoi aggiungere dichiarazioni di policy IAM al ruolo autenticato del pool di identità:

<Infrastructure>
<Fragment slot="cdk">
```ts title="packages/infra/src/stacks/application-stack.ts" {12}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite, UserIdentity, MyApi } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    const identity = new UserIdentity(this, 'Identity');
    const api = new MyApi(this, 'MyApi');

    api.grantInvokeAccess(identity.identityPool.authenticatedRole);

    new MyWebsite(this, 'MyWebsite');
  }
}
```
</Fragment>
<Fragment slot="terraform">
```hcl title="packages/infra/src/main.tf" {12,22}
module "user_identity" {
  source = "../../common/terraform/src/core/user-identity"
}

module "my_api" {
  source = "../../common/terraform/src/app/apis/my-api"
}

# Aggiungi permessi per gli utenti autenticati di invocare Fast API
resource "aws_iam_role_policy" "authenticated_fast_api_invoke" {
  name = "authenticated-user-invoke-my-api"
  role = module.user_identity.authenticated_role_name

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Effect = "Allow"
        Action = [
          "execute-api:Invoke"
        ]
        Resource = "${module.my_api.api_execution_arn}/*"
      }
    ]
  })
}
```
</Fragment>
</Infrastructure>