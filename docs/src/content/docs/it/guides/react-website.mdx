---
title: "Sito Web React"
description: "Documentazione di riferimento per un sito web React"
---

import { FileTree, Steps } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import RunGenerator from '@components/run-generator.astro';
import GeneratorParameters from '@components/generator-parameters.astro';
import NxCommands from '@components/nx-commands.astro';
import Infrastructure from '@components/infrastructure.astro';
import Snippet from '@components/snippet.astro';

Questo generatore crea un nuovo sito web [React](https://react.dev/) con [Cloudscape](http://cloudscape.design/) configurato di default, insieme all'infrastruttura AWS CDK o Terraform per distribuire il tuo sito web sul cloud come sito statico ospitato in [S3](https://aws.amazon.com/s3/), servito da [CloudFront](https://aws.amazon.com/cloudfront/) e protetto da [WAF](https://aws.amazon.com/waf/).

L'applicazione generata utilizza [Vite](https://vite.dev/) come strumento di build e bundler. Utilizza [TanStack Router](https://tanstack.com/router/v1) per il routing type-safe.

:::note
Questo generatore configura [Cloudscape](http://cloudscape.design/) di default, ma puoi selezionare `None` come `uxProvider` se preferisci utilizzare una libreria di componenti o un sistema di design diverso.
:::

## Utilizzo

### Generare un Sito Web React

Puoi generare un nuovo Sito Web React in due modi:

<RunGenerator generator="ts#react-website" />

### Opzioni

<GeneratorParameters generator="ts#react-website" />

## Output del Generatore

Il generatore creerà la seguente struttura del progetto nella directory `<directory>/<nome>`:

<FileTree>
  - index.html Punto di ingresso HTML
  - public Asset statici
  - src
    - main.tsx Punto di ingresso dell'applicazione con configurazione React
    - config.ts Configurazione dell'applicazione (es. logo)
    - components
      - AppLayout Componenti per il layout generale e la barra di navigazione
    - hooks
      - useAppLayout.tsx Hook per regolare il Cloudscape AppLayout da componenti annidati (se UX Provider è impostato su Cloudscape)
    - routes
      - index.tsx Route di esempio (o pagina) per TanStack Router
    - styles.css Stili globali
  - vite.config.ts Configurazione Vite e Vitest
  - tsconfig.json Configurazione TypeScript base per sorgenti e test
  - tsconfig.app.json Configurazione TypeScript per il codice sorgente
  - tsconfig.spec.json Configurazione TypeScript per i test
</FileTree>

:::note
Se hai scelto di non utilizzare [TanStack Router](https://tanstack.com/router/v1), riceverai un semplice file `src/app.tsx` come punto di ingresso dell'applicazione invece della directory `routes`.
:::

### Infrastruttura

<Snippet name="shared-constructs" />

Il generatore crea infrastruttura as code per distribuire il tuo sito web in base al `iacProvider` selezionato:

<Infrastructure>
<Fragment slot="cdk">
<FileTree>
  - packages/common/constructs/src
    - app
      - static-websites
        - \<nome>.ts Infrastruttura specifica per il tuo sito web
    - core
      - static-website.ts Construct generico StaticWebsite
</FileTree>
</Fragment>
<Fragment slot="terraform">
<FileTree>
  - packages/common/terraform/src
    - app
      - static-websites
        - \<nome>
          - \<nome>.tf Modulo specifico per il tuo sito web
    - core
      - static-website
        - static-website.tf Modulo generico per sito statico
</FileTree>
</Fragment>
</Infrastructure>

## Implementazione del Sito Web React

La [documentazione React](https://react.dev/learn) è un buon punto di partenza per apprendere le basi dello sviluppo con React. Puoi consultare la [documentazione Cloudscape](https://cloudscape.design/components/) per dettagli sui componenti disponibili e il loro utilizzo.

### Route

#### Creazione di una Route/Pagina

Il tuo sito Cloudscape include [TanStack Router](https://tanstack.com/router/v1) configurato di default. Questo semplifica l'aggiunta di nuove route:

<Steps>
  1. [Avvia il Server di Sviluppo Locale](#local-development-server)
  2. Crea un nuovo file `<nome-pagina>.tsx` in `src/routes`, con la posizione nell'albero dei file che rappresenta il percorso
  3. Noterai che un `Route` e `RouteComponent` vengono generati automaticamente. Puoi iniziare a costruire la tua pagina qui!
</Steps>

#### Navigazione tra Pagine

Puoi usare il componente `Link` o l'hook `useNavigate` per navigare tra le pagine:

```tsx {1, 4, 8-9, 14}
import { Link, useNavigate } from '@tanstack/react-router';

export const MyComponent = () => {
  const navigate = useNavigate();

  const submit = async () => {
    const id = await ...
    // Usa `navigate` per reindirizzare dopo un'azione asincrona
    navigate({ to: '/products/$id', { params: { id }} });
  };

  return (
    <>
      <Link to="/products">Annulla</Link>
      <Button onClick={submit}>Invia</Button>
    </>
  )
};
```

Per maggiori dettagli, consulta la [documentazione TanStack Router](https://tanstack.com/router/latest/docs/framework/react/overview).

## Configurazione Runtime

La configurazione dalla tua infrastruttura viene fornita al sito web tramite Configurazione Runtime. Questo permette al sito di accedere a dettagli come URL di API non noti fino al deployment dell'applicazione.

### Infrastruttura

<Infrastructure>
<Fragment slot="cdk">
Il construct `RuntimeConfig` CDK può essere usato per aggiungere e recuperare configurazioni nella tua infrastruttura CDK. I construct CDK generati dai generatori `@aws/nx-plugin` (come <Link path="guides/trpc">`ts#trpc-api`</Link> e <Link path="guides/fastapi">`py#fast-api`</Link>) aggiungeranno automaticamente i valori appropriati a `RuntimeConfig`.

Il construct CDK del tuo sito web distribuirà la configurazione runtime come file `runtime-config.json` nella root del bucket S3.

```ts title="packages/infra/src/stacks/application-stack.ts" {9-12,14-15}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    // Aggiunge automaticamente valori a RuntimeConfig
    new MyApi(this, 'MyApi', {
      integrations: MyApi.defaultIntegrations(this).build(),
    });

    // Distribuisce automaticamente la config runtime in runtime-config.json
    new MyWebsite(this, 'MyWebsite');
  }
}
```

:::caution
Devi assicurarti di dichiarare il tuo sito web _dopo_ qualsiasi construct che aggiunge a `RuntimeConfig`, altrimenti mancheranno nel file `runtime-config.json`.
:::
</Fragment>
<Fragment slot="terraform">
Con Terraform, la configurazione runtime è gestita tramite moduli runtime-config. I moduli Terraform generati da generatori `@aws/nx-plugin` (come <Link path="guides/trpc">`ts#trpc-api`</Link> e <Link path="guides/fastapi">`py#fast-api`</Link>) aggiungeranno automaticamente valori appropriati alla configurazione runtime.

Il modulo Terraform del tuo sito web distribuirà la configurazione runtime come file `runtime-config.json` nella root del bucket S3.

```hcl title="packages/infra/src/main.tf" {14-15}
# Aggiunge automaticamente valori alla config runtime
module "my_api" {
  source = "../../common/terraform/src/app/apis/my-api"
}

# Distribuisce automaticamente la config runtime in runtime-config.json
module "my_website" {
  source = "../../common/terraform/src/app/static-websites/my-website"

  providers = {
    aws.us_east_1 = aws.us_east_1
  }

  # Garantisce che l'API sia distribuita prima per aggiungere alla config runtime
  depends_on = [module.my_api]
}
```

:::caution
Devi assicurarti di dichiarare il modulo del sito web _dopo_ qualsiasi modulo che aggiunge alla configurazione runtime e configurare gli appropriati `depends_on` per garantire l'ordine, altrimenti mancheranno nel file `runtime-config.json`.
:::
</Fragment>
</Infrastructure>

### Codice del Sito Web

Nel tuo sito web, puoi usare l'hook `useRuntimeConfig` per recuperare valori dalla configurazione runtime:

```tsx {1,4}
import { useRuntimeConfig } from '../hooks/useRuntimeConfig';

const MyComponent = () => {
  const runtimeConfig = useRuntimeConfig();

  // Accedi ai valori della config runtime qui
  const apiUrl = runtimeConfig.apis.MyApi;
};
```

### Configurazione Runtime Locale

Quando esegui il [server di sviluppo locale](#local-development-server), avrai bisogno di un file `runtime-config.json` nella tua directory `public` per far conoscere al sito locale gli URL dei backend, configurazione identity, ecc.

Il tuo progetto website è configurato con un target `load:runtime-config` che puoi usare per scaricare il file `runtime-config.json` da un'applicazione distribuita:

<NxCommands commands={['run <my-website>:"load:runtime-config"']} />

:::note
<Infrastructure>
<Fragment slot="cdk">
Se cambi il prefisso per i nomi degli stage in `src/main.ts` del tuo progetto infrastruttura, dovrai aggiornare il target `load:runtime-config` nel file `project.json` del tuo sito web di conseguenza.

Inoltre, nota che il target `load:runtime-config` assume che un singolo stage della tua applicazione sia distribuito nell'ambiente per cui hai le credenziali AWS. Dovrai modificare il comando se distribuisci più stage nello stesso account e regione.
</Fragment>
<Fragment slot="terraform">
Per progetti Terraform, il target `load:runtime-config` copia il file `runtime-config.json` creato dopo il più recente `terraform apply` locale.
</Fragment>
</Infrastructure>
:::

## Server di Sviluppo Locale

Puoi eseguire un server di sviluppo locale usando i target `serve` o `serve-local`.

### Target Serve

Il target `serve` avvia un server di sviluppo locale per il tuo sito web. Questo target richiede che tu abbia distribuito qualsiasi infrastruttura di supporto con cui il sito interagisce, e aver [caricato la configurazione runtime locale](#local-runtime-config).

Puoi eseguire questo target con il seguente comando:

<NxCommands commands={['run <my-website>:serve']} />

Questo target è utile per lavorare a modifiche del sito puntando ad API "reali" distribuite e altra infrastruttura.

### Target Serve Local

Il target `serve-local` avvia un server di sviluppo locale per il tuo sito web (con [Vite `MODE`](https://vite.dev/guide/env-and-mode) impostato a `serve-local`), avviando anche server locali per API che hai connesso al sito tramite il generatore <Link path="/guides/connection">Connection</Link>.

Quando il server locale del sito è eseguito tramite questo target, `runtime-config.json` viene automaticamente sovrascritto per puntare agli URL delle API in esecuzione localmente.

Puoi eseguire questo target con il seguente comando:

<NxCommands commands={['run <my-website>:serve-local']} />

Questo target è utile quando lavori sia sul sito che sulle API e vuoi iterare rapidamente senza distribuire l'infrastruttura.

:::warning
In questa modalità, se non è presente `runtime-config.json` e hai configurato l'autenticazione Cognito (tramite il generatore <Link path="/guides/react-website-auth">`ts#react-website#auth`</Link>), il login sarà saltato e le richieste ai server locali non includeranno header di autenticazione.

Per abilitare login e autenticazione in `serve-local`, distribuisci l'infrastruttura e carica la config runtime.
:::

:::tip
Quando esegui con `serve-local`, puoi specificare qualsiasi variabile d'ambiente richiesta dalle tue API per puntare ad altre risorse AWS distribuite, per esempio:

<NxCommands env={{DYNAMODB_TABLE_NAME: 'xxxxx'}} commands={['run <my-website>:serve-local']} />

Nota che i server API locali verranno eseguiti con le credenziali AWS che hai configurato localmente.
:::

## Build

Puoi compilare il sito web con il target `build`. Questo usa Vite per creare un bundle di produzione nella directory root `dist/packages/<my-website>/bundle`, oltre a type-checking, compilazione e linting del sito.

<NxCommands commands={['run <my-website>:build']} />

## Testing

Testare il sito web è simile a scrivere test in un progetto TypeScript standard, quindi consulta la guida <Link path="guides/typescript-project#testing">TypeScript project</Link> per maggiori dettagli.

Per test specifici React, React Testing Library è già installato e disponibile per scrivere test. Per dettagli sul suo utilizzo, consulta la [documentazione React Testing Library](https://testing-library.com/docs/react-testing-library/example-intro).

Puoi eseguire i test con il target `test`:

<NxCommands commands={['run <my-website>:test']} />

## Distribuzione del Sito Web

Il generatore React website crea infrastruttura as code CDK o Terraform in base al `iacProvider` selezionato. Puoi usarla per distribuire il sito.

<Infrastructure>
<Fragment slot="cdk">
Per distribuire il sito, raccomandiamo di usare il generatore <Link path="guides/typescript-infrastructure">`ts#infra`</Link> per creare un'applicazione CDK.

Puoi usare il construct CDK generato in `packages/common/constructs` per distribuire il sito.

```ts title="packages/infra/src/stacks/application-stack.ts" {3, 9}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    new MyWebsite(this, 'MyWebsite');
  }
}
```

Questo configura:

1. Un bucket S3 per l'hosting dei file statici del sito web
2. Distribuzione CloudFront per la delivery globale dei contenuti
3. Web ACL WAF per la protezione di sicurezza
4. Origin Access Control per l'accesso sicuro a S3
5. Deployment automatico dei file del sito web e della configurazione runtime
</Fragment>
<Fragment slot="terraform">
Per distribuire il sito, raccomandiamo di usare il generatore <Link path="guides/terraform-infrastructure">`terraform#project`</Link> per creare un progetto Terraform.

Puoi usare il modulo Terraform generato in `packages/common/terraform` per distribuire il sito.

```hcl title="packages/infra/src/main.tf" {3}
# Distribuisci il sito web
module "my_website" {
  source = "../../common/terraform/src/app/static-websites/my-website"

  providers = {
    aws.us_east_1 = aws.us_east_1
  }
}
```

Questo configura:

1. Un bucket S3 per l'hosting dei file statici del sito web
2. Distribuzione CloudFront per la delivery globale dei contenuti
3. Web ACL WAF per la protezione di sicurezza (distribuito in us-east-1)
4. Origin Access Control per l'accesso sicuro a S3
5. Deployment automatico dei file del sito web e della configurazione runtime

:::note
Il provider `aws.us_east_1` è necessario per risorse CloudFront e WAF, che devono essere distribuite nella regione us-east-1. Assicurati che la configurazione Terraform includa questo provider:

```hcl title="packages/infra/src/providers.tf"
provider "aws" {
  alias  = "us_east_1"
  region = "us-east-1"
}
```
:::
</Fragment>
</Infrastructure>