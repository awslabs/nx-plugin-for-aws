---
title: "Agente Python Strands"
description: "Genera un Agente Python Strands per costruire agenti AI con strumenti e distribuirli su Amazon Bedrock AgentCore Runtime"
---



import { FileTree } from '@astrojs/starlight/components';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import Link from '@components/link.astro';
import Snippet from '@components/snippet.astro';
import Infrastructure from '@components/infrastructure.astro';
import GeneratorParameters from '@components/generator-parameters.astro';

Genera un [Agente Strands](https://strandsagents.com/) in Python per costruire agenti AI con strumenti, e opzionalmente distribuirlo su [Amazon Bedrock AgentCore Runtime](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/).

## Cos'è Strands?

[Strands](https://strandsagents.com/latest/documentation/docs/) è un framework Python leggero e pronto per la produzione per costruire agenti AI. Caratteristiche principali:

- **Leggerezza e personalizzazione**: Ciclo operativo semplice che non ostacola il lavoro
- **Pronto per la produzione**: Osservabilità completa, tracciamento e opzioni di distribuzione scalabili  
- **Indipendente da modelli e provider**: Supporta molti modelli diversi da vari provider
- **Strumenti community**: Set potente di strumenti contribuiti dalla community
- **Supporto multi-agente**: Tecniche avanzate come team di agenti e agenti autonomi
- **Modalità interazione flessibili**: Supporto conversazionale, streaming e non-streaming

## Utilizzo

### Generare un Agente Strands

Puoi generare un Agente Strands in Python in due modi:

<RunGenerator generator="py#strands-agent" />

:::tip
Prima utilizza il generatore <Link path="/guides/python-project">`py#project`</Link> per creare un progetto a cui aggiungere il tuo Agente Strands.
:::

### Opzioni

<GeneratorParameters generator="py#strands-agent" />

## Output del Generatore

Il generatore aggiungerà questi file al tuo progetto Python esistente:

<FileTree>
  - your-project/
    - your_module/
      - agent/ (o nome personalizzato se specificato)
        - \_\_init\_\_.py Inizializzazione pacchetto Python
        - agent.py Definizione principale dell'agente con strumenti di esempio  
        - main.py Punto d'ingresso per Bedrock AgentCore Runtime
        - agentcore_mcp_client.py Factory client utile per invocare server MCP su Bedrock AgentCore
        - Dockerfile Punto d'ingresso per hostare l'agente (escluso se `computeType` è `None`)
    - pyproject.toml Aggiornato con dipendenze Strands
    - project.json Aggiornato con target di servizio dell'agente
</FileTree>

:::note
A meno che non sia selezionato `None` per `computeType`, il generatore creerà anche l'infrastruttura CDK/Terraform per distribuire l'agente.
:::

## Lavorare con il tuo Agente Strands

### Aggiungere Strumenti

Gli strumenti sono funzioni che l'agente AI può chiamare per eseguire azioni. Strands utilizza un approccio basato su decoratori per definirli.

Puoi aggiungere nuovi strumenti nel file [`agent.py`](packages/nx-plugin/src/py/strands-agent/files/agent.py.template:6):

```python
from strands import Agent, tool

@tool
def calculate_sum(numbers: list[int]) -> int:
    """Calcola la somma di una lista di numeri"""
    return sum(numbers)

@tool
def get_weather(city: str) -> str:
    """Ottieni informazioni meteo per una città"""
    # Integrazione con API meteo qui
    return f"Meteo a {city}: Soleggiato, 25°C"

# Aggiungi strumenti all'agente
agent = Agent(
    system_prompt="Sei un assistente utile con accesso a vari strumenti.",
    tools=[calculate_sum, get_weather],
)
```

Il framework Strands gestisce automaticamente:
- Validazione dei tipi basata sulle annotazioni
- Generazione schema JSON per le chiamate
- Gestione errori e formattazione risposte

### Usare Strumenti Predefiniti

Strands offre strumenti pre-costruiti tramite il pacchetto `strands-tools`:

```python
from strands_tools import current_time, http_request, file_read

agent = Agent(
    system_prompt="Sei un assistente utile.",
    tools=[current_time, http_request, file_read],
)
```

### Configurazione Modelli

Di default gli agenti usano Claude 4 Sonnet, ma puoi personalizzare il provider. Vedi la [documentazione Strands sui provider](https://strandsagents.com/latest/documentation/docs/user-guide/quickstart/#model-providers):

```python
from strands import Agent
from strands.models import BedrockModel

# Crea un BedrockModel
bedrock_model = BedrockModel(
    model_id="anthropic.claude-sonnet-4-20250514-v1:0",
    region_name="us-west-2",
    temperature=0.3,
)

agent = Agent(model=bedrock_model)
```

### Utilizzare Server MCP

Puoi [aggiungere strumenti da server MCP](https://strandsagents.com/latest/documentation/docs/user-guide/concepts/tools/mcp-tools/) al tuo agente.

Per server MCP creati con i generatori <Link path="/guides/py-mcp-server">`py#mcp-server`</Link> o <Link path="/guides/ts-mcp-server">`ts#mcp-server`</Link> (o altri hostati su Bedrock AgentCore), viene generata una factory client in `agentcore_mcp_client.py`.

Puoi aggiornare il metodo `get_agent` in `agent.py` per creare client MCP e aggiungere strumenti. Ecco un esempio con autenticazione IAM (SigV4):

```python
# agent.py
import os
from contextlib import contextmanager

import boto3
from strands import Agent

from .agentcore_mcp_client import AgentCoreMCPClient

# Ottieni regione e credenziali
region = os.environ["AWS_REGION"]
boto_session = boto3.Session(region_name=region)
credentials = boto_session.get_credentials()

@contextmanager
def get_agent(session_id: str):
    mcp_client = AgentCoreMCPClient.with_iam_auth(
        agent_runtime_arn=os.environ["MCP_AGENTCORE_RUNTIME_ARN"],
        credentials=credentials,
        region=region,
        session_id=session_id,
    )

    with mcp_client:
        mcp_tools = mcp_client.list_tools_sync()

        yield Agent(
            system_prompt="..."
            tools=[*mcp_tools],
        )
```

:::tip
Per server MCP con autenticazione JWT, usa invece `AgentCoreMCPClient.with_jwt_auth`.
:::

Nell'esempio IAM sopra, dobbiamo configurare due elementi: 
1. Aggiungere la variabile d'ambiente per l'ARN del runtime MCP
2. Concedere i permessi d'invocazione al server MCP:

<Infrastructure>
<Fragment slot="cdk">
```ts {9, 13}
import { MyProjectAgent, MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    const mcpServer = new MyProjectMcpServer(this, 'MyProjectMcpServer');

    const agent = new MyProjectAgent(this, 'MyProjectAgent', {
      environment: {
        MCP_AGENTCORE_RUNTIME_ARN: mcpServer.agentCoreRuntime.arn,
      },
    });

    mcpServer.agentCoreRuntime.grantInvoke(agent.agentCoreRuntime);
  }
}
```
</Fragment>
<Fragment slot="terraform">
```terraform
# Server MCP
module "my_project_mcp_server" {
  source = "../../common/terraform/src/app/mcp-servers/my-project-mcp-server"
}

# Agente
module "my_project_agent" {
  source = "../../common/terraform/src/app/agents/my-project-agent"

  env = {
    MCP_AGENTCORE_RUNTIME_ARN = module.my_project_mcp_server.agent_core_runtime_arn
  }

  additional_iam_policy_statements = [
    {
      Effect = "Allow"
      Action = [
        "bedrock-agentcore:InvokeAgentRuntime"
      ]
      Resource = [
        module.my_project_mcp_server.agent_core_runtime_arn,
        "${module.my_project_mcp_server.agent_core_runtime_arn}/*"
      ]
    }
  ]
}
```
</Fragment>
</Infrastructure>

### Approfondimenti

Per una guida dettagliata, consulta la [documentazione Strands](https://strandsagents.com/latest/documentation/docs/).

## Bedrock AgentCore Python SDK

Il generatore configura l'[SDK Python Bedrock AgentCore](https://github.com/aws/bedrock-agentcore-sdk-python) per gestire il protocollo HTTP richiesto.

Maggiori dettagli sulle capacità dell'SDK nella [documentazione](https://aws.github.io/bedrock-agentcore-starter-toolkit/user-guide/runtime/quickstart.html).

:::note
Essendo il generatore responsabile dell'infrastruttura CDK/Terraform, non è necessario utilizzare `bedrock-agentcore-starter-toolkit` per la distribuzione.
:::

## Eseguire l'Agente Strands

### Sviluppo Locale

Il generatore configura un target `<your-agent-name>-serve` per avviare l'agente localmente:

<NxCommands commands={['run your-project:agent-serve']} />

Il comando usa `uv run` per eseguire l'agente tramite l'[SDK Python Bedrock AgentCore](https://github.com/aws/bedrock-agentcore-sdk-python).

## Distribuire l'Agente su Bedrock AgentCore Runtime

### Infrastruttura come Codice

Se hai selezionato `BedrockAgentCoreRuntime` per `computeType`, viene generata l'infrastruttura CDK/Terraform per distribuire l'agente su [Amazon Bedrock AgentCore Runtime](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/agents-tools-runtime.html).

<Infrastructure>
<Fragment slot="cdk">
Un costrutto CDK viene generato con nome basato sul parametro `name`, o `<ProjectName>Agent` di default:

```ts {6}
import { MyProjectAgent } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    // Aggiungi l'agente allo stack
    const agent = new MyProjectAgent(this, 'MyProjectAgent');

    // Concedi permessi per invocare i modelli Bedrock
    agent.agentCoreRuntime.role.addToPolicy(
      new PolicyStatement({
        actions: [
          'bedrock:InvokeModel',
          'bedrock:InvokeModelWithResponseStream',
        ],
        resources: ['arn:aws:bedrock:*::foundation-model/*'],
      }),
    );
  }
}
```
</Fragment>
<Fragment slot="terraform">
Un modulo Terraform viene generato con nome basato sul parametro `name`:

```terraform
# Agente
module "my_project_agent" {
  source = "../../common/terraform/src/app/agents/my-project-agent"

  additional_iam_policy_statements = [
    {
      Effect = "Allow"
      Action = [
        "bedrock:InvokeModel",
        "bedrock:InvokeModelWithResponseStream"
      ]
      Resource = [
        "arn:aws:bedrock:*::foundation-model/*"
      ]
    }
  ]
}
```
</Fragment>
</Infrastructure>

:::note
Assicurati di abilitare i modelli foundation nel tuo account AWS seguendo [queste istruzioni](https://docs.aws.amazon.com/bedrock/latest/userguide/model-access-modify.html).
:::

:::caution
[Docker](https://www.docker.com/) è obbligatorio per la distribuzione. Installa e avvia Docker per evitare errori tipo:

```
ERROR: Cannot connect to the Docker daemon at unix://path/to/docker.sock.
```
:::

### Target Bundle e Docker

Il target `bundle` aggiunto al progetto:
- Esporta le dipendenze in `requirements.txt` con `uv export`
- Installa le dipendenze per la piattaforma target (`aarch64-manylinux2014`) con `uv pip install`

Il target `docker` specifico per l'agente:
- Costruisce un'immagine Docker dal `Dockerfile` conforme al [contratto runtime AgentCore](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/runtime-service-contract.html)

:::tip
L'immagine Docker usa un tag (es. `my-scope-my-project-agent:latest`) referenziato dall'infrastruttura CDK/Terraform.
:::

### Autenticazione

#### IAM

Di default l'agente usa autenticazione IAM:

<Infrastructure>
<Fragment slot="cdk">
```ts {5}
import { MyProjectAgent } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    new MyProjectAgent(this, 'MyProjectAgent');
  }
}

// Concedi permessi d'invocazione
agent.agentCoreRuntime.grantInvoke(lambdaFunction);
```
</Fragment>
<Fragment slot="terraform">
```terraform
# Agente
module "my_project_agent" {
  source = "../../common/terraform/src/app/agents/my-project-agent"
}

// Policy d'esempio per concedere invocazione
{
  Effect = "Allow"
  Action = [
    "bedrock-agentcore:InvokeAgentRuntime"
  ]
  Resource = [
    module.my_project_agent.agent_core_runtime_arn,
    "${module.my_project_agent.agent_core_runtime_arn}/*"
  ]
}
```
</Fragment>
</Infrastructure>

#### Autenticazione Cognito JWT

Esempio configurazione autenticazione JWT con Cognito:

<Infrastructure>
<Fragment slot="cdk">
```ts {13-18}
import { MyProjectAgent } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    const userPool = new UserPool(this, 'UserPool');
    const client = userPool.addClient('Client', {
      authFlows: {
        userPassword: true,
      },
    });

    new MyProjectAgent(this, 'MyProjectAgent', {
      authorizerConfiguration: {
        customJWTAuthorizer: {
          discoveryUrl: `https://cognito-idp.${Stack.of(userPool).region}.amazonaws.com/${userPool.userPoolId}/.well-known/openid-configuration`,
          allowedClients: [client.userPoolClientId],
        },
      },
    });
  }
}
```
</Fragment>
<Fragment slot="terraform">
```terraform {18-21}
# my-project-agent.tf

locals {
  aws_region = data.aws_region.current.name
  user_pool_id = "xxx"
  user_pool_client_ids = ["yyy"]
}

module "agent_core_runtime" {
  source = "../../../core/agent-core"
  agent_runtime_name = "MyProjectAgent"
  docker_image_tag = "my-scope-my-project-agent:latest"
  server_protocol = "HTTP"
  customJWTAuthorizer = {
    discoveryUrl = "https://cognito-idp.${local.aws_region}.amazonaws.com/${local.user_pool_id}/.well-known/openid-configuration",
    allowedClients = local.user_pool_client_ids
  }
  env = var.env
  additional_iam_policy_statements = var.additional_iam_policy_statements
  tags = var.tags
}
```
</Fragment>
</Infrastructure>

### Osservabilità

L'agente è configurato automaticamente con osservabilità tramite [AWS Distro for OpenTelemetry](https://aws.amazon.com/otel/) (ADOT) nel `Dockerfile`.

I trace sono disponibili in CloudWatch tramite la sezione "GenAI Observability". Abilita [Transaction Search](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-Transaction-Search.html) per visualizzarli.

Per dettagli, vedi la [documentazione AgentCore sull'osservabilità](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/observability-configure.html).