---
title: "Agente Python Strands"
description: "Genera un Agente Python Strands per costruire agenti AI con strumenti e distribuirli su Amazon Bedrock AgentCore Runtime"
---



import { FileTree } from '@astrojs/starlight/components';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import Link from '@components/link.astro';
import Snippet from '@components/snippet.astro';
import Infrastructure from '@components/infrastructure.astro';
import GeneratorParameters from '@components/generator-parameters.astro';

Genera un [Agente Strands](https://strandsagents.com/) in Python per costruire agenti AI con strumenti, e opzionalmente distribuirlo su [Amazon Bedrock AgentCore Runtime](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/).

## Cos'è Strands?

[Strands](https://strandsagents.com/latest/documentation/docs/) è un framework Python leggero e pronto per la produzione per costruire agenti AI. Caratteristiche principali:

- **Leggero e personalizzabile**: Ciclo di agente semplice che non ostacola il lavoro
- **Pronto per la produzione**: Osservabilità completa, tracciamento e opzioni di deployment per scalare
- **Agnostico su modelli e provider**: Supporta molti modelli diversi da vari provider
- **Strumenti della community**: Set potente di strumenti contribuiti dalla community
- **Supporto multi-agente**: Tecniche avanzate come team di agenti e agenti autonomi
- **Modalità di interazione flessibili**: Supporto conversazionale, streaming e non-streaming

## Utilizzo

### Genera un Agente Strands

Puoi generare un Agente Strands in Python in due modi:

<RunGenerator generator="py#strands-agent" />

:::tip
Prima utilizza il generatore <Link path="/guides/python-project">`py#project`</Link> per creare un progetto a cui aggiungere il tuo Agente Strands.
:::

### Opzioni

<GeneratorParameters generator="py#strands-agent" />

## Output del Generatore

Il generatore aggiungerà i seguenti file al tuo progetto Python esistente:

<FileTree>
  - your-project/
    - your_module/
      - agent/ (o nome personalizzato se specificato)
        - \_\_init\_\_.py Inizializzazione pacchetto Python
        - agent.py Definizione principale dell'agente con strumenti di esempio
        - main.py Punto d'ingresso per Bedrock AgentCore Runtime
        - agentcore_mcp_client.py Factory client utile per richiamare server MCP ospitati su Bedrock AgentCore Runtime
        - Dockerfile Punto d'ingresso per hostare il tuo agente (escluso se `computeType` è impostato su `None`)
    - pyproject.toml Aggiornato con le dipendenze Strands
    - project.json Aggiornato con i target di servizio dell'agente
</FileTree>

### Infrastruttura

:::note
Se hai selezionato `None` per `computeType`, il generatore non produrrà alcuna infrastruttura as-code.
:::

<Snippet name="shared-constructs" />

Per il deployment del tuo Agente Strands, vengono generati i seguenti file:

<Infrastructure>
<Fragment slot="cdk">
<FileTree>
  - packages/common/constructs/src
    - app
      - agents
        - \<project-name>
          - \<project-name>.ts Costrutto CDK per deployare l'agente
          - Dockerfile Dockerfile pass-through usato dal costrutto CDK
    - core
      - agent-core
        - runtime.ts Costrutto CDK generico per deploy su Bedrock AgentCore Runtime
</FileTree>
</Fragment>
<Fragment slot="terraform">
<FileTree>
  - packages/common/terraform/src
    - app
      - agents
        - \<project-name>
          - \<project-name>.tf Modulo per deployare l'agente
    - core
      - agent-core
        - runtime.tf Modulo generico per deploy su Bedrock AgentCore Runtime
</FileTree>
</Fragment>
</Infrastructure>

## Lavorare con il Tuo Agente Strands

### Aggiungere Strumenti

Gli strumenti sono funzioni che l'agente AI può chiamare per eseguire azioni. Il framework Strands utilizza un approccio semplice basato su decoratori per definire gli strumenti.

Puoi aggiungere nuovi strumenti nel file [`agent.py`](packages/nx-plugin/src/py/strands-agent/files/agent.py.template:6):

```python
from strands import Agent, tool

@tool
def calculate_sum(numbers: list[int]) -> int:
    """Calcola la somma di una lista di numeri"""
    return sum(numbers)

@tool
def get_weather(city: str) -> str:
    """Ottieni informazioni meteo per una città"""
    # Integrazione con l'API meteo qui
    return f"Meteo a {city}: Soleggiato, 25°C"

# Aggiungi strumenti all'agente
agent = Agent(
    system_prompt="Sei un assistente utile con accesso a vari strumenti.",
    tools=[calculate_sum, get_weather],
)
```

Il framework Strands gestisce automaticamente:
- Validazione dei tipi basata sugli type hint delle funzioni
- Generazione dello schema JSON per le chiamate agli strumenti
- Gestione errori e formattazione delle risposte

### Utilizzare Strumenti Precostruiti

Strands fornisce una collezione di strumenti precostruiti tramite il pacchetto `strands-tools`:

```python
from strands_tools import current_time, http_request, file_read

agent = Agent(
    system_prompt="Sei un assistente utile.",
    tools=[current_time, http_request, file_read],
)
```

### Configurazione del Modello

Di default, gli agenti Strands usano Claude 4 Sonnet, ma puoi personalizzare il provider del modello. Consulta la [documentazione Strands sui provider di modelli](https://strandsagents.com/latest/documentation/docs/user-guide/quickstart/#model-providers) per le opzioni di configurazione:

```python
from strands import Agent
from strands.models import BedrockModel

# Crea un BedrockModel
bedrock_model = BedrockModel(
    model_id="anthropic.claude-sonnet-4-20250514-v1:0",
    region_name="us-west-2",
    temperature=0.3,
)

agent = Agent(model=bedrock_model)
```

### Consumare Server MCP

Puoi [aggiungere strumenti da server MCP](https://strandsagents.com/latest/documentation/docs/user-guide/concepts/tools/mcp-tools/) al tuo agente Strands.

Per consumare server MCP creati con i generatori <Link path="/guides/py-mcp-server">`py#mcp-server`</Link> o <Link path="/guides/ts-mcp-server">`ts#mcp-server`</Link> (o altri hostati su Bedrock AgentCore Runtime), viene generata per te una factory client in `agentcore_mcp_client.py`.

Puoi aggiornare il metodo `get_agent` in `agent.py` per creare client MCP e aggiungere strumenti. L'esempio seguente mostra come farlo con autenticazione IAM (SigV4):

```python
# agent.py
import os
from contextlib import contextmanager

import boto3
from strands import Agent

from .agentcore_mcp_client import AgentCoreMCPClient

# Ottieni regione e credenziali
region = os.environ["AWS_REGION"]
boto_session = boto3.Session(region_name=region)
credentials = boto_session.get_credentials()

@contextmanager
def get_agent(session_id: str):
    mcp_client = AgentCoreMCPClient.with_iam_auth(
        agent_runtime_arn=os.environ["MCP_AGENTCORE_RUNTIME_ARN"],
        credentials=credentials,
        region=region,
        session_id=session_id,
    )

    with mcp_client:
        mcp_tools = mcp_client.list_tools_sync()

        yield Agent(
            system_prompt="..."
            tools=[*mcp_tools],
        )
```

:::tip
Se il tuo server MCP target usa autenticazione JWT, puoi usare il metodo `AgentCoreMCPClient.with_jwt_auth` per creare il client.
:::

Con l'esempio di autenticazione IAM sopra, dobbiamo configurare due cose nella nostra infrastruttura. Primo, aggiungere la variabile d'ambiente che il nostro agente consuma per l'ARN del Runtime AgentCore del server MCP, secondo concedere al nostro agente i permessi per richiamare il server MCP. Questo può essere ottenuto come segue:

<Infrastructure>
<Fragment slot="cdk">
```ts {9, 13}
import { MyProjectAgent, MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    const mcpServer = new MyProjectMcpServer(this, 'MyProjectMcpServer');

    const agent = new MyProjectAgent(this, 'MyProjectAgent', {
      environment: {
        MCP_AGENTCORE_RUNTIME_ARN: mcpServer.agentCoreRuntime.arn,
      },
    });

    mcpServer.agentCoreRuntime.grantInvoke(agent.agentCoreRuntime);
  }
}
```
</Fragment>
<Fragment slot="terraform">
```terraform
# Server MCP
module "my_project_mcp_server" {
  source = "../../common/terraform/src/app/mcp-servers/my-project-mcp-server"
}

# Agente
module "my_project_agent" {
  source = "../../common/terraform/src/app/agents/my-project-agent"

  env = {
    MCP_AGENTCORE_RUNTIME_ARN = module.my_project_mcp_server.agent_core_runtime_arn
  }

  additional_iam_policy_statements = [
    {
      Effect = "Allow"
      Action = [
        "bedrock-agentcore:InvokeAgentRuntime"
      ]
      Resource = [
        module.my_project_mcp_server.agent_core_runtime_arn,
        "${module.my_project_mcp_server.agent_core_runtime_arn}/*"
      ]
    }
  ]
}
```
</Fragment>
</Infrastructure>

### Approfondimenti

Per una guida più dettagliata sulla scrittura di agenti Strands, consulta la [documentazione Strands](https://strandsagents.com/latest/documentation/docs/).

## Bedrock AgentCore Python SDK

Il generatore configura il [Bedrock AgentCore Python SDK](https://github.com/aws/bedrock-agentcore-sdk-python) per gestire il contratto HTTP sottostante che gli agenti su AgentCore devono implementare.

Puoi trovare maggiori dettagli sulle capacità dell'SDK nella [documentazione qui](https://aws.github.io/bedrock-agentcore-starter-toolkit/user-guide/runtime/quickstart.html).

:::note
Poiché il generatore produce infrastruttura CDK o Terraform che gestisce il deployment del tuo agente, non è necessario utilizzare il `bedrock-agentcore-starter-toolkit` menzionato nella documentazione per deployare l'agente.
:::

## Eseguire il Tuo Agente Strands

### Sviluppo Locale

Il generatore configura un target chiamato `<your-agent-name>-serve`, che avvia il tuo Agente Strands localmente per sviluppo e test.

<NxCommands commands={['run your-project:agent-serve']} />

Questo comando usa `uv run` per eseguire il tuo Agente Strands utilizzando il [Bedrock AgentCore Python SDK](https://github.com/aws/bedrock-agentcore-sdk-python).

## Deploy dell'Agente Strands su Bedrock AgentCore Runtime

### Infrastruttura as-Code

Se hai selezionato `BedrockAgentCoreRuntime` per `computeType`, viene generata l'infrastruttura CDK o Terraform rilevante che puoi usare per deployare il tuo Agente Strands su [Amazon Bedrock AgentCore Runtime](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/agents-tools-runtime.html).

<Infrastructure>
<Fragment slot="cdk">
Viene generato un costrutto CDK per te, nominato in base al `name` scelto durante l'esecuzione del generatore, o `<ProjectName>Agent` di default.

Puoi usare questo costrutto CDK in un'applicazione CDK:

```ts {6}
import { MyProjectAgent } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    // Aggiungi l'agente al tuo stack
    const agent = new MyProjectAgent(this, 'MyProjectAgent');

    // Concedi permessi per richiamare i modelli pertinenti in bedrock
    agent.agentCoreRuntime.role.addToPolicy(
      new PolicyStatement({
        actions: [
          'bedrock:InvokeModel',
          'bedrock:InvokeModelWithResponseStream',
        ],
        // Puoi limitare il sotto a specifici modelli usati
        resources: ['arn:aws:bedrock:*::foundation-model/*'],
      }),
    );
  }
}
```
</Fragment>
<Fragment slot="terraform">
Viene generato un modulo Terraform per te, nominato in base al `name` scelto durante l'esecuzione del generatore, o `<ProjectName>-agent` di default.

Puoi usare questo modulo Terraform in un progetto Terraform:

```terraform
# Agente
module "my_project_agent" {
  # Percorso relativo al modulo generato in common/terraform
  source = "../../common/terraform/src/app/agents/my-project-agent"

  # Concedi permessi per richiamare i modelli pertinenti in bedrock
  additional_iam_policy_statements = [
    {
      Effect = "Allow"
      Action = [
        "bedrock:InvokeModel",
        "bedrock:InvokeModelWithResponseStream"
      ]
      Resource = [
        "arn:aws:bedrock:*::foundation-model/*"
      ]
    }
  ]
}
```
</Fragment>
</Infrastructure>

:::note
Quando fai il deploy su Bedrock AgentCore Runtime, devi assicurarti che i modelli foundation appropriati siano abilitati nel tuo account AWS. Di default, gli agenti Strands usano Claude 4 Sonnet, ma questo può essere personalizzato come descritto sopra.

Per abilitare l'accesso ai modelli in Amazon Bedrock, segui le [istruzioni qui](https://docs.aws.amazon.com/bedrock/latest/userguide/model-access-modify.html).
:::

:::caution
[Docker](https://www.docker.com/) è richiesto per buildare e deployare il tuo Agente Strands. Assicurati di aver installato e avviato Docker per evitare errori come:

```
ERROR: Cannot connect to the Docker daemon at unix://path/to/docker.sock.
```
:::

### Target Bundle e Docker

Per buildare il tuo Agente Strands per Bedrock AgentCore Runtime, viene aggiunto un target `bundle` al tuo progetto, che:

- Esporta le dipendenze Python in un file `requirements.txt` usando `uv export`
- Installa le dipendenze per la piattaforma target (`aarch64-manylinux2014`) usando `uv pip install`

Viene anche aggiunto un target `docker` specifico per il tuo Agente Strands, che:

- Builda un'immagine docker dal `Dockerfile` che esegue il tuo agente, secondo il [contratto runtime di AgentCore](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/runtime-service-contract.html)

:::tip
L'immagine docker è buildata usando un tag (esempio `my-scope-my-project-agent:latest`), referenziato dalla tua infrastruttura CDK o Terraform, permettendo al tuo `Dockerfile` di essere co-locato con il progetto del tuo Agente Strands.
:::

### Autenticazione

#### IAM

Di default, il tuo Agente Strands sarà protetto usando autenticazione IAM, semplicemente deployalo senza argomenti:

<Infrastructure>
<Fragment slot="cdk">
```ts {5}
import { MyProjectAgent } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    new MyProjectAgent(this, 'MyProjectAgent');
  }
}
```

Puoi concedere l'accesso per richiamare il tuo agente su Bedrock AgentCore Runtime usando il metodo `grantInvoke`, per esempio:

```ts {8}
import { MyProjectAgent } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    const agent = new MyProjectAgent(this, 'MyProjectAgent');
    const lambdaFunction = new Function(this, ...);

    agent.agentCoreRuntime.grantInvoke(lambdaFunction);
  }
}
```
</Fragment>
<Fragment slot="terraform">
```terraform
# Agente
module "my_project_agent" {
  # Percorso relativo al modulo generato in common/terraform
  source = "../../common/terraform/src/app/agents/my-project-agent"
}
```

Per concedere l'accesso a richiamare l'agente, dovrai aggiungere una policy come la seguente, referenziando l'output `module.my_project_agent.agent_core_runtime_arn`:

```terraform
{
  Effect = "Allow"
  Action = [
    "bedrock-agentcore:InvokeAgentRuntime"
  ]
  Resource = [
    module.my_project_agent.agent_core_runtime_arn,
    "${module.my_project_agent.agent_core_runtime_arn}/*"
  ]
}
```
</Fragment>
</Infrastructure>

#### Autenticazione Cognito JWT

Quanto segue dimostra come configurare l'autenticazione Cognito per il tuo agente.

<Infrastructure>
<Fragment slot="cdk">
Per configurare l'autenticazione JWT, puoi passare la proprietà `authorizerConfiguration` al tuo costrutto agente. Ecco un esempio che configura un user pool e client Cognito per proteggere l'agente:

```ts {13-18}
import { MyProjectAgent } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    const userPool = new UserPool(this, 'UserPool');
    const client = userPool.addClient('Client', {
      authFlows: {
        userPassword: true,
      },
    });

    new MyProjectAgent(this, 'MyProjectAgent', {
      authorizerConfiguration: {
        customJWTAuthorizer: {
          discoveryUrl: `https://cognito-idp.${Stack.of(userPool).region}.amazonaws.com/${userPool.userPoolId}/.well-known/openid-configuration`,
          allowedClients: [client.userPoolClientId],
        },
      },
    });
  }
}
```
</Fragment>
<Fragment slot="terraform">
Per configurare l'autenticazione JWT, puoi modificare il tuo modulo agente per configurare la variabile `customJWTAuthorizer` come segue:

```terraform {18-21}
# packages/common/terraform/src/app/agents/my-project-agent/my-project-agent.tf

data "aws_region" "current" {}

locals {
  aws_region = data.aws_region.current.name

  # Sostituisci con i tuoi ID user pool e client o esponili come variabili
  user_pool_id = "xxx"
  user_pool_client_ids = ["yyy"]
}

module "agent_core_runtime" {
  source = "../../../core/agent-core"
  agent_runtime_name = "MyProjectAgent"
  docker_image_tag = "my-scope-my-project-agent:latest"
  server_protocol = "HTTP"
  customJWTAuthorizer = {
    discoveryUrl = "https://cognito-idp.${local.aws_region}.amazonaws.com/${local.user_pool_id}/.well-known/openid-configuration",
    allowedClients = local.user_pool_client_ids
  }
  env = var.env
  additional_iam_policy_statements = var.additional_iam_policy_statements
  tags = var.tags
}
```
</Fragment>
</Infrastructure>

### Osservabilità

Il tuo agente è configurato automaticamente con osservabilità usando [AWS Distro for Open Telemetry](https://aws.amazon.com/otel/) (ADOT), configurando auto-strumentazione nel tuo `Dockerfile`.

Puoi trovare le tracce nella Console AWS CloudWatch, selezionando "GenAI Observability" nel menu. Nota che per popolare le tracce devi abilitare [Transaction Search](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-Transaction-Search.html).

Per maggiori dettagli, consulta la [documentazione AgentCore sull'osservabilità](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/observability-configure.html).