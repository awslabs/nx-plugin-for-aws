---
title: "Gu칤a de Inicio R치pido"
description: "Una introducci칩n r치pida sobre c칩mo usar @aws/nx-plugin."
---

import { Steps } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import Snippet from '@components/snippet.astro';
import CreateNxWorkspaceCommand from '@components/create-nx-workspace-command.astro';
import InstallCommand from '@components/install-command.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import Infrastructure from '@components/infrastructure.astro';

Esta gu칤a te guiar치 a trav칠s de los conceptos b치sicos de instalar y usar `@aws/nx-plugin` para construir proyectos en AWS r치pidamente.

:::tip
Para un tutorial m치s detallado sobre c칩mo construir una aplicaci칩n full-stack, revisa la <Link path="get_started/tutorials/dungeon-game/overview">Tutorial de Dungeon Adventure</Link>.
:::

## Requisitos previos

Se necesitan las siguientes dependencias globales antes de continuar:

<Snippet name="prerequisites" />

## Paso 1: Inicializar un nuevo espacio de trabajo Nx

Ejecuta el siguiente comando para crear un espacio de trabajo Nx con el gestor de paquetes de tu elecci칩n:

<CreateNxWorkspaceCommand workspace="my-project" />

:::tip
Se te pedir치 que elijas tu proveedor de infraestructura como c칩digo (IaC), ya sea [CDK](https://docs.aws.amazon.com/cdk/) o [Terraform](https://developer.hashicorp.com/terraform). Puedes omitir esta pregunta ejecutando el comando con `--iacProvider`, por ejemplo:

<Infrastructure>
<Fragment slot="cdk">
<CreateNxWorkspaceCommand workspace="my-project" iacProvider="CDK" />
</Fragment>
<Fragment slot="terraform">
<CreateNxWorkspaceCommand workspace="my-project" iacProvider="Terraform" />
</Fragment>
</Infrastructure>
:::

Una vez completado, accede al directorio del proyecto:

```sh
cd my-project
```

## Paso 2: Usar generadores para estructurar tu proyecto

En esta gu칤a r치pida, agregaremos una API tRPC, un sitio web React, autenticaci칩n Cognito e infraestructura CDK o Terraform. Dependiendo del tipo de proyecto que est칠s construyendo, puedes elegir cualquier combinaci칩n de generadores para inicializar r치pidamente tu proyecto. Revisa las **Gu칤as** en la barra de navegaci칩n izquierda para ver la lista completa de opciones.

### Agregar una API tRPC

<RunGenerator generator="ts#trpc-api" requiredParameters={{ name: 'demo-api', auth: 'IAM' }} />

Esto crear치 la API en la carpeta `packages/demo-api`.

### Agregar un sitio web React

<RunGenerator generator="ts#react-website" requiredParameters={{ name: 'demo-website' }} />

Esto genera un nuevo sitio web React en `packages/demo-website`.

### Agregar autenticaci칩n Cognito

<RunGenerator generator="ts#react-website#auth" requiredParameters={{ project: '@my-project/demo-website', cognitoDomain: 'my-demo' }} />

Esto configura la infraestructura necesaria y el c칩digo React para agregar autenticaci칩n Cognito a tu sitio web.

### Conectar el frontend al backend

<RunGenerator generator="api-connection" requiredParameters={{ sourceProject: '@my-project/demo-website', targetProject: '@my-project/demo-api' }} />

Esto configura los proveedores necesarios para asegurar que tu sitio web pueda llamar a tu API tRPC.

### Agregar infraestructura

Agrega el proyecto de infraestructura seg칰n tu proveedor IaC elegido.

<Infrastructure>
<Fragment slot="cdk">
<RunGenerator generator="ts#infra" requiredParameters={{ name: 'infra' }} />

Esto configura una aplicaci칩n CDK que puedes usar para desplegar tu infraestructura en AWS.
</Fragment>
<Fragment slot="terraform">
<RunGenerator generator="terraform#project" requiredParameters={{ name: 'infra' }} />

Esto configura un proyecto Terraform que puedes usar para desplegar tu infraestructura en AWS.
</Fragment>
</Infrastructure>

## Paso 3: Ejecutar tu sitio web y API localmente

Usa el siguiente comando para iniciar servidores locales de desarrollo para tu sitio web y sus APIs conectadas:

<NxCommands commands={['run demo-website:serve-local']} />

Tu sitio web estar치 disponible en `http://localhost:4200`.

Los cambios tanto en tu sitio web como en la API se reflejar치n en tiempo real, ya que ambos servidores locales recargar치n autom치ticamente.

## Paso 4: Definir recursos en la nube y desplegar en AWS

<Infrastructure>
<Fragment slot="cdk">
Abre `packages/infra/src/stacks/application-stack.ts` y agrega el siguiente c칩digo:

```typescript
import * as cdk from 'aws-cdk-lib';
import { DemoApi, DemoWebsite, UserIdentity } from ':my-project/common-constructs';
import { Construct } from 'constructs';

export class ApplicationStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    const identity = new UserIdentity(this, 'identity');
    const api = new DemoApi(this, 'api', {
      integrations: DemoApi.defaultIntegrations(this).build(),
    });
    api.grantInvokeAccess(identity.identityPool.authenticatedRole);

    new DemoWebsite(this, 'website');
  }
}
```

Este es todo el c칩digo CDK necesario para desplegar nuestra aplicaci칩n full-stack.
</Fragment>
<Fragment slot="terraform">
Abre `packages/infra/src/main.tf` y agrega el siguiente c칩digo:

```hcl
# Include metrics tracking for @aws/nx-plugin usage
module "metrics" {
  source = "../../common/terraform/src/metrics"
}

# Deploy user identity
module "user_identity" {
  source = "../../common/terraform/src/core/user-identity"
}

# Deploy API
module "demo_api" {
  source = "../../common/terraform/src/app/apis/demo-api"
}

# Grant authenticated users access to invoke the API
resource "aws_iam_policy" "api_invoke_policy" {
  name        = "DemoApiInvokePolicy"
  description = "Policy to allow authenticated users to invoke the API"

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Effect = "Allow"
        Action = "execute-api:Invoke"
        Resource = "${module.demo_api.api_execution_arn}/*/*"
      }
    ]
  })
}

resource "aws_iam_role_policy_attachment" "authenticated_api_access" {
  role       = module.user_identity.authenticated_role_name
  policy_arn = aws_iam_policy.api_invoke_policy.arn
}

# Deploy website
provider "aws" {
  alias  = "us_east_1"
  region = "us-east-1"
}

module "demo_website" {
  source = "../../common/terraform/src/app/static-websites/demo-website"

  providers = {
    aws.us_east_1 = aws.us_east_1
  }

  depends_on = [module.user_identity, module.demo_api]
}
```

Este es todo el c칩digo Terraform necesario para desplegar nuestra aplicaci칩n full-stack.
</Fragment>
</Infrastructure>

### Construir y desplegar la infraestructura

Luego, ejecuta el siguiente comando para construir tu proyecto:

<NxCommands commands={['run-many --target build --all']} />

:::tip
Si encuentras errores de linting, puedes ejecutar el siguiente comando para corregirlos autom치ticamente.

<NxCommands commands={['run-many --target lint --configuration=fix --all']} />
:::

Inicializa tu infraestructura:

<Infrastructure>
<Fragment slot="cdk">
<NxCommands commands={['run infra:bootstrap']} />

:::tip
Se requiere inicializaci칩n de CDK tanto para la regi칩n AWS de despliegue objetivo como para `us-east-1` para permitir el despliegue del WebACL de AWS WAF para el sitio web.
:::
</Fragment>
<Fragment slot="terraform">
<NxCommands commands={['run infra:bootstrap']} />

:::tip
La inicializaci칩n de Terraform crea un bucket S3 para almacenar tus archivos de estado de Terraform. Esto solo necesita hacerse una vez por combinaci칩n de cuenta/regi칩n de AWS.
:::
</Fragment>
</Infrastructure>

Despliega tu proyecto:

<Infrastructure>
<Fragment slot="cdk">
<NxCommands commands={['run infra:deploy "my-project-sandbox/*"']} />
</Fragment>
<Fragment slot="terraform">
<NxCommands commands={['run infra:apply']} />

:::tip
Este comando primero ejecutar치 `terraform plan` para mostrarte los cambios que se realizar치n, luego aplicar치 esos cambios para desplegar tu infraestructura.
:::
</Fragment>
</Infrastructure>

## Paso 5: Probar el sitio web con los recursos en la nube desplegados

<Steps>
1. Obt칠n el archivo `runtime-config.json`:

    <NxCommands commands={['run demo-website:load:runtime-config']} />

2. Inicia el servidor local del sitio web

    <NxCommands commands={['run demo-website:serve']} />
</Steps>

Tu sitio web estar치 disponible en `http://localhost:4200` y apuntar치 a los recursos que desplegaste para la API y autenticaci칩n.

---

춰Felicidades! 游꿀 춰Has construido y desplegado exitosamente una aplicaci칩n full-stack usando `@aws/nx-plugin`!