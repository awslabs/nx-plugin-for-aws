---
title: "Construir la UI"
description: "Un tutorial de c칩mo construir un juego de aventuras de mazmorra con IA ag칠ntica usando @aws/nx-plugin."
---

import { Aside, Code, FileTree, Steps, Tabs, TabItem } from '@astrojs/starlight/components';
import { Image } from 'astro:assets';
import Drawer from '@components/drawer.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import InstallCommand from '@components/install-command.astro';
import E2ECode from '@components/e2e-code.astro';
import E2EDiff from '@components/e2e-diff.astro';

import dungeonAdventureArchitecturePng from '@assets/dungeon-game-architecture.png'
import dungeonAdventureErPng from '@assets/dungeon-adventure-er.png'
import baselineWebsitePng from '@assets/baseline-website.png'
import baselineGamePng from '@assets/baseline-game.png'
import nxGraphPng from '@assets/nx-graph.png'
import gameSelectPng from '@assets/game-select.png'
import gameConversationPng from '@assets/game-conversation.png'

## Tarea 1: Configurar el servidor de desarrollo local

Para comenzar a construir la interfaz de usuario, necesitaremos configurar nuestro servidor de desarrollo local para apuntar a nuestro sandbox desplegado. Para esto, ejecuta el siguiente comando:

<NxCommands commands={["run @dungeon-adventure/game-ui:load:runtime-config"]} />

Este comando descargar치 el `runtime-config.json` que est치 desplegado y lo almacenar치 localmente en la carpeta `packages/game-ui/public`.

Para iniciar el servidor de desarrollo, ejecuta el siguiente comando:

<NxCommands commands={["run @dungeon-adventure/game-ui:serve"]} />

Abre el sitio web local en tu navegador, donde se te pedir치 iniciar sesi칩n y seguir las indicaciones para crear un nuevo usuario. Una vez completado, deber칤as ver el sitio web base:

<Image src={baselineWebsitePng} alt="baseline-website.png" width="800" height="600" />

<Aside type="caution">
Recomendamos mantener el servidor de desarrollo en ejecuci칩n durante el resto de este m칩dulo, ya que recargar치 autom치ticamente los cambios que realicemos.
</Aside>

:::tip
Puedes ejecutar comandos Nx en su lugar para iniciar cualquier servidor API local conectado, permiti칠ndote iterar tanto en tu API tRPC como en tu sitio web simult치neamente. <NxCommands commands={["run @dungeon-adventure/game-ui:serve-local"]} /> 
:::

## Tarea 2: Crear una nueva ruta '/game'

Mostraremos las capacidades de `@tanstack/react-router` creando una nueva ruta tipada. 
Para esto, crea un archivo vac칤o en la siguiente ubicaci칩n: `packages/game-ui/src/routes/game/index.tsx`. Notar치s que el archivo se actualiza inmediatamente.

El `@tanstack/react-router` configura autom치ticamente tu nueva ruta y el archivo que acabas de crear ya est치 poblado con la ruta:

```tsx
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/game/')({
  component: RouteComponent,
})

function RouteComponent() {
  return <div>Hello "/game/"!</div>
}
```

Si navegas a `http://localhost:4200/game`, ver치s que tu nueva p치gina se ha renderizado.

<Image src={baselineGamePng} alt="baseline-game.png" width="800" height="600" />

Actualiza el archivo `index.tsx` para cargar nuestra nueva ruta `/game` por defecto. Cuando actualices el campo `to`, tendr치s una lista de rutas tipadas para elegir.

<Tabs>
<TabItem label="routes/index.tsx">
<E2EDiff before="dungeon-adventure/4/routes/index.tsx.old.template" after="dungeon-adventure/4/routes/index.tsx.template" lang="tsx" />
</TabItem>
</Tabs>

Puedes eliminar la carpeta `packages/game-ui/src/routes/welcome/` ya que no es necesaria.

## Tarea 3: Actualizar el dise침o

El dise침o predeterminado configurado es m치s similar a una aplicaci칩n empresarial estilo SaaS que a un juego. 
Para reconfigurar el dise침o y redise침ar el tema para que se parezca m치s a un juego de estilo mazmorra, realiza los siguientes cambios en `packages/game-ui/src`:

<Tabs>
<TabItem label="config.ts">
<E2EDiff before="dungeon-adventure/4/config.ts.old.template" after="dungeon-adventure/4/config.ts.template" lang="typescript" />
</TabItem>
<TabItem label="components/AppLayout/index.tsx">
<E2ECode path="dungeon-adventure/4/AppLayout/index.tsx.template" lang="tsx" />
</TabItem>
<TabItem label="styles.css">
<E2ECode path="dungeon-adventure/4/styles.css.template" lang="css" />
</TabItem>
</Tabs>

Elimina el archivo `packages/game-ui/src/hooks/useAppLayout.tsx` ya que no se utiliza.

## Tarea 4: Integrar el Agente de Historia

Creemos un hook para inicializar un cliente que interact칰e con nuestro Agente de Historia.

<Tabs>
<TabItem label="hooks/useStoryAgent.tsx">
<E2ECode path="dungeon-adventure/4/hooks/useStoryAgent.tsx.template" lang="tsx" />
</TabItem>
</Tabs>

Este hook:

- Recupera el ARN del Agente desde `runtime-config.json`,
- Construye la URL de invocaci칩n de AgentCore Runtime desde el ARN,
- Invoca al Agente con el token JWT del usuario autenticado y un ID de sesi칩n aleatorio, y
- Retorna un iterador as칤ncrono para consumir fragmentos de mensajes transmitidos del agente.

:::tip
La integraci칩n con nuestra Game API ya est치 configurada, ya que usamos el generador `api-connection`. Si deseas una experiencia similar para agentes, da +1 a [este issue de GitHub](https://github.com/awslabs/nx-plugin-for-aws/issues/326).
:::

## Tarea 5: Crear las p치ginas del juego

Para crear las p치ginas del juego que llamar치n a nuestras APIs y completar치n la implementaci칩n del juego, actualiza los siguientes archivos en `packages/game-ui/src/routes/game`:

<Tabs>
<TabItem label="index.tsx">
<E2ECode path="dungeon-adventure/4/routes/game/index.tsx.template" lang="tsx" />
</TabItem>
<TabItem label="$playerName.tsx">

<E2ECode path="dungeon-adventure/4/routes/game/$playerName.tsx.template" lang="tsx" />

<Aside type="tip">
La sintaxis `$playerName` indicar치 a `@tanstack/react-router` que trate `playerName` como un [par치metro de ruta](https://tanstack.com/router/v1/docs/framework/react/guide/path-params). Adicionalmente, implementamos el m칠todo `validateSearch` que asegura que el par치metro de consulta `genre` est칠 fuertemente tipado seg칰n nuestro enum de g칠neros.
</Aside>
</TabItem>
</Tabs>

Al realizar estos cambios, tu servidor de desarrollo local (http://localhost:4200/) deber칤a tener ahora el juego listo para jugar.

<Drawer title="Compilar e implementar" trigger="Tambi칠n puedes compilar e implementar tu c칩digo en Cloudfront si lo prefieres.">

## Tarea 6: Compilar e implementar

### Compilar tu c칩digo
Para compilar tu c칩digo, ejecuta el siguiente comando:

<NxCommands commands={['run-many --target build --all']} />

### Implementar tu aplicaci칩n
Para implementar tu aplicaci칩n, ejecuta el siguiente comando:

<NxCommands commands={['run @dungeon-adventure/infra:deploy dungeon-adventure-infra-sandbox/*']} />

Una vez implementado, navega a tu URL de Cloudfront. Para encontrar esta URL, inspecciona las salidas del despliegue de CDK.

</Drawer>

<Image src={gameSelectPng} alt="game-select.png" width="500" height="400" />
<div style="margin-top: -100px; margin-left: 100px;">
<Image src={gameConversationPng} alt="game-conversation.png" width="500" height="400" />
</div>

춰Felicidades! Has construido y desplegado tu Juego de Aventuras de Mazmorras con Agentes. 游꿀游꿀游꿀