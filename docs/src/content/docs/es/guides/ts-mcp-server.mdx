---
title: "Servidor MCP de TypeScript"
description: "Generar un servidor de Protocolo de Contexto de Modelo (MCP) de TypeScript para proporcionar contexto a Modelos de Lenguaje Grande"
---



import { FileTree } from '@astrojs/starlight/components';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import Link from '@components/link.astro';
import Snippet from '@components/snippet.astro';
import GeneratorParameters from '@components/generator-parameters.astro';

Genera un servidor TypeScript del [Model Context Protocol (MCP)](https://modelcontextprotocol.io/) para proporcionar contexto a Modelos de Lenguaje Grande (LLMs), y opcionalmente despliégalo en [Amazon Bedrock AgentCore](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/).

## ¿Qué es MCP?

El [Model Context Protocol (MCP)](https://modelcontextprotocol.io/) es un estándar abierto que permite a asistentes de IA interactuar con herramientas y recursos externos. Proporciona una forma consistente para que los LLMs puedan:

- Ejecutar herramientas (funciones) que realizan acciones o recuperan información
- Acceder a recursos que proveen contexto o datos

## Uso

### Generar un servidor MCP

Puedes generar un servidor MCP en TypeScript de dos formas:

<RunGenerator generator="ts#mcp-server" />

:::tip
Primero usa el generador <Link path="/guides/typescript-project">`ts#project`</Link> para crear un proyecto donde añadir tu servidor MCP.
:::

### Opciones

<GeneratorParameters generator="ts#mcp-server" />

## Resultado del generador

El generador añadirá los siguientes archivos a tu proyecto TypeScript existente:

<FileTree>
  - your-project/
    - src/
      - mcp-server/ (o nombre personalizado si se especifica)
        - index.ts Exporta tu servidor
        - server.ts Definición principal del servidor
        - stdio.ts Punto de entrada para transporte STDIO, útil para servidores MCP locales simples
        - http.ts Punto de entrada para transporte HTTP transmitible, útil para alojar tu servidor MCP
        - tools/
          - add.ts Herramienta de ejemplo
        - resources/
          - sample-guidance.ts Recurso de ejemplo
        - Dockerfile Punto de entrada para alojar tu servidor MCP (cuando `computeType` está configurado como `BedrockAgentCoreRuntime`)
    - package.json Actualizado con entrada bin y dependencias MCP
    - project.json Actualizado con objetivo serve del servidor MCP
</FileTree>

:::note
Si seleccionaste `BedrockAgentCoreRuntime` para `computeType`, el generador también creará un constructo CDK para desplegar tu servidor MCP.
:::

## Trabajando con tu servidor MCP

### Añadiendo herramientas

Las herramientas son funciones que el asistente de IA puede llamar para realizar acciones. Puedes añadir nuevas herramientas en el archivo `server.ts`:

```typescript
server.tool("toolName", "tool description",
  { param1: z.string(), param2: z.number() }, // Esquema de entrada usando Zod
  async ({ param1, param2 }) => {
    // Implementación de la herramienta
    return {
      content: [{ type: "text", text: "Result" }]
    };
  }
);
```

:::caution
El SDK de MCP solo soporta Zod v3 actualmente. Para permitir el uso de Zod v4 en otros generadores, la dependencia de Zod v3 se instala como `zod-v3`. Para esquemas de herramientas MCP, necesitarás importar Zod de la siguiente manera:

```ts
import { z } from 'zod-v3';
```

Una vez que [este issue del SDK MCP](https://github.com/modelcontextprotocol/typescript-sdk/issues/164) se resuelva, podrás eliminar la dependencia adicional `zod-v3` e importar directamente desde `zod`.
:::

### Añadiendo recursos

Los recursos proveen contexto al asistente de IA. Puedes añadir recursos estáticos desde archivos o recursos dinámicos:

```typescript
const exampleContext = 'algún contexto para retornar';

server.resource('resource-name', 'example://resource', async (uri) => ({
  contents: [{ uri: uri.href, text: exampleContext }],
}));

// Recurso dinámico
server.resource('dynamic-resource', 'dynamic://resource', async (uri) => {
  const data = await fetchSomeData();
  return {
    contents: [{ uri: uri.href, text: data }],
  };
});
```

## Configuración con asistentes de IA

<Snippet name="mcp/configuration" parentHeading="Configuración con asistentes de IA" />

## Ejecutando tu servidor MCP

### STDIO

La forma más fácil de probar y usar un servidor MCP es configurándolo con un asistente de IA (como se mencionó arriba).

Sin embargo, puedes ejecutar tu servidor con [transporte STDIO](https://modelcontextprotocol.io/docs/concepts/transports#standard-input%2Foutput-stdio) directamente usando el objetivo `<your-server-name>-serve-stdio`.

<NxCommands commands={['run your-project:your-server-name-serve-stdio']} />

Este comando usa `tsx --watch` para reiniciar automáticamente el servidor cuando los archivos cambien.

### HTTP transmitible

Si deseas ejecutar tu servidor MCP localmente usando [transporte HTTP transmitible](https://modelcontextprotocol.io/docs/concepts/transports#streamable-http), puedes usar el objetivo `<your-server-name>-serve-http`.

<NxCommands commands={['run your-project:your-server-name-serve-http']} />

Este comando usa `tsx --watch` para reiniciar automáticamente el servidor cuando los archivos cambien.

## Desplegando tu servidor MCP en Bedrock AgentCore Runtime

Si seleccionaste `BedrockAgentCoreRuntime` para `computeType`, se genera un constructo CDK que puedes usar para desplegar tu servidor MCP en [Amazon Bedrock AgentCore Runtime](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/agents-tools-runtime.html).

Puedes usar este constructo CDK en una aplicación CDK:

```ts {6}
import { MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    // Añade el servidor MCP a tu stack
    new MyProjectMcpServer(this, 'MyProjectMcpServer');
  }
}
```

:::caution
Se requiere [Docker](https://www.docker.com/) para construir y desplegar tu servidor MCP. Asegúrate de tener Docker instalado y ejecutándose para evitar errores como:

```
ERROR: Cannot connect to the Docker daemon at unix://path/to/docker.sock.
```
:::

### Autenticación

#### IAM

Por defecto, tu servidor MCP estará protegido usando autenticación IAM. Simplemente despliégalo sin argumentos:

```ts {5}
import { MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    new MyProjectMcpServer(this, 'MyProjectMcpServer');
  }
}
```

#### Autenticación Cognito JWT

Para configurar autenticación JWT, puedes pasar la propiedad `authorizerConfiguration` a tu constructo de servidor MCP. Aquí un ejemplo que configura un grupo de usuarios Cognito y un cliente para proteger el servidor MCP:

```ts {14-17}
import { MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    const userPool = new UserPool(this, 'UserPool');
    const client = userPool.addClient('Client', {
      authFlows: {
        userPassword: true,
      },
    });

    new MyProjectMcpServer(this, 'MyProjectMcpServer', {
      authorizerConfiguration: {
        customJWTAuthorizer: {
          discoveryUrl: `https://cognito-idp.${Stack.of(userPool).region}.amazonaws.com/${userPool.userPoolId}/.well-known/openid-configuration`,
          allowedClients: [client.userPoolClientId],
        },
      },
    });
  }
}
```

### Objetivo de bundle

Para construir tu servidor MCP para Bedrock AgentCore Runtime, se añade un objetivo `<your-mcp-server>-bundle` a tu proyecto, que:

- Empqueta tu servidor MCP en un único archivo JavaScript con [`esbuild`](https://esbuild.github.io/), usando `http.ts` como punto de entrada para un servidor MCP HTTP transmitible.
- Construye una imagen docker desde el `Dockerfile` que ejecuta este servidor empaquetado en el puerto `8000`, según el [contrato de protocolo MCP](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/runtime-service-contract.html#mcp-protocol-contract)

:::tip
La imagen docker se construye usando un tag (por ejemplo `my-scope-my-project-mcp-server:latest`), del cual el `Dockerfile` del constructo CDK hereda, permitiendo que tu `Dockerfile` esté ubicado junto a tu proyecto de servidor MCP.
:::

### Observabilidad

Tu servidor MCP se configura automáticamente con observabilidad usando [AWS Distro for Open Telemetry](https://aws.amazon.com/otel/) (ADOT), mediante la configuración de [auto-instrumentación](https://aws-otel.github.io/docs/getting-started/js-sdk/trace-metric-auto-instr) con el SDK de JavaScript en tu `Dockerfile`.

Puedes encontrar trazas en la consola de CloudWatch AWS, seleccionando "GenAI Observability" en el menú. Nota que para que las trazas se muestren, debes habilitar [Transaction Search](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-Transaction-Search.html).

Para más detalles, consulta la [documentación de AgentCore sobre observabilidad](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/observability-configure.html).