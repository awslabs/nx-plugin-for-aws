---
title: "Generador de Generadores de Nx"
description: "Genera un Generador de Nx"
---



import { FileTree } from '@astrojs/starlight/components';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import GeneratorParameters from '@components/generator-parameters.astro';
import Drawer from '@components/drawer.astro';
import Link from '@components/link.astro';
import schema from '../../../../../../packages/nx-plugin/src/ts/nx-generator/schema.json';

Agrega un [Generador de Nx](https://nx.dev/extending-nx/recipes/local-generators) a un proyecto TypeScript, para ayudarte a automatizar tareas repetitivas como la creación de componentes o la aplicación de estructuras de proyecto específicas.

## Uso

### Generar un Generador

Puedes generar un generador de dos formas:

<RunGenerator generator="ts#nx-generator" />

### Opciones

<GeneratorParameters schema={schema} />

## Resultado del Generador

El generador creará los siguientes archivos dentro del `pluginProject` especificado:

<FileTree>
  - src/\<nombre>/
    - schema.json Esquema para la entrada de tu generador
    - schema.d.ts Tipos TypeScript para tu esquema
    - generator.ts Implementación base del generador
    - generator.spec.ts Pruebas para tu generador
  - generators.json Configuración de Nx para definir tus generadores
</FileTree>

## Generadores Locales

:::tip
Recomendamos generar primero un proyecto TypeScript dedicado para todos tus generadores usando el generador `ts#project`. Por ejemplo:

<RunGenerator generator="ts#project" requiredParameters={{ name: 'nx-plugin', directory: 'tools' }} />
:::

Selecciona tu proyecto local `nx-plugin` cuando ejecutes el generador `ts#nx-generator`, y especifica un nombre junto con un directorio opcional y descripción.

### Definición del Esquema

El archivo `schema.json` define las opciones que acepta tu generador. Sigue el formato [JSON Schema](https://json-schema.org/) con extensiones específicas de Nx.

#### Estructura Básica

Un archivo schema.json tiene la siguiente estructura básica:

```json
{
  "$schema": "https://json-schema.org/schema",
  "$id": "NombreDeTuGenerador",
  "title": "Título de tu Generador",
  "description": "Descripción de lo que hace tu generador",
  "type": "object",
  "properties": {
    // Tus opciones del generador van aquí
  },
  "required": ["opcionRequerida1", "opcionRequerida2"]
}
```

#### Ejemplo Simple

Aquí un ejemplo simple con algunas opciones básicas:

```json
{
  "$schema": "https://json-schema.org/schema",
  "$id": "GeneradorDeComponentes",
  "title": "Crear un Componente",
  "description": "Crea un nuevo componente React",
  "type": "object",
  "properties": {
    "nombre": {
      "type": "string",
      "description": "Nombre del componente",
      "x-priority": "important"
    },
    "directorio": {
      "type": "string",
      "description": "Directorio donde se creará el componente",
      "default": "src/components"
    },
    "conPruebas": {
      "type": "boolean",
      "description": "Si se generarán archivos de prueba",
      "default": true
    }
  },
  "required": ["nombre"]
}
```

#### Prompts Interactivos (CLI)

Puedes personalizar los prompts mostrados al ejecutar tu generador vía CLI añadiendo la propiedad `x-prompt`:

```json
"nombre": {
  "type": "string",
  "description": "Nombre del componente",
  "x-prompt": "¿Cuál es el nombre de tu componente?"
}
```

Para opciones booleanas, puedes usar un prompt sí/no:

```json
"conPruebas": {
  "type": "boolean",
  "description": "Si se generarán archivos de prueba",
  "x-prompt": "¿Deseas generar archivos de prueba?"
}
```

#### Selecciones en Menú Desplegable

Para opciones con un conjunto fijo de opciones, usa `enum` para que los usuarios puedan seleccionar:

```json
"estilo": {
  "type": "string",
  "description": "Enfoque de estilos a usar",
  "enum": ["css", "scss", "styled-components", "ninguno"],
  "default": "css"
}
```

#### Menú Desplegable de Selección de Proyecto

Un patrón común es permitir seleccionar entre proyectos existentes:

```json
"proyecto": {
  "type": "string",
  "description": "Proyecto al que añadir el componente",
  "x-prompt": "¿A qué proyecto quieres añadir el componente?",
  "x-dropdown": "proyectos"
}
```

La propiedad `x-dropdown: "proyectos"` indica a Nx que muestre todos los proyectos del workspace.

#### Argumentos Posicionales

Puedes configurar opciones para recibirlas como argumentos posicionales:

```json
"nombre": {
  "type": "string",
  "description": "Nombre del componente",
  "x-priority": "important",
  "$default": {
    "$source": "argv",
    "index": 0
  }
}
```

Esto permite ejecutar el generador como `nx g tu-generador mi-componente` en lugar de `nx g tu-generador --nombre=mi-componente`.

#### Establecer Prioridades

Usa la propiedad `x-priority` para indicar opciones importantes:

```json
"nombre": {
  "type": "string",
  "description": "Nombre del componente",
  "x-priority": "important"
}
```

Las prioridades pueden ser `"important"` o `"internal"`. Esto ayuda a ordenar las opciones en la extensión VSCode de Nx.

#### Valores por Defecto

Puedes proveer valores predeterminados:

```json
"directorio": {
  "type": "string",
  "description": "Directorio donde se creará el componente",
  "default": "src/components"
}
```

#### Más Información

Para más detalles sobre esquemas, consulta la [documentación de Opciones de Generadores Nx](https://nx.dev/extending-nx/recipes/generator-options).

#### Tipos TypeScript con schema.d.ts

Junto con `schema.json`, el generador crea `schema.d.ts` con tipos TypeScript:

```typescript
export interface EsquemaDeTuGenerador {
  nombre: string;
  directorio?: string;
  conPruebas?: boolean;
}
```

Esta interfaz se usa en la implementación para seguridad de tipos:

```typescript
import { EsquemaDeTuGenerador } from './schema';

export default async function (arbol: Tree, opciones: EsquemaDeTuGenerador) {
  const { nombre, directorio = 'src/components', conPruebas = true } = opciones;
  // ...
}
```

:::caution
Al modificar `schema.json`, actualiza `schema.d.ts` para que coincidan:
- Añadir/eliminar propiedades
- Cambiar tipos
- Hacer propiedades requeridas/opcionales (usa `?` para opcionales)

La interfaz debe reflejar fielmente el esquema JSON.
:::

### Implementando un Generador

Tras crear el generador, implementa su lógica en `generator.ts`.

Un generador es una función que modifica un sistema de archivos virtual (`Tree`).

Operaciones comunes:

#### Leer y Escribir Archivos

```typescript
// Leer archivo
const contenido = arbol.read('ruta/archivo.ts', 'utf-8');

// Escribir archivo
arbol.write('ruta/nuevo-archivo.ts', 'export const hola = "mundo";');

// Verificar existencia
if (arbol.exists('ruta/archivo.ts')) {
  // ...
}
```

#### Generar Archivos desde Plantillas

```typescript
import { generateFiles, joinPathFragments } from '@nx/devkit';

generateFiles(
  arbol,
  joinPathFragments(__dirname, 'plantillas'),
  'ruta/salida',
  {
    nombre: opciones.nombre,
    nombreCamelCase: camelCase(opciones.nombre),
    // ...
  }
);
```

#### Manipulación de AST TypeScript

Recomendamos usar [TSQuery](https://github.com/phenomnomnominal/tsquery):

```typescript
import { tsquery } from '@phenomnomnominal/tsquery';
import * as ts from 'typescript';

// Ejemplo: Incrementar versión
const archivo = tsquery.ast(arbol.read('ruta/version.ts', 'utf-8'));
const nodos = tsquery.query(archivo, 'VariableDeclaration:has(Identifier[name="VERSION"]) NumericLiteral');

if (nodos.length > 0) {
  const versionActual = Number(nodos[0].text);
  const nuevaVersion = versionActual + 1;
  
  const resultado = tsquery.replace(/* ... */);
  
  arbol.write(
    'ruta/version.ts',
    ts.createPrinter().printNode(ts.EmitHint.Unspecified, resultado, archivo)
  );
}
```

:::tip
Prueba selectores en el [TSQuery Playground](https://tsquery-playground.firebaseapp.com/).
:::

#### Añadir Dependencias

```typescript
import { addDependenciesToPackageJson } from '@nx/devkit';

addDependenciesToPackageJson(
  arbol,
  { 'nueva-dependencia': '^1.0.0' },
  { 'nueva-dev-dependencia': '^2.0.0' }
);
```

#### Formatear Archivos

```typescript
import { formatFiles } from '@nx/devkit';

await formatFiles(arbol);
```

#### Leer y Actualizar JSON

```typescript
import { readJson, updateJson } from '@nx/devkit';

const packageJson = readJson(arbol, 'package.json');

updateJson(arbol, 'tsconfig.json', json => ({
  ...json,
  compilerOptions: { ...json.compilerOptions, strict: true }
}));
```

### Ejecutar tu Generador

Puedes ejecutarlo de dos formas:

<RunGenerator namespace="@mi-proyecto/nx-plugin" generator="mi-generador" />

:::note
Si no ves tu generador en la UI de VSCode, actualiza tu workspace Nx con:

<NxCommands commands={['reset']} />
:::

### Probar tu Generador

Las pruebas unitarias siguen este patrón:

```typescript
import { createTreeWithEmptyWorkspace } from '@nx/devkit/testing';
import { tuGenerador } from './generator';

describe('tu generador', () => {
  let arbol;

  beforeEach(() => {
    arbol = createTreeWithEmptyWorkspace();
    // Configuración inicial...
  });

  it('debe generar archivos esperados', async () => {
    await tuGenerador(arbol, { nombre: 'prueba' });
    
    expect(arbol.exists('src/prueba/archivo.ts')).toBeTruthy();
    expect(arbol.read('src/prueba/archivo.ts', 'utf-8')).toMatchSnapshot();
  });

  it('debe manejar errores', async () => {
    await expect(tuGenerador(arbol, { nombre: 'invalido' }))
      .rejects.toThrow('Mensaje de error esperado');
  });
});
```

Puntos clave:
- Usa `createTreeWithEmptyWorkspace()` para simular un filesystem
- Prueba creación y modificación de archivos
- Usa snapshots para contenido complejo
- Verifica manejo de errores

## Contribuir Generadores a @aws/nx-plugin

Puedes usar `ts#nx-generator` para crear generadores dentro de `@aws/nx-plugin`.

Al ejecutarlo en nuestro repositorio, generará:

<FileTree>
  - packages/nx-plugin/src/\<nombre>/
    - schema.json
    - schema.d.ts
    - generator.ts
    - generator.spec.ts
  - docs/src/content/docs/guides/
    - \<nombre>.mdx
  - packages/nx-plugin/generators.json Actualizado
</FileTree>

:::tip
Para una guía detallada sobre contribuciones, consulta el <Link path="get_started/tutorials/contribute-generator">tutorial aquí</Link>.
:::