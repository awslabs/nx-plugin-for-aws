---
title: "Sitio web de React"
description: "Documentación de referencia para un sitio web de React"
---

import { FileTree, Steps } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import RunGenerator from '@components/run-generator.astro';
import GeneratorParameters from '@components/generator-parameters.astro';
import NxCommands from '@components/nx-commands.astro';
import Infrastructure from '@components/infrastructure.astro';
import Snippet from '@components/snippet.astro';

Este generador crea un nuevo sitio web en [React](https://react.dev/) configurado con [Cloudscape](http://cloudscape.design/) por defecto, junto con la infraestructura de AWS CDK o Terraform para desplegar tu sitio web en la nube como un sitio estático alojado en [S3](https://aws.amazon.com/s3/), servido por [CloudFront](https://aws.amazon.com/cloudfront/) y protegido por [WAF](https://aws.amazon.com/waf/).

La aplicación generada utiliza [Vite](https://vite.dev/) como herramienta de construcción y empaquetado. Emplea [TanStack Router](https://tanstack.com/router/v1) para enrutamiento tipado.

:::note
Este generador te configura con [Cloudscape](http://cloudscape.design/) por defecto, pero puedes seleccionar `None` como `uxProvider` si prefieres usar una biblioteca de componentes o sistema de diseño diferente.
:::

## Uso

### Generar un sitio web React

Puedes generar un nuevo sitio web React de dos formas:

<RunGenerator generator="ts#react-website" />

### Opciones

<GeneratorParameters generator="ts#react-website" />

## Salida del generador

El generador creará la siguiente estructura de proyecto en el directorio `<directory>/<name>`:

<FileTree>
  - index.html Punto de entrada HTML
  - public Assets estáticos
  - src
    - main.tsx Punto de entrada de la aplicación con configuración de React
    - config.ts Configuración de la aplicación (ej. logo)
    - components
      - AppLayout Componentes para el layout general y barra de navegación
    - hooks
      - useAppLayout.tsx Hook para ajustar el AppLayout de Cloudscape desde componentes anidados (si el UX Provider está configurado como Cloudscape)
    - routes
      - index.tsx Ruta (o página) de ejemplo para TanStack Router
    - styles.css Estilos globales
  - vite.config.ts Configuración de Vite y Vitest
  - tsconfig.json Configuración base de TypeScript para código y tests
  - tsconfig.app.json Configuración de TypeScript para código fuente
  - tsconfig.spec.json Configuración de TypeScript para tests
</FileTree>

:::note
Si optaste por no usar [TanStack Router](https://tanstack.com/router/v1), se te proporcionará un archivo simple `src/app.tsx` como punto de entrada de tu aplicación en lugar del directorio `routes`.
:::

### Infraestructura

<Snippet name="shared-constructs" />

El generador crea infraestructura como código para desplegar tu sitio web según el `iacProvider` seleccionado:

<Infrastructure>
<Fragment slot="cdk">
<FileTree>
  - packages/common/constructs/src
    - app
      - static-websites
        - \<name>.ts Infraestructura específica de tu sitio web
    - core
      - static-website.ts Construct genérico StaticWebsite
</FileTree>
</Fragment>
<Fragment slot="terraform">
<FileTree>
  - packages/common/terraform/src
    - app
      - static-websites
        - \<name>
          - \<name>.tf Módulo específico para tu sitio web
    - core
      - static-website
        - static-website.tf Módulo genérico de sitio web estático
</FileTree>
</Fragment>
</Infrastructure>

## Implementando tu sitio web React

La [documentación de React](https://react.dev/learn) es un buen punto de partida para aprender los fundamentos. Puedes consultar la [documentación de Cloudscape](https://cloudscape.design/components/) para detalles sobre los componentes disponibles y su uso.

### Rutas

#### Crear una ruta/página

Tu sitio Cloudscape incluye [TanStack Router](https://tanstack.com/router/v1) configurado por defecto. Esto facilita añadir nuevas rutas:

<Steps>
  1. [Ejecutar el servidor de desarrollo local](#servidor-de-desarrollo-local)
  2. Crear un nuevo archivo `<nombre-pagina>.tsx` en `src/routes`, donde la posición en el árbol de archivos representa la ruta
  3. Observa que se generan automáticamente un `Route` y `RouteComponent`. ¡Puedes empezar a construir tu página aquí!
</Steps>

#### Navegar entre páginas

Puedes usar el componente `Link` o el hook `useNavigate` para navegar entre páginas:

```tsx {1, 4, 8-9, 14}
import { Link, useNavigate } from '@tanstack/react-router';

export const MyComponent = () => {
  const navigate = useNavigate();

  const submit = async () => {
    const id = await ...
    // Usar `navigate` para redireccionar después de una acción asíncrona
    navigate({ to: '/products/$id', { params: { id }} });
  };

  return (
    <>
      <Link to="/products">Cancelar</Link>
      <Button onClick={submit}>Enviar</Button>
    </>
  )
};
```

Para más detalles, consulta la [documentación de TanStack Router](https://tanstack.com/router/latest/docs/framework/react/overview).

## Configuración en tiempo de ejecución

La configuración de tu infraestructura se provee al sitio web mediante Configuración en Tiempo de Ejecución. Esto permite acceder a detalles como URLs de API que no se conocen hasta el despliegue.

### Infraestructura

<Infrastructure>
<Fragment slot="cdk">
El construct `RuntimeConfig` de CDK puede usarse para añadir y recuperar configuración. Los constructs generados por generadores `@aws/nx-plugin` (como <Link path="guides/trpc">`ts#trpc-api`</Link> y <Link path="guides/fastapi">`py#fast-api`</Link>) añaden automáticamente valores al `RuntimeConfig`.

Tu construct CDK del sitio web desplegará la configuración como archivo `runtime-config.json` en la raíz de tu bucket S3.

```ts title="packages/infra/src/stacks/application-stack.ts" {9-12,14-15}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    // Añade automáticamente valores al RuntimeConfig
    new MyApi(this, 'MyApi', {
      integrations: MyApi.defaultIntegrations(this).build(),
    });

    // Despliega automáticamente la configuración en runtime-config.json
    new MyWebsite(this, 'MyWebsite');
  }
}
```

:::caution
Debes declarar tu sitio web _después_ de cualquier construct que añada al `RuntimeConfig`, de lo contrario faltarán en tu archivo `runtime-config.json`.
:::
</Fragment>
<Fragment slot="terraform">
Con Terraform, la configuración se gestiona mediante módulos runtime-config. Los módulos generados por `@aws/nx-plugin` (como <Link path="guides/trpc">`ts#trpc-api`</Link> y <Link path="guides/fastapi">`py#fast-api`</Link>) añaden automáticamente valores a la configuración.

Tu módulo Terraform del sitio web desplegará la configuración como archivo `runtime-config.json` en la raíz de tu bucket S3.

```hcl title="packages/infra/src/main.tf" {14-15}
# Añade valores a la configuración automáticamente
module "my_api" {
  source = "../../common/terraform/src/app/apis/my-api"
}

# Despliega la configuración en runtime-config.json
module "my_website" {
  source = "../../common/terraform/src/app/static-websites/my-website"

  providers = {
    aws.us_east_1 = aws.us_east_1
  }

  # Garantiza que la API se despliega primero
  depends_on = [module.my_api]
}
```

:::caution
Debes declarar tu módulo del sitio web _después_ de cualquier módulo que añada a la configuración y configurar `depends_on` apropiado, de lo contrario faltarán valores en `runtime-config.json`.
:::
</Fragment>
</Infrastructure>

### Código del sitio web

En tu sitio web, usa el hook `useRuntimeConfig` para obtener valores de la configuración:

```tsx {1,4}
import { useRuntimeConfig } from '../hooks/useRuntimeConfig';

const MyComponent = () => {
  const runtimeConfig = useRuntimeConfig();

  // Accede a los valores de la configuración aquí
  const apiUrl = runtimeConfig.apis.MyApi;
};
```

### Configuración local

Al ejecutar el [servidor de desarrollo local](#servidor-de-desarrollo-local), necesitarás un archivo `runtime-config.json` en tu directorio `public` para que el sitio local conozca las URLs del backend, configuración de identidad, etc.

Tu proyecto incluye un target `load:runtime-config` para descargar el archivo desde una aplicación desplegada:

<NxCommands commands={['run <my-website>:"load:runtime-config"']} />

:::note
<Infrastructure>
<Fragment slot="cdk">
Si cambias el prefijo de stages en `src/main.ts` de tu infraestructura, debes actualizar el target `load:runtime-config` en el `project.json` de tu sitio web.

Además, este target asume un único stage desplegado en el entorno con credenciales AWS. Debes ajustar el comando si despliegas múltiples stages en la misma cuenta/región.
</Fragment>
<Fragment slot="terraform">
Para proyectos Terraform, el target `load:runtime-config` copia el `runtime-config.json` creado tras el último `terraform apply` local.
</Fragment>
</Infrastructure>
:::

## Servidor de desarrollo local

Puedes ejecutar un servidor local usando los targets `serve` o `serve-local`.

### Target Serve

El target `serve` inicia un servidor de desarrollo local. Requiere tener desplegada cualquier infraestructura relacionada y haber [cargado la configuración local](#configuración-local).

Ejecútalo con:

<NxCommands commands={['run <my-website>:serve']} />

Útil para trabajar en cambios del sitio apuntando a APIs reales desplegadas.

### Target Serve Local

El target `serve-local` inicia un servidor local (con [Vite `MODE`](https://vite.dev/guide/env-and-mode) en `serve-local`) e inicia servidores locales para APIs conectadas mediante el generador <Link path="/guides/connection">API Connection</Link>.

En este modo, `runtime-config.json` se sobrescribe automáticamente para apuntar a URLs locales de APIs.

Ejecútalo con:

<NxCommands commands={['run <my-website>:serve-local']} />

Útil para desarrollo conjunto del sitio y API sin desplegar infraestructura.

:::warning
En este modo, si no hay `runtime-config.json` y usas Autenticación Cognito (via <Link path="/guides/react-website-auth">generador `ts#react-website#auth`</Link>), el login se omitirá y las peticiones no incluirán headers de autenticación.

Para habilitar login en `serve-local`, despliega tu infraestructura y carga la configuración.
:::

:::tip
Al ejecutar con `serve-local`, puedes especificar cualquier variable de entorno requerida por tus APIs para apuntar a otros recursos AWS desplegados, por ejemplo:

<NxCommands env={{DYNAMODB_TABLE_NAME: 'xxxxx'}} commands={['run <my-website>:serve-local']} />

Ten en cuenta que tus servidores locales de API se ejecutarán con las credenciales AWS que hayas configurado localmente.
:::

## Construcción

Construye tu sitio web con el target `build`. Esto crea un bundle de producción en `dist/packages/<my-website>/bundle` usando Vite, junto con verificación de tipos y linting.

<NxCommands commands={['run <my-website>:build']} />

## Pruebas

Las pruebas siguen estándares de proyectos TypeScript. Consulta la <Link path="guides/typescript-project#testing">guía de proyectos TypeScript</Link>.

Para pruebas específicas de React, React Testing Library está preinstalado. Consulta su [documentación](https://testing-library.com/docs/react-testing-library/example-intro).

Ejecuta pruebas con:

<NxCommands commands={['run <my-website>:test']} />

## Despliegue del sitio web

El generador crea infraestructura CDK o Terraform según tu `iacProvider`. Úsala para desplegar tu sitio.

<Infrastructure>
<Fragment slot="cdk">
Recomendamos usar el generador <Link path="guides/typescript-infrastructure">`ts#infra`</Link> para crear una aplicación CDK.

Usa el construct generado en `packages/common/constructs` para desplegar:

```ts title="packages/infra/src/stacks/application-stack.ts" {3, 9}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    new MyWebsite(this, 'MyWebsite');
  }
}
```

Esto configura:

1. Bucket S3 para alojar archivos estáticos
2. Distribución CloudFront para entrega global
3. Web ACL WAF para protección
4. Origin Access Control para acceso seguro
5. Despliegue automático de archivos y configuración
</Fragment>
<Fragment slot="terraform">
Recomendamos usar el generador <Link path="guides/terraform-infrastructure">`terraform#project`</Link> para crear un proyecto Terraform.

Usa el módulo generado en `packages/common/terraform` para desplegar:

```hcl title="packages/infra/src/main.tf" {3}
# Desplegar sitio web
module "my_website" {
  source = "../../common/terraform/src/app/static-websites/my-website"

  providers = {
    aws.us_east_1 = aws.us_east_1
  }
}
```

Esto configura:

1. Bucket S3 para archivos estáticos
2. Distribución CloudFront
3. Web ACL WAF (en us-east-1)
4. Origin Access Control
5. Despliegue automático de archivos y configuración

:::note
El provider `aws.us_east_1` es requerido para recursos CloudFront/WAF en us-east-1. Asegúrate de incluirlo:

```hcl title="packages/infra/src/providers.tf"
provider "aws" {
  alias  = "us_east_1"
  region = "us-east-1"
}
```
:::
</Fragment>
</Infrastructure>