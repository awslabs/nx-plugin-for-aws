---
title: "æ„å»ºUI"
description: "ä½¿ç”¨ @aws/nx-plugin æ„å»ºä»£ç†å¼AIé©±åŠ¨çš„åœ°ç‰¢å†’é™©æ¸¸æˆçš„æ¼”ç»ƒ"
---

import { Aside, Code, FileTree, Steps, Tabs, TabItem } from '@astrojs/starlight/components';
import { Image } from 'astro:assets';
import Drawer from '@components/drawer.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import InstallCommand from '@components/install-command.astro';
import E2ECode from '@components/e2e-code.astro';
import E2EDiff from '@components/e2e-diff.astro';

import dungeonAdventureArchitecturePng from '@assets/dungeon-game-architecture.png'
import dungeonAdventureErPng from '@assets/dungeon-adventure-er.png'
import baselineWebsitePng from '@assets/baseline-website.png'
import baselineGamePng from '@assets/baseline-game.png'
import nxGraphPng from '@assets/nx-graph.png'
import gameSelectPng from '@assets/game-select.png'
import gameConversationPng from '@assets/game-conversation.png'

## ä»»åŠ¡ä¸€ï¼šé…ç½®æœ¬åœ°å¼€å‘æœåŠ¡å™¨

è¦å¼€å§‹æ„å»ºç”¨æˆ·ç•Œé¢ï¼Œæˆ‘ä»¬éœ€è¦å°†æœ¬åœ°å¼€å‘æœåŠ¡å™¨é…ç½®æŒ‡å‘å·²éƒ¨ç½²çš„æ²™ç›’ç¯å¢ƒã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

<NxCommands commands={["run @dungeon-adventure/game-ui:load:runtime-config"]} />

è¯¥å‘½ä»¤å°†æ‹‰å–å·²éƒ¨ç½²çš„ `runtime-config.json` æ–‡ä»¶ï¼Œå¹¶å­˜å‚¨åœ¨æœ¬åœ° `packages/game-ui/public` ç›®å½•ä¸­ã€‚

è¦å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

<NxCommands commands={["run @dungeon-adventure/game-ui:serve"]} />

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æœ¬åœ°ç½‘ç«™ï¼Œç³»ç»Ÿå°†æç¤ºç™»å½•å¹¶æŒ‰ç…§æç¤ºåˆ›å»ºæ–°ç”¨æˆ·ã€‚å®Œæˆåï¼Œæ‚¨å°†çœ‹åˆ°åŸºç¡€ç½‘ç«™ç•Œé¢ï¼š

<Image src={baselineWebsitePng} alt="baseline-website.png" width="800" height="600" />

<Aside type="caution">
æˆ‘ä»¬å»ºè®®åœ¨æœ¬æ¨¡å—å‰©ä½™éƒ¨åˆ†ä¿æŒå¼€å‘æœåŠ¡å™¨è¿è¡Œï¼Œå› ä¸ºå®ƒä¼šè‡ªåŠ¨çƒ­é‡è½½æˆ‘ä»¬æ‰€åšçš„ä»»ä½•ä¿®æ”¹ã€‚
</Aside>

:::tip
æ‚¨ä¹Ÿå¯ä»¥è¿è¡Œ Nx å‘½ä»¤æ¥å¯åŠ¨æ‰€æœ‰å…³è”çš„ API æœ¬åœ°æœåŠ¡å™¨ï¼Œæ–¹ä¾¿æ‚¨åŒæ—¶è¿­ä»£ tRPC API å’Œç½‘ç«™ã€‚<NxCommands commands={["run @dungeon-adventure/game-ui:serve-local"]} /> 
:::

## ä»»åŠ¡äºŒï¼šåˆ›å»ºæ–°è·¯ç”± '/game'

è®©æˆ‘ä»¬é€šè¿‡åˆ›å»ºç±»å‹å®‰å…¨è·¯ç”±æ¥å±•ç¤º `@tanstack/react-router` çš„åŠŸèƒ½ã€‚
ä¸ºæ­¤ï¼Œåœ¨ä»¥ä¸‹ä½ç½®åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶ï¼š`packages/game-ui/src/routes/game/index.tsx`ã€‚æ‚¨ä¼šæ³¨æ„åˆ°æ–‡ä»¶ç«‹å³è¢«æ›´æ–°ã€‚

`@tanstack/react-router` ä¼šè‡ªåŠ¨é…ç½®æ–°è·¯ç”±ï¼Œæ‚¨åˆšåˆ›å»ºçš„æ–‡ä»¶å·²åŒ…å«è·¯ç”±è·¯å¾„å®šä¹‰ï¼š

```tsx
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/game/')({
  component: RouteComponent,
})

function RouteComponent() {
  return <div>Hello "/game/"!</div>
}
```

å¦‚æœæ‚¨è®¿é—® `http://localhost:4200/game`ï¼Œå°†çœ‹åˆ°æ–°é¡µé¢å·²è¢«æ¸²æŸ“ã€‚

<Image src={baselineGamePng} alt="baseline-game.png" width="800" height="600" />

æ›´æ–° `index.tsx` æ–‡ä»¶ä»¥é»˜è®¤åŠ è½½æ–°çš„ `/game` è·¯ç”±ã€‚å½“æ‚¨æ›´æ–° `to` å­—æ®µæ—¶ï¼Œç³»ç»Ÿä¼šæä¾›ç±»å‹å®‰å…¨çš„è·¯ç”±é€‰é¡¹åˆ—è¡¨ã€‚

<Tabs>
<TabItem label="routes/index.tsx">
<E2EDiff before="dungeon-adventure/4/routes/index.tsx.old.template" after="dungeon-adventure/4/routes/index.tsx.template" lang="tsx" />
</TabItem>
</Tabs>

æ‚¨å¯ä»¥åˆ é™¤ä¸å†éœ€è¦çš„ `packages/game-ui/src/routes/welcome/` ç›®å½•ã€‚

## ä»»åŠ¡ä¸‰ï¼šæ›´æ–°å¸ƒå±€

é»˜è®¤é…ç½®çš„å¸ƒå±€æ›´ç±»ä¼¼äº SaaS é£æ ¼çš„å•†ä¸šåº”ç”¨è€Œéæ¸¸æˆã€‚
è¦é‡æ–°é…ç½®å¸ƒå±€å¹¶å°†ä¸»é¢˜è°ƒæ•´ä¸ºæ›´åƒåœ°ç‰¢é£æ ¼çš„æ¸¸æˆï¼Œè¯·å¯¹ `packages/game-ui/src` è¿›è¡Œä»¥ä¸‹ä¿®æ”¹ï¼š

<Tabs>
<TabItem label="config.ts">
<E2EDiff before="dungeon-adventure/4/config.ts.old.template" after="dungeon-adventure/4/config.ts.template" lang="typescript" />
</TabItem>
<TabItem label="components/AppLayout/index.tsx">
<E2ECode path="dungeon-adventure/4/AppLayout/index.tsx.template" lang="tsx" />
</TabItem>
<TabItem label="styles.css">
<E2ECode path="dungeon-adventure/4/styles.css.template" lang="css" />
</TabItem>
</Tabs>

åˆ é™¤æœªä½¿ç”¨çš„ `packages/game-ui/src/hooks/useAppLayout.tsx` æ–‡ä»¶ã€‚

## ä»»åŠ¡å››ï¼šé›†æˆæ•…äº‹ä»£ç†

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé’©å­æ¥åˆå§‹åŒ–ä¸æ•…äº‹ä»£ç†äº¤äº’çš„å®¢æˆ·ç«¯ã€‚

<Tabs>
<TabItem label="hooks/useStoryAgent.tsx">
<E2ECode path="dungeon-adventure/4/hooks/useStoryAgent.tsx.template" lang="tsx" />
</TabItem>
</Tabs>

è¯¥é’©å­ï¼š

- ä» `runtime-config.json` è·å–ä»£ç† ARNï¼Œ
- æ ¹æ® ARN æ„å»º AgentCore Runtime è°ƒç”¨ URLï¼Œ
- ä½¿ç”¨å·²ç™»å½•ç”¨æˆ·çš„ JWT ä»¤ç‰Œå’Œéšæœºä¼šè¯ ID è°ƒç”¨ä»£ç†ï¼Œå¹¶
- è¿”å›ç”¨äºå¤„ç†æµå¼ä»£ç†æ¶ˆæ¯å—çš„å¼‚æ­¥è¿­ä»£å™¨ã€‚

:::tip
æ¸¸æˆ API é›†æˆå·²è‡ªåŠ¨é…ç½®ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº† `api-connection` ç”Ÿæˆå™¨ã€‚å¦‚æœæ‚¨å¸Œæœ›ä»£ç†ä¹Ÿæœ‰ç±»ä¼¼çš„ä½“éªŒï¼Œè¯·ä¸º[æ­¤ GitHub è®®é¢˜](https://github.com/awslabs/nx-plugin-for-aws/issues/326)ç‚¹èµã€‚
:::

## ä»»åŠ¡äº”ï¼šåˆ›å»ºæ¸¸æˆé¡µé¢

è¦åˆ›å»ºè°ƒç”¨ API å¹¶å®Œæˆæ¸¸æˆå®ç°çš„æ¸¸æˆé¡µé¢ï¼Œè¯·æ›´æ–° `packages/game-ui/src/routes/game` ä¸­çš„ä»¥ä¸‹æ–‡ä»¶ï¼š

<Tabs>
<TabItem label="index.tsx">
<E2ECode path="dungeon-adventure/4/routes/game/index.tsx.template" lang="tsx" />
</TabItem>
<TabItem label="$playerName.tsx">

<E2ECode path="dungeon-adventure/4/routes/game/$playerName.tsx.template" lang="tsx" />

<Aside type="tip">
`$playerName` è¯­æ³•å°†æŒ‡ç¤º `@tanstack/react-router` å°† `playerName` ä½œä¸º[è·¯å¾„å‚æ•°](https://tanstack.com/router/v1/docs/framework/react/guide/path-params)å¤„ç†ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å®ç°äº† `validateSearch` æ–¹æ³•ï¼Œç¡®ä¿ `genre` æŸ¥è¯¢å‚æ•°ä¸¥æ ¼ç±»å‹åŒ–ä¸ºæˆ‘ä»¬çš„ç±»å‹æšä¸¾ã€‚
</Aside>
</TabItem>
</Tabs>

å®Œæˆè¿™äº›ä¿®æ”¹åï¼Œæ‚¨çš„æœ¬åœ°å¼€å‘æœåŠ¡å™¨ï¼ˆhttp://localhost:4200/ï¼‰ç°åœ¨åº”è¯¥å·²å‡†å¤‡å¥½æ¸¸æˆä¾›æ‚¨æ¸¸ç©ã€‚

<Drawer title="æ„å»ºä¸éƒ¨ç½²" trigger="å¦‚æœæ‚¨æ„¿æ„ï¼Œä¹Ÿå¯ä»¥æ„å»ºå¹¶éƒ¨ç½²ä»£ç åˆ° Cloudfrontã€‚">

## ä»»åŠ¡å…­ï¼šæ„å»ºä¸éƒ¨ç½²

### æ„å»ºä»£ç 
è¦æ„å»ºä»£ç ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

<NxCommands commands={['run-many --target build --all']} />

### éƒ¨ç½²åº”ç”¨ç¨‹åº
è¦éƒ¨ç½²åº”ç”¨ç¨‹åºï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

<NxCommands commands={['run @dungeon-adventure/infra:deploy dungeon-adventure-infra-sandbox/*']} />

éƒ¨ç½²å®Œæˆåï¼Œè®¿é—®æ‚¨çš„ Cloudfront URLã€‚è¦æ‰¾åˆ°æ­¤ URLï¼Œè¯·æŸ¥çœ‹ CDK éƒ¨ç½²è¾“å‡ºã€‚

</Drawer>

<Image src={gameSelectPng} alt="game-select.png" width="500" height="400" />
<div style="margin-top: -100px; margin-left: 100px;">
<Image src={gameConversationPng} alt="game-conversation.png" width="500" height="400" />
</div>

æ­å–œæ‚¨ã€‚æ‚¨å·²æˆåŠŸæ„å»ºå¹¶éƒ¨ç½²æ™ºèƒ½åœ°ç‰¢å†’é™©æ¸¸æˆï¼ğŸ‰ğŸ‰ğŸ‰