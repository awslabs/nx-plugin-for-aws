---
title: "ä»£ç†å¼AIåœ°ç‰¢æ¸¸æˆ"
description: "ä½¿ç”¨ @aws/nx-plugin æ„å»ºä»£ç†å¼AIé©±åŠ¨çš„åœ°ç‰¢å†’é™©æ¸¸æˆçš„æ¼”ç»ƒ"
---



import { Aside, Code, FileTree, Steps, Tabs, TabItem } from '@astrojs/starlight/components';
import { Image } from 'astro:assets';
import Drawer from '@components/drawer.astro';
import Link from '@components/link.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import InstallCommand from '@components/install-command.astro';
import E2ECode from '@components/e2e-code.astro';
import E2EDiff from '@components/e2e-diff.astro';

import dungeonAdventureArchitecturePng from '@assets/dungeon-game-architecture.png'
import dungeonAdventureErPng from '@assets/dungeon-adventure-er.png'
import baselineWebsitePng from '@assets/baseline-website.png'
import baselineGamePng from '@assets/baseline-game.png'
import nxGraphPng from '@assets/nx-graph.png'
import gameSelectPng from '@assets/game-select.png'
import gameConversationPng from '@assets/game-conversation.png'

## æ¨¡å— 3ï¼šæ•…äº‹ä»£ç†å®ç°

<Aside type="caution">
è¯·ç¡®ä¿æ‚¨çš„ AWS è´¦æˆ·å·²æŒ‰ç…§[æœ¬æŒ‡å—](https://docs.aws.amazon.com/bedrock/latest/userguide/model-access-modify.html)æ‰€è¿°æ­¥éª¤ï¼Œåœ¨ç›®æ ‡åŒºåŸŸå¯ç”¨äº†å¯¹ Bedrock ä¸­[Strands é»˜è®¤æ¨¡å‹](https://strandsagents.com/latest/documentation/docs/user-guide/concepts/model-providers/amazon-bedrock/)çš„è®¿é—®ã€‚æœ¬æ–‡æ’°å†™æ—¶ä½¿ç”¨çš„æ¨¡å‹æ˜¯ Anthropic Claude Sonnet 4ã€‚
</Aside>

æ•…äº‹ä»£ç†æ˜¯ä¸€ä¸ª [Strands](https://strandsagents.com/) ä»£ç†ï¼Œå®ƒåŸºäºç»™å®šçš„ `Game` å’Œ `Action` åˆ—è¡¨ä½œä¸ºä¸Šä¸‹æ–‡æ¥æ¨è¿›æ•…äº‹æƒ…èŠ‚ã€‚æˆ‘ä»¬å°†é…ç½®è¯¥ä»£ç†ä¸åº“å­˜ç®¡ç†æœåŠ¡å™¨ï¼ˆMCP Serverï¼‰äº¤äº’ï¼Œç®¡ç†ç©å®¶å¯ç”¨ç‰©å“ã€‚

:::note
ä¸ºç®€åŒ–æ•™ç¨‹ï¼Œæˆ‘ä»¬ä»¥"æ— çŠ¶æ€"æ–¹å¼å®ç°ä»£ç†ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½æ˜¯åŒ…å«å®Œæ•´æ¶ˆæ¯å†å²çš„ç‹¬ç«‹ä¼šè¯ã€‚ç”Ÿäº§ç¯å¢ƒä¸­å»ºè®®é›†æˆ [Bedrock AgentCore Memory](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/memory.html)ã€‚å…³äºåœ¨ Strands ä¸­ä½¿ç”¨ AgentCore Memory çš„æ›´å¤šæ–‡æ¡£[å¯åœ¨æ­¤å¤„è·å–](https://github.com/aws/bedrock-agentcore-sdk-python/tree/main/src/bedrock_agentcore/memory/integrations/strands)ã€‚
:::

### ä»£ç†å®ç°

è®©æˆ‘ä»¬å®ç°ä»£ç†ã€‚æ›´æ–° `packages/story/dungeon_adventure_story/agent` ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼š

<Tabs>
  <TabItem label="main.py">
<E2ECode lang="python" path="dungeon-adventure/3/main.py.template" />
  </TabItem>
  <TabItem label="agent.py">
<E2ECode lang="python" path="dungeon-adventure/3/agent.py.template" />
  </TabItem>
</Tabs>

æ­¤é…ç½®å®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼š
- ä»ä»£ç†è´Ÿè½½ä¸­æå–ç©å®¶ä¿¡æ¯ã€æ•…äº‹ç±»å‹å’ŒåŠ¨ä½œ
- æ„å»ºä½¿ç”¨ SigV4 è®¤è¯è°ƒç”¨ MCP æœåŠ¡å™¨çš„å®¢æˆ·ç«¯
- é€šè¿‡ç³»ç»Ÿæç¤ºå’Œ MCP æœåŠ¡å™¨å·¥å…·æ„å»ºä»£ç†

### éƒ¨ç½²ä¸æµ‹è¯•

é¦–å…ˆæ„å»ºä»£ç åº“ï¼š

<NxCommands commands={['run-many --target build --all']} />

<Aside type="tip">
è‹¥é‡åˆ° lint é”™è¯¯ï¼Œå¯è¿è¡Œä»¥ä¸‹å‘½ä»¤è‡ªåŠ¨ä¿®å¤ï¼š

<NxCommands commands={['run-many --target lint --configuration=fix --all']} />
</Aside>

è¿è¡Œä»¥ä¸‹å‘½ä»¤éƒ¨ç½²åº”ç”¨ï¼š

<NxCommands commands={['deploy infra dungeon-adventure-infra-sandbox/*']} />

éƒ¨ç½²è¿‡ç¨‹çº¦éœ€ 2 åˆ†é’Ÿã€‚

éƒ¨ç½²å®Œæˆåå°†çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼ˆéƒ¨åˆ†å€¼å·²è„±æ•ï¼‰ï¼š

```bash
dungeon-adventure-infra-sandbox-Application
dungeon-adventure-infra-sandbox-Application: deploying... [2/2]

 âœ…  dungeon-adventure-infra-sandbox-Application

âœ¨  éƒ¨ç½²æ—¶é—´: 354s

è¾“å‡º:
dungeon-adventure-infra-sandbox-Application.ElectroDbTableTableNameXXX = dungeon-adventure-infra-sandbox-Application-ElectroDbTableXXX-YYY
dungeon-adventure-infra-sandbox-Application.GameApiEndpointXXX = https://xxx.execute-api.region.amazonaws.com/prod/
dungeon-adventure-infra-sandbox-Application.GameUIDistributionDomainNameXXX = xxx.cloudfront.net
dungeon-adventure-infra-sandbox-Application.InventoryMcpArn = arn:aws:bedrock-agentcore:region:xxxxxxx:runtime/dungeonadventureventoryMcpServerXXXX-YYYY
dungeon-adventure-infra-sandbox-Application.StoryAgentArn = arn:aws:bedrock-agentcore:region:xxxxxxx:runtime/dungeonadventurecationStoryAgentXXXX-YYYY
dungeon-adventure-infra-sandbox-Application.UserIdentityUserIdentityIdentityPoolIdXXX = region:xxx
dungeon-adventure-infra-sandbox-Application.UserIdentityUserIdentityUserPoolIdXXX = region_xxx
```

å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼æµ‹è¯• APIï¼š
<ul>
<li>å¯åŠ¨ä»£ç†æœåŠ¡å™¨æœ¬åœ°å®ä¾‹å¹¶ä½¿ç”¨ `curl` è°ƒç”¨</li>
<li>ä½¿ç”¨å¸¦ JWT ä»¤ç‰Œçš„ curl è°ƒç”¨å·²éƒ¨ç½² API</li>
</ul>

<Tabs>
  <TabItem label="æœ¬åœ°æµ‹è¯•">
  è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœ¬åœ°ä»£ç†æœåŠ¡å™¨ï¼š
    <NxCommands highlights={['arn:aws:bedrock-agentcore:region:xxxxxxx:runtime/dungeonadventureventoryMcpServerXXXX-YYYY', 'region']} env={{PORT: '9999', INVENTORY_MCP_ARN:"arn:aws:bedrock-agentcore:region:xxxxxxx:runtime/dungeonadventureventoryMcpServerXXXX-YYYY", AWS_REGION: '<region>'}} commands={["run dungeon_adventure.story:agent-serve"]} />

    :::caution
    è¯·ä½¿ç”¨ CDK éƒ¨ç½²è¾“å‡ºçš„ `InventoryMcpArn` å¹¶æŒ‡å®šç›®æ ‡ `AWS_REGION`ã€‚
    :::

    ä»£ç†æœåŠ¡å™¨å¯åŠ¨åï¼ˆæ— è¾“å‡ºæ˜¾ç¤ºï¼‰ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤è°ƒç”¨ï¼š

    ```bash
    curl -N -X POST http://127.0.0.1:9999/invocations \
      -d '{"genre":"superhero", "actions":[], "playerName":"UnnamedHero"}' \
      -H "Content-Type: application/json" \
      -H "X-Amzn-Bedrock-AgentCore-Runtime-Session-Id: abcdefghijklmnopqrstuvwxyz-123456789"
    ```
  </TabItem>
  <TabItem label="äº‘ç«¯æµ‹è¯•">
    æµ‹è¯•å·²éƒ¨ç½²ä»£ç†éœ€é€šè¿‡ Cognito è®¤è¯è·å– JWT ä»¤ç‰Œã€‚é¦–å…ˆè®¾ç½®ç¯å¢ƒå˜é‡ï¼š

    ```bash
    # ä» CDK è¾“å‡ºè·å– Cognito ç”¨æˆ·æ±  ID å’Œå®¢æˆ·ç«¯ ID
    export POOL_ID="<CDK è¾“å‡ºçš„ UserPoolId>"
    export CLIENT_ID="<CDK è¾“å‡ºçš„ UserPoolClientId>"
    export REGION="<æ‚¨çš„åŒºåŸŸ>"
    ```

    åˆ›å»ºæµ‹è¯•ç”¨æˆ·å¹¶è·å–è®¤è¯ä»¤ç‰Œï¼š

    ```bash
    # åˆ›å»ºç”¨æˆ·
    aws cognito-idp admin-create-user \
      --user-pool-id $POOL_ID \
      --username "testuser" \
      --temporary-password "TempPass123!" \
      --region $REGION \
      --message-action SUPPRESS > /dev/null

    # è®¾ç½®æ°¸ä¹…å¯†ç ï¼ˆè¯·æ›¿æ¢ä¸ºæ›´å®‰å…¨çš„å¯†ç ï¼ï¼‰
    aws cognito-idp admin-set-user-password \
      --user-pool-id $POOL_ID \
      --username "testuser" \
      --password "PermanentPass123!" \
      --region $REGION \
      --permanent > /dev/null

    # ç”¨æˆ·è®¤è¯å¹¶è·å– ID ä»¤ç‰Œ
    export BEARER_TOKEN=$(aws cognito-idp initiate-auth \
      --client-id "$CLIENT_ID" \
      --auth-flow USER_PASSWORD_AUTH \
      --auth-parameters USERNAME='testuser',PASSWORD='PermanentPass123!' \
      --region $REGION | jq -r '.AuthenticationResult.IdToken')
    ```

    :::caution
    ä½¿ç”¨ CDK è¾“å‡ºçš„ `UserIdentityUserIdentityUserPoolIdXXX` ä½œä¸º `POOL_ID`ï¼Œå¹¶ç¡®ä¿ä½¿ç”¨å¯¹åº”çš„å®¢æˆ·ç«¯ IDã€‚
    :::

    è°ƒç”¨å·²éƒ¨ç½²ä»£ç†ï¼š

    ```bash
    # è®¾ç½® CDK è¾“å‡ºçš„ Story Agent ARN
    export AGENT_ARN="<CDK è¾“å‡ºçš„ StoryAgentArn>"

    # URL ç¼–ç  ARN
    export ENCODED_ARN=$(echo $AGENT_ARN | sed 's/:/%3A/g' | sed 's/\//%2F/g')

    # æ„é€ è°ƒç”¨ URL
    export MCP_URL="https://bedrock-agentcore.$REGION.amazonaws.com/runtimes/$ENCODED_ARN/invocations?qualifier=DEFAULT"

    # è°ƒç”¨ä»£ç†
    curl -N -X POST "$MCP_URL" \
      -H "authorization: Bearer $BEARER_TOKEN" \
      -H "Content-Type: application/json" \
      -H "X-Amzn-Bedrock-AgentCore-Runtime-Session-Id: abcdefghijklmnopqrstuvwxyz-123456789" \
      -d '{"genre":"superhero", "actions":[], "playerName":"UnnamedHero"}'
    ```

    :::note
    URL ç¼–ç æ˜¯æ­£ç¡®æ ¼å¼åŒ– Bedrock AgentCore API ç«¯ç‚¹ ARN çš„å¿…è¦æ­¥éª¤ã€‚
    :::
  </TabItem>
</Tabs>

æˆåŠŸæ‰§è¡Œå‘½ä»¤åï¼Œå°†çœ‹åˆ°ç±»ä¼¼äº‹ä»¶æµï¼š

```
data: {"init_event_loop": true}

data: {"start": true}

data: {"start_event_loop": true}

data: {"event": {"messageStart": {"role": "assistant"}}}

data: {"event": {"contentBlockDelta": {"delta": {"text": "Welcome"}, "contentBlockIndex": 0}}}

...
```

æ­å–œï¼æ‚¨å·²æˆåŠŸåœ¨ Bedrock AgentCore Runtime ä¸Šæ„å»ºå¹¶éƒ¨ç½²é¦–ä¸ª Strands ä»£ç†ï¼ğŸ‰ğŸ‰ğŸ‰