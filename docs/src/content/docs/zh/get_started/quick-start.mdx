---
title: "快速入门指南"
description: "关于如何使用 @aws/nx-plugin 的快速入门。"
---



import { Steps } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import Snippet from '@components/snippet.astro';
import CreateNxWorkspaceCommand from '@components/create-nx-workspace-command.astro';
import InstallCommand from '@components/install-command.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';

本指南将带您了解如何安装和使用 `@aws/nx-plugin` 快速构建 AWS 项目的核心流程。

:::tip
如需构建全栈应用的深度教程，请参考<Link path="get_started/tutorials/dungeon-game/overview">地下城冒险教程</Link>。
:::

## 前置条件

开始前请安装以下全局依赖：

<Snippet name="prerequisites" />

## 步骤一：初始化新 Nx 工作区

使用您选择的包管理器创建 Nx 工作区：

<CreateNxWorkspaceCommand workspace="my-project" />

进入项目目录：

```sh
cd my-project
```

## 步骤二：添加 AWS 的 Nx 插件

使用包管理器安装插件：

<InstallCommand dev pkg="@aws/nx-plugin" />

## 步骤三：使用生成器搭建项目

本快速入门指南将演示如何为项目添加 tRPC API、React 网站、Cognito 身份验证和 CDK 基础设施。您可以根据实际需求选择任意组合的生成器来初始化项目。完整选项列表请参阅左侧导航栏的 __指南__ 部分。

### 添加 tRPC API

<RunGenerator generator="ts#trpc-api" requiredParameters={{ apiName: 'demo-api' }} />

这将在 `packages/demo-api` 目录下创建 API。

### 添加 React 网站

<RunGenerator generator="ts#cloudscape-website" requiredParameters={{ name: 'demo-website' }} />

这将在 `packages/demo-website` 目录下创建 React 网站脚手架。

### 添加 Cognito 身份验证

<RunGenerator generator="ts#cloudscape-website#auth" requiredParameters={{ project: '@my-project/demo-website', cognitoDomain: 'my-demo' }} />

这将设置必要的 AWS 基础设施和 React 代码，为网站添加 Cognito 身份验证功能。

### 连接前后端

<RunGenerator generator="api-connection" requiredParameters={{ sourceProject: '@my-project/demo-website', targetProject: '@my-project/demo-api-backend' }} />

这将配置必要的提供程序，确保网站可以调用 tRPC API。

### 添加 CDK 基础设施

<RunGenerator generator="ts#infra" requiredParameters={{ name: 'infra' }} />

这将配置一个 CDK App，用于在 AWS 上部署基础设施。

## 步骤四：定义云资源并部署到 AWS

打开 `packages/infra/src/stacks/application-stack.ts` 并添加以下代码：

```typescript
import * as cdk from 'aws-cdk-lib';
import { DemoApi, DemoWebsite, UserIdentity } from ':my-project/common-constructs';
import { Construct } from 'constructs';

export class ApplicationStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    const identity = new UserIdentity(this, 'identity');
    const api = new DemoApi(this, 'api');
    api.grantInvokeAccess(identity.identityPool.authenticatedRole);

    new DemoWebsite(this, 'website');
  }
}
```
__注意__：这是我们部署全栈应用所需的全部 CDK 代码。

### 构建并部署基础设施

运行以下命令构建项目：

<NxCommands commands={['run-many --target build --all']} />

:::tip
若遇到 lint 错误，运行以下命令自动修复：

<NxCommands commands={['run-many --target lint --configuration=fix --all']} />
:::

## 步骤五：本地运行前端

<Steps>
1. 获取 `runtime-config.json` 文件

    <NxCommands commands={['run @demo/demo-website:load:runtime-config']} />

2. 启动本地 Web 服务

    <NxCommands commands={['run @demo/demo-website:serve']} />
</Steps>

您可以在浏览器中通过 `http://localhost:4200` 预览网站。

---

恭喜！🎉 您已成功使用 `@aws/nx-plugin` 构建并部署全栈应用！