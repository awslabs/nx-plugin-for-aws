---
title: "快速入门指南"
description: "关于如何使用 @aws/nx-plugin 的快速入门。"
---



import { Steps } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import Snippet from '@components/snippet.astro';
import CreateNxWorkspaceCommand from '@components/create-nx-workspace-command.astro';
import InstallCommand from '@components/install-command.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';

本指南将引导您完成安装和使用 `@aws/nx-plugin` 在 AWS 上快速构建项目的基础知识。

:::tip
如需更深入的完整应用构建教程，请查看<Link path="get_started/tutorials/dungeon-game/overview">地牢冒险教程</Link>。
:::

## 前置条件

开始前需要安装以下全局依赖项：

<Snippet name="prerequisites" />

## 步骤 1：初始化新的 Nx 工作区

运行以下命令使用您选择的包管理器创建 Nx 工作区：

<CreateNxWorkspaceCommand workspace="my-project" />

完成后进入项目目录：

```sh
cd my-project
```

## 步骤 2：使用生成器快速搭建项目

本快速入门指南将添加 tRPC API、React 网站、Cognito 身份验证和 CDK 基础设施。根据您构建的项目类型，可以选择任意组合的生成器快速启动项目。查看左侧导航栏中的 __指南__ 查看完整选项列表。

### 添加 tRPC API

<RunGenerator generator="ts#trpc-api" requiredParameters={{ name: 'demo-api', auth: 'IAM' }} />

这将在 `packages/demo-api` 目录下创建 API。

### 添加 React 网站

<RunGenerator generator="ts#react-website" requiredParameters={{ name: 'demo-website' }} />

这将在 `packages/demo-website` 目录下生成新的 React 网站。

### 添加 Cognito 身份验证

<RunGenerator generator="ts#react-website#auth" requiredParameters={{ project: '@my-project/demo-website', cognitoDomain: 'my-demo' }} />

这将设置必要的基础设施和 React 代码，为您的网站添加 Cognito 身份验证。

### 连接前端与后端

<RunGenerator generator="api-connection" requiredParameters={{ sourceProject: '@my-project/demo-website', targetProject: '@my-project/demo-api' }} />

这将配置必要的提供程序，确保您的网站可以调用 tRPC API。

### 添加 CDK 基础设施

<RunGenerator generator="ts#infra" requiredParameters={{ name: 'infra' }} />

这将配置一个 CDK 应用，用于在 AWS 上部署基础设施。

## 步骤 3：本地运行网站和 API

使用以下命令启动网站及其连接 API 的本地开发服务器：

<NxCommands commands={['run demo-website:serve-local']} />

您的网站将在 `http://localhost:4200` 可用。

对网站和 API 的更改将实时反映，因为本地网站和 API 服务器都会热重载。

## 步骤 4：定义云资源并部署到 AWS

打开 `packages/infra/src/stacks/application-stack.ts` 并添加以下代码：

```typescript
import * as cdk from 'aws-cdk-lib';
import { DemoApi, DemoWebsite, UserIdentity } from ':my-project/common-constructs';
import { Construct } from 'constructs';

export class ApplicationStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    const identity = new UserIdentity(this, 'identity');
    const api = new DemoApi(this, 'api', {
      integrations: DemoApi.defaultIntegrations(this).build(),
    });
    api.grantInvokeAccess(identity.identityPool.authenticatedRole);

    new DemoWebsite(this, 'website');
  }
}
```

这就是部署全栈应用所需的所有 CDK 代码。

### 构建并部署基础设施

接下来运行以下命令构建项目：

<NxCommands commands={['run-many --target build --all']} />

:::tip
如果遇到 lint 错误，可以运行以下命令自动修复：

<NxCommands commands={['run-many --target lint --configuration=fix --all']} />
:::

运行以下命令部署项目：

<NxCommands commands={['run infra:deploy my-project-sandbox/*']} />

:::tip
您需要确保 AWS 环境已为 CDK 正确引导。

CDK 引导需要在目标部署 AWS 区域和 `us-east-1` 区域完成，以允许部署网站的 AWS WAF WebACL。

<NxCommands commands={['run infra:bootstrap']} />
:::

## 步骤 5：测试已部署云资源的网站

<Steps>
1. 获取 `runtime-config.json` 文件：

    <NxCommands commands={['run demo-website:load:runtime-config']} />

2. 启动本地网站服务器

    <NxCommands commands={['run demo-website:serve']} />
</Steps>

您的网站将在 `http://localhost:4200` 可用，并将指向已部署的 API 和身份验证资源。

---

恭喜！🎉 您已成功使用 `@aws/nx-plugin` 构建并部署了一个全栈应用！