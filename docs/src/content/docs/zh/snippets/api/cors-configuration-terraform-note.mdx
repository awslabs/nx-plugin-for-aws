---
title: "CORS 配置 Terraform"
---

import Link from '@components/link.astro';

:::note
如果您的解决方案包含 Terraform 网站模块，那么您可以使用其 CloudFront 域名来限制 CORS。
给定一个 CloudFront 域名 `<domain_name>`，在用于部署 API 的 Terraform 模块中添加
- 对于 HTTP API，添加一个 `cors_allow_origins` 属性，设置为 `["http://localhost:4200", "http://localhost:4300", "https://<domain name>"]`。这会将 API 网关 CORS 限制为此分发和本地主机。
- 对于 REST API，添加一个 `ALLOWED_ORIGINS` 环境变量，设置为 `"https://<domain_name>"`。这会将 CloudFront 分发设置为 AWS Lambda 集成中唯一允许的 CORS 源（除本地主机外）。请注意，此限制不适用于预检 OPTIONS 请求 - 请为 [this GitHub issue](https://github.com/awslabs/nx-plugin-for-aws/issues/377) 点赞以帮助优先解决此问题。

```hcl {4,7}
module "my_api" {
  source = "../../common/terraform/src/app/apis/my-api"

  cors_allow_origins = ["http://localhost:4200", "http://localhost:4300", "https://<domain name>"] // Only required for HTTP API

  env = {
    ALLOWED_ORIGINS = "https://<domain name>" // Only required for REST API
    ENVIRONMENT = var.environment
    LOG_LEVEL   = "INFO"
  }
}
```
`MyWebsite` 构造可以使用 <Link path="/guides/react-website">`ts#react-website` 生成器</Link>生成
:::