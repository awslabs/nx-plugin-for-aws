---
title: "MCP基岩部署"
---



import Link from '@components/link.astro'

### CDK 构造体

如果为 `computeType` 选择了 `BedrockAgentCoreRuntime`，系统会生成一个 CDK 构造体，可用于将 MCP 服务器部署到 [Amazon Bedrock AgentCore Runtime](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/agents-tools-runtime.html)。

CDK 构造体名称基于运行生成器时选择的 `name`，默认格式为 `<ProjectName>McpServer`。

您可以在 CDK 应用程序中使用该 CDK 构造体：

```ts {6}
import { MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    // 将 MCP 服务器添加到您的堆栈
    new MyProjectMcpServer(this, 'MyProjectMcpServer');
  }
}
```

:::caution
构建和部署 MCP 服务器需要 [Docker](https://www.docker.com/)。请确保已安装并启动 Docker 以避免出现以下错误：

```
ERROR: Cannot connect to the Docker daemon at unix://path/to/docker.sock.
```
:::

### 身份验证

#### IAM

默认情况下，您的 MCP 服务器将使用 IAM 身份验证进行保护，直接部署时不需任何参数：

```ts {5}
import { MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    new MyProjectMcpServer(this, 'MyProjectMcpServer');
  }
}
```

您可以通过 `grantInvoke` 方法授予调用 Bedrock AgentCore Runtime 上 MCP 的权限。例如，您可能希望使用 <Link path="/guides/py-strands-agent">`py#strands-agent`</Link> 生成器创建的代理调用 MCP 服务器：

```ts {8}
import { MyProjectAgent, MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    const agent = new MyProjectAgent(this, 'MyProjectAgent');
    const mcpServer = new MyProjectMcpServer(this, 'MyProjectMcpServer');

    mcpServer.agentCoreRuntime.grantInvoke(agent.agentCoreRuntime);
  }
}
```

#### Cognito JWT 身份验证

要配置 JWT 身份验证，可以向 MCP 服务器构造体传递 `authorizerConfiguration` 属性。以下示例配置了 Cognito 用户池和客户端来保护 MCP 服务器：

```ts {14-17}
import { MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    const userPool = new UserPool(this, 'UserPool');
    const client = userPool.addClient('Client', {
      authFlows: {
        userPassword: true,
      },
    });

    new MyProjectMcpServer(this, 'MyProjectMcpServer', {
      authorizerConfiguration: {
        customJWTAuthorizer: {
          discoveryUrl: `https://cognito-idp.${Stack.of(userPool).region}.amazonaws.com/${userPool.userPoolId}/.well-known/openid-configuration`,
          allowedClients: [client.userPoolClientId],
        },
      },
    });
  }
}
```