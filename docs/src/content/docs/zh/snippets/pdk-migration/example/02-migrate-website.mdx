---
title: "迁移网站"
---

import { Steps, Tabs, TabItem } from '@astrojs/starlight/components';
import CreateNxWorkspaceCommand from '@components/create-nx-workspace-command.astro';
import RunGenerator from '@components/run-generator.astro';
import Link from '@components/link.astro';
import NxCommands from '@components/nx-commands.astro';
import Drawer from '@components/drawer.astro';
import InstallCommand from '@components/install-command.astro';

购物清单应用中使用的`CloudscapeReactTsWebsiteProject`配置了一个内置CloudScape和Cognito身份验证的React网站。

该项目类型基于现已弃用的[`create-react-app`](https://github.com/facebook/create-react-app)。在本迁移指南中，我们将使用<Link path="/guides/react-website">`ts#react-website`生成器</Link>，它采用了更现代且受支持的技术栈——[Vite](https://vite.dev/)。

作为迁移的一部分，我们还将从PDK配置的React Router迁移到[TanStack Router](https://tanstack.com/router)，这将为网站路由增加额外的类型安全性。

#### 生成React网站

运行<Link path="/guides/react-website">`ts#react-website`生成器</Link>在`packages/website`目录下创建网站项目：

<RunGenerator generator="ts#react-website" noInteractive requiredParameters={{ name: 'website' }} />

#### 添加Cognito身份验证

上述React网站生成器默认不包含Cognito身份验证（与`CloudscapeReactTsWebsiteProject`不同），需要通过<Link path="/guides/react-website-auth">`ts#react-website#auth`生成器</Link>显式添加：

<RunGenerator generator="ts#react-website#auth" noInteractive requiredParameters={{ project: 'website', cognitoDomain: 'shopping-list' }} />

这会添加管理重定向逻辑的React组件以确保用户通过Cognito托管UI登录，同时在`packages/common/constructs`目录下添加名为`UserIdentity`的CDK构造用于部署Cognito资源。

:::note
PDK的`CloudscapeReactTsWebsiteProject`依赖`@aws-northstar/ui`提供应用内Cognito登录组件。若希望继续使用此方式而非托管UI，可将生成的`packages/common/constructs/src/core/user-identity.ts`替换为[PDK实现](https://github.com/aws/aws-pdk/blob/mainline/packages/identity/src/user-identity.ts)，将`@aws-cdk/aws-cognito-identitypool-alpha`的构造替换为`aws-cdk-lib`提供的版本，并确保在`RuntimeConfig`中设置相关值：

```ts
RuntimeConfig.ensure(this).config = {
  ...RuntimeConfig.ensure(this).config,
  region: Stack.of(this).region,
  identityPoolId: this.identityPool.identityPoolId,
  userPoolId: this.userPool.userPoolId,
  userPoolWebClientId: this.userPoolClient.userPoolClientId,
};
```

之后可复用`CloudscapeReactTsWebsiteProject`中的`Auth`组件。
:::

#### 连接网站与API

在PDK中，通过传递项目实例来触发集成代码生成。在Nx Plugin for AWS中，API集成通过<Link path="/guides/connection">`connection`生成器</Link>实现。运行以下命令使网站能够调用Smithy API：

<RunGenerator generator="connection" noInteractive requiredParameters={{ sourceProject: 'website', targetProject: 'api' }} />

这将生成必要的客户端提供程序与构建目标，使网站可以通过生成的TypeScript客户端调用API。

#### 添加AWS Northstar依赖

由于`CloudscapeReactTsWebsiteProject`自动包含`@aws-northstar/ui`依赖，需手动添加：

<InstallCommand pkg="@aws-northstar/ui" />

#### 迁移组件与页面

[购物清单应用](https://aws.github.io/aws-pdk/getting_started/shopping_list_app.html#create-new-pages-components)包含`CreateItem`组件及`ShoppingList`、`ShoppingLists`两个页面。迁移时需调整以适应TanStack Router和Nx Plugin for AWS的TypeScript客户端代码生成。

<Steps>

1. 将PDK项目中的`packages/website/src/components/CreateItem/index.tsx`复制到新项目相同位置

1. 将`packages/website/src/pages/ShoppingLists/index.tsx`复制为`packages/website/src/routes/index.tsx`（因`ShoppingLists`是首页且使用文件路由）

1. 将`packages/website/src/pages/ShoppingList/index.tsx`复制为`packages/website/src/routes/$shoppingListId.tsx`（对应`/:shoppingListId`路由）

</Steps>

迁移后IDE中可能出现构建错误，需进行后续调整。

#### 从React Router迁移到TanStack Router

使用[文件路由](https://tanstack.com/router/latest/docs/framework/react/routing/file-based-routing)时，可通过本地开发服务器自动生成路由配置。启动本地网站服务：

<NxCommands commands={["serve-local website"]} />

:::tip
`serve-local`目标会同时启动通过`connection`连接的API本地服务，并在网站、模型或后端变更时热重载！这使得我们无需编写CDK代码即可本地测试API与网站。
:::

服务启动后（网站端口`4200`，Smithy API端口`3001`），按以下步骤迁移路由：

<Steps>

1. 添加`createFileRoute`注册路由：

    <Tabs>
    <TabItem label="routes/index.tsx">
    ```diff lang="ts"
    +import { createFileRoute } from "@tanstack/react-router";
    ...
    -export default ShoppingLists;
    +export const Route = createFileRoute('/')({
    +  component: ShoppingLists,
    +});
    ```
    </TabItem>
    <TabItem label="routes/$shoppingListId.tsx">
    ```diff lang="ts"
    +import { createFileRoute } from "@tanstack/react-router";
    ...
    -export default ShoppingList;
    +export const Route = createFileRoute('/$shoppingListId')({
    +  component: ShoppingList,
    +});
    ```
    </TabItem>
    </Tabs>

    保存文件后，`createFileRoute`调用的类型错误将消失。

1. 替换`useNavigate`钩子。

    更新导入：

    ```diff lang="ts"
    - import { useNavigate } from 'react-router-dom';
    + import { useNavigate } from '@tanstack/react-router';
    ```

    更新`navigate`方法调用（由`useNavigate`返回）以传入类型安全的路由：

    ```diff lang="ts"
    - navigate(`/${cell.shoppingListId}`);
    + navigate({
    +   to: '/$shoppingListId',
    +   params: { shoppingListId: cell.shoppingListId },
    + });
    ```

1. 替换`useParams`钩子。

    移除导入：

    ```diff lang="ts"
    - import { useParams } from 'react-router-dom';
    ```

    使用上面创建的`Route`提供的钩子更新`useParams`调用。现在这些都是类型安全的！

    ```diff lang="ts"
    - const { shoppingListId } = useParams();
    + const { shoppingListId } = Route.useParams();
    ```

</Steps>

:::tip
对于更复杂的场景，可查看[TanStack Router文档中的详细指南](https://tanstack.com/router/latest/docs/framework/react/migrate-from-react-router)以获取更深入的信息。
:::

#### 修复组件导入

由于路由文件在文件树中的嵌套层级不如PDK项目深，需要修复`routes/index.tsx`和`routes/$shoppingListId.tsx`中`CreateItem`的导入：

```diff lang="ts"
-import CreateItem from "../../components/CreateItem";
+import CreateItem from "../components/CreateItem";
```

`AppLayoutContext`在新项目中的位置也略有不同：

```diff lang="ts"
-import { AppLayoutContext } from "../../layouts/App";
+import { AppLayoutContext } from "../components/AppLayout";
```

#### 迁移至新生成的TypeScript客户端

我们越来越接近了！接下来，需要迁移到Nx Plugin for AWS生成的TypeScript客户端，相比Type Safe API有一些改进。按照以下步骤操作：

<Steps>

1. 导入新生成的客户端和类型而非旧的，例如：

    ```diff lang="ts"
    -import {
    -  ShoppingList,
    -  usePutShoppingList,
    -  useDeleteShoppingList,
    -  useGetShoppingLists,
    -} from "myapi-typescript-react-query-hooks";
    +import { ShoppingList } from "../generated/my-api/types.gen";
    +import { useMyApi } from "../hooks/useMyApi";
    +import { useInfiniteQuery, useMutation } from "@tanstack/react-query";
    ```

    注意`routes/$shoppingListId.tsx`将`ShoppingList`类型导入为`_ShoppingList` - 在该文件中应该同样操作，但从`types.gen`导入。

    另外注意我们直接从`@tanstack/react-query`导入相关钩子，因为生成的客户端提供生成TanStack query钩子选项的方法，而不是钩子包装器。

1. 实例化新的TanStack Query钩子，例如：

    ```diff lang="ts"
    -const getShoppingLists = useGetShoppingLists({ pageSize: PAGE_SIZE });
    -const putShoppingList = usePutShoppingList();
    -const deleteShoppingList = useDeleteShoppingList();
    +const api = useMyApi();
    +const getShoppingLists = useInfiniteQuery(
    +  api.getShoppingLists.infiniteQueryOptions(
    +    { pageSize: PAGE_SIZE },
    +    { getNextPageParam: (p) => p.nextToken },
    +  ),
    +);
    +const putShoppingList = useMutation(api.putShoppingList.mutationOptions());
    +const deleteShoppingList = useMutation(
    +  api.deleteShoppingList.mutationOptions(),
    +);
    ```

1. 移除请求体中接受参数的操作调用的`<operation>RequestContent`包装器：

    ```diff lang="ts"
    await putShoppingList.mutateAsync({
    -  putShoppingListRequestContent: {
        name: item,
    -  },
    });
    ```

</Steps>

:::note
购物清单应用的`pages/ShoppingList/index.tsx`中还有一个小bug，没有正确使用可选链。让我们也修复它以避免最终构建时的lint错误：

```diff lang="ts"
const shoppingList: _ShoppingList | undefined =
-    getShoppingLists.data?.pages[0].shoppingLists[0]!;
+    getShoppingLists.data?.pages?.[0]?.shoppingLists?.[0];
```

同样更新假定其已定义的引用：

```diff lang="ts"
-name: shoppingList.name,
-shoppingListId: shoppingList.shoppingListId,
+name: shoppingList?.name ?? 'my list',
+shoppingListId: shoppingList?.shoppingListId,
```
:::

#### 从TanStack Query v4迁移至v5

由于PDK使用的TanStack Query v4与`connection`生成器添加的v5之间的差异，还需要修复一些错误：

<Steps>

1. 将mutation的`isLoading`替换为`isPending`，例如：

    ```diff lang="ts"
    -putShoppingList.isLoading
    +putShoppingList.isPending
    ```

1. 购物清单应用使用了`@aws-northstar/ui`的`InfiniteQueryTable`，它期望TanStack Query v4的类型。这实际上也适用于v5的无限查询，因此我们可以直接抑制类型错误：

    ```diff lang="tsx"
    <InfiniteQueryTable
    -  query={getShoppingLists}
    +  query={getShoppingLists as any}
    ```

</Steps>

:::tip
TanStack Query文档有一个[详细的迁移指南](https://tanstack.com/query/latest/docs/framework/react/guides/migrating-to-v5)，如果您使用了该库的更多特性，可以参考。
:::

#### 访问本地网站

现在可以访问本地网站：http://localhost:4200/

由于所有内容都已迁移，网站应该可以加载了！因为购物清单应用除了API、网站和身份验证外，仅依赖DynamoDB表 - 如果您在区域内有一个名为`shopping_list`的DynamoDB表，并且本地AWS凭证可以访问它，网站将完全可用！

如果没有，没关系，我们接下来将迁移基础设施。

<Drawer title="购物清单页面迁移" trigger="点击此处查看教程中两个购物清单页面的完整迁移前后示例">

<h4>购物清单列表页</h4>

<Tabs syncKey="pdk-migration">
<TabItem label="迁移前">
```tsx
// pages/ShoppingLists/index.tsx
/* eslint-disable @typescript-eslint/no-floating-promises */
import { InfiniteQueryTable } from "@aws-northstar/ui/components";
import {
  Button,
  Header,
  Link,
  SpaceBetween,
  TableProps,
} from "@cloudscape-design/components";
import {
  ShoppingList,
  usePutShoppingList,
  useDeleteShoppingList,
  useGetShoppingLists,
} from "myapi-typescript-react-query-hooks";
import { useContext, useEffect, useMemo, useState } from "react";
import { useNavigate } from "react-router-dom";
import CreateItem from "../../components/CreateItem";
import { AppLayoutContext } from "../../layouts/App";

const PAGE_SIZE = 50;

/**
 * Component to render the ShoppingLists "/" route.
 */
const ShoppingLists: React.FC = () => {
  const [visibleModal, setVisibleModal] = useState(false);
  const [selectedShoppingList, setSelectedShoppingList] = useState<
    ShoppingList[]
  >([]);
  const getShoppingLists = useGetShoppingLists({ pageSize: PAGE_SIZE });
  const putShoppingList = usePutShoppingList();
  const deleteShoppingList = useDeleteShoppingList();
  const navigate = useNavigate();
  const { setAppLayoutProps } = useContext(AppLayoutContext);

  useEffect(() => {
    setAppLayoutProps({
      contentType: "table",
    });
  }, [setAppLayoutProps]);

  const columnDefinitions = useMemo<
    TableProps.ColumnDefinition<ShoppingList>[]
  >(
    () => [
      {
        id: "shoppingListId",
        isRowHeader: true,
        header: "Shopping List Id",
        cell: (cell) => (
          <Link
            href={`/${cell.shoppingListId}`}
            onFollow={(e) => {
              e.preventDefault();
              navigate(`/${cell.shoppingListId}`);
            }}
          >
            {cell.shoppingListId}
          </Link>
        ),
      },
      {
        id: "name",
        header: "Name",
        cell: (cell) => cell.name,
      },
      {
        id: "shoppingItems",
        header: "Shopping Items",
        cell: (cell) => `${cell.shoppingItems?.length || 0} Items.`,
      },
    ],
    [navigate],
  );

  return (
    <>
      <CreateItem
        title="Create Shopping List"
        callback={async (item) => {
          await putShoppingList.mutateAsync({
            putShoppingListRequestContent: {
              name: item,
            },
          });
          getShoppingLists.refetch();
        }}
        isLoading={putShoppingList.isLoading}
        visibleModal={visibleModal}
        setVisibleModal={setVisibleModal}
      />
      <InfiniteQueryTable
        query={getShoppingLists}
        itemsKey="shoppingLists"
        pageSize={PAGE_SIZE}
        selectionType="single"
        stickyHeader={true}
        selectedItems={selectedShoppingList}
        onSelectionChange={(e) =>
          setSelectedShoppingList(e.detail.selectedItems)
        }
        header={
          <Header
            variant="awsui-h1-sticky"
            actions={
              <SpaceBetween size="xs" direction="horizontal">
                <Button
                  loading={deleteShoppingList.isLoading}
                  data-testid="header-btn-delete"
                  disabled={selectedShoppingList.length === 0}
                  onClick={async () => {
                    await deleteShoppingList.mutateAsync({
                      shoppingListId: selectedShoppingList![0].shoppingListId,
                    });
                    setSelectedShoppingList([]);
                    getShoppingLists.refetch();
                  }}
                >
                  Delete
                </Button>
                <Button
                  data-testid="header-btn-create"
                  variant="primary"
                  onClick={() => setVisibleModal(true)}
                >
                  Create Shopping List
                </Button>
              </SpaceBetween>
            }
          >
            Shopping Lists
          </Header>
        }
        variant="full-page"
        columnDefinitions={columnDefinitions}
      />
    </>
  );
};

export default ShoppingLists;
```
</TabItem>
<TabItem label="迁移后">
```tsx
// routes/index.tsx
/* eslint-disable @typescript-eslint/no-floating-promises */
import { InfiniteQueryTable } from "@aws-northstar/ui/components";
import {
  Button,
  Header,
  Link,
  SpaceBetween,
  TableProps,
} from "@cloudscape-design/components";
import { useContext, useEffect, useMemo, useState } from "react";
import { useNavigate } from "@tanstack/react-router";
import CreateItem from "../components/CreateItem";
import { AppLayoutContext } from "../components/AppLayout";
import { createFileRoute } from "@tanstack/react-router";
import { ShoppingList } from "../generated/my-api/types.gen";
import { useMyApi } from "../hooks/useMyApi";
import { useInfiniteQuery, useMutation } from "@tanstack/react-query";

const PAGE_SIZE = 50;

/**
 * Component to render the ShoppingLists "/" route.
 */
const ShoppingLists: React.FC = () => {
  const [visibleModal, setVisibleModal] = useState(false);
  const [selectedShoppingList, setSelectedShoppingList] = useState<
    ShoppingList[]
  >([]);
  const api = useMyApi();
  const getShoppingLists = useInfiniteQuery(
    api.getShoppingLists.infiniteQueryOptions(
      { pageSize: PAGE_SIZE },
      { getNextPageParam: (res) => res.nextToken },
    ),
  );
  const putShoppingList = useMutation(api.putShoppingList.mutationOptions());
  const deleteShoppingList = useMutation(
    api.deleteShoppingList.mutationOptions(),
  );
  const navigate = useNavigate();
  const { setAppLayoutProps } = useContext(AppLayoutContext);

  useEffect(() => {
    setAppLayoutProps({
      contentType: "table",
    });
  }, [setAppLayoutProps]);

  const columnDefinitions = useMemo<
    TableProps.ColumnDefinition<ShoppingList>[]
  >(
    () => [
      {
        id: "shoppingListId",
        isRowHeader: true,
        header: "Shopping List Id",
        cell: (cell) => (
          <Link
            href={`/${cell.shoppingListId}`}
            onFollow={(e) => {
              e.preventDefault();
              navigate({
  to: '/$shoppingListId',
  params: { shoppingListId: cell.shoppingListId },
});
            }}
          >
            {cell.shoppingListId}
          </Link>
        ),
      },
      {
        id: "name",
        header: "Name",
        cell: (cell) => cell.name,
      },
      {
        id: "shoppingItems",
        header: "Shopping Items",
        cell: (cell) => `${cell.shoppingItems?.length || 0} Items.`,
      },
    ],
    [navigate],
  );

  return (
    <>
      <CreateItem
        title="Create Shopping List"
        callback={async (item) => {
          await putShoppingList.mutateAsync({
              name: item,
          });
          getShoppingLists.refetch();
        }}
        isLoading={putShoppingList.isPending}
        visibleModal={visibleModal}
        setVisibleModal={setVisibleModal}
      />
      <InfiniteQueryTable
        query={getShoppingLists as any}
        itemsKey="shoppingLists"
        pageSize={PAGE_SIZE}
        selectionType="single"
        stickyHeader={true}
        selectedItems={selectedShoppingList}
        onSelectionChange={(e) =>
          setSelectedShoppingList(e.detail.selectedItems)
        }
        header={
          <Header
            variant="awsui-h1-sticky"
            actions={
              <SpaceBetween size="xs" direction="horizontal">
                <Button
                  loading={deleteShoppingList.isPending}
                  data-testid="header-btn-delete"
                  disabled={selectedShoppingList.length === 0}
                  onClick={async () => {
                    await deleteShoppingList.mutateAsync({
                      shoppingListId: selectedShoppingList![0].shoppingListId,
                    });
                    setSelectedShoppingList([]);
                    getShoppingLists.refetch();
                  }}
                >
                  Delete
                </Button>
                <Button
                  data-testid="header-btn-create"
                  variant="primary"
                  onClick={() => setVisibleModal(true)}
                >
                  Create Shopping List
                </Button>
              </SpaceBetween>
            }
          >
            Shopping Lists
          </Header>
        }
        variant="full-page"
        columnDefinitions={columnDefinitions}
      />
    </>
  );
};

export const Route = createFileRoute('/')({
  component: ShoppingLists,
});
```
</TabItem>
</Tabs>

<h4>单个购物清单页</h4>

<Tabs syncKey="pdk-migration">
<TabItem label="迁移前">
```tsx
// pages/ShoppingList/index.tsx
/* eslint-disable @typescript-eslint/no-floating-promises */
import {
  Board,
  BoardItem,
  BoardProps,
} from "@cloudscape-design/board-components";
import {
  Button,
  Container,
  ContentLayout,
  Header,
  SpaceBetween,
  Spinner,
} from "@cloudscape-design/components";
import {
  ShoppingList as _ShoppingList,
  usePutShoppingList,
  useGetShoppingLists,
} from "myapi-typescript-react-query-hooks";
import { useEffect, useState } from "react";
import { useParams } from "react-router-dom";
import CreateItem from "../../components/CreateItem";

type ListItem = { name: string };

/**
 * Component to render a singular Shopping List "/:shoppingListId" route.
 */
const ShoppingList: React.FC = () => {
  const { shoppingListId } = useParams();
  const [visibleModal, setVisibleModal] = useState(false);
  const getShoppingLists = useGetShoppingLists({ shoppingListId });
  const putShoppingList = usePutShoppingList();
  const shoppingList: _ShoppingList | undefined =
    getShoppingLists.data?.pages[0].shoppingLists[0]!;
  const [shoppingItems, setShoppingItems] =
    useState<BoardProps.Item<ListItem>[]>();

  useEffect(() => {
    setShoppingItems(
      shoppingList?.shoppingItems?.map((i) => ({
        id: i,
        definition: { minColumnSpan: 4 },
        data: { name: i },
      })),
    );
  }, [shoppingList?.shoppingItems]);

  return (
    <ContentLayout
      header={
        <Header
          variant="awsui-h1-sticky"
          actions={
            <SpaceBetween size="xs" direction="horizontal">
              <Button
                data-testid="header-btn-create"
                variant="primary"
                onClick={() => setVisibleModal(true)}
              >
                Add Item
              </Button>
            </SpaceBetween>
          }
        >
          Shopping list: {shoppingList?.name}
        </Header>
      }
    >
      <CreateItem
        isLoading={false}
        title="Add Item"
        callback={async (item) => {
          const items = [
            ...(shoppingItems || []),
            {
              id: item,
              definition: { minColumnSpan: 4 },
              data: { name: item },
            },
          ];
          setShoppingItems(items);
          putShoppingList.mutate({
            putShoppingListRequestContent: {
              name: shoppingList.name,
              shoppingListId: shoppingList.shoppingListId,
              shoppingItems: items.map((i) => i.data.name),
            },
          });
        }}
        visibleModal={visibleModal}
        setVisibleModal={setVisibleModal}
      />
      <Container>
        {!shoppingList ? (
          <Spinner />
        ) : (
          <Board<ListItem>
            onItemsChange={(event) => {
              const items = event.detail.items as BoardProps.Item<ListItem>[];
              setShoppingItems(items);
              putShoppingList.mutate({
                putShoppingListRequestContent: {
                  name: shoppingList.name,
                  shoppingListId: shoppingList.shoppingListId,
                  shoppingItems: items.map((i) => i.data.name),
                },
              });
            }}
            items={shoppingItems || []}
            renderItem={(item, actions) => (
              <BoardItem
                header={item.data.name}
                settings={
                  <Button
                    iconName="close"
                    variant="icon"
                    onClick={actions.removeItem}
                  />
                }
                i18nStrings={{
                  dragHandleAriaLabel: "Drag handle",
                  dragHandleAriaDescription:
                    "Use Space or Enter to activate drag, arrow keys to move, Space or Enter to submit, or Escape to discard.",
                  resizeHandleAriaLabel: "Resize handle",
                  resizeHandleAriaDescription:
                    "Use Space or Enter to activate resize, arrow keys to move, Space or Enter to submit, or Escape to discard.",
                }}
              />
            )}
            i18nStrings={{
              liveAnnouncementDndCommitted: () => "",
              liveAnnouncementDndDiscarded: () => "",
              liveAnnouncementDndItemInserted: () => "",
              liveAnnouncementDndItemReordered: () => "",
              liveAnnouncementDndItemResized: () => "",
              liveAnnouncementDndStarted: () => "",
              liveAnnouncementItemRemoved: () => "",
              navigationAriaLabel: "",
              navigationItemAriaLabel: () => "",
            }}
            empty={<></>}
          />
        )}
      </Container>
    </ContentLayout>
  );
};

export default ShoppingList;
```
</TabItem>
<TabItem label="迁移后">
```tsx
// routes/$shoppingListId.tsx
/* eslint-disable @typescript-eslint/no-floating-promises */
import {
  Board,
  BoardItem,
  BoardProps,
} from "@cloudscape-design/board-components";
import {
  Button,
  Container,
  ContentLayout,
  Header,
  SpaceBetween,
  Spinner,
} from "@cloudscape-design/components";
import { useEffect, useState } from "react";
import CreateItem from "../components/CreateItem";
import { createFileRoute } from "@tanstack/react-router";
import { useMyApi } from "../hooks/useMyApi";
import { useInfiniteQuery, useMutation } from "@tanstack/react-query";
import { ShoppingList as _ShoppingList } from "../generated/my-api/types.gen";

type ListItem = { name: string };

/**
 * Component to render a singular Shopping List "/:shoppingListId" route.
 */
const ShoppingList: React.FC = () => {
  const { shoppingListId } = Route.useParams();
  const [visibleModal, setVisibleModal] = useState(false);
  const api = useMyApi();
  const getShoppingLists = useInfiniteQuery(
    api.getShoppingLists.infiniteQueryOptions(
      { shoppingListId },
      { getNextPageParam: (p) => p.nextToken },
    ),
  );
  const putShoppingList = useMutation(api.putShoppingList.mutationOptions());
  const shoppingList: _ShoppingList | undefined =
    getShoppingLists.data?.pages?.[0]?.shoppingLists?.[0];
  const [shoppingItems, setShoppingItems] =
    useState<BoardProps.Item<ListItem>[]>();

  useEffect(() => {
    setShoppingItems(
      shoppingList?.shoppingItems?.map((i) => ({
        id: i,
        definition: { minColumnSpan: 4 },
        data: { name: i },
      })),
    );
  }, [shoppingList?.shoppingItems]);

  return (
    <ContentLayout
      header={
        <Header
          variant="awsui-h1-sticky"
          actions={
            <SpaceBetween size="xs" direction="horizontal">
              <Button
                data-testid="header-btn-create"
                variant="primary"
                onClick={() => setVisibleModal(true)}
              >
                Add Item
              </Button>
            </SpaceBetween>
          }
        >
          Shopping list: {shoppingList?.name}
        </Header>
      }
    >
      <CreateItem
        isLoading={false}
        title="Add Item"
        callback={async (item) => {
          const items = [
            ...(shoppingItems || []),
            {
              id: item,
              definition: { minColumnSpan: 4 },
              data: { name: item },
            },
          ];
          setShoppingItems(items);
          putShoppingList.mutate({
              name: shoppingList?.name ?? 'my list',
              shoppingListId: shoppingList?.shoppingListId,
              shoppingItems: items.map((i) => i.data.name),
          });
        }}
        visibleModal={visibleModal}
        setVisibleModal={setVisibleModal}
      />
      <Container>
        {!shoppingList ? (
          <Spinner />
        ) : (
          <Board<ListItem>
            onItemsChange={(event) => {
              const items = event.detail.items as BoardProps.Item<ListItem>[];
              setShoppingItems(items);
              putShoppingList.mutate({
                  name: shoppingList.name,
                  shoppingListId: shoppingList.shoppingListId,
                  shoppingItems: items.map((i) => i.data.name),
              });
            }}
            items={shoppingItems || []}
            renderItem={(item, actions) => (
              <BoardItem
                header={item.data.name}
                settings={
                  <Button
                    iconName="close"
                    variant="icon"
                    onClick={actions.removeItem}
                  />
                }
                i18nStrings={{
                  dragHandleAriaLabel: "Drag handle",
                  dragHandleAriaDescription:
                    "Use Space or Enter to activate drag, arrow keys to move, Space or Enter to submit, or Escape to discard.",
                  resizeHandleAriaLabel: "Resize handle",
                  resizeHandleAriaDescription:
                    "Use Space or Enter to activate resize, arrow keys to move, Space or Enter to submit, or Escape to discard.",
                }}
              />
            )}
            i18nStrings={{
              liveAnnouncementDndCommitted: () => "",
              liveAnnouncementDndDiscarded: () => "",
              liveAnnouncementDndItemInserted: () => "",
              liveAnnouncementDndItemReordered: () => "",
              liveAnnouncementDndItemResized: () => "",
              liveAnnouncementDndStarted: () => "",
              liveAnnouncementItemRemoved: () => "",
              navigationAriaLabel: "",
              navigationItemAriaLabel: () => "",
            }}
            empty={<></>}
          />
        )}
      </Container>
    </ContentLayout>
  );
};

export const Route = createFileRoute('/$shoppingListId')({
  component: ShoppingList,
});
```
</TabItem>
</Tabs>

</Drawer>