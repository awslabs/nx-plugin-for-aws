---
title: "éƒ¨ç½²"
---



import { Steps, Tabs, TabItem } from '@astrojs/starlight/components';
import CreateNxWorkspaceCommand from '@components/create-nx-workspace-command.astro';
import RunGenerator from '@components/run-generator.astro';
import Link from '@components/link.astro';
import NxCommands from '@components/nx-commands.astro';
import Drawer from '@components/drawer.astro';
import InstallCommand from '@components/install-command.astro';

ç°åœ¨æˆ‘ä»¬å·²ç»å®Œæˆäº†ä»£ç åº“çš„å®Œå…¨è¿ç§»ï¼Œæ¥ä¸‹æ¥å¯ä»¥ç€æ‰‹éƒ¨ç½²ã€‚æ­¤æ—¶æœ‰ä¸¤ç§è·¯å¾„å¯ä¾›é€‰æ‹©ã€‚

#### å…¨æ–°èµ„æºï¼ˆç®€å•æ–¹æ¡ˆï¼‰

æœ€ç®€å•çš„å¤„ç†æ–¹å¼æ˜¯å°†å…¶è§†ä¸ºä¸€ä¸ªå…¨æ–°çš„åº”ç”¨ï¼Œå³é€šè¿‡å…¨æ–°çš„ DynamoDB è¡¨å’Œ Cognito ç”¨æˆ·æ± "é‡æ–°å¼€å§‹"â€”â€”ä½†ä¼šä¸¢å¤±æ‰€æœ‰ç”¨æˆ·åŠå…¶è´­ç‰©æ¸…å•ã€‚é‡‡ç”¨æ­¤æ–¹æ¡ˆåªéœ€ï¼š

<Steps>

1. åˆ é™¤åä¸º `shopping_list` çš„ DynamoDB è¡¨

1. éƒ¨ç½²æ–°åº”ç”¨ï¼š

    <NxCommands commands={["deploy infra shopping-list-infra-sandbox/*"]} />

</Steps>

ğŸ‰ å¤§åŠŸå‘Šæˆï¼ğŸ‰

#### æ— ä¸­æ–­è¿ç§»ç°æœ‰æœ‰çŠ¶æ€èµ„æºï¼ˆå¤æ‚æ–¹æ¡ˆï¼‰

å®é™…åœºæ™¯ä¸­ï¼Œæ›´å¯èƒ½éœ€è¦å°†ç°æœ‰ AWS èµ„æºè¿ç§»è‡³æ–°ä»£ç åº“ç®¡ç†ï¼ŒåŒæ—¶é¿å…ç”¨æˆ·æœåŠ¡ä¸­æ–­ã€‚

:::danger
æ­¤æ–¹æ¡ˆæ¶‰åŠè¾ƒå¤šç»†èŠ‚ä¸”å¤æ‚åº¦è¾ƒé«˜ï¼Œç”±äºæœ¬æ–‡ä»…ä¸ºç¤ºä¾‹ï¼Œå¼ºçƒˆå»ºè®®åœ¨éç”Ÿäº§ç¯å¢ƒï¼ˆæœ€å¥½æ–°å»ºæ²™ç›’ç¯å¢ƒï¼‰ä¸­æ¼”ç»ƒï¼Œå¹¶ä¸ºå…·ä½“åº”ç”¨è®°å½•è¯¦ç»†æ­¥éª¤ã€‚åŒæ—¶åº”åˆ¶å®šåº”æ€¥å›æ»šè®¡åˆ’ä»¥åº”å¯¹æ­¥éª¤å¤±è´¥æˆ–æ„å¤–ç»“æœã€‚
:::

:::note
æˆ‘ä»¬çš„ PDK è´­ç‰©æ¸…å•åº”ç”¨æœªé…ç½®è‡ªå®šä¹‰åŸŸåæˆ– DNSã€‚å®é™…åº”ç”¨ä¸­é€šå¸¸éœ€è¦ä¸ºç½‘ç«™å’Œ API é…ç½®åŸŸåã€‚æœ¬èŠ‚æŒ‡å—å‡è®¾å·²é€šè¿‡ Route53 ä¸ºç½‘ç«™å’Œ API è®¾ç½®è‡ªå®šä¹‰ DNSã€‚
:::

å¯¹äºè´­ç‰©æ¸…å•åº”ç”¨ï¼Œéœ€é‡ç‚¹å…³æ³¨çš„æœ‰çŠ¶æ€èµ„æºæ˜¯å­˜å‚¨ç”¨æˆ·è´­ç‰©æ¸…å•çš„ DynamoDB è¡¨å’ŒåŒ…å«æ³¨å†Œç”¨æˆ·ä¿¡æ¯çš„ Cognito ç”¨æˆ·æ± ã€‚æˆ‘ä»¬çš„æ ¸å¿ƒç­–ç•¥æ˜¯ä¿ç•™è¿™ä¸¤ä¸ªå…³é”®èµ„æºå¹¶å°†å…¶è¿ç§»è‡³æ–°å †æ ˆç®¡ç†ï¼Œç„¶åæ›´æ–° DNS æŒ‡å‘æ–°ç½‘ç«™ï¼ˆåŠé¢å‘å®¢æˆ·çš„ APIï¼‰ã€‚

<Steps>

1. æ›´æ–°æ–°åº”ç”¨ä»¥å¼•ç”¨éœ€ä¿ç•™çš„ç°æœ‰èµ„æº

    é’ˆå¯¹è´­ç‰©æ¸…å•åº”ç”¨çš„ DynamoDB è¡¨ï¼š

    ```diff lang="ts"
    // constructs/database.ts
    -this.shoppingListTable = new Table(this, 'ShoppingList', {
    -  ...
    +this.shoppingListTable = Table.fromTableName(
    +  this,
    +  'ShoppingList',
    +  'shopping_list',
    +);
    ```

    é’ˆå¯¹ Cognito ç”¨æˆ·æ± ï¼š

    ```diff lang="ts"
    // packages/common/constructs/src/core/user-identity.ts
    -this.userPool = this.createUserPool();
    +this.userPool = UserPool.fromUserPoolId(
    +  this,
    +  'UserPool',
    +  '<your-user-pool-id>',
    +);
    ```

1. æ„å»ºå¹¶éƒ¨ç½²æ–°åº”ç”¨ï¼š

    <NxCommands commands={["run-many --target build"]} />

    <NxCommands commands={["deploy infra shopping-list-infra-sandbox/*"]} />

    æ­¤æ—¶æ–°åº”ç”¨å·²éƒ¨ç½²å®Œæˆï¼Œå¼•ç”¨ç°æœ‰èµ„æºä½†å°šæœªæ¥æ”¶æµé‡ã€‚

1. æ‰§è¡Œå®Œæ•´é›†æˆæµ‹è¯•ç¡®ä¿æ–°åº”ç”¨åŠŸèƒ½æ­£å¸¸ã€‚å¯¹äºè´­ç‰©æ¸…å•åº”ç”¨ï¼Œéœ€éªŒè¯ç™»å½•åŠè´­ç‰©æ¸…å•çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½ã€‚

1. è¿˜åŸæ–°åº”ç”¨ä¸­å¼•ç”¨ç°æœ‰èµ„æºçš„ä¿®æ”¹ï¼ˆæš‚ä¸éƒ¨ç½²ï¼‰ï¼š

    ```diff lang="ts"
    // constructs/database.ts
    +this.shoppingListTable = new Table(this, 'ShoppingList', {
    +  ...
    -this.shoppingListTable = Table.fromTableName(
    -  this,
    -  'ShoppingList',
    -  'shopping_list',
    -);
    ```

    é’ˆå¯¹ Cognito ç”¨æˆ·æ± ï¼š

    ```diff lang="ts"
    // packages/common/constructs/src/core/user-identity.ts
    +this.userPool = this.createUserPool();
    -this.userPool = UserPool.fromUserPoolId(
    -  this,
    -  'UserPool',
    -  '<your-user-pool-id>',
    -);
    ```

    éšåæ‰§è¡Œæ„å»ºï¼š

    <NxCommands commands={["run-many --target build"]} />

1. åœ¨æ–°åº”ç”¨çš„ `packages/infra` ç›®å½•æ‰§è¡Œ `cdk import` æŸ¥çœ‹éœ€å¯¼å…¥çš„èµ„æºï¼š

    ```bash title="æ–°åº”ç”¨"
    cd packages/infra
    pnpm exec cdk import shopping-list-infra-sandbox/Application --force
    ```

    æŒ‰å›è½¦é€æ­¥ç¡®è®¤ã€‚ç”±äºèµ„æºä»ç”±æ—§å †æ ˆç®¡ç†ï¼Œå¯¼å…¥ä¼šå¤±è´¥â€”â€”è¿™ç¬¦åˆé¢„æœŸï¼Œæ­¤æ­¥éª¤ä»…ç”¨äºç¡®è®¤éœ€ä¿ç•™çš„èµ„æºã€‚è¾“å‡ºç¤ºä¾‹å¦‚ä¸‹ï¼š

    ```bash wrap
    shopping-list-infra-sandbox/Application/ApplicationUserIdentity/UserPool/smsRole/Resource (AWS::IAM::Role): è¾“å…¥ RoleNameï¼ˆç•™ç©ºè·³è¿‡ï¼‰
    shopping-list-infra-sandbox/Application/ApplicationUserIdentity/UserPool/Resource (AWS::Cognito::UserPool): è¾“å…¥ UserPoolIdï¼ˆç•™ç©ºè·³è¿‡ï¼‰
    shopping-list-infra-sandbox/Application/Database/ShoppingList/Resource (AWS::DynamoDB::Table): ä½¿ç”¨ TableName=shopping_list å¯¼å…¥ (y/n) y
    ```

    è¿™è¡¨æ˜å®é™…éœ€å¯¼å…¥ 3 ä¸ªèµ„æºè‡³æ–°å †æ ˆã€‚

1. æ›´æ–°æ—§ PDK é¡¹ç›®ï¼Œä¸ºä¸Šæ­¥å‘ç°çš„èµ„æºè®¾ç½® `RemovalPolicy` ä¸º `RETAIN`ã€‚å½“å‰ DynamoDB è¡¨å’Œç”¨æˆ·æ± é»˜è®¤ä¿ç•™ç­–ç•¥ï¼Œä½†éœ€ä¸ºå‘ç°çš„ SMS è§’è‰²æ›´æ–°ç­–ç•¥ï¼š

    ```diff lang="ts"
    // application-stack.ts
    const userIdentity = new UserIdentity(this, `${id}UserIdentity`, {
      userPool,
    });

    +const smsRole = userIdentity.userPool.node.findAll().filter(
    +  c => CfnResource.isCfnResource(c) &&
    +    c.node.path.includes('/smsRole/'))[0] as CfnResource;
    +smsRole.applyRemovalPolicy(RemovalPolicy.RETAIN);
    ```

1. éƒ¨ç½² PDK é¡¹ç›®ä»¥åº”ç”¨ä¿ç•™ç­–ç•¥ï¼š

    ```bash title="PDK åº”ç”¨"
    cd packages/infra
    npx projen deploy
    ```

1. æŸ¥çœ‹ CloudFormation æ§åˆ¶å°ï¼Œè®°å½• `cdk import` æ­¥éª¤æç¤ºçš„ä¿¡æ¯ï¼š

    1. ç”¨æˆ·æ±  IDï¼Œå¦‚ `us-west-2_XXXXX`
    2. SMS è§’è‰²åç§°ï¼Œå¦‚ `infra-sandbox-UserIdentityUserPoolsmsRoleXXXXXX`

1. æ›´æ–° PDK é¡¹ç›®ä»¥å¼•ç”¨ç°æœ‰èµ„æºï¼š

    ```diff lang="ts"
    // constructs/database.ts
    -this.shoppingListTable = new Table(this, 'ShoppingList', {
    -  ...
    +this.shoppingListTable = Table.fromTableName(
    +  this,
    +  'ShoppingList',
    +  'shopping_list',
    +);
    ```

    é’ˆå¯¹ Cognito ç”¨æˆ·æ± ï¼š

    ```diff lang="ts"
    // application-stack.ts
    +const userPool = UserPool.fromUserPoolId(
    +  this,
    +  'UserPool',
    +  '<your-user-pool-id>',
    +);
    const userIdentity = new UserIdentity(this, `${id}UserIdentity`, {
    +  // PDK æ„é€ æ¥å— UserPool è€Œé IUserPoolï¼Œæ­¤å¤„ä»æœ‰æ•ˆï¼
    +  userPool: userPool as any,
    });
    ```

1. å†æ¬¡éƒ¨ç½² PDK é¡¹ç›®ï¼Œä½¿èµ„æºè„±ç¦»åŸ CloudFormation å †æ ˆç®¡ç†ï¼š

    ```bash title="PDK åº”ç”¨"
    cd packages/infra
    npx projen deploy
    ```

1. èµ„æºè§£é™¤æ‰˜ç®¡åï¼Œåœ¨æ–°åº”ç”¨ä¸­æ‰§è¡Œ `cdk import` å®Œæˆå®é™…å¯¼å…¥ï¼š

    ```bash title="æ–°åº”ç”¨"
    cd packages/infra
    pnpm exec cdk import shopping-list-infra-sandbox/Application --force
    ```

    è¾“å…¥è®°å½•çš„å€¼ï¼Œå¯¼å…¥åº”æˆåŠŸå®Œæˆã€‚

1. å†æ¬¡éƒ¨ç½²æ–°åº”ç”¨ä»¥ç¡®ä¿å¯¹ç°æœ‰èµ„æºï¼ˆç°ç”±æ–°å †æ ˆç®¡ç†ï¼‰çš„å˜æ›´ç”Ÿæ•ˆï¼š

    <NxCommands commands={["deploy infra shopping-list-infra-sandbox/*"]} />

1. å†æ¬¡å…¨é¢æµ‹è¯•æ–°åº”ç”¨

1. æ›´æ–° DNS è®°å½•æŒ‡å‘æ–°ç½‘ç«™ï¼ˆåŠ API å¦‚éœ€è¦ï¼‰

    å»ºè®®é‡‡ç”¨ Route53 [åŠ æƒè·¯ç”±](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/routing-policy-weighted.html)é€æ­¥åˆ‡æ¢æµé‡ã€‚åˆå§‹é˜¶æ®µå°†éƒ¨åˆ†è¯·æ±‚å¯¼å‘æ–°åº”ç”¨ï¼Œé€šè¿‡ç›‘æ§æŒ‡æ ‡é€æ­¥å¢åŠ æ–°åº”ç”¨æƒé‡ï¼Œç›´è‡³æ—§ PDK åº”ç”¨æ— æµé‡ã€‚

    è‹¥æœªé…ç½® DNS ä¸”ä½¿ç”¨è‡ªåŠ¨ç”ŸæˆåŸŸåï¼Œå¯é€šè¿‡ [CloudFront HTTP æºç«™](https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_cloudfront_origins-readme.html#from-an-http-endpoint)æˆ– [API Gateway HTTP é›†æˆ](https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigateway.HttpIntegration.html)ä»£ç†è¯·æ±‚ã€‚

1. ç›‘æ§ PDK åº”ç”¨æŒ‡æ ‡ç¡®è®¤æ— æµé‡åï¼Œé”€æ¯æ—§ CloudFormation å †æ ˆï¼š

    ```bash
    cd packages/infra
    npx projen destroy
    ```

</Steps>

è™½ç„¶è¿‡ç¨‹å¤æ‚ï¼Œä½†æˆ‘ä»¬æˆåŠŸå®ç°äº†ç”¨æˆ·çš„æ— ç¼è¿ç§»ï¼ğŸ‰ğŸ‰ğŸ‰

ç°åœ¨ï¼Œæˆ‘ä»¬å·²è·å¾— Nx Plugin for AWS ç›¸è¾ƒäº PDK çš„æ–°ä¼˜åŠ¿ï¼š

- æ›´å¿«çš„æ„å»ºé€Ÿåº¦
- æœ¬åœ° API å¼€å‘æ”¯æŒ
- æ›´å‹å¥½çš„ç¼–ç ä½“éªŒï¼ˆ<Link path="/get_started/building-with-ai">è¯•è¯•æˆ‘ä»¬çš„ MCP æœåŠ¡ï¼</Link>ï¼‰
- æ›´ç›´è§‚çš„ç±»å‹å®‰å…¨å®¢æˆ·ç«¯/æœåŠ¡ç«¯ä»£ç 
- ä»¥åŠæ›´å¤šï¼