---
title: "TypeScript MCP 服务器"
description: "为大型语言模型提供上下文的 TypeScript 模型上下文协议（MCP）服务器"
---



import { FileTree } from '@astrojs/starlight/components';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import Link from '@components/link.astro';
import Snippet from '@components/snippet.astro';
import GeneratorParameters from '@components/generator-parameters.astro';

生成一个 TypeScript [模型上下文协议（MCP）](https://modelcontextprotocol.io/) 服务器，用于为大型语言模型（LLM）提供上下文，并可选部署至 [Amazon Bedrock AgentCore](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/)。

## 什么是 MCP？

[模型上下文协议（MCP）](https://modelcontextprotocol.io/) 是一个开放标准，允许 AI 助手与外部工具和资源交互。它为 LLM 提供了一致的方式来：

- 执行工具（函数）以执行操作或检索信息
- 访问提供上下文或数据的资源

## 使用方法

### 生成 MCP 服务器

您可以通过两种方式生成 TypeScript MCP 服务器：

<RunGenerator generator="ts#mcp-server" />

:::tip
建议先使用 <Link path="/guides/typescript-project">`ts#project`</Link> 生成器创建项目，再添加 MCP 服务器。
:::

### 选项配置

<GeneratorParameters generator="ts#mcp-server" />

## 生成器输出

生成器将在现有 TypeScript 项目中添加以下文件：

<FileTree>
  - your-project/
    - src/
      - mcp-server/ （或自定义名称）
        - index.ts 导出服务器
        - server.ts 主服务器定义
        - stdio.ts STDIO 传输入口，适用于本地简单 MCP 服务器
        - http.ts 流式 HTTP 传输入口，适用于托管 MCP 服务器
        - tools/
          - add.ts 示例工具
        - resources/
          - sample-guidance.ts 示例资源
        - Dockerfile 托管 MCP 服务器的入口（当 `computeType` 设为 `BedrockAgentCoreRuntime` 时）
    - package.json 更新 bin 入口和 MCP 依赖
    - project.json 更新 MCP 服务器服务目标
</FileTree>

:::note
若选择 `BedrockAgentCoreRuntime` 作为 `computeType`，生成器还会创建用于部署 MCP 服务器的 CDK 构造。
:::

## 使用 MCP 服务器

### 添加工具

工具是 AI 助手可调用的功能函数。可在 `server.ts` 中添加新工具：

```typescript
server.tool("工具名称", "工具描述",
  { 参数1: z.string(), 参数2: z.number() }, // 使用 Zod 的输入模式
  async ({ 参数1, 参数2 }) => {
    // 工具实现
    return {
      content: [{ type: "text", text: "结果" }]
    };
  }
);
```

:::caution
当前 MCP SDK 仅支持 Zod v3。为兼容其他生成器使用 Zod v4，Zod v3 依赖以 `zod-v3` 安装。在 MCP 工具模式中需按如下方式导入：

```ts
import { z } from 'zod-v3';
```

待 [MCP SDK 此问题](https://github.com/modelcontextprotocol/typescript-sdk/issues/164) 解决后，可移除 `zod-v3` 依赖并直接导入 `zod`。
:::

### 添加资源

资源为 AI 助手提供上下文。可添加静态文件资源或动态资源：

```typescript
const 示例上下文 = '要返回的上下文内容';

server.resource('资源名称', 'example://resource', async (uri) => ({
  contents: [{ uri: uri.href, text: 示例上下文 }],
}));

// 动态资源
server.resource('动态资源', 'dynamic://resource', async (uri) => {
  const 数据 = await 获取数据();
  return {
    contents: [{ uri: uri.href, text: 数据 }],
  };
});
```

## 配置 AI 助手

<Snippet name="mcp/configuration" parentHeading="Configuring with AI Assistants" />

## 运行 MCP 服务器

### STDIO 模式

测试和使用 MCP 服务器最简便的方式是通过 AI 助手配置（如上所述）。

也可直接使用 `<your-server-name>-serve-stdio` 目标通过 [STDIO 传输](https://modelcontextprotocol.io/docs/concepts/transports#standard-input%2Foutput-stdio) 运行：

<NxCommands commands={['run your-project:your-server-name-serve-stdio']} />

此命令使用 `tsx --watch` 实现文件变更时自动重启服务器。

### 流式 HTTP 模式

若需通过 [流式 HTTP 传输](https://modelcontextprotocol.io/docs/concepts/transports#streamable-http) 本地运行 MCP 服务器，可使用 `<your-server-name>-serve-http` 目标：

<NxCommands commands={['run your-project:your-server-name-serve-http']} />

此命令同样使用 `tsx --watch` 实现自动重启。

## 部署至 Bedrock AgentCore Runtime

若选择 `BedrockAgentCoreRuntime` 作为 `computeType`，生成的 CDK 构造可用于将 MCP 服务器部署至 [Amazon Bedrock AgentCore Runtime](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/agents-tools-runtime.html)。

可在 CDK 应用中使用此构造：

```ts {6}
import { MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    // 将 MCP 服务器加入堆栈
    new MyProjectMcpServer(this, 'MyProjectMcpServer');
  }
}
```

:::caution
需安装 [Docker](https://www.docker.com/) 以构建和部署 MCP 服务器。确保已安装并启动 Docker，避免出现如下错误：

```
ERROR: Cannot connect to the Docker daemon at unix://path/to/docker.sock.
```
:::

### 认证配置

#### IAM 认证

默认使用 IAM 认证，直接部署无需参数：

```ts {5}
import { MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    new MyProjectMcpServer(this, 'MyProjectMcpServer');
  }
}
```

#### Cognito JWT 认证

配置 JWT 认证时，可向 MCP 服务器构造传递 `authorizerConfiguration` 属性。以下示例配置了 Cognito 用户池和客户端来保护 MCP 服务器：

```ts {14-17}
import { MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    const userPool = new UserPool(this, 'UserPool');
    const client = userPool.addClient('Client', {
      authFlows: {
        userPassword: true,
      },
    });

    new MyProjectMcpServer(this, 'MyProjectMcpServer', {
      authorizerConfiguration: {
        customJWTAuthorizer: {
          discoveryUrl: `https://cognito-idp.${Stack.of(userPool).region}.amazonaws.com/${userPool.userPoolId}/.well-known/openid-configuration`,
          allowedClients: [client.userPoolClientId],
        },
      },
    });
  }
}
```

### 构建目标

为将 MCP 服务器构建至 Bedrock AgentCore Runtime，项目中添加了 `<your-mcp-server>-bundle` 目标，该目标：

- 使用 [`esbuild`](https://esbuild.github.io/) 将 MCP 服务器打包为单一 JavaScript 文件，以 `http.ts` 作为流式 HTTP MCP 服务器的入口。
- 根据 `Dockerfile` 构建 Docker 镜像，在端口 `8000` 运行打包后的服务器，符合 [MCP 协议约定](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/runtime-service-contract.html#mcp-protocol-contract)

:::tip
Docker 镜像使用标签（如 `my-scope-my-project-mcp-server:latest`）构建，CDK 构造的 `Dockerfile` 继承此标签，使得您的 `Dockerfile` 可与 MCP 服务器项目共存。
:::