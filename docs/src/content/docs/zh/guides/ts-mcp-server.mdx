---
title: "TypeScript MCP 服务器"
description: "为大型语言模型提供上下文的 TypeScript 模型上下文协议（MCP）服务器"
---



import { FileTree } from '@astrojs/starlight/components';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import Link from '@components/link.astro';
import Snippet from '@components/snippet.astro';
import GeneratorParameters from '@components/generator-parameters.astro';

生成一个TypeScript [模型上下文协议（MCP）](https://modelcontextprotocol.io/)服务器，用于为大型语言模型（LLMs）提供上下文。

## 什么是MCP？

[模型上下文协议（MCP）](https://modelcontextprotocol.io/)是一个开放标准，允许AI助手与外部工具和资源交互。它为LLMs提供了一致的方式来：

- 执行执行操作或检索信息的工具（函数）
- 访问提供上下文或数据的资源

## 使用方法

### 生成MCP服务器

您可以通过两种方式生成TypeScript MCP服务器：

<RunGenerator generator="ts#mcp-server" />

:::tip
建议先使用 <Link path="/guides/typescript-project">`ts#project`</Link> 生成器创建项目，再添加MCP服务器。
:::

### 选项参数

<GeneratorParameters generator="ts#mcp-server" />

## 生成器输出

生成器将在现有TypeScript项目中添加以下文件：

<FileTree>
  - your-project/
    - src/
      - mcp-server/ (或自定义名称)
        - index.ts MCP服务器入口文件
        - server.ts 主服务器定义
        - tools/
          - add.ts 示例工具
        - resources/
          - sample-guidance.ts 示例资源
    - package.json 更新了bin入口和MCP依赖
    - project.json 更新了MCP服务器服务目标
</FileTree>

## 使用MCP服务器

### 添加工具

工具是AI助手可以调用的功能函数。可在`server.ts`中添加新工具：

```typescript
server.tool("工具名称", "工具描述",
  { 参数1: z.string(), 参数2: z.number() }, // 使用Zod定义输入模式
  async ({ 参数1, 参数2 }) => {
    // 工具实现
    return {
      content: [{ type: "text", text: "结果" }]
    };
  }
);
```

### 添加资源

资源为AI助手提供上下文。可添加静态或动态资源：

```typescript
const 示例上下文 = '要返回的上下文内容';

server.resource('资源名称', 'example://resource', async (uri) => ({
  contents: [{ uri: uri.href, text: 示例上下文 }],
}));

// 动态资源
server.resource('动态资源', 'dynamic://resource', async (uri) => {
  const 数据 = await 获取数据();
  return {
    contents: [{ uri: uri.href, text: 数据 }],
  };
});
```

## 配置AI助手

### 配置文件

支持MCP的AI助手通常使用类似的配置方式。需在配置文件中添加MCP服务器信息：

```json
{
  "mcpServers": {
    "你的MCP服务器": {
      "command": "npx",
      "args": ["tsx", "/路径/到/你的MCP服务器/index.ts"]
    }
  }
}
```

:::caution
若出现`ENOENT npx`错误，可能需要通过终端运行`which npx`获取npx的完整路径。
:::

### 热重载

开发时建议添加`--watch`参数，确保AI助手获取最新工具/资源：

```json {5}
{
  "mcpServers": {
    "你的MCP服务器": {
      "command": "npx",
      "args": ["tsx", "--watch", "/路径/到/你的MCP服务器/index.ts"]
    }
  }
}
```

:::note
添加新工具/资源后可能需要刷新AI助手中的MCP服务器连接。
:::

### 特定助手配置

各AI助手的MCP配置请参考：

<Snippet name="mcp/assistant-docs" />

:::tip
部分AI助手（如Amazon Q Developer）支持工作区级MCP配置，便于定义项目相关服务器。
:::

## 运行MCP服务器

虽然推荐通过AI助手使用MCP服务器，但也可通过`<your-server-name>-serve`目标运行，这在切换[STDIO传输](https://modelcontextprotocol.io/docs/concepts/transports#standard-input%2Foutput-stdio)到[流式HTTP传输](https://modelcontextprotocol.io/docs/concepts/transports#streamable-http)时很有用。

<NxCommands commands={['run your-project:your-server-name-serve']} />

该命令使用`tsx --watch`实现文件变更时自动重启服务器。