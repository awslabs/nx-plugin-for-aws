---
title: "React 网站"
description: "React 网站的参考文档"
---



import { FileTree, Steps } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import RunGenerator from '@components/run-generator.astro';
import GeneratorParameters from '@components/generator-parameters.astro';
import NxCommands from '@components/nx-commands.astro';

该生成器会创建一个配置了 [CloudScape](http://cloudscape.design/) 的 [React](https://react.dev/) 网站，并附带 AWS CDK 基础设施代码，用于将您的网站作为静态站点部署到云端，通过 [S3](https://aws.amazon.com/s3/) 托管、[CloudFront](https://aws.amazon.com/cloudfront/) 分发，并通过 [WAF](https://aws.amazon.com/waf/) 进行安全防护。

生成的应用程序使用 [Vite](https://vite.dev/) 作为构建工具和打包器，并采用 [TanStack Router](https://tanstack.com/router/v1) 实现类型安全的路由。

:::note
虽然本生成器默认配置了 CloudScape，但本质上这是一个 React 项目生成器，您可以根据需要修改代码以切换至其他设计系统或组件库。
:::

## 使用方式

### 生成 React 网站

您可以通过两种方式生成新的 React 网站：

<RunGenerator generator="ts#react-website" />

### 选项参数

<GeneratorParameters generator="ts#react-website" />

## 生成器输出

生成器将在 `<directory>/<name>` 目录下创建以下项目结构：

<FileTree>
  - index.html HTML入口点
  - public 静态资源目录
  - src
    - main.tsx 应用入口文件（包含React初始化）
    - config.ts 应用配置（如logo）
    - components
      - AppLayout 整体布局与导航栏组件
    - hooks
      - useAppLayout.tsx 用于从嵌套组件调整AppLayout的Hook
    - routes
      - welcome
        - index.tsx @tanstack/react-router的示例路由（页面）
    - styles.css 全局样式
  - vite.config.ts Vite与Vitest配置
  - tsconfig.json 基础TypeScript配置（源码与测试）
  - tsconfig.app.json 源码TypeScript配置
  - tsconfig.spec.json 测试TypeScript配置
</FileTree>

生成器还会在 `packages/common/constructs` 目录下创建用于部署网站的CDK基础设施代码：

<FileTree>
  - src
    - app
      - static-websites
        - \<name>.ts 网站专属基础设施
    - core
      - static-website.ts 通用StaticWebsite构造
</FileTree>

## 开发您的React网站

[React官方文档](https://react.dev/learn)是学习React基础的良好起点。[CloudScape文档](https://cloudscape.design/components/)则详细介绍了可用组件及其使用方法。

### 路由管理

#### 创建路由/页面

生成的React网站已预配置[TanStack Router](https://tanstack.com/router/v1)，添加新路由非常简便：

<Steps>
  1. [启动本地开发服务器](#local-development-server)
  2. 在`src/routes`目录下新建`<页面名称>.tsx`文件，文件路径决定路由路径
  3. 系统会自动生成`Route`和`RouteComponent`，您可在此开始构建页面！
</Steps>

#### 页面间导航

可使用`Link`组件或`useNavigate`钩子实现页面导航：

```tsx {1, 4, 8-9, 14}
import { Link, useNavigate } from '@tanstack/react-router';

export const MyComponent = () => {
  const navigate = useNavigate();

  const submit = async () => {
    const id = await ...
    // 使用`navigate`在异步操作后重定向
    navigate({ to: '/products/$id', { params: { id }} });
  };

  return (
    <>
      <Link to="/products">取消</Link>
      <Button onClick={submit}>提交</Button>
    </>
  )
};
```

更多细节请参考[TanStack Router文档](https://tanstack.com/router/latest/docs/framework/react/overview)。

## 运行时配置

通过运行时配置（Runtime Configuration），您的网站可以获取AWS CDK基础设施提供的配置信息。这使得网站能够访问部署时才能确定的资源信息（如API URL）。

### 基础设施配置

在CDK基础设施中，可使用`RuntimeConfig`构造来添加和获取配置。由`@aws/nx-plugin`生成的CDK构造（如<Link path="guides/trpc">tRPC API</Link>和<Link path="guides/fastapi">FastAPI</Link>）会自动将相关配置值添加到`RuntimeConfig`。

网站CDK构造会将运行时配置以`runtime-config.json`文件形式部署到S3存储桶根目录。

```ts title="packages/infra/src/stacks/application-stack.ts" {9-12,14-15}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    // 自动向RuntimeConfig添加值
    new MyApi(this, 'MyApi', {
      integrations: MyApi.defaultIntegrations(this).build(),
    });

    // 自动部署runtime-config.json
    new MyWebsite(this, 'MyWebsite');
  }
}
```

:::warning
必须确保在声明网站构造_之后_再声明其他会向`RuntimeConfig`添加内容的构造，否则这些配置将不会出现在`runtime-config.json`中。
:::

### 网站代码

在网站代码中，可使用`useRuntimeConfig`钩子获取运行时配置值：

```tsx {1,4}
import { useRuntimeConfig } from '../hooks/useRuntimeConfig';

const MyComponent = () => {
  const runtimeConfig = useRuntimeConfig();

  // 在此访问运行时配置
  const apiUrl = runtimeConfig.apis.MyApi;
};
```

### 本地运行时配置

运行[本地开发服务器](#local-development-server)时，需要在`public`目录下放置`runtime-config.json`文件，以便本地网站获取后端URL、身份验证配置等信息。

网站项目已配置`load:runtime-config`目标，可用于从已部署的应用中拉取`runtime-config.json`文件：

<NxCommands commands={['run <my-website>:"load:runtime-config"']} />

:::warning
若修改了基础设施项目`src/main.ts`中的堆栈名称，需同步更新网站`project.json`文件中`load:runtime-config`目标对应的堆栈名称。
:::

## 本地开发服务器

可通过`serve`或`serve-local`目标启动本地开发服务器。

### Serve目标

`serve`目标启动网站本地开发服务器。该目标要求已部署网站依赖的基础设施，并已[加载本地运行时配置](#local-runtime-config)。

运行以下命令启动：

<NxCommands commands={['run <my-website>:serve']} />

此目标适用于在指向"真实"已部署API等基础设施时进行网站修改。

### Serve Local目标

`serve-local`目标启动本地开发服务器（设置[Vite `MODE`](https://vite.dev/guide/env-and-mode)为`serve-local`），并同时启动通过<Link path="/guides/api-connection">API连接生成器</Link>连接的所有API本地服务器。

通过此目标运行时，`runtime-config.json`会自动覆盖为指向本地运行的API URL。

运行以下命令启动：

<NxCommands commands={['run <my-website>:serve-local']} />

此目标适用于需要同时开发网站和API并进行快速迭代的场景。

:::warning
在此模式下运行时若未配置`runtime-config.json`，且启用了Cognito身份验证（通过<Link path="/guides/react-website-auth">React网站身份验证生成器</Link>），登录流程将被跳过，发往本地服务器的请求也不会携带认证头。

如需在`serve-local`模式下启用登录和身份验证，请部署基础设施并加载运行时配置。
:::

## 构建网站

使用`build`目标进行网站构建。该目标会使用Vite在根目录`dist/packages/<my-website>/bundle`下生成生产包，同时执行类型检查、编译和代码校验。

<NxCommands commands={['run <my-website>:build']} />

## 测试

网站测试流程与标准TypeScript项目类似，请参考<Link path="guides/typescript-project#testing">TypeScript项目指南</Link>获取详细信息。

针对React的测试，项目已预装React Testing Library。具体使用方法请参考[React Testing Library文档](https://testing-library.com/docs/react-testing-library/example-intro)。

运行测试命令：

<NxCommands commands={['run <my-website>:test']} />

## 部署网站

推荐使用<Link path="guides/typescript-infrastructure">TypeScript基础设施生成器</Link>创建CDK应用来部署网站。

您可以使用`packages/common/constructs`中生成的CDK构造来部署网站：

```ts title="packages/infra/src/stacks/application-stack.ts" {3, 9}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    new MyWebsite(this, 'MyWebsite');
  }
}
```