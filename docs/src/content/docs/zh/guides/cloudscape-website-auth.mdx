---
title: "CloudScape网站身份验证"
description: "CloudScape网站身份验证参考文档"
---



import { FileTree } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import RunGenerator from '@components/run-generator.astro';
import GeneratorParameters from '@components/generator-parameters.astro';
import NxCommands from '@components/nx-commands.astro';
import schema from '../../../../../../packages/nx-plugin/src/cloudscape-website/cognito-auth/schema.json';

CloudScape 网站认证生成器通过[Amazon Cognito](https://aws.amazon.com/cognito/)为您的 CloudScape 网站添加身份验证功能。

该生成器将配置 CDK 基础设施以创建 Cognito 用户池及关联的身份池，同时生成用于处理用户登录流程的托管界面，并将其集成到您的 CloudScape 网站中。

## 使用方式

### 为 CloudScape 网站添加认证

您可以通过两种方式为 CloudScape 网站添加身份验证：

<RunGenerator generator="ts#cloudscape-website#auth" />

### 配置选项

<GeneratorParameters schema={schema} />

## 生成器输出

您的 React 网站将发生以下变更：

<FileTree>
  - src
    - components
      - CognitoAuth
        - index.tsx 主认证组件
    - main.tsx 已更新以集成 CognitoAuth 组件
</FileTree>

您还将在 `packages/common/constructs` 目录中看到生成的基础设施代码：

<FileTree>
  - src
    - core
      - user-identity.ts 定义用户池和身份池的构造体
</FileTree>

## 基础设施应用

您需要在堆栈中添加 `UserIdentity` 构造体，并确保其在网站构造体之前声明：

```ts title="packages/infra/src/stacks/application-stack.ts" {3,9}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite, UserIdentity } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    new UserIdentity(this, 'Identity');

    new MyWebsite(this, 'MyWebsite');
  }
}
```

`UserIdentity` 构造体会自动添加必要的 <Link path="guides/cloudscape-website#runtime-configuration">运行时配置</Link>，确保您的网站能够指向正确的 Cognito 用户池进行身份验证。

### 授予认证用户访问权限

如需授予认证用户执行特定操作的权限（例如调用 API 的权限），可以向身份池的认证角色添加 IAM 策略声明：

```ts title="packages/infra/src/stacks/application-stack.ts" {12}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite, UserIdentity, MyApi } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    const identity = new UserIdentity(this, 'Identity');
    const api = new MyApi(this, 'MyApi');

    api.grantInvokeAccess(identity.identityPool.authenticatedRole);

    new MyWebsite(this, 'MyWebsite');
  }
}
```