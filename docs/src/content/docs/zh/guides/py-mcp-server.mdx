---
title: "Python MCP服务器"
description: "为大型语言模型提供上下文的Python模型上下文协议（MCP）服务器"
---



import { FileTree } from '@astrojs/starlight/components';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import Link from '@components/link.astro';
import Snippet from '@components/snippet.astro';
import GeneratorParameters from '@components/generator-parameters.astro';

生成一个Python [模型上下文协议（MCP）](https://modelcontextprotocol.io/) 服务器，用于为大型语言模型（LLMs）提供上下文，并可选部署到[Amazon Bedrock AgentCore](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/)。

## 什么是MCP？

[模型上下文协议（MCP）](https://modelcontextprotocol.io/) 是一个开放标准，允许AI助手与外部工具和资源交互。它为LLMs提供了一致的方式来：

- 执行工具（函数）以执行操作或检索信息
- 访问提供上下文或数据的资源

## 使用方式

### 生成MCP服务器

您可以通过两种方式生成Python MCP服务器：

<RunGenerator generator="py#mcp-server" />

:::tip
建议先使用 <Link path="/guides/python-project">`py#project`</Link> 生成器创建项目，再向其中添加MCP服务器。
:::

### 选项配置

<GeneratorParameters generator="py#mcp-server" />

## 生成器输出

生成器将在现有Python项目中添加以下文件：

<FileTree>
  - your-project/
    - your_module/
      - mcp_server/ (或自定义名称)
        - \_\_init\_\_.py Python包初始化文件
        - server.py 主服务器定义，包含示例工具和资源
        - stdio.py STDIO传输入口点，适用于本地简单MCP服务器
        - http.py 流式HTTP传输入口点，适用于托管MCP服务器
        - Dockerfile 部署MCP服务器的Docker配置（当`computeType`设为`BedrockAgentCoreRuntime`时）
    - pyproject.toml 更新MCP依赖项
    - project.json 更新MCP服务器服务目标
</FileTree>

:::note
如果选择`BedrockAgentCoreRuntime`作为`computeType`，生成器还会创建CDK构造用于部署MCP服务器。
:::

## 开发MCP服务器

### 添加工具

工具是AI助手可调用的功能函数。Python MCP服务器使用[MCP Python SDK (FastMCP)](https://github.com/modelcontextprotocol/python-sdk)库，通过装饰器定义工具：

```python
@mcp.tool(description="工具描述")
def your_tool_name(param1: str, param2: int) -> str:
    """带类型提示的工具实现"""
    # 工具逻辑
    return f"结果: {param1} 与 {param2}"
```

FastMCP库自动处理：
- 基于类型提示的类型验证
- MCP协议的JSON模式生成
- 错误处理和响应格式化

### 添加资源

使用`@mcp.resource`装饰器添加上下文资源：

```python
@mcp.resource("example://static-resource", description="静态资源示例")
def static_resource() -> str:
    """返回静态内容"""
    return "这是提供给AI的静态上下文"

@mcp.resource("dynamic://resource/{item_id}", description="动态资源示例")
def dynamic_resource(item_id: str) -> str:
    """根据参数返回动态内容"""
    data = fetch_data_for_item(item_id)
    return f"{item_id}的动态内容: {data}"
```

## 配置AI助手

<Snippet name="mcp/configuration-py" parentHeading="配置AI助手" />

## 运行MCP服务器

### 检查器

生成器配置了`<your-server-name>-inspect`目标，用于启动[MCP检查器](https://github.com/modelcontextprotocol/inspector)通过STDIO连接服务器：

<NxCommands commands={['run your-project:your-server-name-inspect']} />

检查器运行于`http://localhost:6274`，点击"Connect"按钮开始使用。

### STDIO模式

通过`<your-server-name>-serve-stdio`目标直接运行STDIO传输：

<NxCommands commands={['run your-project:your-server-name-serve-stdio']} />

该命令使用`uv run`以STDIO模式启动服务器。

### 流式HTTP模式

通过`<your-server-name>-serve-http`目标运行HTTP传输：

<NxCommands commands={['run your-project:your-server-name-serve-http']} />

该命令使用`uv run`启动HTTP服务器，默认端口8000。

## 部署到Bedrock AgentCore Runtime

<Snippet name="mcp/bedrock-deployment" parentHeading="部署到Bedrock AgentCore Runtime" />

### 打包与Docker目标

`bundle`目标用于构建Bedrock AgentCore Runtime部署包：
- 使用`uv export`导出依赖到`requirements.txt`
- 使用`uv pip install`为目标平台(`aarch64-manylinux2014`)安装依赖

`docker`目标构建Docker镜像：
- 基于`Dockerfile`构建镜像，按[MCP协议规范](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/runtime-service-contract.html#mcp-protocol-contract)运行于8000端口

:::tip
镜像标签（如`my-scope-my-project-mcp-server:latest`）会被CDK构造继承，确保Dockerfile与项目位置一致。
:::

### 可观测性

<Snippet name="mcp/observability" parentHeading="可观测性" />