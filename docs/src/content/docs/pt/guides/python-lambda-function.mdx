---
title: "Funções Lambda em Python"
description: "Documentação de referência para Funções Lambda em Python"
---



import { FileTree } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import RunGenerator from '@components/run-generator.astro';
import GeneratorParameters from '@components/generator-parameters.astro';
import Infrastructure from '@components/infrastructure.astro';
import Snippet from '@components/snippet.astro';
import NxCommands from '@components/nx-commands.astro';

O gerador de Função Lambda em Python permite adicionar uma função lambda a um projeto Python existente.

Este gerador cria um novo handler de lambda em Python com configuração de infraestrutura AWS CDK ou Terraform. O backend gerado utiliza AWS Lambda para implantação serverless, com opção de type-safety usando o [Parser do AWS Lambda Powertools](https://docs.powertools.aws.dev/lambda/python/latest/utilities/parser/). Configura o [AWS Lambda Powertools](https://docs.powertools.aws.dev/lambda/python/latest/) para observabilidade, incluindo logging, rastreamento com AWS X-Ray e métricas no Cloudwatch.

## Utilização

### Gerar uma Função Lambda

Você pode gerar uma nova Função Lambda de duas formas:

<RunGenerator generator="py#lambda-function" />

### Opções

<GeneratorParameters generator="py#lambda-function" />

## Saída do Gerador

O gerador adicionará os seguintes arquivos ao seu projeto:

<FileTree>

- \<module-name>
  - \<lambda-function>.py Implementação da função

</FileTree>

Se a opção `functionPath` for fornecida, o gerador adicionará os arquivos no caminho especificado:

<FileTree>

- \<module-name>
  - \<custom-path>
    - \<function-name>.py Implementação da função

</FileTree>

### Infraestrutura

<Snippet name="shared-constructs" />

O gerador cria infraestrutura como código para implantação da função baseado no `iacProvider` selecionado:

<Infrastructure>
<Fragment slot="cdk">
O gerador cria constructs CDK para implantação da função, localizados no diretório `packages/common/constructs`.
</Fragment>
<Fragment slot="terraform">
O gerador cria um módulo Terraform para implantação da função, localizado no diretório `packages/common/terraform/src/app/lambda-functions/<function-name>`.
</Fragment>
</Infrastructure>

## Implementando sua Função

A implementação principal está em `<function-name>.py`. Veja um exemplo:

```python
import os

from aws_lambda_powertools import Logger, Metrics, Tracer
from aws_lambda_powertools.metrics import MetricUnit
from aws_lambda_powertools.utilities.parser import event_parser
from aws_lambda_powertools.utilities.parser.models import EventBridgeModel
from aws_lambda_powertools.utilities.typing import LambdaContext

os.environ["POWERTOOLS_METRICS_NAMESPACE"] = "Foo"
os.environ["POWERTOOLS_SERVICE_NAME"] = "Foo"

logger: Logger = Logger()
metrics: Metrics = Metrics()
tracer: Tracer = Tracer()

@tracer.capture_lambda_handler
@metrics.log_metrics
@event_parser(model=EventBridgeModel)
def lambda_handler(event: EventBridgeModel, context: LambdaContext):
    logger.info("Received event", extra={"event": event.model_dump() })
    metrics.add_metric(name="InvocationCount", unit=MetricUnit.Count, value=1)

    try:
        # TODO: Implementar
        metrics.add_metric(name="SuccessCount", unit=MetricUnit.Count, value=1)
        # TODO: Implementar resposta de sucesso se necessário
    except Exception as e:
        logger.exception(e)
        metrics.add_metric(name="ErrorCount", unit=MetricUnit.Count, value=1)
        # TODO: Implementar resposta de erro se necessário
```

O gerador configura automaticamente vários recursos:

1. Integração com AWS Lambda Powertools para observabilidade
2. Coleta de métricas
3. Type-safety usando `@event_parser`

### Observabilidade com AWS Lambda Powertools

#### Logging

O gerador configura logging estruturado usando AWS Lambda Powertools.

```python
def lambda_handler(event: EventBridgeModel, context: LambdaContext):
    logger.info("Received event", extra={"event": event.model_dump()})
```

:::tip
Recomenda-se definir um correlation id para requisições únicas para facilitar depuração e monitoramento. Consulte a documentação do [aws powertools logger](https://docs.powertools.aws.dev/lambda/python/2.22.0/core/logger/#setting-a-correlation-id) para melhores práticas.
:::

O logger inclui automaticamente:

- Requisições de evento
- Informações de contexto do Lambda
- Indicadores de cold start

#### Tracing

O rastreamento com AWS X-Ray é configurado automaticamente. Você pode adicionar subsegmentos personalizados:

```python
def lambda_handler(event: EventBridgeModel, context: LambdaContext):
    # Cria um novo subsegmento
    with tracer.provider.in_subsegment("function-subsegment"):
        # Sua lógica aqui
        return ....
```

#### Métricas

Métricas no CloudWatch são coletadas automaticamente para cada requisição. Você pode adicionar métricas personalizadas:

```python
def lambda_handler(event: EventBridgeModel, context: LambdaContext):
    metrics.add_metric(name="NewMetric", unit=MetricUnit.Count, value=1)
    return ...
```

Métricas padrão incluem:

- Contagem de invocações
- Contagem de sucessos/falhas
- Métricas de cold start

### Type Safety

Se você escolheu um `eventSource` ao gerar sua função, ela será instrumentada com [`@event_parser` do AWS Lambda Powertools](https://docs.powertools.aws.dev/lambda/python/latest/utilities/parser/). Exemplo:

```python {3}
@event_parser(model=EventBridgeModel)
def lambda_handler(event: EventBridgeModel, context: LambdaContext):
    event.detail_type # <- type-safe com autocompletar na IDE
```

Isso permite definir modelos de dados usando [Pydantic](https://docs.pydantic.dev/latest/), de forma similar ao trabalho com <Link path="guides/fastapi">Fast API</Link>.

:::tip
Se você possui dados personalizados aninhados em eventos, como streams DynamoDB ou eventos EventBridge, pode beneficiar-se do uso de [Envelopes](https://docs.powertools.aws.dev/lambda/python/latest/utilities/parser/#envelopes) para garantir type-safety.
:::

Se não deseja tipar seu evento, basta selecionar `Any` como `eventSource`.

## Bundling

O gerador configura automaticamente o empacotamento Python para pacotes de implantação Lambda usando [uv](https://docs.astral.sh/uv/):

<NxCommands commands={['run <project-name>:bundle']} />

:::note
Isso empacota todo o projeto como pacote de implantação. Para minimizar o tamanho, você pode dividir funções lambda em múltiplos projetos Python usando o gerador <Link path="guides/python-project">`py#project`</Link>.
:::

Este processo utiliza:

1. [`uv export`](https://docs.astral.sh/uv/reference/cli/#uv-export) para exportar dependências para um arquivo `requirements.txt`
2. [`uv pip install`](https://docs.astral.sh/uv/reference/cli/#uv-pip-install) para instalar dependências na plataforma alvo (`x86_64-manylinux2014`) para implantação Lambda

:::note
Se alterar a [arquitetura Lambda para ARM](https://docs.aws.amazon.com/lambda/latest/dg/foundation-arch.html), será necessário editar o target do bundle para usar `aarch64-manylinux2014`.
:::

## Implantando sua Função

<Snippet name="lambda-function/deploying-your-function" parentHeading="Implantando sua Função" />