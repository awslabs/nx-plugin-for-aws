---
title: "Função Lambda em TypeScript"
description: "Gerar uma função lambda em TypeScript"
---



import { FileTree } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import RunGenerator from '@components/run-generator.astro';
import GeneratorParameters from '@components/generator-parameters.astro';
import NxCommands from '@components/nx-commands.astro';
import Infrastructure from '@components/infrastructure.astro';
import Snippet from '@components/snippet.astro';

O gerador de Função Lambda em TypeScript permite adicionar uma função lambda a um projeto TypeScript existente.

Este gerador cria um novo handler Lambda em TypeScript com configuração de infraestrutura AWS CDK ou Terraform. O handler gerado utiliza [AWS Lambda Powertools for TypeScript](https://docs.powertools.aws.dev/lambda/typescript/latest/) para observabilidade, incluindo logging, rastreamento com AWS X-Ray e métricas do CloudWatch, além de validação opcional de tipos para eventos usando o [Parser do AWS Lambda Powertools](https://docs.powertools.aws.dev/lambda/typescript/latest/utilities/parser/)

## Utilização

### Gerar uma função lambda TypeScript

Você pode gerar uma função lambda de duas formas:

<RunGenerator generator="ts#lambda-function" />

### Opções

<GeneratorParameters generator="ts#lambda-function" />

## Saída do Gerador

O gerador adicionará os seguintes arquivos ao seu projeto:

<FileTree>

- \<project-name>
  - src/
    - \<lambda-function>.ts Implementação da função

</FileTree>

Se a opção `functionPath` for fornecida, o gerador adicionará o handler no caminho especificado dentro do diretório source do projeto:

<FileTree>

- \<project-name>
  - src/
    - \<custom-path>/
      - \<function-name>.ts Implementação da função

</FileTree>

### Infraestrutura

<Snippet name="shared-constructs" />

O gerador cria infraestrutura como código para implantar sua função com base no `iacProvider` selecionado:

<Infrastructure>
<Fragment slot="cdk">
O gerador cria um construct CDK que pode ser usado para implantar sua função, localizado no diretório `packages/common/constructs/src/app/lambda-functions`.
</Fragment>
<Fragment slot="terraform">
O gerador cria um módulo Terraform que pode ser usado para implantar sua função, localizado no diretório `packages/common/terraform/src/app/lambda-functions/<function-name>`.
</Fragment>
</Infrastructure>

## Implementando sua Função

A implementação principal da função está em `<function-name>.ts`. Aqui está um exemplo:

```typescript
import { parser } from '@aws-lambda-powertools/parser/middleware';
import { EventBridgeSchema } from '@aws-lambda-powertools/parser/schemas';
import middy from '@middy/core';
import { Tracer } from '@aws-lambda-powertools/tracer';
import { captureLambdaHandler } from '@aws-lambda-powertools/tracer/middleware';
import { injectLambdaContext } from '@aws-lambda-powertools/logger/middleware';
import { Logger } from '@aws-lambda-powertools/logger';
import { Metrics } from '@aws-lambda-powertools/metrics';
import { logMetrics } from '@aws-lambda-powertools/metrics/middleware';
import { z } from 'zod';

process.env.POWERTOOLS_METRICS_NAMESPACE = 'MyFunction';
process.env.POWERTOOLS_SERVICE_NAME = 'MyFunction';

const tracer = new Tracer();
const logger = new Logger();
const metrics = new Metrics();

export const myFunction = async (
  event: z.infer<typeof EventBridgeSchema>,
): Promise<void> => {
  logger.info('Received event', event);

  // TODO: implement
};

export const handler = middy()
  .use(captureLambdaHandler(tracer))
  .use(injectLambdaContext(logger))
  .use(logMetrics(metrics))
  .use(parser({ schema: EventBridgeSchema }))
  .handler(myFunction);

```

O gerador configura automaticamente vários recursos:

1. **Pilha de middleware Middy** para funcionalidades estendidas do Lambda
2. **Integração com AWS Lambda Powertools** para observabilidade
3. **Coleta de métricas** com CloudWatch
4. **Validação de tipos** usando middleware de parser
5. **Empacotamento com Rolldown** para pacotes de implantação otimizados

### Observabilidade com AWS Lambda Powertools

#### Logging

O gerador configura logging estruturado usando AWS Lambda Powertools com injeção automática de contexto via middleware Middy.

```typescript
export const handler = middy()
  .use(injectLambdaContext(logger))
  .handler(myFunction);
```

#### Tracing

O rastreamento com AWS X-Ray é configurado automaticamente via middleware `captureLambdaHandler`. Você pode adicionar subsegmentos personalizados aos seus traces:

```typescript
const tracer = new Tracer();

export const myFunction = async (
  event: z.infer<typeof EventBridgeSchema>,
): Promise<void> => {
  // Cria um novo subsegmento
  const subsegment = tracer.getSegment()?.addNewSubsegment('custom-operation');
  try {
    // Sua lógica aqui
  } catch (error) {
    subsegment?.addError(error as Error);
    throw error;
  } finally {
    subsegment?.close();
  }
};

export const handler = middy()
  .use(captureLambdaHandler(tracer))
  .handler(myFunction);
```

#### Métricas

Métricas do CloudWatch são coletadas automaticamente para cada requisição via middleware `logMetrics`. Você pode adicionar métricas personalizadas:

```typescript
const metrics = new Metrics();

export const myFunction = async (
  event: z.infer<typeof EventBridgeSchema>,
): Promise<void> => {
  metrics.addMetric("CustomMetric", MetricUnit.Count, 1);
  metrics.addMetric("ProcessingTime", MetricUnit.Milliseconds, processingTime);
};

export const handler = middy()
  .use(logMetrics(metrics))
  .handler(myFunction);
```

### Validação de Tipos

Se você escolheu um `eventSource` ao gerar sua função Lambda, seu handler será instrumentado com o middleware [`parser` do AWS Lambda Powertools](https://docs.powertools.aws.dev/lambda/typescript/latest/utilities/parser/). Por exemplo:

```typescript {4}
export const myFunction = async (
  event: z.infer<typeof EventBridgeSchema>,
): Promise<void> => {
  event.detail // <- tipagem segura com autocompletar do IDE
};

export const handler = middy()
  .use(parser({ schema: EventBridgeSchema }))
  .handler(myFunction);
```

Isso fornece segurança de tipos em tempo de compilação e validação em runtime para eventos Lambda.

:::caution
Se você não quer que seu handler lance um erro quando o evento não conformar com o schema, você pode usar a opção [`safeParse`](https://docs.powertools.aws.dev/lambda/typescript/latest/utilities/parser/#safe-parsing).
:::

:::tip
Se você tem dados personalizados aninhados em um evento, por exemplo em um stream do DynamoDB ou evento do EventBridge, pode se beneficiar usando [Envelopes](https://docs.powertools.aws.dev/lambda/typescript/latest/utilities/parser/#envelopes) para fornecer validação de tipos para esses dados.
:::

Se você não deseja tipar seu evento, pode selecionar `Any` para o `eventSource`, resultando em um tipo `any` para o parâmetro event.

## Empacotamento

<Snippet name="ts-bundle" />

## Implantando sua Função

<Snippet name="lambda-function/deploying-your-function" parentHeading="Implantando sua Função" />