---
title: "Site React"
description: "Documentação de referência para um Site React"
---



import { FileTree, Steps } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import RunGenerator from '@components/run-generator.astro';
import GeneratorParameters from '@components/generator-parameters.astro';
import NxCommands from '@components/nx-commands.astro';
import Infrastructure from '@components/infrastructure.astro';
import Snippet from '@components/snippet.astro';

Este gerador cria um novo website [React](https://react.dev/) com [CloudScape](http://cloudscape.design/) configurado, juntamente com a infraestrutura AWS CDK ou Terraform para implantar seu website na nuvem como um site estático hospedado no [S3](https://aws.amazon.com/s3/), servido pelo [CloudFront](https://aws.amazon.com/cloudfront/) e protegido pelo [WAF](https://aws.amazon.com/waf/).

A aplicação gerada utiliza [Vite](https://vite.dev/) como ferramenta de build e bundler. Usa [TanStack Router](https://tanstack.com/router/v1) para roteamento type-safe.

:::note
Embora este gerador configure o CloudScape, ele é fundamentalmente um gerador de projetos React, e você pode modificar seu código para migrar para um sistema de design ou biblioteca de componentes alternativo se desejar.
:::

## Utilização

### Gerar um Website React

Você pode gerar um novo Website React de duas formas:

<RunGenerator generator="ts#react-website" />

### Opções

<GeneratorParameters generator="ts#react-website" />

## Saída do Gerador

O gerador criará a seguinte estrutura de projeto no diretório `<directory>/<name>`:

<FileTree>
  - index.html Ponto de entrada HTML
  - public Assets estáticos
  - src
    - main.tsx Ponto de entrada da aplicação com configuração React
    - config.ts Configuração da aplicação (ex: logo)
    - components
      - AppLayout Componentes para o layout CloudScape e barra de navegação
    - hooks
      - useAppLayout.tsx Hook para ajustar o AppLayout de componentes aninhados
    - routes
      - welcome
        - index.tsx Rota de exemplo (ou página) para @tanstack/react-router
    - styles.css Estilos globais
  - vite.config.ts Configuração do Vite e Vitest
  - tsconfig.json Configuração TypeScript base para código e testes
  - tsconfig.app.json Configuração TypeScript para código fonte
  - tsconfig.spec.json Configuração TypeScript para testes
</FileTree>

### Infraestrutura

<Snippet name="shared-constructs" />

O gerador cria infraestrutura como código para implantar seu website baseado no `iacProvider` selecionado:

<Infrastructure>
<Fragment slot="cdk">
<FileTree>
  - packages/common/constructs/src
    - app
      - static-websites
        - \<name>.ts Infraestrutura específica para seu website
    - core
      - static-website.ts Construct genérico StaticWebsite
</FileTree>
</Fragment>
<Fragment slot="terraform">
<FileTree>
  - packages/common/terraform/src
    - app
      - static-websites
        - \<name>
          - \<name>.tf Módulo específico para seu website
    - core
      - static-website
        - static-website.tf Módulo genérico de website estático
</FileTree>
</Fragment>
</Infrastructure>

## Implementando seu Website React

A [documentação do React](https://react.dev/learn) é um bom ponto de partida para aprender os fundamentos de desenvolvimento com React. Você pode consultar a [documentação do CloudScape](https://cloudscape.design/components/) para detalhes sobre os componentes disponíveis e como usá-los.

### Rotas

#### Criando uma Rota/Página

Seu website CloudScape vem com [TanStack Router](https://tanstack.com/router/v1) configurado por padrão. Isso facilita a adição de novas rotas:

<Steps>
  1. [Execute o Servidor de Desenvolvimento Local](#local-development-server)
  2. Crie um novo arquivo `<page-name>.tsx` em `src/routes`, com sua posição na estrutura de arquivos representando o caminho
  3. Observe que um `Route` e `RouteComponent` são gerados automaticamente. Comece a construir sua página aqui!
</Steps>

#### Navegação Entre Páginas

Você pode usar o componente `Link` ou o hook `useNavigate` para navegar entre páginas:

```tsx {1, 4, 8-9, 14}
import { Link, useNavigate } from '@tanstack/react-router';

export const MyComponent = () => {
  const navigate = useNavigate();

  const submit = async () => {
    const id = await ...
    // Use `navigate` para redirecionar após ação assíncrona
    navigate({ to: '/products/$id', { params: { id }} });
  };

  return (
    <>
      <Link to="/products">Cancelar</Link>
      <Button onClick={submit}>Enviar</Button>
    </>
  )
};
```

Para mais detalhes, consulte a documentação do [TanStack Router](https://tanstack.com/router/latest/docs/framework/react/overview).

## Configuração de Runtime

A configuração de sua infraestrutura é fornecida ao seu website via Configuração de Runtime. Isso permite que seu website acesse detalhes como URLs de API que só são conhecidos após a implantação.

### Infraestrutura

<Infrastructure>
<Fragment slot="cdk">
O construct CDK `RuntimeConfig` pode ser usado para adicionar e recuperar configuração em sua infraestrutura CDK. Os constructs CDK gerados pelos geradores `@aws/nx-plugin` (como <Link path="guides/trpc">`ts#trpc-api`</Link> e <Link path="guides/fastapi">`py#fast-api`</Link>) adicionarão automaticamente valores apropriados ao `RuntimeConfig`.

Seu construct CDK do website implantará a configuração de runtime como um arquivo `runtime-config.json` na raiz do seu bucket S3.

```ts title="packages/infra/src/stacks/application-stack.ts" {9-12,14-15}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    // Adiciona automaticamente valores ao RuntimeConfig
    new MyApi(this, 'MyApi', {
      integrations: MyApi.defaultIntegrations(this).build(),
    });

    // Implanta automaticamente a config de runtime em runtime-config.json
    new MyWebsite(this, 'MyWebsite');
  }
}
```

:::caution
Você deve garantir que declare seu website _após_ quaisquer constructs que adicionem ao `RuntimeConfig`, caso contrário eles estarão faltando no arquivo `runtime-config.json`.
:::
</Fragment>
<Fragment slot="terraform">
Com Terraform, a configuração de runtime é gerenciada através dos módulos runtime-config. Os módulos Terraform gerados pelos geradores `@aws/nx-plugin` (como <Link path="guides/trpc">`ts#trpc-api`</Link> e <Link path="guides/fastapi">`py#fast-api`</Link>) adicionarão automaticamente valores apropriados à configuração de runtime.

Seu módulo Terraform do website implantará a configuração de runtime como um arquivo `runtime-config.json` na raiz do seu bucket S3.

```hcl title="packages/infra/src/main.tf" {14-15}
# Adiciona automaticamente valores à config de runtime
module "my_api" {
  source = "../../common/terraform/src/app/apis/my-api"
}

# Implanta automaticamente a config de runtime em runtime-config.json
module "my_website" {
  source = "../../common/terraform/src/app/static-websites/my-website"

  providers = {
    aws.us_east_1 = aws.us_east_1
  }

  # Garante que API é implantada primeiro para adicionar à config de runtime
  depends_on = [module.my_api]
}
```

:::caution
Você deve garantir que declare seu módulo de website _após_ quaisquer módulos que adicionem à configuração de runtime e configure o `depends_on` apropriado para garantir ordem, caso contrário eles estarão faltando no arquivo `runtime-config.json`.
:::
</Fragment>
</Infrastructure>

### Código do Website

Em seu website, você pode usar o hook `useRuntimeConfig` para recuperar valores da configuração de runtime:

```tsx {1,4}
import { useRuntimeConfig } from '../hooks/useRuntimeConfig';

const MyComponent = () => {
  const runtimeConfig = useRuntimeConfig();

  // Acesse valores da config de runtime aqui
  const apiUrl = runtimeConfig.apis.MyApi;
};
```

### Config de Runtime Local

Ao executar o [servidor de desenvolvimento local](#local-development-server), você precisará de um arquivo `runtime-config.json` em seu diretório `public` para que seu website local conheça as URLs de backend, configuração de identidade, etc.

Seu projeto de website está configurado com um target `load:runtime-config` que você pode usar para baixar o arquivo `runtime-config.json` de uma aplicação implantada:

<NxCommands commands={['run <my-website>:"load:runtime-config"']} />

:::note
<Infrastructure>
<Fragment slot="cdk">
Se você alterar o prefixo dos nomes de stage em `src/main.ts` de seu projeto de infraestrutura, precisará atualizar o target `load:runtime-config` no arquivo `project.json` de seu website.

Além disso, é importante notar que o target `load:runtime-config` assume que um único stage de sua aplicação está implantado no ambiente para o qual você tem credenciais AWS. Você precisará ajustar o comando se implantar múltiplos stages na mesma conta e região.
</Fragment>
<Fragment slot="terraform">
Para projetos Terraform, o target `load:runtime-config` copia o arquivo `runtime-config.json` criado após seu último `terraform apply` local.
</Fragment>
</Infrastructure>
:::

## Servidor de Desenvolvimento Local

Você pode executar um servidor de desenvolvimento local usando os targets `serve` ou `serve-local`.

### Target Serve

O target `serve` inicia um servidor de desenvolvimento local para seu website. Este target requer que você tenha implantado qualquer infraestrutura de suporte com a qual o website interage, e tenha [carregado a configuração de runtime local](#local-runtime-config).

Você pode executar este target com o seguinte comando:

<NxCommands commands={['run <my-website>:serve']} />

Este target é útil para trabalhar em alterações do website apontando para APIs "reais" implantadas e outras infraestruturas.

### Target Serve Local

O target `serve-local` inicia um servidor de desenvolvimento local para seu website (com [Vite `MODE`](https://vite.dev/guide/env-and-mode) definido como `serve-local`), além de iniciar quaisquer servidores locais para APIs conectadas via gerador <Link path="/guides/api-connection">API Connection</Link>.

Quando seu servidor local é executado via este target, `runtime-config.json` é automaticamente sobrescrito para apontar para URLs de API locais.

Você pode executar este target com o seguinte comando:

<NxCommands commands={['run <my-website>:serve-local']} />

Este target é útil quando você está trabalhando simultaneamente no website e na API e deseja iterar rapidamente sem implantar infraestrutura.

:::warning
Quando executado neste modo e nenhum `runtime-config.json` estiver presente, se você configurou Autenticação Cognito (via gerador <Link path="/guides/react-website-auth">CloudScape Website Auth</Link>), o login será ignorado e requisições para servidores locais não incluirão headers de autenticação.

Para habilitar login e autenticação no `serve-local`, implante sua infraestrutura e carregue a config de runtime.
:::

## Build

Você pode construir seu website usando o target `build`. Isso usa o Vite para criar um bundle de produção no diretório `dist/packages/<my-website>/bundle`, além de type-checking, compilação e linting.

<NxCommands commands={['run <my-website>:build']} />

## Testes

Testar seu website é similar a escrever testes em um projeto TypeScript padrão. Consulte o <Link path="guides/typescript-project#testing">guia de projetos TypeScript</Link> para detalhes.

Para testes específicos de React, o React Testing Library já está instalado e disponível. Para detalhes de uso, consulte a [documentação do React Testing Library](https://testing-library.com/docs/react-testing-library/example-intro).

Você pode executar seus testes usando o target `test`:

<NxCommands commands={['run <my-website>:test']} />

## Implantando Seu Website

O gerador de website React cria infraestrutura como código CDK ou Terraform baseado no `iacProvider` selecionado. Você pode usar isso para implantar seu website.

<Infrastructure>
<Fragment slot="cdk">
Para implantar seu website, recomendamos usar o gerador <Link path="guides/typescript-infrastructure">`ts#infra`</Link> para criar uma aplicação CDK.

Você pode usar o construct CDK gerado em `packages/common/constructs` para implantar seu website.

```ts title="packages/infra/src/stacks/application-stack.ts" {3, 9}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    new MyWebsite(this, 'MyWebsite');
  }
}
```

Isso configura:

1. Um bucket S3 para hospedar arquivos estáticos do website
2. Distribuição CloudFront para entrega global de conteúdo
3. Web ACL WAF para proteção de segurança
4. Origin Access Control para acesso seguro ao S3
5. Implantação automática de arquivos do website e configuração de runtime
</Fragment>
<Fragment slot="terraform">
Para implantar seu website, recomendamos usar o gerador <Link path="guides/terraform-infrastructure">`terraform#project`</Link> para criar um projeto Terraform.

Você pode usar o módulo Terraform gerado em `packages/common/terraform` para implantar seu website.

```hcl title="packages/infra/src/main.tf" {3}
# Implanta website
module "my_website" {
  source = "../../common/terraform/src/app/static-websites/my-website"

  providers = {
    aws.us_east_1 = aws.us_east_1
  }
}
```

Isso configura:

1. Um bucket S3 para hospedar arquivos estáticos do website
2. Distribuição CloudFront para entrega global de conteúdo
3. Web ACL WAF para proteção de segurança (implantado em us-east-1)
4. Origin Access Control para acesso seguro ao S3
5. Implantação automática de arquivos do website e configuração de runtime

:::note
O provider `aws.us_east_1` é necessário para recursos CloudFront e WAF, que devem ser implantados na região us-east-1. Garanta que sua configuração Terraform inclua este provider:

```hcl title="packages/infra/src/providers.tf"
provider "aws" {
  alias  = "us_east_1"
  region = "us-east-1"
}
```
:::
</Fragment>
</Infrastructure>