---
title: "Agente de Strands em Python"
description: "Gerar um Agente de Strands em Python para construir agentes de IA com ferramentas e implantar no Amazon Bedrock AgentCore Runtime"
---



import { FileTree } from '@astrojs/starlight/components';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import Link from '@components/link.astro';
import Snippet from '@components/snippet.astro';
import Infrastructure from '@components/infrastructure.astro';
import GeneratorParameters from '@components/generator-parameters.astro';

Gerar um agente [Strands Agent](https://strandsagents.com/) em Python para construção de agentes de IA com ferramentas, e opcionalmente implantá-lo no [Amazon Bedrock AgentCore Runtime](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/).

## O que é o Strands?

[Strands](https://strandsagents.com/latest/documentation/docs/) é um framework Python leve e pronto para produção para construção de agentes de IA. Principais características:

- **Leve e personalizável**: Loop de agente simples que não atrapalha
- **Pronto para produção**: Observabilidade completa, tracing e opções de implantação em escala  
- **Agnóstico a modelos e provedores**: Suporte a diversos modelos de vários provedores
- **Ferramentas comunitárias**: Conjunto poderoso de ferramentas contribuídas pela comunidade
- **Suporte a multiagentes**: Técnicas avançadas como equipes de agentes e agentes autônomos
- **Modos flexíveis de interação**: Suporte a conversacional, streaming e não-streaming

## Utilização

### Gerar um Strands Agent

Você pode gerar um Strands Agent em Python de duas formas:

<RunGenerator generator="py#strands-agent" />

:::tip
Primeiro use o gerador <Link path="/guides/python-project">`py#project`</Link> para criar um projeto onde adicionar seu Strands Agent.
:::

### Opções

<GeneratorParameters generator="py#strands-agent" />

## Saída do Gerador

O gerador adicionará os seguintes arquivos ao seu projeto Python existente:

<FileTree>
  - your-project/
    - your_module/
      - agent/ (ou nome personalizado se especificado)
        - \_\_init\_\_.py Inicialização do pacote Python
        - agent.py Definição principal do agente com ferramentas de exemplo  
        - main.py Ponto de entrada para Bedrock AgentCore Runtime
        - agentcore_mcp_client.py Fábrica de clientes útil para invocar servidores MCP também hospedados no Bedrock AgentCore Runtime
        - Dockerfile Ponto de entrada para hospedar seu agente (excluído quando `computeType` é `None`)
    - pyproject.toml Atualizado com dependências do Strands
    - project.json Atualizado com targets de serviço do agente
</FileTree>

:::note
A menos que você tenha selecionado `None` para `computeType`, o gerador também criará a infraestrutura CDK ou Terraform para implantar seu Strands Agent.
:::

## Trabalhando com Seu Strands Agent

### Adicionando Ferramentas

Ferramentas são funções que o agente de IA pode chamar para executar ações. O Strands usa uma abordagem baseada em decoradores para definir ferramentas.

Você pode adicionar novas ferramentas no arquivo [`agent.py`](packages/nx-plugin/src/py/strands-agent/files/agent.py.template:6):

```python
from strands import Agent, tool

@tool
def calculate_sum(numbers: list[int]) -> int:
    """Calculate the sum of a list of numbers"""
    return sum(numbers)

@tool
def get_weather(city: str) -> str:
    """Get weather information for a city"""
    # Your weather API integration here
    return f"Weather in {city}: Sunny, 25°C"

# Add tools to your agent
agent = Agent(
    system_prompt="You are a helpful assistant with access to various tools.",
    tools=[calculate_sum, get_weather],
)
```

O Strands gerencia automaticamente:
- Validação de tipos baseada em type hints
- Geração de schema JSON para chamadas de ferramentas
- Tratamento de erros e formatação de respostas

### Usando Ferramentas Pré-construídas

O Strands fornece ferramentas pré-construídas através do pacote `strands-tools`:

```python
from strands_tools import current_time, http_request, file_read

agent = Agent(
    system_prompt="You are a helpful assistant.",
    tools=[current_time, http_request, file_read],
)
```

### Configuração de Modelo

Por padrão, os agents usam Claude 4 Sonnet, mas você pode customizar o provedor. Veja [documentação do Strands sobre provedores de modelos](https://strandsagents.com/latest/documentation/docs/user-guide/quickstart/#model-providers):

```python
from strands import Agent
from strands.models import BedrockModel

# Create a BedrockModel
bedrock_model = BedrockModel(
    model_id="anthropic.claude-sonnet-4-20250514-v1:0",
    region_name="us-west-2",
    temperature=0.3,
)

agent = Agent(model=bedrock_model)
```

### Consumindo Servidores MCP

Você pode [adicionar ferramentas de servidores MCP](https://strandsagents.com/latest/documentation/docs/user-guide/concepts/tools/mcp-tools/) ao seu agent.

Para servidores MCP criados com os geradores <Link path="/guides/py-mcp-server">`py#mcp-server`</Link> ou <Link path="/guides/ts-mcp-server">`ts#mcp-server`</Link> (ou outros hospedados no Bedrock AgentCore Runtime), uma fábrica de clientes é gerada em `agentcore_mcp_client.py`.

Atualize o método `get_agent` em `agent.py` para criar clientes MCP e adicionar ferramentas. Exemplo com autenticação IAM (SigV4):

```python
# agent.py
import os
from contextlib import contextmanager

import boto3
from strands import Agent

from .agentcore_mcp_client import AgentCoreMCPClient

# Obtain the region an credentials
region = os.environ["AWS_REGION"]
boto_session = boto3.Session(region_name=region)
credentials = boto_session.get_credentials()

@contextmanager
def get_agent(session_id: str):
    mcp_client = AgentCoreMCPClient.with_iam_auth(
        agent_runtime_arn=os.environ["MCP_AGENTCORE_RUNTIME_ARN"],
        credentials=credentials,
        region=region,
        session_id=session_id,
    )

    with mcp_client:
        mcp_tools = mcp_client.list_tools_sync()

        yield Agent(
            system_prompt="..."
            tools=[*mcp_tools],
        )
```

:::tip
Se seu servidor MCP usar autenticação JWT, use `AgentCoreMCPClient.with_jwt_auth` ao invés.
:::

No exemplo acima, precisamos configurar duas coisas na infraestrutura:
1. Adicionar variável de ambiente com ARN do AgentCore Runtime
2. Conceder permissões de invocação ao agent

<Infrastructure>
<Fragment slot="cdk">
```ts {9, 13}
import { MyProjectAgent, MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    const mcpServer = new MyProjectMcpServer(this, 'MyProjectMcpServer');

    const agent = new MyProjectAgent(this, 'MyProjectAgent', {
      environment: {
        MCP_AGENTCORE_RUNTIME_ARN: mcpServer.agentCoreRuntime.arn,
      },
    });

    mcpServer.agentCoreRuntime.grantInvoke(agent.agentCoreRuntime);
  }
}
```
</Fragment>
<Fragment slot="terraform">
```terraform
# MCP Server
module "my_project_mcp_server" {
  source = "../../common/terraform/src/app/mcp-servers/my-project-mcp-server"
}

# Agent
module "my_project_agent" {
  source = "../../common/terraform/src/app/agents/my-project-agent"

  env = {
    MCP_AGENTCORE_RUNTIME_ARN = module.my_project_mcp_server.agent_core_runtime_arn
  }

  additional_iam_policy_statements = [
    {
      Effect = "Allow"
      Action = [
        "bedrock-agentcore:InvokeAgentRuntime"
      ]
      Resource = [
        module.my_project_mcp_server.agent_core_runtime_arn,
        "${module.my_project_mcp_server.agent_core_runtime_arn}/*"
      ]
    }
  ]
}
```
</Fragment>
</Infrastructure>

### Mais

Para um guia detalhado, consulte a [documentação do Strands](https://strandsagents.com/latest/documentation/docs/).

## Bedrock AgentCore Python SDK

O gerador configura o [Bedrock AgentCore Python SDK](https://github.com/aws/bedrock-agentcore-sdk-python) para gerenciar o contrato HTTP requerido pelo AgentCore.

Veja detalhes na [documentação](https://aws.github.io/bedrock-agentcore-starter-toolkit/user-guide/runtime/quickstart.html).

:::note
Como o gerador cria infraestrutura CDK/Terraform, você não precisa usar o `bedrock-agentcore-starter-toolkit` para implantação.
:::

## Executando Seu Strands Agent

### Desenvolvimento Local

O gerador configura um target `<your-agent-name>-serve` para executar o agent localmente:

<NxCommands commands={['run your-project:agent-serve']} />

Este comando usa `uv run` com o [Bedrock AgentCore Python SDK](https://github.com/aws/bedrock-agentcore-sdk-python).

## Implantando no Bedrock AgentCore Runtime

### Infraestrutura como Código

Se selecionou `BedrockAgentCoreRuntime` para `computeType`, a infraestrutura CDK/Terraform relevante é gerada para implantação.

<Infrastructure>
<Fragment slot="cdk">
Um construct CDK é gerado com base no nome escolhido (padrão: `<ProjectName>Agent`):

```ts {6}
import { MyProjectAgent } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    const agent = new MyProjectAgent(this, 'MyProjectAgent');

    agent.agentCoreRuntime.role.addToPolicy(
      new PolicyStatement({
        actions: [
          'bedrock:InvokeModel',
          'bedrock:InvokeModelWithResponseStream',
        ],
        resources: ['arn:aws:bedrock:*::foundation-model/*'],
      }),
    );
  }
}
```
</Fragment>
<Fragment slot="terraform">
Um módulo Terraform é gerado (padrão: `<ProjectName>-agent`):

```terraform
module "my_project_agent" {
  source = "../../common/terraform/src/app/agents/my-project-agent"

  additional_iam_policy_statements = [
    {
      Effect = "Allow"
      Action = [
        "bedrock:InvokeModel",
        "bedrock:InvokeModelWithResponseStream"
      ]
      Resource = [
        "arn:aws:bedrock:*::foundation-model/*"
      ]
    }
  ]
}
```
</Fragment>
</Infrastructure>

:::note
Ative os modelos necessários no Bedrock seguindo [estas instruções](https://docs.aws.amazon.com/bedrock/latest/userguide/model-access-modify.html).
:::

:::caution
[Docker](https://www.docker.com/) é obrigatório. Erros como abaixo indicam Docker não instalado:

```
ERROR: Cannot connect to the Docker daemon at unix://path/to/docker.sock.
```
:::

### Targets de Bundle e Docker

O target `bundle`:
- Exporta dependências para `requirements.txt` usando `uv export`
- Instala dependências para `aarch64-manylinux2014` usando `uv pip install`

O target `docker`:
- Constrói imagem a partir do `Dockerfile` seguindo o [contrato do AgentCore](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/runtime-service-contract.html)

:::tip
A tag da imagem (ex: `my-scope-my-project-agent:latest`) é referenciada pela infraestrutura CDK/Terraform.
:::

### Autenticação

#### IAM

Configuração padrão com IAM:

<Infrastructure>
<Fragment slot="cdk">
```ts {5}
import { MyProjectAgent } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    new MyProjectAgent(this, 'MyProjectAgent');
  }
}

// Conceder acesso
agent.agentCoreRuntime.grantInvoke(lambdaFunction);
```
</Fragment>
<Fragment slot="terraform">
```terraform
module "my_project_agent" {
  source = "../../common/terraform/src/app/agents/my-project-agent"
}

# Política de exemplo:
{
  Effect = "Allow"
  Action = ["bedrock-agentcore:InvokeAgentRuntime"]
  Resource = [module.my_project_agent.agent_core_runtime_arn]
}
```
</Fragment>
</Infrastructure>

#### Cognito JWT

Exemplo de configuração Cognito:

<Infrastructure>
<Fragment slot="cdk">
```ts {13-18}
new MyProjectAgent(this, 'MyProjectAgent', {
  authorizerConfiguration: {
    customJWTAuthorizer: {
      discoveryUrl: `https://cognito-idp.${region}.amazonaws.com/${userPoolId}/.well-known/openid-configuration`,
      allowedClients: [clientId],
    },
  },
});
```
</Fragment>
<Fragment slot="terraform">
```terraform {18-21}
module "agent_core_runtime" {
  # ...
  customJWTAuthorizer = {
    discoveryUrl = "https://cognito-idp.${local.aws_region}.amazonaws.com/${local.user_pool_id}/.well-known/openid-configuration",
    allowedClients = local.user_pool_client_ids
  }
}
```
</Fragment>
</Infrastructure>

### Observabilidade

Rastreamento automático com [AWS Distro for OpenTelemetry](https://aws.amazon.com/otel/). Visualize traces no CloudWatch em "GenAI Observability".

Consulte [documentação do AgentCore](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/observability-configure.html) para detalhes.