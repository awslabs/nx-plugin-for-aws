---
title: "Agente de Strands em Python"
description: "Gerar um Agente de Strands em Python para construir agentes de IA com ferramentas e implantar no Amazon Bedrock AgentCore Runtime"
---

import { FileTree } from '@astrojs/starlight/components';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import Link from '@components/link.astro';
import Snippet from '@components/snippet.astro';
import Infrastructure from '@components/infrastructure.astro';
import GeneratorParameters from '@components/generator-parameters.astro';

Gere um [Agente Strands](https://strandsagents.com/) em Python para construir agentes de IA com ferramentas, e opcionalmente implante-o no [Amazon Bedrock AgentCore Runtime](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/).

## O que é o Strands?

[Strands](https://strandsagents.com/latest/documentation/docs/) é um framework Python leve e pronto para produção para construção de agentes de IA. Principais recursos incluem:

- **Leve e personalizável**: Loop de agente simples que não atrapalha
- **Pronto para produção**: Observabilidade completa, tracing e opções de implantação para escala
- **Agnóstico de modelo e provedor**: Suporte a diversos modelos de vários provedores
- **Ferramentas comunitárias**: Conjunto poderoso de ferramentas contribuídas pela comunidade
- **Suporte a multiagentes**: Técnicas avançadas como equipes de agentes e agentes autônomos
- **Modos de interação flexíveis**: Suporte a conversacional, streaming e não-streaming

## Uso

### Gerar um Agente Strands

Você pode gerar um Agente Strands em Python de duas formas:

<RunGenerator generator="py#strands-agent" />

:::tip
Primeiro use o gerador <Link path="/guides/python-project">`py#project`</Link> para criar um projeto onde adicionar seu Agente Strands.
:::

### Opções

<GeneratorParameters generator="py#strands-agent" />

## Saída do Gerador

O gerador adicionará os seguintes arquivos ao seu projeto Python existente:

<FileTree>
  - your-project/
    - your_module/
      - agent/ (ou nome personalizado se especificado)
        - \_\_init\_\_.py Inicialização do pacote Python
        - agent.py Definição principal do agente com ferramentas de exemplo
        - main.py Ponto de entrada para Bedrock AgentCore Runtime
        - agentcore_mcp_client.py Fábrica de clientes útil para invocar servidores MCP também hospedados no Bedrock AgentCore Runtime
        - Dockerfile Ponto de entrada para hospedar seu agente (excluído quando `computeType` é `None`)
    - pyproject.toml Atualizado com dependências do Strands
    - project.json Atualizado com alvos de serviço do agente
</FileTree>

### Infraestrutura

:::note
Se selecionou `None` para `computeType`, o gerador não fornecerá nenhuma infraestrutura como código.
:::

<Snippet name="shared-constructs" />

Para implantar seu Agente Strands, os seguintes arquivos são gerados:

<Infrastructure>
<Fragment slot="cdk">
<FileTree>
  - packages/common/constructs/src
    - app
      - agents
        - \<project-name>
          - \<project-name>.ts Construct CDK para implantar seu agente
          - Dockerfile Arquivo Docker repassado usado pelo construct CDK
</FileTree>
</Fragment>
<Fragment slot="terraform">
<FileTree>
  - packages/common/terraform/src
    - app
      - agents
        - \<project-name>
          - \<project-name>.tf Módulo para implantar seu agente
    - core
      - agent-core
        - runtime.tf Módulo genérico para implantação no Bedrock AgentCore Runtime
</FileTree>
</Fragment>
</Infrastructure>

## Trabalhando com Seu Agente Strands

### Adicionando Ferramentas

Ferramentas são funções que o agente de IA pode chamar para executar ações. O framework Strands usa uma abordagem simples baseada em decoradores para definir ferramentas.

Você pode adicionar novas ferramentas no arquivo [`agent.py`](packages/nx-plugin/src/py/strands-agent/files/agent.py.template:6):

```python
from strands import Agent, tool

@tool
def calculate_sum(numbers: list[int]) -> int:
    """Calculate the sum of a list of numbers"""
    return sum(numbers)

@tool
def get_weather(city: str) -> str:
    """Get weather information for a city"""
    # Your weather API integration here
    return f"Weather in {city}: Sunny, 25°C"

# Add tools to your agent
agent = Agent(
    system_prompt="You are a helpful assistant with access to various tools.",
    tools=[calculate_sum, get_weather],
)
```

O framework Strands trata automaticamente:
- Validação de tipos baseada nas dicas de tipo da função
- Geração de schema JSON para chamadas de ferramentas
- Tratamento de erros e formatação de respostas

### Usando Ferramentas Pré-construídas

Strands fornece uma coleção de ferramentas pré-construídas através do pacote `strands-tools`:

```python
from strands_tools import current_time, http_request, file_read

agent = Agent(
    system_prompt="You are a helpful assistant.",
    tools=[current_time, http_request, file_read],
)
```

### Configuração de Modelo

Por padrão, agentes Strands usam Claude 4 Sonnet, mas você pode personalizar o provedor de modelo. Consulte a [documentação do Strands sobre provedores de modelos](https://strandsagents.com/latest/documentation/docs/user-guide/quickstart/#model-providers) para opções de configuração:

```python
from strands import Agent
from strands.models import BedrockModel

# Create a BedrockModel
bedrock_model = BedrockModel(
    model_id="anthropic.claude-sonnet-4-20250514-v1:0",
    region_name="us-west-2",
    temperature=0.3,
)

agent = Agent(model=bedrock_model)
```

### Consumindo Servidores MCP

Você pode [adicionar ferramentas de servidores MCP](https://strandsagents.com/latest/documentation/docs/user-guide/concepts/tools/mcp-tools/) ao seu agente Strands.

Para consumir servidores MCP criados usando os geradores <Link path="/guides/py-mcp-server">`py#mcp-server`</Link> ou <Link path="/guides/ts-mcp-server">`ts#mcp-server`</Link> (ou outros hospedados no Bedrock AgentCore Runtime), uma fábrica de clientes é gerada para você em `agentcore_mcp_client.py`.

Você pode atualizar seu método `get_agent` em `agent.py` para criar clientes MCP e adicionar ferramentas. O exemplo abaixo mostra como fazer isso com autenticação IAM (SigV4):

```python
# agent.py
import os
from contextlib import contextmanager

import boto3
from strands import Agent

from .agentcore_mcp_client import AgentCoreMCPClient

# Obtain the region an credentials
region = os.environ["AWS_REGION"]
boto_session = boto3.Session(region_name=region)
credentials = boto_session.get_credentials()

@contextmanager
def get_agent(session_id: str):
    mcp_client = AgentCoreMCPClient.with_iam_auth(
        agent_runtime_arn=os.environ["MCP_AGENTCORE_RUNTIME_ARN"],
        credentials=credentials,
        region=region,
        session_id=session_id,
    )

    with mcp_client:
        mcp_tools = mcp_client.list_tools_sync()

        yield Agent(
            system_prompt="..."
            tools=[*mcp_tools],
        )
```

:::tip
Se seu servidor MCP alvo usa autenticação JWT, você pode usar o método `AgentCoreMCPClient.with_jwt_auth` para criar o cliente.
:::

Com o exemplo de autenticação IAM acima, precisamos configurar duas coisas em nossa infraestrutura. Primeiro, adicionar a variável de ambiente que nosso agente consome para a ARN do AgentCore Runtime do servidor MCP, e segundo, conceder permissões ao nosso agente para invocar o servidor MCP. Isso pode ser feito da seguinte forma:

<Infrastructure>
<Fragment slot="cdk">
```ts {9, 13}
import { MyProjectAgent, MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    const mcpServer = new MyProjectMcpServer(this, 'MyProjectMcpServer');

    const agent = new MyProjectAgent(this, 'MyProjectAgent', {
      environmentVariables: {
        MCP_AGENTCORE_RUNTIME_ARN: mcpServer.agentCoreRuntime.agentRuntimeArn,
      },
    });

    mcpServer.agentCoreRuntime.grantInvoke(agent.agentCoreRuntime);
  }
}
```
</Fragment>
<Fragment slot="terraform">
```terraform
# MCP Server
module "my_project_mcp_server" {
  source = "../../common/terraform/src/app/mcp-servers/my-project-mcp-server"
}

# Agent
module "my_project_agent" {
  source = "../../common/terraform/src/app/agents/my-project-agent"

  env = {
    MCP_AGENTCORE_RUNTIME_ARN = module.my_project_mcp_server.agent_core_runtime_arn
  }

  additional_iam_policy_statements = [
    {
      Effect = "Allow"
      Action = [
        "bedrock-agentcore:InvokeAgentRuntime"
      ]
      Resource = [
        module.my_project_mcp_server.agent_core_runtime_arn,
        "${module.my_project_mcp_server.agent_core_runtime_arn}/*"
      ]
    }
  ]
}
```
</Fragment>
</Infrastructure>

### Mais

Para um guia mais detalhado sobre escrita de agentes Strands, consulte a [documentação do Strands](https://strandsagents.com/latest/documentation/docs/).

## Servidor FastAPI

O gerador usa [FastAPI](https://fastapi.tiangolo.com/) para criar o servidor HTTP para seu Agente Strands. FastAPI fornece um framework web moderno e rápido para construção de APIs com Python, com documentação automática de API e validação de tipos.

O servidor gerado inclui:
- Configuração da aplicação FastAPI com middleware CORS
- Middleware de tratamento de erros
- Geração de schema OpenAPI
- Endpoint de verificação de saúde (`/ping`)
- Endpoint de invocação do agente (`/invocations`)

### Personalizando Entradas e Saídas de Invocação com Pydantic

O endpoint de invocação do agente usa modelos [Pydantic](https://docs.pydantic.dev/) para definir e validar os schemas de requisição e resposta. Você pode personalizar esses modelos em `main.py` para atender aos requisitos do seu agente.

#### Definindo Modelos de Entrada

O modelo padrão `InvokeInput` aceita um prompt e um ID de sessão.

```python
from pydantic import BaseModel

class InvokeInput(BaseModel):
    prompt: str
    session_id: str
```

Você pode estender este modelo para incluir quaisquer campos adicionais que seu agente necessite.

:::caution
Você provavelmente desejará abstrair parte ou todo o ID de sessão do chamador se os usuários forem invocar seu agente diretamente. Por exemplo, você pode usar o ID do usuário autenticado como parte do ID de sessão.

Também vale a pena notar que, dependendo do seu caso de uso, você pode precisar implementar autorização para sessões, por exemplo, garantindo que os usuários possam acessar apenas suas próprias sessões e não as de outros usuários.
:::

#### Definindo Modelos de Saída

Para respostas em streaming, a anotação de tipo de retorno em seu endpoint corresponde ao tipo de cada valor produzido pela sua função geradora. Por padrão, o agente produz strings contendo o texto de resposta do agente conforme ele é transmitido de volta do Strands:

```python
@app.post("/invocations", openapi_extra={"x-streaming": True})
async def invoke(input: InvokeInput) -> str:
    """Entry point for agent invocation"""
    return StreamingResponse(handle_invoke(input), media_type="text/event-stream")
```

Você pode definir um modelo Pydantic para produzir dados estruturados em vez disso:

```python
from pydantic import BaseModel

class StreamChunk(BaseModel):
    content: str
    timestamp: str
    token_count: int

@app.post("/invocations", openapi_extra={"x-streaming": True})
async def invoke(input: InvokeInput) -> StreamChunk:
    return StreamingResponse(handle_invoke(input), media_type="application/json")
```

## Bedrock AgentCore Python SDK

O gerador inclui uma dependência no [Bedrock AgentCore Python SDK](https://github.com/aws/bedrock-agentcore-sdk-python) para as constantes `PingStatus`. Se desejar, é simples usar `BedrockAgentCoreApp` em vez de FastAPI, porém note que a segurança de tipos é perdida.

Você pode encontrar mais detalhes sobre as capacidades do SDK na [documentação aqui](https://aws.github.io/bedrock-agentcore-starter-toolkit/user-guide/runtime/quickstart.html).

:::note
Como o gerador fornece infraestrutura CDK ou Terraform que gerencia a implantação do seu agente, você não precisa utilizar o `bedrock-agentcore-starter-toolkit` mencionado na documentação para implantar seu agente.
:::

## Executando Seu Agente Strands

### Desenvolvimento Local

O gerador configura um alvo chamado `<your-agent-name>-serve`, que inicia seu Agente Strands localmente para desenvolvimento e testes.

<NxCommands commands={['run your-project:agent-serve']} />

Este comando usa `uv run` para executar seu Agente Strands usando o [Bedrock AgentCore Python SDK](https://github.com/aws/bedrock-agentcore-sdk-python).

## Implantando Seu Agente Strands no Bedrock AgentCore Runtime

### Infraestrutura como Código

Se selecionou `BedrockAgentCoreRuntime` para `computeType`, a infraestrutura CDK ou Terraform relevante é gerada para você implantar seu Agente Strands no [Amazon Bedrock AgentCore Runtime](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/agents-tools-runtime.html).

<Infrastructure>
<Fragment slot="cdk">
Um construct CDK é gerado para seu agente, nomeado com base no `name` escolhido ao executar o gerador, ou `<ProjectName>Agent` por padrão.

Você pode usar este construct CDK em uma aplicação CDK:

```ts {6}
import { MyProjectAgent } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    // Adicione o agente à sua stack
    const agent = new MyProjectAgent(this, 'MyProjectAgent');

    // Conceda permissões para invocar os modelos relevantes no bedrock
    agent.agentCoreRuntime.addToRolePolicy(
      new PolicyStatement({
        actions: [
          'bedrock:InvokeModel',
          'bedrock:InvokeModelWithResponseStream',
        ],
        // Você pode restringir abaixo aos modelos específicos que usa
        resources: ['arn:aws:bedrock:*::foundation-model/*'],
      }),
    );
  }
}
```

:::note
Este construct usa o [módulo `@aws-cdk/aws-bedrock-agentcore-alpha`](https://docs.aws.amazon.com/cdk/api/v2/docs/aws-bedrock-agentcore-alpha-readme.html).
:::
</Fragment>
<Fragment slot="terraform">
Um módulo Terraform é gerado para você, nomeado com base no `name` escolhido ao executar o gerador, ou `<ProjectName>-agent` por padrão.

Você pode usar este módulo Terraform em um projeto Terraform:

```terraform
# Agent
module "my_project_agent" {
  # Caminho relativo para o módulo gerado no projeto common/terraform
  source = "../../common/terraform/src/app/agents/my-project-agent"

  # Conceda permissões para invocar os modelos relevantes no bedrock
  additional_iam_policy_statements = [
    {
      Effect = "Allow"
      Action = [
        "bedrock:InvokeModel",
        "bedrock:InvokeModelWithResponseStream"
      ]
      Resource = [
        "arn:aws:bedrock:*::foundation-model/*"
      ]
    }
  ]
}
```
</Fragment>
</Infrastructure>

:::note
Ao implantar no Bedrock AgentCore Runtime, você precisará garantir que os modelos de fundação apropriados estejam habilitados em sua conta AWS. Por padrão, agentes Strands usam Claude 4 Sonnet, mas isso pode ser personalizado conforme descrito acima.

Para habilitar acesso a modelos no Amazon Bedrock, siga as [instruções aqui](https://docs.aws.amazon.com/bedrock/latest/userguide/model-access-modify.html).
:::

:::caution
[Docker](https://www.docker.com/) é necessário para construir e implantar seu Agente Strands. Certifique-se de ter instalado e iniciado o Docker para evitar erros como:

```
ERROR: Cannot connect to the Docker daemon at unix://path/to/docker.sock.
```
:::

### Alvos Bundle e Docker

Para construir seu Agente Strands para o Bedrock AgentCore Runtime, um alvo `bundle` é adicionado ao seu projeto, que:
- Exporta suas dependências Python para um arquivo `requirements.txt` usando `uv export`
- Instala dependências para a plataforma alvo (`aarch64-manylinux2014`) usando `uv pip install`

Um alvo `docker` específico para seu Agente Strands também é adicionado, que:
- Constrói uma imagem Docker a partir do `Dockerfile` que executa seu agente, conforme o [contrato de runtime do AgentCore](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/runtime-service-contract.html)

:::tip
A imagem Docker é construída usando uma tag (por exemplo `my-scope-my-project-agent:latest`), que é referenciada por sua infraestrutura CDK ou Terraform, permitindo que seu `Dockerfile` fique co-localizado com seu projeto do Agente Strands.
:::

### Autenticação

#### IAM

Por padrão, seu Agente Strands será protegido usando autenticação IAM. Basta implantá-lo sem argumentos:

<Infrastructure>
<Fragment slot="cdk">
```ts {5}
import { MyProjectAgent } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    new MyProjectAgent(this, 'MyProjectAgent');
  }
}
```

Você pode conceder acesso para invocar seu agente no Bedrock AgentCore Runtime usando o método `grantInvoke`, por exemplo:

```ts {8}
import { MyProjectAgent } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    const agent = new MyProjectAgent(this, 'MyProjectAgent');
    const lambdaFunction = new Function(this, ...);

    agent.agentCoreRuntime.grantInvoke(lambdaFunction);
  }
}
```
</Fragment>
<Fragment slot="terraform">
```terraform
# Agent
module "my_project_agent" {
  # Caminho relativo para o módulo gerado no projeto common/terraform
  source = "../../common/terraform/src/app/agents/my-project-agent"
}
```

Para conceder acesso para invocar seu agente, você precisará adicionar uma política como a seguinte, referenciando a saída `module.my_project_agent.agent_core_runtime_arn`:

```terraform
{
  Effect = "Allow"
  Action = [
    "bedrock-agentcore:InvokeAgentRuntime"
  ]
  Resource = [
    module.my_project_agent.agent_core_runtime_arn,
    "${module.my_project_agent.agent_core_runtime_arn}/*"
  ]
}
```
</Fragment>
</Infrastructure>

#### Autenticação Cognito JWT

O exemplo abaixo demonstra como configurar autenticação Cognito para seu agente.

<Infrastructure>
<Fragment slot="cdk">
Para configurar autenticação JWT usando Cognito, use o método de fábrica `RuntimeAuthorizerConfiguration.usingCognito()`:

```ts {13-16}
import { MyProjectAgent } from ':my-scope/common-constructs';
import { RuntimeAuthorizerConfiguration } from '@aws-cdk/aws-bedrock-agentcore-alpha';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    const userPool = new UserPool(this, 'UserPool');
    const client = userPool.addClient('Client', {
      authFlows: {
        userPassword: true,
      },
    });

    new MyProjectAgent(this, 'MyProjectAgent', {
      authorizerConfiguration: RuntimeAuthorizerConfiguration.usingCognito(
        userPool,
        [client],
      ),
    });
  }
}
```

Alternativamente, para autenticação JWT personalizada com seu próprio provedor OIDC, use `RuntimeAuthorizerConfiguration.usingJWT()`:

```ts {6-10}
import { MyProjectAgent } from ':my-scope/common-constructs';
import { RuntimeAuthorizerConfiguration } from '@aws-cdk/aws-bedrock-agentcore-alpha';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    new MyProjectAgent(this, 'MyProjectAgent', {
      authorizerConfiguration: RuntimeAuthorizerConfiguration.usingJWT(
        'https://example.com/.well-known/openid-configuration',
        ['client1', 'client2'], // IDs de Cliente Permitidos (opcional)
        ['audience1'],          // Audiências Permitidas (opcional)
      ),
    });
  }
}
```
</Fragment>
<Fragment slot="terraform">
Para configurar autenticação JWT, você pode editar seu módulo de agente para configurar a variável `authorizer_configuration` da seguinte forma:

```terraform {18-23}
# packages/common/terraform/src/app/agents/my-project-agent/my-project-agent.tf

data "aws_region" "current" {}

locals {
  aws_region = data.aws_region.current.id

  # Substitua pelos IDs do seu user pool e client ou exponha como variáveis
  user_pool_id = "xxx"
  user_pool_client_ids = ["yyy"]
}

module "agent_core_runtime" {
  source = "../../../core/agent-core"
  agent_runtime_name = "MyProjectAgent"
  docker_image_tag = "my-scope-my-project-agent:latest"
  server_protocol = "HTTP"
  authorizer_configuration = {
    custom_jwt_authorizer = {
      discovery_url = "https://cognito-idp.${local.aws_region}.amazonaws.com/${local.user_pool_id}/.well-known/openid-configuration"
      allowed_clients = local.user_pool_client_ids
    }
  }
  env = var.env
  additional_iam_policy_statements = var.additional_iam_policy_statements
  tags = var.tags
}
```
</Fragment>
</Infrastructure>

### Observabilidade

Seu agente é configurado automaticamente com observabilidade usando o [AWS Distro for Open Telemetry](https://aws.amazon.com/otel/) (ADOT), através da configuração de auto-instrumentação em seu `Dockerfile`.

Você pode encontrar traces no Console AWS CloudWatch, selecionando "GenAI Observability" no menu. Note que para os traces serem populados, você precisará habilitar o [Transaction Search](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-Transaction-Search.html).

Para mais detalhes, consulte a [documentação do AgentCore sobre observabilidade](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/observability-configure.html).