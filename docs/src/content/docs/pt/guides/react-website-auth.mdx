---
title: "Autenticação de Website em React"
description: "Documentação de referência para Autenticação de Website em React"
---



import { FileTree } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import RunGenerator from '@components/run-generator.astro';
import GeneratorParameters from '@components/generator-parameters.astro';
import NxCommands from '@components/nx-commands.astro';
import Infrastructure from '@components/infrastructure.astro';
import Snippet from '@components/snippet.astro';

O gerador de Autenticação para Website React adiciona autenticação ao seu site React usando [Amazon Cognito](https://aws.amazon.com/cognito/).

Este gerador configura a infraestrutura CDK ou Terraform para criar um User Pool do Cognito e um Identity Pool associado, além de uma interface hospedada para gerenciar fluxos de login de usuários e sua integração com seu website React.

## Utilização

### Adicionar autenticação ao seu website React

Você pode adicionar autenticação ao seu website React de duas formas:

<RunGenerator generator="ts#react-website#auth" />

### Opções

<GeneratorParameters generator="ts#react-website#auth" />

## Saída do Gerador

Você encontrará as seguintes alterações no seu website React:

<FileTree>
  - src
    - components
      - CognitoAuth
        - index.tsx Componente principal de autenticação
    - main.tsx Atualizado para instrumentar o componente CognitoAuth
</FileTree>

### Infraestrutura

<Snippet name="shared-constructs" />

Você também encontrará o seguinte código de infraestrutura gerado com base no `iacProvider` selecionado:

<Infrastructure>
<Fragment slot="cdk">
<FileTree>
  - packages/common/constructs/src
    - core
      - user-identity.ts Construct que define o user pool e identity pool
</FileTree>
</Fragment>
<Fragment slot="terraform">
<FileTree>
  - packages/common/terraform/src
    - core
      - user-identity
        - main.tf Módulo wrapper para configuração de identidade
        - identity
          - identity.tf Infraestrutura principal de identidade incluindo Cognito User Pool e Identity Pool
        - add-callback-url
          - add-callback-url.tf Módulo para adicionar URLs de callback a clientes existentes do user pool
</FileTree>
</Fragment>
</Infrastructure>

## Uso da Infraestrutura

<Infrastructure>
<Fragment slot="cdk">
Você precisará adicionar a infraestrutura de identidade do usuário à sua stack, declarando-a _antes_ do website:

```ts title="packages/infra/src/stacks/application-stack.ts" {3,9}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite, UserIdentity } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    new UserIdentity(this, 'Identity');

    new MyWebsite(this, 'MyWebsite');
  }
}
```

O construct `UserIdentity` adiciona automaticamente a <Link path="guides/react-website#runtime-configuration">Configuração de Runtime</Link> necessária para garantir que seu website possa apontar para o Cognito User Pool correto para autenticação.
</Fragment>
<Fragment slot="terraform">
Você precisará adicionar o módulo de identidade do usuário e garantir que seu website dependa dele:

```hcl title="packages/infra/src/main.tf" {2-4,14-15}
# Implanta identidade primeiro para adicionar à configuração de runtime
module "user_identity" {
  source = "../../common/terraform/src/core/user-identity"
}

# Implanta website após identidade para incluir configuração de runtime
module "my_website" {
  source = "../../common/terraform/src/app/static-websites/my-website"

  providers = {
    aws.us_east_1 = aws.us_east_1
  }

  # Garante que identidade seja implantada primeiro
  depends_on = [module.user_identity]
}
```

O módulo de identidade do usuário adiciona automaticamente a <Link path="guides/react-website#runtime-configuration">Configuração de Runtime</Link> necessária para garantir que seu website possa apontar para o Cognito User Pool correto para autenticação.
</Fragment>
</Infrastructure>

### Concedendo Acesso a Usuários Autenticados

Para conceder acesso a usuários autenticados para realizar determinadas ações, como conceder permissões para invocar uma API, você pode adicionar políticas IAM à função autenticada do identity pool:

<Infrastructure>
<Fragment slot="cdk">
```ts title="packages/infra/src/stacks/application-stack.ts" {12}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite, UserIdentity, MyApi } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    const identity = new UserIdentity(this, 'Identity');
    const api = new MyApi(this, 'MyApi');

    api.grantInvokeAccess(identity.identityPool.authenticatedRole);

    new MyWebsite(this, 'MyWebsite');
  }
}
```
</Fragment>
<Fragment slot="terraform">
```hcl title="packages/infra/src/main.tf" {12,22}
module "user_identity" {
  source = "../../common/terraform/src/core/user-identity"
}

module "my_api" {
  source = "../../common/terraform/src/app/apis/my-api"
}

# Adiciona permissões para usuários autenticados invocarem Fast API
resource "aws_iam_role_policy" "authenticated_fast_api_invoke" {
  name = "authenticated-user-invoke-my-api"
  role = module.user_identity.authenticated_role_name

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Effect = "Allow"
        Action = [
          "execute-api:Invoke"
        ]
        Resource = "${module.my_api.api_execution_arn}/*"
      }
    ]
  })
}
```
</Fragment>
</Infrastructure>