---
title: "Servidor MCP em TypeScript"
description: "Gerar um servidor de Protocolo de Contexto de Modelo (MCP) em TypeScript para fornecer contexto a Modelos de Linguagem de Grande Escala"
---



import { FileTree } from '@astrojs/starlight/components';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import Link from '@components/link.astro';
import Snippet from '@components/snippet.astro';
import GeneratorParameters from '@components/generator-parameters.astro';

Gere um servidor TypeScript do [Model Context Protocol (MCP)](https://modelcontextprotocol.io/) para fornecer contexto a Large Language Models (LLMs), e opcionalmente implante-o no [Amazon Bedrock AgentCore](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/).

## O que é o MCP?

O [Model Context Protocol (MCP)](https://modelcontextprotocol.io/) é um padrão aberto que permite a assistentes de IA interagirem com ferramentas e recursos externos. Ele fornece uma maneira consistente para LLMs:

- Executar ferramentas (funções) que realizam ações ou recuperam informações
- Acessar recursos que fornecem contexto ou dados

## Utilização

### Gerar um servidor MCP

Você pode gerar um servidor MCP em TypeScript de duas formas:

<RunGenerator generator="ts#mcp-server" />

:::tip
Primeiro use o gerador <Link path="/guides/typescript-project">`ts#project`</Link> para criar um projeto onde adicionar seu servidor MCP.
:::

### Opções

<GeneratorParameters generator="ts#mcp-server" />

## Saída do Gerador

O gerador adicionará os seguintes arquivos ao seu projeto TypeScript existente:

<FileTree>
  - your-project/
    - src/
      - mcp-server/ (ou nome personalizado se especificado)
        - index.ts Exporta seu servidor
        - server.ts Definição principal do servidor
        - stdio.ts Ponto de entrada para transporte STDIO, útil para servidores MCP locais simples
        - http.ts Ponto de entrada para transporte HTTP Streamable, útil para hospedar seu servidor MCP
        - tools/
          - add.ts Exemplo de ferramenta
        - resources/
          - sample-guidance.ts Exemplo de recurso
        - Dockerfile Ponto de entrada para hospedar seu servidor MCP (excluído quando `computeType` é definido como `None`)
    - package.json Atualizado com entrada bin e dependências MCP
    - project.json Atualizado com alvo de serviço do servidor MCP
</FileTree>

### Infraestrutura

:::note
Se você selecionou `None` para `computeType`, o gerador não fornecerá nenhum código de infraestrutura.
:::

<Snippet name="shared-constructs" />

<Snippet name="mcp/shared-constructs" />

## Trabalhando com Seu Servidor MCP

### Adicionando Ferramentas

Ferramentas são funções que o assistente de IA pode chamar para realizar ações. Você pode adicionar novas ferramentas no arquivo `server.ts`:

```typescript
server.tool("toolName", "tool description",
  { param1: z.string(), param2: z.number() }, // Esquema de entrada usando Zod
  async ({ param1, param2 }) => {
    // Implementação da ferramenta
    return {
      content: [{ type: "text", text: "Result" }]
    };
  }
);
```

:::caution
O SDK MCP atualmente só suporta Zod v3. Para permitir o uso do Zod v4 em outros geradores, a dependência do Zod v3 é instalada como `zod-v3`. Para esquemas de ferramentas MCP, você precisará importar Zod da seguinte forma:

```ts
import { z } from 'zod-v3';
```

Uma vez que [este problema com o SDK MCP](https://github.com/modelcontextprotocol/typescript-sdk/issues/164) for resolvido, você poderá remover a dependência adicional `zod-v3` e importar diretamente de `zod`.
:::

### Adicionando Recursos

Recursos fornecem contexto ao assistente de IA. Você pode adicionar recursos estáticos de arquivos ou recursos dinâmicos:

```typescript
const exampleContext = 'algum contexto para retornar';

server.resource('resource-name', 'example://resource', async (uri) => ({
  contents: [{ uri: uri.href, text: exampleContext }],
}));

// Recurso dinâmico
server.resource('dynamic-resource', 'dynamic://resource', async (uri) => {
  const data = await fetchSomeData();
  return {
    contents: [{ uri: uri.href, text: data }],
  };
});
```

## Configurando com Assistente de IA

<Snippet name="mcp/configuration-ts" parentHeading="Configurando com Assistente de IA" />

## Executando Seu Servidor MCP

### Inspector

O gerador configura um alvo chamado `<your-server-name>-inspect`, que inicia o [MCP Inspector](https://github.com/modelcontextprotocol/inspector) com a configuração para conectar ao seu servidor MCP usando transporte STDIO.

<NxCommands commands={['run your-project:your-server-name-inspect']} />

Isso iniciará o inspector em `http://localhost:6274`. Comece clicando no botão "Connect".

### STDIO

A maneira mais fácil de testar e usar um servidor MCP é usando o inspector ou configurando-o com um assistente de IA (como acima).

Você também pode executar seu servidor com [transporte STDIO](https://modelcontextprotocol.io/docs/concepts/transports#standard-input%2Foutput-stdio) diretamente usando o alvo `<your-server-name>-serve-stdio`.

<NxCommands commands={['run your-project:your-server-name-serve-stdio']} />

Este comando usa `tsx --watch` para reiniciar automaticamente o servidor quando arquivos mudarem.

### HTTP Streamable

Se você deseja executar seu servidor MCP localmente usando [transporte HTTP Streamable](https://modelcontextprotocol.io/docs/concepts/transports#streamable-http), pode usar o alvo `<your-server-name>-serve-http`.

<NxCommands commands={['run your-project:your-server-name-serve-http']} />

Este comando usa `tsx --watch` para reiniciar automaticamente o servidor quando arquivos mudarem.

## Implantando Seu Servidor MCP no Bedrock AgentCore Runtime

<Snippet name="mcp/bedrock-deployment" parentHeading="Implantando Seu Servidor MCP no Bedrock AgentCore Runtime" />

### Alvo de Bundle

<Snippet name="ts-bundle" />

O alvo de bundle usa `http.ts` como ponto de entrada para o servidor MCP HTTP Streamable hospedado no Bedrock AgentCore Runtime.

### Alvo Docker

O gerador configura um alvo `<your-server-name>-docker` que executa o servidor MCP HTTP Streamable empacotado na porta `8000` conforme o [contrato do protocolo MCP](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/runtime-service-contract.html#mcp-protocol-contract).

:::tip
A imagem docker é construída usando uma tag (por exemplo `my-scope-my-project-mcp-server:latest`), da qual o constructo CDK `Dockerfile` herda, permitindo que seu `Dockerfile` fique colocado junto ao projeto do servidor MCP.
:::

Um alvo `docker` também é gerado para executar o build docker para todos servidores MCP se você tiver múltiplos definidos.

### Observabilidade

<Snippet name="mcp/observability" parentHeading="Observabilidade" />