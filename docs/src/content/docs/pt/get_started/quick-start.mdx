---
title: "Guia de In√≠cio R√°pido"
description: "Um in√≠cio r√°pido sobre como usar @aws/nx-plugin."
---

import { Steps } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import Snippet from '@components/snippet.astro';
import CreateNxWorkspaceCommand from '@components/create-nx-workspace-command.astro';
import InstallCommand from '@components/install-command.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import Infrastructure from '@components/infrastructure.astro';

Este guia orienta voc√™ atrav√©s dos fundamentos de instala√ß√£o e uso do `@aws/nx-plugin` para construir projetos rapidamente na AWS.

:::tip
Para um tutorial mais detalhado sobre como construir uma aplica√ß√£o full-stack, confira o <Link path="get_started/tutorials/dungeon-game/overview">Tutorial Dungeon Adventure</Link>.
:::

## Pr√©-requisitos

As seguintes depend√™ncias globais s√£o necess√°rias antes de prosseguir:

<Snippet name="prerequisites" />

## Passo 1: Inicializar um Novo Workspace Nx

Execute o seguinte comando para criar um workspace Nx com o gerenciador de pacotes de sua prefer√™ncia:

<CreateNxWorkspaceCommand workspace="my-project" />

:::tip
Voc√™ ser√° questionado sobre seu provedor de infraestrutura como c√≥digo (IaC) preferido, [CDK](https://docs.aws.amazon.com/cdk/) ou [Terraform](https://developer.hashicorp.com/terraform). Voc√™ pode pular a pergunta executando o comando com `--iacProvider`, ex:

<Infrastructure>
<Fragment slot="cdk">
<CreateNxWorkspaceCommand workspace="my-project" iacProvider="CDK" />
</Fragment>
<Fragment slot="terraform">
<CreateNxWorkspaceCommand workspace="my-project" iacProvider="Terraform" />
</Fragment>
</Infrastructure>
:::

Ap√≥s a conclus√£o, navegue at√© o diret√≥rio do projeto:

```sh
cd my-project
```

## Passo 2: Usar Geradores para Estruturar seu Projeto

Neste guia r√°pido, adicionaremos uma API tRPC, Website React, Autentica√ß√£o Cognito e Infraestrutura CDK ou Terraform. Dependendo do tipo de projeto que voc√™ est√° construindo, voc√™ pode escolher qualquer combina√ß√£o de geradores para inicializar rapidamente seu projeto. Confira os __Guias__ na barra de navega√ß√£o √† esquerda para ver a lista completa de op√ß√µes.

### Adicionar uma API tRPC

<RunGenerator generator="ts#trpc-api" requiredParameters={{ name: 'demo-api', auth: 'IAM' }} />

Isso criar√° a API na pasta `packages/demo-api`.

### Adicionar um Website React

<RunGenerator generator="ts#react-website" requiredParameters={{ name: 'demo-website' }} />

Isso estruturar√° um novo website React em `packages/demo-website`.

### Adicionar Autentica√ß√£o Cognito

<RunGenerator generator="ts#react-website#auth" requiredParameters={{ project: '@my-project/demo-website', cognitoDomain: 'my-demo' }} />

Isso configurar√° a infraestrutura necess√°ria e o c√≥digo React para adicionar Autentica√ß√£o Cognito ao seu website.

### Conectar Frontend ao Backend

<RunGenerator generator="connection" requiredParameters={{ sourceProject: '@my-project/demo-website', targetProject: '@my-project/demo-api' }} />

Isso configurar√° os provedores necess√°rios para garantir que seu website possa chamar sua API tRPC.

### Adicionar Infraestrutura

Adicione o projeto de infraestrutura baseado no seu provedor IaC escolhido.

<Infrastructure>
<Fragment slot="cdk">
<RunGenerator generator="ts#infra" requiredParameters={{ name: 'infra' }} />

Isso configura uma Aplica√ß√£o CDK que voc√™ pode usar para implantar sua infraestrutura na AWS.
</Fragment>
<Fragment slot="terraform">
<RunGenerator generator="terraform#project" requiredParameters={{ name: 'infra' }} />

Isso configura um projeto Terraform que voc√™ pode usar para implantar sua infraestrutura na AWS.
</Fragment>
</Infrastructure>

## Passo 3: Executar seu Website e API Localmente

Use o seguinte comando para iniciar servidores locais de desenvolvimento para seu website e APIs conectadas:

<NxCommands commands={['run demo-website:serve-local']} />

Seu website estar√° dispon√≠vel em `http://localhost:4200`.

Altera√ß√µes no website e na API ser√£o refletidas em tempo real, pois ambos os servidores locais recarregar√£o automaticamente.

## Passo 4: Definir Recursos Cloud e Implantar na AWS

<Infrastructure>
<Fragment slot="cdk">
Abra `packages/infra/src/stacks/application-stack.ts` e adicione o seguinte c√≥digo:

```typescript
import * as cdk from 'aws-cdk-lib';
import { DemoApi, DemoWebsite, UserIdentity } from ':my-project/common-constructs';
import { Construct } from 'constructs';

export class ApplicationStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    const identity = new UserIdentity(this, 'identity');
    const api = new DemoApi(this, 'api', {
      integrations: DemoApi.defaultIntegrations(this).build(),
    });
    api.grantInvokeAccess(identity.identityPool.authenticatedRole);

    new DemoWebsite(this, 'website');
  }
}
```

Este √© todo o c√≥digo CDK necess√°rio para implantar nossa aplica√ß√£o full-stack.
</Fragment>
<Fragment slot="terraform">
Abra `packages/infra/src/main.tf` e adicione o seguinte c√≥digo:

```hcl
# Inclui rastreamento de m√©tricas para uso do @aws/nx-plugin
module "metrics" {
  source = "../../common/terraform/src/metrics"
}

# Implanta identidade do usu√°rio
module "user_identity" {
  source = "../../common/terraform/src/core/user-identity"
}

# Implanta API
module "demo_api" {
  source = "../../common/terraform/src/app/apis/demo-api"
}

# Concede acesso a usu√°rios autenticados para invocar a API
resource "aws_iam_policy" "api_invoke_policy" {
  name        = "DemoApiInvokePolicy"
  description = "Pol√≠tica para permitir que usu√°rios autenticados invoquem a API"

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Effect = "Allow"
        Action = "execute-api:Invoke"
        Resource = "${module.demo_api.api_execution_arn}/*/*"
      }
    ]
  })
}

resource "aws_iam_role_policy_attachment" "authenticated_api_access" {
  role       = module.user_identity.authenticated_role_name
  policy_arn = aws_iam_policy.api_invoke_policy.arn
}

# Implanta website
provider "aws" {
  alias  = "us_east_1"
  region = "us-east-1"
}

module "demo_website" {
  source = "../../common/terraform/src/app/static-websites/demo-website"

  providers = {
    aws.us_east_1 = aws.us_east_1
  }

  depends_on = [module.user_identity, module.demo_api]
}
```

Este √© todo o c√≥digo Terraform necess√°rio para implantar nossa aplica√ß√£o full-stack.
</Fragment>
</Infrastructure>

### Construir e Implantar a Infraestrutura

Em seguida, execute o seguinte comando para construir seu projeto:

<NxCommands commands={['run-many --target build --all']} />

:::tip
Se encontrar erros de lint, voc√™ pode executar o seguinte comando para corrigi-los automaticamente:

<NxCommands commands={['run-many --target lint --configuration=fix --all']} />
:::

Inicialize sua infraestrutura:

<Infrastructure>
<Fragment slot="cdk">
<NxCommands commands={['run infra:bootstrap']} />

:::tip
O bootstrap do CDK √© necess√°rio tanto para a regi√£o AWS de implanta√ß√£o quanto para `us-east-1` para permitir a implanta√ß√£o do AWS WAF WebACL para o website.
:::
</Fragment>
<Fragment slot="terraform">
<NxCommands commands={['run infra:bootstrap']} />

:::tip
O bootstrap do Terraform cria um bucket S3 para armazenar seus arquivos de estado do Terraform. Isso s√≥ precisa ser feito uma vez por combina√ß√£o de conta/regi√£o AWS.
:::
</Fragment>
</Infrastructure>

Implante seu projeto:

<Infrastructure>
<Fragment slot="cdk">
<NxCommands commands={['run infra:deploy "my-project-sandbox/*"']} />
</Fragment>
<Fragment slot="terraform">
<NxCommands commands={['run infra:apply']} />

:::tip
Este comando primeiro executar√° `terraform plan` para mostrar as altera√ß√µes planejadas, depois aplicar√° essas altera√ß√µes para implantar sua infraestrutura.
:::
</Fragment>
</Infrastructure>

## Passo 5: Testar o Website com Recursos Cloud Implantados

<Steps>
1. Obtenha o arquivo `runtime-config.json`:

    <NxCommands commands={['run demo-website:load:runtime-config']} />

2. Inicie o servidor local do website

    <NxCommands commands={['run demo-website:serve']} />
</Steps>

Seu website estar√° dispon√≠vel em `http://localhost:4200` e apontar√° para os recursos implantados da API e autentica√ß√£o.

---

Parab√©ns! üéâ Voc√™ construiu e implantou com sucesso uma aplica√ß√£o full-stack usando `@aws/nx-plugin`!