---
title: "Construir a UI"
description: "Um guia passo a passo de como construir um jogo de aventura de dungeon com IA ag√™ntica usando o @aws/nx-plugin."
---

import { Aside, Code, FileTree, Steps, Tabs, TabItem } from '@astrojs/starlight/components';
import { Image } from 'astro:assets';
import Drawer from '@components/drawer.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import InstallCommand from '@components/install-command.astro';
import E2ECode from '@components/e2e-code.astro';
import E2EDiff from '@components/e2e-diff.astro';

import dungeonAdventureArchitecturePng from '@assets/dungeon-game-architecture.png'
import dungeonAdventureErPng from '@assets/dungeon-adventure-er.png'
import baselineWebsitePng from '@assets/baseline-website.png'
import baselineGamePng from '@assets/baseline-game.png'
import nxGraphPng from '@assets/nx-graph.png'
import gameSelectPng from '@assets/game-select.png'
import gameConversationPng from '@assets/game-conversation.png'

## Tarefa 1: Configurar o servidor de desenvolvimento local

Para come√ßar a construir a UI, precisamos configurar nosso servidor de desenvolvimento local para apontar para o sandbox implantado. Para fazer isso, execute o seguinte comando:

<NxCommands commands={["run @dungeon-adventure/game-ui:load:runtime-config"]} />

Este comando ir√° baixar o `runtime-config.json` que est√° implantado e armazen√°-lo localmente na pasta `packages/game-ui/public`.

Para iniciar o servidor de desenvolvimento, execute o seguinte comando:

<NxCommands commands={["run @dungeon-adventure/game-ui:serve"]} />

Abra seu site local em um navegador, onde voc√™ ser√° solicitado a fazer login e seguir as instru√ß√µes para criar um novo usu√°rio. Ap√≥s concluir, voc√™ dever√° ver o site base:

<Image src={baselineWebsitePng} alt="baseline-website.png" width="800" height="600" />

<Aside type="caution">
Recomendamos manter o servidor de desenvolvimento em execu√ß√£o durante o restante deste m√≥dulo, pois ele recarregar√° automaticamente quaisquer altera√ß√µes que fizermos.
</Aside>

:::tip
Voc√™ pode executar comandos Nx para iniciar tamb√©m quaisquer servidores de API locais conectados, permitindo que voc√™ itere tanto na API tRPC quanto no site simultaneamente. <NxCommands commands={["run @dungeon-adventure/game-ui:serve-local"]} /> 
:::

## Tarefa 2: Criar uma nova rota '/game'

Vamos demonstrar as capacidades do `@tanstack/react-router` criando uma nova rota tipada.
Para fazer isso, crie um arquivo vazio no seguinte local: `packages/game-ui/src/routes/game/index.tsx`. Voc√™ notar√° que o arquivo √© atualizado imediatamente.

O `@tanstack/react-router` configura automaticamente sua nova rota e o arquivo que voc√™ acabou de criar j√° est√° populado com o caminho da rota:

```tsx
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/game/')({
  component: RouteComponent,
})

function RouteComponent() {
  return <div>Hello "/game/"!</div>
}
```

Se voc√™ navegar para `http://localhost:4200/game`, ver√° que sua nova p√°gina foi renderizada.

<Image src={baselineGamePng} alt="baseline-game.png" width="800" height="600" />

Atualize o arquivo `index.tsx` para carregar nossa nova rota `/game` por padr√£o. Quando voc√™ atualizar o campo `to`, ter√° uma lista de rotas tipadas para escolher.

<Tabs>
<TabItem label="routes/index.tsx">
<E2EDiff before="dungeon-adventure/4/routes/index.tsx.old.template" after="dungeon-adventure/4/routes/index.tsx.template" lang="tsx" />
</TabItem>
</Tabs>

Voc√™ pode excluir a pasta `packages/game-ui/src/routes/welcome/` pois n√£o √© mais necess√°ria.

## Tarefa 3: Atualizar o layout

O layout padr√£o configurado √© mais similar a um aplicativo empresarial no estilo SaaS do que a um jogo.
Para reconfigurar o layout e retematiz√°-lo para se parecer mais com um jogo de masmorra, fa√ßa as seguintes altera√ß√µes em `packages/game-ui/src`:

<Tabs>
<TabItem label="config.ts">
<E2EDiff before="dungeon-adventure/4/config.ts.old.template" after="dungeon-adventure/4/config.ts.template" lang="typescript" />
</TabItem>
<TabItem label="components/AppLayout/index.tsx">
<E2ECode path="dungeon-adventure/4/AppLayout/index.tsx.template" lang="tsx" />
</TabItem>
<TabItem label="styles.css">
<E2ECode path="dungeon-adventure/4/styles.css.template" lang="css" />
</TabItem>
</Tabs>

Exclua o arquivo `packages/game-ui/src/hooks/useAppLayout.tsx` pois n√£o est√° sendo usado.

## Tarefa 4: Integrar o Agente de Hist√≥ria

Vamos criar um hook para inicializar um cliente de intera√ß√£o com nosso Agente de Hist√≥ria.

<Tabs>
<TabItem label="hooks/useStoryAgent.tsx">
<E2ECode path="dungeon-adventure/4/hooks/useStoryAgent.tsx.template" lang="tsx" />
</TabItem>
</Tabs>

Este hook:

- Recupera o ARN do Agente do `runtime-config.json`,
- Constr√≥i a URL de invoca√ß√£o do AgentCore Runtime a partir do ARN,
- Invoca o Agente com o token JWT do usu√°rio autenticado e um ID de sess√£o aleat√≥rio, e
- Retorna um iterador ass√≠ncrono para consumo de chunks de mensagens transmitidas do agente.

:::tip
A integra√ß√£o com nossa Game API j√° est√° configurada, pois usamos o gerador `api-connection`. Se desejar uma experi√™ncia similar para agentes, +1 [nesta issue do GitHub](https://github.com/awslabs/nx-plugin-for-aws/issues/326).
:::

## Tarefa 5: Criar as p√°ginas do jogo

Para criar as p√°ginas do jogo que chamar√£o nossas APIs e finalizar√£o a implementa√ß√£o do jogo, atualize os seguintes arquivos em `packages/game-ui/src/routes/game`:

<Tabs>
<TabItem label="index.tsx">
<E2ECode path="dungeon-adventure/4/routes/game/index.tsx.template" lang="tsx" />
</TabItem>
<TabItem label="$playerName.tsx">

<E2ECode path="dungeon-adventure/4/routes/game/$playerName.tsx.template" lang="tsx" />

<Aside type="tip">
A sintaxe `$playerName` instrui o `@tanstack/react-router` a tratar `playerName` como um [par√¢metro de caminho](https://tanstack.com/router/v1/docs/framework/react/guide/path-params). Al√©m disso, implementamos o m√©todo `validateSearch` que garante que o par√¢metro de consulta `genre` seja fortemente tipado com nosso enum de g√™neros.
</Aside>
</TabItem>
</Tabs>

Ap√≥s fazer essas altera√ß√µes, seu servidor de desenvolvimento local (http://localhost:4200/) deve ter seu jogo pronto para jogar.

<Drawer title="Compilar e Implantar" trigger="Voc√™ tamb√©m pode compilar e implantar seu c√≥digo no Cloudfront se preferir.">

## Tarefa 6: Compilar e implantar

### Compilar seu c√≥digo
Para compilar seu c√≥digo, execute o seguinte comando:

<NxCommands commands={['run-many --target build --all']} />

### Implantar sua aplica√ß√£o
Para implantar sua aplica√ß√£o, execute o seguinte comando:

<NxCommands commands={['run @dungeon-adventure/infra:deploy dungeon-adventure-infra-sandbox/*']} />

Ap√≥s a implanta√ß√£o, navegue at√© sua URL do Cloudfront. Para encontrar esta URL, inspecione as sa√≠das do deploy do CDK.

</Drawer>

<Image src={gameSelectPng} alt="game-select.png" width="500" height="400" />
<div style="margin-top: -100px; margin-left: 100px;">
<Image src={gameConversationPng} alt="game-conversation.png" width="500" height="400" />
</div>

Parab√©ns. Voc√™ construiu e implantou seu Jogo de Aventura em Masmorra com Agentes!  üéâüéâüéâ