---
title: "Serveur MCP TypeScript"
description: "Générer un serveur de protocole de contexte de modèle (MCP) TypeScript pour fournir du contexte aux modèles de langage de grande taille"
---



import { FileTree } from '@astrojs/starlight/components';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import Link from '@components/link.astro';
import Snippet from '@components/snippet.astro';
import GeneratorParameters from '@components/generator-parameters.astro';

Générer un serveur TypeScript [Model Context Protocol (MCP)](https://modelcontextprotocol.io/) pour fournir du contexte aux Grands Modèles de Langage (LLMs), avec option de déploiement sur [Amazon Bedrock AgentCore](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/).

## Qu'est-ce que le MCP ?

Le [Model Context Protocol (MCP)](https://modelcontextprotocol.io/) est une norme ouverte permettant aux assistants IA d'interagir avec des outils et ressources externes. Il fournit une méthode standardisée pour que les LLMs puissent :

- Exécuter des outils (fonctions) réalisant des actions ou récupérant des informations
- Accéder à des ressources fournissant du contexte ou des données

## Utilisation

### Générer un serveur MCP

Vous pouvez générer un serveur MCP TypeScript de deux manières :

<RunGenerator generator="ts#mcp-server" />

:::tip
Commencez par utiliser le générateur <Link path="/guides/typescript-project">`ts#project`</Link> pour créer un projet avant d'y ajouter votre serveur MCP.
:::

### Options

<GeneratorParameters generator="ts#mcp-server" />

## Résultat du générateur

Le générateur ajoutera les fichiers suivants à votre projet TypeScript existant :

<FileTree>
  - your-project/
    - src/
      - mcp-server/ (ou nom personnalisé si spécifié)
        - index.ts Exporte votre serveur
        - server.ts Définition principale du serveur
        - stdio.ts Point d'entrée pour le transport STDIO, utile pour des serveurs MCP locaux simples
        - http.ts Point d'entrée pour le transport HTTP streamable, utile pour héberger votre serveur MCP
        - tools/
          - add.ts Exemple d'outil
        - resources/
          - sample-guidance.ts Exemple de ressource
        - Dockerfile Point d'entrée pour héberger votre serveur MCP (lorsque `computeType` est défini sur `BedrockAgentCoreRuntime`)
    - package.json Mis à jour avec l'entrée bin et les dépendances MCP
    - project.json Mis à jour avec la cible de service du serveur MCP
</FileTree>

:::note
Si vous avez sélectionné `BedrockAgentCoreRuntime` pour `computeType`, le générateur créera également un construct CDK pour déployer votre serveur MCP.
:::

## Utilisation de votre serveur MCP

### Ajout d'outils

Les outils sont des fonctions que l'assistant IA peut appeler pour effectuer des actions. Vous pouvez ajouter de nouveaux outils dans le fichier `server.ts` :

```typescript
server.tool("toolName", "tool description",
  { param1: z.string(), param2: z.number() }, // Schéma d'entrée utilisant Zod
  async ({ param1, param2 }) => {
    // Implémentation de l'outil
    return {
      content: [{ type: "text", text: "Result" }]
    };
  }
);
```

:::caution
Le SDK MCP ne prend actuellement en charge que Zod v3. Pour permettre l'utilisation de Zod v4 dans d'autres générateurs, la dépendance à Zod v3 est installée sous `zod-v3`. Pour les schémas d'outils MCP, vous devrez importer Zod comme suit :

```ts
import { z } from 'zod-v3';
```

Une fois [ce problème du SDK MCP](https://github.com/modelcontextprotocol/typescript-sdk/issues/164) résolu, vous pourrez supprimer la dépendance `zod-v3` et importer directement depuis `zod`.
:::

### Ajout de ressources

Les ressources fournissent du contexte à l'assistant IA. Vous pouvez ajouter des ressources statiques depuis des fichiers ou des ressources dynamiques :

```typescript
const exampleContext = 'contexte à retourner';

server.resource('resource-name', 'example://resource', async (uri) => ({
  contents: [{ uri: uri.href, text: exampleContext }],
}));

// Ressource dynamique
server.resource('dynamic-resource', 'dynamic://resource', async (uri) => {
  const data = await fetchSomeData();
  return {
    contents: [{ uri: uri.href, text: data }],
  };
});
```

## Configuration avec des assistants IA

<Snippet name="mcp/configuration" parentHeading="Configuring with AI Assistants" />

## Exécution de votre serveur MCP

### STDIO

La méthode la plus simple pour tester et utiliser un serveur MCP est de le configurer avec un assistant IA (comme ci-dessus).

Vous pouvez cependant exécuter votre serveur avec le [transport STDIO](https://modelcontextprotocol.io/docs/concepts/transports#standard-input%2Foutput-stdio) directement en utilisant la cible `<your-server-name>-serve-stdio`.

<NxCommands commands={['run your-project:your-server-name-serve-stdio']} />

Cette commande utilise `tsx --watch` pour redémarrer automatiquement le serveur lors des modifications de fichiers.

### HTTP Streamable

Pour exécuter votre serveur MCP localement avec le [transport HTTP streamable](https://modelcontextprotocol.io/docs/concepts/transports#streamable-http), utilisez la cible `<your-server-name>-serve-http`.

<NxCommands commands={['run your-project:your-server-name-serve-http']} />

Cette commande utilise `tsx --watch` pour redémarrer automatiquement le serveur lors des modifications de fichiers.

## Déploiement sur Bedrock AgentCore Runtime

Si vous avez sélectionné `BedrockAgentCoreRuntime` pour `computeType`, un construct CDK est généré pour déployer votre serveur MCP sur [Amazon Bedrock AgentCore Runtime](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/agents-tools-runtime.html).

Utilisez ce construct CDK dans une application CDK :

```ts {6}
import { MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    // Ajoute le serveur MCP à votre pile
    new MyProjectMcpServer(this, 'MyProjectMcpServer');
  }
}
```

:::caution
[Docker](https://www.docker.com/) est requis pour construire et déployer votre serveur MCP. Assurez-vous que Docker est installé et lancé pour éviter des erreurs comme :

```
ERROR: Cannot connect to the Docker daemon at unix://path/to/docker.sock.
```
:::

### Authentification

#### IAM

Par défaut, votre serveur MCP sera sécurisé avec l'authentification IAM. Déployez-le simplement sans arguments :

```ts {5}
import { MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    new MyProjectMcpServer(this, 'MyProjectMcpServer');
  }
}
```

#### Authentification JWT avec Cognito

Pour configurer l'authentification JWT, passez la propriété `authorizerConfiguration` à votre construct MCP. Exemple avec un pool d'utilisateurs Cognito :

```ts {14-17}
import { MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    const userPool = new UserPool(this, 'UserPool');
    const client = userPool.addClient('Client', {
      authFlows: {
        userPassword: true,
      },
    });

    new MyProjectMcpServer(this, 'MyProjectMcpServer', {
      authorizerConfiguration: {
        customJWTAuthorizer: {
          discoveryUrl: `https://cognito-idp.${Stack.of(userPool).region}.amazonaws.com/${userPool.userPoolId}/.well-known/openid-configuration`,
          allowedClients: [client.userPoolClientId],
        },
      },
    });
  }
}
```

### Cible de bundle

Pour construire votre serveur MCP pour Bedrock AgentCore Runtime, une cible `<your-mcp-server>-bundle` est ajoutée à votre projet. Elle :

- Bundle votre serveur MCP en un seul fichier JavaScript avec [`esbuild`](https://esbuild.github.io/), utilisant `http.ts` comme point d'entrée
- Construit une image Docker depuis le `Dockerfile` exécutant ce serveur sur le port `8000`, conformément au [contrat de service MCP](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/runtime-service-contract.html#mcp-protocol-contract)

:::tip
L'image Docker est construite avec un tag (ex: `my-scope-my-project-mcp-server:latest`), que le `Dockerfile` du construct CDK hérite, permettant de co-localiser votre `Dockerfile` avec votre projet de serveur MCP.
:::