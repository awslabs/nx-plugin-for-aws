---
title: "Serveur MCP TypeScript"
description: "Générer un serveur de protocole de contexte de modèle (MCP) TypeScript pour fournir du contexte aux modèles de langage de grande taille"
---



import { FileTree } from '@astrojs/starlight/components';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import Link from '@components/link.astro';
import Snippet from '@components/snippet.astro';
import GeneratorParameters from '@components/generator-parameters.astro';

Générez un serveur [Model Context Protocol (MCP)](https://modelcontextprotocol.io/) en TypeScript pour fournir du contexte aux modèles de langage de grande taille (LLMs), avec option de déploiement sur [Amazon Bedrock AgentCore](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/).

## Qu'est-ce que le MCP ?

Le [Model Context Protocol (MCP)](https://modelcontextprotocol.io/) est un standard ouvert permettant aux assistants IA d'interagir avec des outils et ressources externes. Il fournit une méthode cohérente pour que les LLMs puissent :

- Exécuter des outils (fonctions) réalisant des actions ou récupérant des informations
- Accéder à des ressources fournissant du contexte ou des données

## Utilisation

### Générer un serveur MCP

Vous pouvez générer un serveur MCP en TypeScript de deux manières :

<RunGenerator generator="ts#mcp-server" />

:::tip
Utilisez d'abord le générateur <Link path="/guides/typescript-project">`ts#project`</Link> pour créer un projet auquel ajouter votre serveur MCP.
:::

### Options

<GeneratorParameters generator="ts#mcp-server" />

## Résultat du générateur

Le générateur ajoutera les fichiers suivants à votre projet TypeScript existant :

<FileTree>
  - your-project/
    - src/
      - mcp-server/ (ou nom personnalisé si spécifié)
        - index.ts Exporte votre serveur
        - server.ts Définition principale du serveur
        - stdio.ts Point d'entrée pour le transport STDIO, utile pour des serveurs MCP locaux simples
        - http.ts Point d'entrée pour le transport HTTP Streamable, utile pour héberger votre serveur MCP
        - tools/
          - add.ts Exemple d'outil
        - resources/
          - sample-guidance.ts Exemple de ressource
        - Dockerfile Point d'entrée pour héberger votre serveur MCP (exclu si `computeType` est défini sur `None`)
    - package.json Mis à jour avec l'entrée bin et les dépendances MCP
    - project.json Mis à jour avec la cible de service du serveur MCP
</FileTree>

### Infrastructure

:::note
Si vous avez sélectionné `None` pour `computeType`, le générateur ne fournira aucune infrastructure-as-code.
:::

<Snippet name="shared-constructs" />

<Snippet name="mcp/shared-constructs" />

## Utilisation de votre serveur MCP

### Ajout d'outils

Les outils sont des fonctions que l'assistant IA peut appeler pour effectuer des actions. Vous pouvez ajouter de nouveaux outils dans le fichier `server.ts` :

```typescript
server.tool("toolName", "description de l'outil",
  { param1: z.string(), param2: z.number() }, // Schéma d'entrée utilisant Zod
  async ({ param1, param2 }) => {
    // Implémentation de l'outil
    return {
      content: [{ type: "text", text: "Résultat" }]
    };
  }
);
```

:::caution
Le SDK MCP ne prend actuellement en charge que Zod v3. Pour permettre l'utilisation de Zod v4 dans d'autres générateurs, la dépendance à Zod v3 est installée sous `zod-v3`. Pour les schémas d'outils MCP, vous devrez importer Zod comme suit :

```ts
import { z } from 'zod-v3';
```

Une fois [ce problème du SDK MCP](https://github.com/modelcontextprotocol/typescript-sdk/issues/164) résolu, vous pourrez supprimer la dépendance supplémentaire `zod-v3` et importer directement depuis `zod`.
:::

### Ajout de ressources

Les ressources fournissent du contexte à l'assistant IA. Vous pouvez ajouter des ressources statiques depuis des fichiers ou des ressources dynamiques :

```typescript
const exampleContext = 'contexte exemple à retourner';

server.resource('resource-name', 'example://resource', async (uri) => ({
  contents: [{ uri: uri.href, text: exampleContext }],
}));

// Ressource dynamique
server.resource('dynamic-resource', 'dynamic://resource', async (uri) => {
  const data = await fetchSomeData();
  return {
    contents: [{ uri: uri.href, text: data }],
  };
});
```

## Configuration avec des assistants IA

<Snippet name="mcp/configuration-ts" parentHeading="Configuration avec des assistants IA" />

## Exécution de votre serveur MCP

### Inspecteur

Le générateur configure une cible nommée `<your-server-name>-inspect` qui démarre l'[MCP Inspector](https://github.com/modelcontextprotocol/inspector) avec la configuration pour se connecter à votre serveur MCP via le transport STDIO.

<NxCommands commands={['run your-project:your-server-name-inspect']} />

Ceci démarrera l'inspecteur sur `http://localhost:6274`. Commencez en cliquant sur le bouton "Connect".

### STDIO

La méthode la plus simple pour tester et utiliser un serveur MCP est d'utiliser l'inspecteur ou de le configurer avec un assistant IA (comme ci-dessus).

Vous pouvez cependant exécuter votre serveur avec le [transport STDIO](https://modelcontextprotocol.io/docs/concepts/transports#standard-input%2Foutput-stdio) directement en utilisant la cible `<your-server-name>-serve-stdio`.

<NxCommands commands={['run your-project:your-server-name-serve-stdio']} />

Cette commande utilise `tsx --watch` pour redémarrer automatiquement le serveur lors des modifications de fichiers.

### HTTP Streamable

Si vous souhaitez exécuter votre serveur MCP localement avec le [transport HTTP Streamable](https://modelcontextprotocol.io/docs/concepts/transports#streamable-http), utilisez la cible `<your-server-name>-serve-http`.

<NxCommands commands={['run your-project:your-server-name-serve-http']} />

Cette commande utilise `tsx --watch` pour redémarrer automatiquement le serveur lors des modifications de fichiers.

## Déploiement sur Bedrock AgentCore Runtime

<Snippet name="mcp/bedrock-deployment" parentHeading="Déploiement sur Bedrock AgentCore Runtime" />

### Cible de bundle

Pour construire votre serveur MCP pour Bedrock AgentCore Runtime, une cible `<your-mcp-server>-bundle` est ajoutée à votre projet. Elle :

- Package votre serveur MCP en un seul fichier JavaScript avec [`esbuild`](https://esbuild.github.io/), utilisant `http.ts` comme point d'entrée pour un serveur MCP HTTP Streamable
- Construit une image Docker depuis le `Dockerfile` qui exécute ce serveur packagé sur le port `8000`, conformément au [contrat de protocole MCP](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/runtime-service-contract.html#mcp-protocol-contract)

:::tip
L'image Docker est construite avec un tag (par exemple `my-scope-my-project-mcp-server:latest`), dont hérite le construct CDK via son `Dockerfile`, permettant ainsi de co-localiser votre `Dockerfile` avec votre projet de serveur MCP.
:::

### Observabilité

<Snippet name="mcp/observability" parentHeading="Observabilité" />