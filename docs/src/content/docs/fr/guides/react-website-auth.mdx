---
title: "Authentification de site web React"
description: "Documentation de référence pour l'authentification de site web React"
---



import { FileTree } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import RunGenerator from '@components/run-generator.astro';
import GeneratorParameters from '@components/generator-parameters.astro';
import NxCommands from '@components/nx-commands.astro';
import Infrastructure from '@components/infrastructure.astro';
import Snippet from '@components/snippet.astro';

Le générateur d'authentification pour site web React ajoute une authentification à votre site React en utilisant [Amazon Cognito](https://aws.amazon.com/cognito/).

Ce générateur configure l'infrastructure CDK ou Terraform pour créer un User Pool Cognito et un Identity Pool associé, ainsi qu'une interface hébergée pour gérer les flux de connexion utilisateur et son intégration avec votre site React.

## Utilisation

### Ajouter l'authentification à votre site web React

Vous pouvez ajouter l'authentification à votre site web React de deux manières :

<RunGenerator generator="ts#react-website#auth" />

### Options

<GeneratorParameters generator="ts#react-website#auth" />

## Sortie du générateur

Vous trouverez les modifications suivantes dans votre site web React :

<FileTree>
  - src
    - components
      - CognitoAuth
        - index.tsx Composant principal d'authentification
    - main.tsx Mis à jour pour intégrer le composant CognitoAuth
</FileTree>

### Infrastructure

<Snippet name="shared-constructs" />

Vous trouverez également le code d'infrastructure suivant généré en fonction du `iacProvider` sélectionné :

<Infrastructure>
<Fragment slot="cdk">
<FileTree>
  - packages/common/constructs/src
    - core
      - user-identity.ts Construct définissant le user pool et l'identity pool
</FileTree>
</Fragment>
<Fragment slot="terraform">
<FileTree>
  - packages/common/terraform/src
    - core
      - user-identity
        - main.tf Module wrapper pour la configuration d'identité
        - identity
          - identity.tf Infrastructure d'identité principale incluant Cognito User Pool et Identity Pool
        - add-callback-url
          - add-callback-url.tf Module pour ajouter des URLs de callback aux clients existants du user pool
</FileTree>
</Fragment>
</Infrastructure>

## Utilisation de l'infrastructure

<Infrastructure>
<Fragment slot="cdk">
Vous devrez ajouter l'infrastructure d'identité utilisateur à votre stack, en la déclarant _avant_ le site web :

```ts title="packages/infra/src/stacks/application-stack.ts" {3,9}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite, UserIdentity } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    new UserIdentity(this, 'Identity');

    new MyWebsite(this, 'MyWebsite');
  }
}
```

Le construct `UserIdentity` ajoute automatiquement la <Link path="guides/react-website#runtime-configuration">Configuration d'exécution</Link> nécessaire pour que votre site web puisse pointer vers le bon Cognito User Pool pour l'authentification.
</Fragment>
<Fragment slot="terraform">
Vous devrez ajouter le module d'identité utilisateur et vous assurer que votre site web en dépend :

```hcl title="packages/infra/src/main.tf" {2-4,14-15}
# Déployer d'abord l'identité utilisateur pour l'ajouter à la config d'exécution
module "user_identity" {
  source = "../../common/terraform/src/core/user-identity"
}

# Déployer le site web après l'identité pour inclure la config d'exécution
module "my_website" {
  source = "../../common/terraform/src/app/static-websites/my-website"

  providers = {
    aws.us_east_1 = aws.us_east_1
  }

  # S'assurer que l'identité est déployée en premier
  depends_on = [module.user_identity]
}
```

Le module d'identité utilisateur ajoute automatiquement la <Link path="guides/react-website#runtime-configuration">Configuration d'exécution</Link> nécessaire pour que votre site web puisse pointer vers le bon Cognito User Pool pour l'authentification.
</Fragment>
</Infrastructure>

### Accorder l'accès aux utilisateurs authentifiés

Pour accorder aux utilisateurs authentifiés l'accès à certaines actions, comme l'autorisation d'appeler une API, vous pouvez ajouter des déclarations de politique IAM au rôle authentifié de l'identity pool :

<Infrastructure>
<Fragment slot="cdk">
```ts title="packages/infra/src/stacks/application-stack.ts" {12}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite, UserIdentity, MyApi } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    const identity = new UserIdentity(this, 'Identity');
    const api = new MyApi(this, 'MyApi');

    api.grantInvokeAccess(identity.identityPool.authenticatedRole);

    new MyWebsite(this, 'MyWebsite');
  }
}
```
</Fragment>
<Fragment slot="terraform">
```hcl title="packages/infra/src/main.tf" {12,22}
module "user_identity" {
  source = "../../common/terraform/src/core/user-identity"
}

module "my_api" {
  source = "../../common/terraform/src/app/apis/my-api"
}

# Ajouter des permissions pour les utilisateurs authentifiés d'appeler Fast API
resource "aws_iam_role_policy" "authenticated_fast_api_invoke" {
  name = "authenticated-user-invoke-my-api"
  role = module.user_identity.authenticated_role_name

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Effect = "Allow"
        Action = [
          "execute-api:Invoke"
        ]
        Resource = "${module.my_api.api_execution_arn}/*"
      }
    ]
  })
}
```
</Fragment>
</Infrastructure>