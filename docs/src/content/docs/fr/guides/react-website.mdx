---
title: "Site Web React"
description: "Documentation de référence pour un site Web React"
---



import { FileTree, Steps } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import RunGenerator from '@components/run-generator.astro';
import GeneratorParameters from '@components/generator-parameters.astro';
import NxCommands from '@components/nx-commands.astro';

Ce générateur crée un nouveau site [React](https://react.dev/) préconfiguré avec [CloudScape](http://cloudscape.design/), ainsi que l'infrastructure AWS CDK pour déployer votre site web dans le cloud en tant que site statique hébergé dans [S3](https://aws.amazon.com/s3/), servi par [CloudFront](https://aws.amazon.com/cloudfront/) et protégé par [WAF](https://aws.amazon.com/waf/).

L'application générée utilise [Vite](https://vite.dev/) comme outil de build et de bundling. Elle utilise [TanStack Router](https://tanstack.com/router/v1) pour le routage typé.

:::note
Bien que ce générateur vous configure avec CloudScape, il s'agit fondamentalement d'un générateur de projet React. Vous pouvez modifier votre code pour passer à un autre système de design ou bibliothèque de composants si vous le souhaitez.
:::

## Utilisation

### Générer un site React

Vous pouvez générer un nouveau site React de deux manières :

<RunGenerator generator="ts#react-website" />

### Options

<GeneratorParameters generator="ts#react-website" />

## Sortie du générateur

Le générateur créera la structure de projet suivante dans le répertoire `<directory>/<name>` :

<FileTree>
  - index.html Point d'entrée HTML
  - public Assets statiques
  - src
    - main.tsx Point d'entrée de l'application avec la configuration React
    - config.ts Configuration de l'application (ex: logo)
    - components
      - AppLayout Composants pour le layout global et la barre de navigation
    - hooks
      - useAppLayout.tsx Hook pour ajuster le AppLayout depuis des composants imbriqués
    - routes
      - welcome
        - index.tsx Exemple de route (ou page) pour @tanstack/react-router
    - styles.css Styles globaux
  - vite.config.ts Configuration Vite et Vitest
  - tsconfig.json Configuration TypeScript de base pour le code source et les tests
  - tsconfig.app.json Configuration TypeScript pour le code source
  - tsconfig.spec.json Configuration TypeScript pour les tests
</FileTree>

Le générateur créera également le code d'infrastructure CDK pour déployer votre site dans le répertoire `packages/common/constructs` :

<FileTree>
  - src
    - app
      - static-websites
        - \<name>.ts Infrastructure spécifique à votre site
    - core
      - static-website.ts Construct générique StaticWebsite
</FileTree>

## Implémentation de votre site React

La [documentation React](https://react.dev/learn) est un bon point de départ pour apprendre les bases du développement avec React. Vous pouvez consulter la [documentation CloudScape](https://cloudscape.design/components/) pour les détails sur les composants disponibles et leur utilisation.

### Routes

#### Création d'une route/page

Votre site React est préconfiguré avec [TanStack Router](https://tanstack.com/router/v1), ce qui facilite l'ajout de nouvelles routes :

<Steps>
  1. [Lancer le serveur de développement local](#local-development-server)
  2. Créer un nouveau fichier `<page-name>.tsx` dans `src/routes`, où la position dans l'arborescence représente le chemin
  3. Une `Route` et un `RouteComponent` sont générés automatiquement. Vous pouvez commencer à développer votre page ici !
</Steps>

#### Navigation entre les pages

Utilisez le composant `Link` ou le hook `useNavigate` pour naviguer entre les pages :

```tsx {1, 4, 8-9, 14}
import { Link, useNavigate } from '@tanstack/react-router';

export const MyComponent = () => {
  const navigate = useNavigate();

  const submit = async () => {
    const id = await ...
    // Utilisez `navigate` pour les redirections après une action asynchrone
    navigate({ to: '/products/$id', { params: { id }} });
  };

  return (
    <>
      <Link to="/products">Annuler</Link>
      <Button onClick={submit}>Valider</Button>
    </>
  )
};
```

Pour plus de détails, consultez la [documentation TanStack Router](https://tanstack.com/router/latest/docs/framework/react/overview).

## Configuration à l'exécution

La configuration de votre infrastructure AWS CDK est fournie à votre site via une Configuration à l'exécution. Cela permet d'accéder à des détails comme les URLs d'API qui ne sont connus qu'après le déploiement.

### Infrastructure

Le construct CDK `RuntimeConfig` permet d'ajouter et récupérer des valeurs de configuration. Les constructs générés par `@aws/nx-plugin` (comme les <Link path="guides/trpc">API tRPC</Link> et <Link path="guides/fastapi">FastAPIs</Link>) ajoutent automatiquement les valeurs appropriées au `RuntimeConfig`.

Votre construct CDK de site web déploiera la configuration dans un fichier `runtime-config.json` à la racine de votre bucket S3.

```ts title="packages/infra/src/stacks/application-stack.ts" {9-12,14-15}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    // Ajoute automatiquement des valeurs au RuntimeConfig
    new MyApi(this, 'MyApi', {
      integrations: MyApi.defaultIntegrations(this).build(),
    });

    // Déploie automatiquement la config dans runtime-config.json
    new MyWebsite(this, 'MyWebsite');
  }
}
```

:::warning
Vous devez déclarer votre site web _après_ les constructs qui ajoutent des valeurs au `RuntimeConfig`, sans quoi elles seront absentes du fichier `runtime-config.json`.
:::

### Code du site

Dans votre site, utilisez le hook `useRuntimeConfig` pour accéder à la configuration :

```tsx {1,4}
import { useRuntimeConfig } from '../hooks/useRuntimeConfig';

const MyComponent = () => {
  const runtimeConfig = useRuntimeConfig();

  // Accédez aux valeurs de configuration ici
  const apiUrl = runtimeConfig.apis.MyApi;
};
```

### Configuration locale

Pour le [serveur de développement local](#local-development-server), vous aurez besoin d'un fichier `runtime-config.json` dans le répertoire `public` afin que votre site local puisse accéder aux URLs des backends déployés.

Votre projet inclut une cible `load:runtime-config` pour télécharger le fichier depuis une application déployée :

<NxCommands commands={['run <my-website>:"load:runtime-config"']} />

:::warning
Si vous renommez votre stack dans le `src/main.ts` de votre projet d'infrastructure, mettez à jour la cible `load:runtime-config` dans le `project.json` de votre site avec le nouveau nom de stack.
:::

## Serveur de développement local

Lancez un serveur local avec les cibles `serve` ou `serve-local`.

### Cible Serve

La cible `serve` démarre un serveur de développement local. Elle nécessite que l'infrastructure associée soit déployée et que la [configuration locale](#local-runtime-config) soit chargée.

Exécutez-la avec :

<NxCommands commands={['run <my-website>:serve']} />

Utile pour modifier le site tout en pointant vers des APIs déployées.

### Cible Serve Local

La cible `serve-local` démarre le serveur local avec le [mode Vite](https://vite.dev/guide/env-and-mode) défini sur `serve-local`, et lance aussi les serveurs locaux des APIs connectées via le <Link path="/guides/api-connection">générateur API Connection</Link>.

Dans ce mode, le `runtime-config.json` est automatiquement remplacé pour pointer vers les URLs locales des APIs.

Exécutez-la avec :

<NxCommands commands={['run <my-website>:serve-local']} />

Utile pour développer simultanément sur le site et les APIs sans déployer.

:::warning
Dans ce mode sans `runtime-config.json`, si vous avez configuré l'authentification Cognito (via le <Link path="/guides/react-website-auth">générateur React Website Auth</Link>), le login sera désactivé et les requêtes n'incluront pas les en-têtes d'authentification.

Pour activer l'authentification en mode `serve-local`, déployez l'infrastructure et chargez la configuration.
:::

## Build

Générez une version de production avec la cible `build`. Cela crée un bundle dans `dist/packages/<my-website>/bundle` tout en vérifiant les types et le linting.

<NxCommands commands={['run <my-website>:build']} />

## Tests

Les tests fonctionnent comme dans un projet TypeScript standard - consultez le <Link path="guides/typescript-project#testing">guide TypeScript</Link> pour plus de détails.

Pour les tests React, React Testing Library est préinstallé. Voir la [documentation officielle](https://testing-library.com/docs/react-testing-library/example-intro) pour son utilisation.

Exécutez les tests avec :

<NxCommands commands={['run <my-website>:test']} />

## Déploiement

Nous recommandons d'utiliser le <Link path="guides/typescript-infrastructure">générateur d'infrastructure TypeScript</Link> pour créer une application CDK.

Utilisez le construct généré dans `packages/common/constructs` pour déployer votre site :

```ts title="packages/infra/src/stacks/application-stack.ts" {3, 9}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    new MyWebsite(this, 'MyWebsite');
  }
}
```