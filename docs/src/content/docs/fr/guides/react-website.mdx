---
title: "Site Web React"
description: "Documentation de référence pour un site Web React"
---

import { FileTree, Steps } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import RunGenerator from '@components/run-generator.astro';
import GeneratorParameters from '@components/generator-parameters.astro';
import NxCommands from '@components/nx-commands.astro';
import Infrastructure from '@components/infrastructure.astro';
import Snippet from '@components/snippet.astro';

Ce générateur crée un nouveau site [React](https://react.dev/) configuré avec [Cloudscape](http://cloudscape.design/) par défaut, ainsi que l'infrastructure AWS CDK ou Terraform pour déployer votre site web dans le cloud en tant que site statique hébergé dans [S3](https://aws.amazon.com/s3/), servi par [CloudFront](https://aws.amazon.com/cloudfront/) et protégé par [WAF](https://aws.amazon.com/waf/).

L'application générée utilise [Vite](https://vite.dev/) comme outil de build et bundler. Elle utilise [TanStack Router](https://tanstack.com/router/v1) pour le routage type-safe.

:::note
Ce générateur vous configure avec [Cloudscape](http://cloudscape.design/) par défaut, mais vous pouvez sélectionner `None` comme `uxProvider` si vous préférez utiliser une bibliothèque de composants ou un système de design différent.
:::

## Utilisation

### Générer un site React

Vous pouvez générer un nouveau site React de deux manières :

<RunGenerator generator="ts#react-website" />

### Options

<GeneratorParameters generator="ts#react-website" />

## Sortie du générateur

Le générateur créera la structure de projet suivante dans le répertoire `<directory>/<name>` :

<FileTree>
  - index.html Point d'entrée HTML
  - public Assets statiques
  - src
    - main.tsx Point d'entrée de l'application avec la configuration React
    - config.ts Configuration de l'application (ex: logo)
    - components
      - AppLayout Composants pour le layout et la barre de navigation
    - hooks
      - useAppLayout.tsx Hook pour ajuster l'AppLayout Cloudscape depuis des composants imbriqués (si UX Provider est défini sur Cloudscape)
    - routes
      - index.tsx Exemple de route (ou page) pour TanStack Router
    - styles.css Styles globaux
  - vite.config.mts Configuration Vite et Vitest
  - tsconfig.json Configuration TypeScript de base pour le code et les tests
  - tsconfig.app.json Configuration TypeScript pour le code source
  - tsconfig.spec.json Configuration TypeScript pour les tests
</FileTree>

:::note
Si vous avez choisi de ne pas utiliser [TanStack Router](https://tanstack.com/router/v1), un simple fichier `src/app.tsx` vous sera fourni comme point d'entrée de l'application au lieu du répertoire `routes`.
:::

### Infrastructure

<Snippet name="shared-constructs" />

Le générateur crée une infrastructure as code pour déployer votre site web en fonction du `iacProvider` sélectionné :

<Infrastructure>
<Fragment slot="cdk">
<FileTree>
  - packages/common/constructs/src
    - app
      - static-websites
        - \<name>.ts Infrastructure spécifique à votre site
    - core
      - static-website.ts Construct générique StaticWebsite
</FileTree>
</Fragment>
<Fragment slot="terraform">
<FileTree>
  - packages/common/terraform/src
    - app
      - static-websites
        - \<name>
          - \<name>.tf Module spécifique à votre site
    - core
      - static-website
        - static-website.tf Module générique de site statique
</FileTree>
</Fragment>
</Infrastructure>

## Implémentation de votre site React

La [documentation React](https://react.dev/learn) est un bon point de départ pour apprendre les bases du développement avec React. Vous pouvez consulter la [documentation Cloudscape](https://cloudscape.design/components/) pour les détails sur les composants disponibles et leur utilisation.

### Routes

#### Création d'une route/page

Votre site Cloudscape est configuré avec [TanStack Router](https://tanstack.com/router/v1) par défaut. Cela facilite l'ajout de nouvelles routes :

<Steps>
  1. [Lancer le serveur de développement local](#local-development-server)
  2. Créer un nouveau fichier `<page-name>.tsx` dans `src/routes`, où la position dans l'arborescence représente le chemin
  3. Une `Route` et un `RouteComponent` sont générés automatiquement. Vous pouvez commencer à développer votre page ici !
</Steps>

#### Navigation entre pages

Vous pouvez utiliser le composant `Link` ou le hook `useNavigate` pour naviguer entre les pages :

```tsx {1, 4, 8-9, 14}
import { Link, useNavigate } from '@tanstack/react-router';

export const MyComponent = () => {
  const navigate = useNavigate();

  const submit = async () => {
    const id = await ...
    // Utiliser `navigate` pour rediriger après une action asynchrone
    navigate({ to: '/products/$id', { params: { id }} });
  };

  return (
    <>
      <Link to="/products">Annuler</Link>
      <Button onClick={submit}>Valider</Button>
    </>
  )
};
```

Pour plus de détails, consultez la [documentation TanStack Router](https://tanstack.com/router/latest/docs/framework/react/overview).

## Configuration runtime

La configuration de votre infrastructure est fournie à votre site via la Configuration Runtime. Cela permet à votre site d'accéder à des détails comme les URLs d'API qui ne sont connus qu'au moment du déploiement.

### Infrastructure

<Infrastructure>
<Fragment slot="cdk">
Le construct CDK `RuntimeConfig` peut être utilisé pour ajouter et récupérer la configuration dans votre infrastructure CDK. Les constructs CDK générés par les générateurs `@aws/nx-plugin` (comme <Link path="guides/trpc">`ts#trpc-api`</Link> et <Link path="guides/fastapi">`py#fast-api`</Link>) ajoutent automatiquement les valeurs appropriées au `RuntimeConfig`.

Votre construct CDK de site web déploie la configuration runtime dans un fichier `runtime-config.json` à la racine de votre bucket S3.

```ts title="packages/infra/src/stacks/application-stack.ts" {9-12,14-15}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    // Ajoute automatiquement des valeurs au RuntimeConfig
    new MyApi(this, 'MyApi', {
      integrations: MyApi.defaultIntegrations(this).build(),
    });

    // Déploie automatiquement la config runtime dans runtime-config.json
    new MyWebsite(this, 'MyWebsite');
  }
}
```

:::caution
Vous devez vous assurer de déclarer votre site web _après_ tout construct qui ajoute des éléments au `RuntimeConfig`, sans quoi ils seront absents du fichier `runtime-config.json`.
:::
</Fragment>
<Fragment slot="terraform">
Avec Terraform, la configuration runtime est gérée via les modules runtime-config. Les modules Terraform générés par les générateurs `@aws/nx-plugin` (comme <Link path="guides/trpc">`ts#trpc-api`</Link> et <Link path="guides/fastapi">`py#fast-api`</Link>) ajoutent automatiquement les valeurs appropriées à la configuration runtime.

Votre module Terraform de site web déploie la configuration runtime dans un fichier `runtime-config.json` à la racine de votre bucket S3.

```hcl title="packages/infra/src/main.tf" {14-15}
# Ajoute automatiquement des valeurs à la config runtime
module "my_api" {
  source = "../../common/terraform/src/app/apis/my-api"
}

# Déploie automatiquement la config runtime dans runtime-config.json
module "my_website" {
  source = "../../common/terraform/src/app/static-websites/my-website"

  providers = {
    aws.us_east_1 = aws.us_east_1
  }

  # S'assure que l'API est déployée en premier pour ajouter à la config runtime
  depends_on = [module.my_api]
}
```

:::caution
Vous devez vous assurer de déclarer votre module de site web _après_ tout module qui ajoute à la configuration runtime et configurer les `depends_on` appropriés pour garantir l'ordre, sans quoi ils seront absents du fichier `runtime-config.json`.
:::
</Fragment>
</Infrastructure>

### Code du site

Dans votre site, vous pouvez utiliser le hook `useRuntimeConfig` pour récupérer les valeurs de la configuration runtime :

```tsx {1,4}
import { useRuntimeConfig } from '../hooks/useRuntimeConfig';

const MyComponent = () => {
  const runtimeConfig = useRuntimeConfig();

  // Accéder aux valeurs de la config runtime ici
  const apiUrl = runtimeConfig.apis.MyApi;
};
```

### Configuration runtime locale

Lors de l'exécution du [serveur de développement local](#local-development-server), vous aurez besoin d'un fichier `runtime-config.json` dans votre répertoire `public` pour que votre site local connaisse les URLs des backends, la configuration d'identité, etc.

Votre projet de site est configuré avec une cible `load:runtime-config` que vous pouvez utiliser pour récupérer le fichier `runtime-config.json` d'une application déployée :

<NxCommands commands={['run <my-website>:"load:runtime-config"']} />

:::note
<Infrastructure>
<Fragment slot="cdk">
Si vous modifiez le préfixe des noms de stage dans le `src/main.ts` de votre projet d'infrastructure, vous devrez mettre à jour la cible `load:runtime-config` dans le fichier `project.json` de votre site en conséquence.

De plus, notez que la cible `load:runtime-config` suppose qu'un seul stage de votre application est déployé dans l'environnement pour lequel vous avez des credentials AWS. Vous devrez ajuster la commande si vous déployez plusieurs stages dans le même compte et région.
</Fragment>
<Fragment slot="terraform">
Pour les projets Terraform, la cible `load:runtime-config` copie le fichier `runtime-config.json` créé après votre dernier `terraform apply` local.
</Fragment>
</Infrastructure>
:::

## Serveur de développement local

Vous pouvez lancer un serveur de développement local en utilisant les cibles `serve` ou `serve-local`.

### Cible Serve

La cible `serve` démarre un serveur de développement local pour votre site. Cette cible nécessite que vous ayez déployé toute infrastructure de support avec laquelle le site interagit, et que vous ayez [chargé la configuration runtime locale](#local-runtime-config).

Vous pouvez exécuter cette cible avec la commande :

<NxCommands commands={['run <my-website>:serve']} />

Cette cible est utile pour travailler sur des modifications du site tout en pointant vers des APIs "réelles" déployées et d'autres infrastructures.

### Cible Serve Local

La cible `serve-local` démarre un serveur de développement local pour votre site (avec le [MODE Vite](https://vite.dev/guide/env-and-mode) défini sur `serve-local`), ainsi que des serveurs locaux pour les APIs connectées via le <Link path="/guides/connection">générateur Connection</Link>.

Lorsque le serveur local est lancé via cette cible, le `runtime-config.json` est automatiquement remplacé pour pointer vers les URLs des APIs locales.

Vous pouvez exécuter cette cible avec la commande :

<NxCommands commands={['run <my-website>:serve-local']} />

Cette cible est utile lorsque vous travaillez à la fois sur votre site et vos APIs et souhaitez itérer rapidement sans déployer l'infrastructure.

:::warning
Dans ce mode, si aucun `runtime-config.json` n'est présent et que vous avez configuré l'authentification Cognito (via le <Link path="/guides/react-website-auth">générateur `ts#react-website#auth`</Link>), la connexion sera ignorée et les requêtes vers vos serveurs locaux n'incluront pas d'en-têtes d'authentification.

Pour activer la connexion et l'authentification en mode `serve-local`, déployez votre infrastructure et chargez la configuration runtime.
:::

:::tip
Lors de l'exécution avec `serve-local`, vous pouvez spécifier toutes les variables d'environnement requises par vos APIs pour pointer vers d'autres ressources AWS déployées, par exemple :

<NxCommands env={{DYNAMODB_TABLE_NAME: 'xxxxx'}} commands={['run <my-website>:serve-local']} />

Notez que vos serveurs d'API locaux s'exécuteront avec les credentials AWS que vous avez configurés localement.
:::

## Build

Vous pouvez builder votre site avec la cible `build`. Cela utilise Vite pour créer un bundle de production dans le répertoire `dist/packages/<my-website>/bundle`, ainsi que la vérification de types, la compilation et le linting.

<NxCommands commands={['run <my-website>:build']} />

## Tests

Tester votre site fonctionne comme pour un projet TypeScript standard. Consultez le <Link path="guides/typescript-project#testing">guide de projet TypeScript</Link> pour plus de détails.

Pour les tests spécifiques à React, React Testing Library est déjà installé et disponible. Consultez la [documentation React Testing Library](https://testing-library.com/docs/react-testing-library/example-intro) pour son utilisation.

Vous pouvez exécuter les tests avec la cible `test` :

<NxCommands commands={['run <my-website>:test']} />

## Déploiement du site

Le générateur de site React crée une infrastructure CDK ou Terraform en fonction du `iacProvider` sélectionné. Vous pouvez l'utiliser pour déployer votre site.

<Infrastructure>
<Fragment slot="cdk">
Pour déployer votre site, nous recommandons d'utiliser le <Link path="guides/typescript-infrastructure">générateur `ts#infra`</Link> pour créer une application CDK.

Vous pouvez utiliser le construct CDK généré dans `packages/common/constructs` pour déployer votre site.

```ts title="packages/infra/src/stacks/application-stack.ts" {3, 9}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    new MyWebsite(this, 'MyWebsite');
  }
}
```

Ceci configure :

1. Un bucket S3 pour héberger les fichiers statiques
2. Une distribution CloudFront pour la diffusion globale
3. Un Web ACL WAF pour la sécurité
4. Une Origin Access Control pour l'accès sécurisé à S3
5. Déploiement automatique des fichiers et configuration runtime
</Fragment>
<Fragment slot="terraform">
Pour déployer votre site, nous recommandons d'utiliser le <Link path="guides/terraform-infrastructure">générateur `terraform#project`</Link> pour créer un projet Terraform.

Vous pouvez utiliser le module Terraform généré dans `packages/common/terraform` pour déployer votre site.

```hcl title="packages/infra/src/main.tf" {3}
# Déployer le site
module "my_website" {
  source = "../../common/terraform/src/app/static-websites/my-website"

  providers = {
    aws.us_east_1 = aws.us_east_1
  }
}
```

Ceci configure :

1. Un bucket S3 pour héberger les fichiers statiques
2. Une distribution CloudFront pour la diffusion globale
3. Un Web ACL WAF pour la sécurité (déployé en us-east-1)
4. Une Origin Access Control pour l'accès sécurisé à S3
5. Déploiement automatique des fichiers et configuration runtime

:::note
Le provider `aws.us_east_1` est requis pour les ressources CloudFront et WAF qui doivent être déployées en région us-east-1. Assurez-vous que votre configuration Terraform inclut ce provider :

```hcl title="packages/infra/src/providers.tf"
provider "aws" {
  alias  = "us_east_1"
  region = "us-east-1"
}
```
:::
</Fragment>
</Infrastructure>