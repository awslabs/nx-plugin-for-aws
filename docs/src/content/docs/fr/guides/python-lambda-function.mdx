---
title: "Fonctions Lambda Python"
description: "Documentation de référence pour les fonctions Lambda Python"
---



import { FileTree } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import RunGenerator from '@components/run-generator.astro';
import GeneratorParameters from '@components/generator-parameters.astro';
import Infrastructure from '@components/infrastructure.astro';
import Snippet from '@components/snippet.astro';
import NxCommands from '@components/nx-commands.astro';

Le générateur de fonction Lambda Python permet d'ajouter une fonction lambda à un projet Python existant.

Ce générateur crée un nouveau gestionnaire Lambda Python avec une infrastructure AWS CDK ou Terraform. Le backend généré utilise AWS Lambda pour un déploiement serverless, avec une validation de types optionnelle via le [Parser d'AWS Lambda Powertools](https://docs.powertools.aws.dev/lambda/python/latest/utilities/parser/). Il configure [AWS Lambda Powertools](https://docs.powertools.aws.dev/lambda/python/latest/) pour l'observabilité, incluant le logging, le tracing AWS X-Ray et les métriques CloudWatch.

## Utilisation

### Générer une fonction Lambda

Vous pouvez générer une nouvelle fonction Lambda de deux manières :

<RunGenerator generator="py#lambda-function" />

### Options

<GeneratorParameters generator="py#lambda-function" />

## Résultat du générateur

Le générateur ajoutera les fichiers suivants à votre projet :

<FileTree>

- \<module-name>
  - \<lambda-function>.py Implémentation de la fonction

</FileTree>

Si l'option `functionPath` est fournie, le générateur ajoutera les fichiers nécessaires au chemin spécifié :

<FileTree>

- \<module-name>
  - \<custom-path>
    - \<function-name>.py Implémentation de la fonction

</FileTree>

### Infrastructure

<Snippet name="shared-constructs" />

Le générateur crée une infrastructure as code pour déployer votre fonction selon le `iacProvider` sélectionné :

<Infrastructure>
<Fragment slot="cdk">
Le générateur crée des constructs CDK utilisables pour déployer votre fonction, situés dans le répertoire `packages/common/constructs`.
</Fragment>
<Fragment slot="terraform">
Le générateur crée un module Terraform utilisable pour déployer votre fonction, situé dans le répertoire `packages/common/terraform/src/app/lambda-functions/<function-name>`.
</Fragment>
</Infrastructure>

## Implémentation de votre fonction

L'implémentation principale se trouve dans `<function-name>.py`. Voici un exemple :

```python
import os

from aws_lambda_powertools import Logger, Metrics, Tracer
from aws_lambda_powertools.metrics import MetricUnit
from aws_lambda_powertools.utilities.parser import event_parser
from aws_lambda_powertools.utilities.parser.models import EventBridgeModel
from aws_lambda_powertools.utilities.typing import LambdaContext

os.environ["POWERTOOLS_METRICS_NAMESPACE"] = "Foo"
os.environ["POWERTOOLS_SERVICE_NAME"] = "Foo"

logger: Logger = Logger()
metrics: Metrics = Metrics()
tracer: Tracer = Tracer()

@tracer.capture_lambda_handler
@metrics.log_metrics
@event_parser(model=EventBridgeModel)
def lambda_handler(event: EventBridgeModel, context: LambdaContext):
    logger.info("Received event", extra={"event": event.model_dump() })
    metrics.add_metric(name="InvocationCount", unit=MetricUnit.Count, value=1)

    try:
        # TODO: Implement
        metrics.add_metric(name="SuccessCount", unit=MetricUnit.Count, value=1)
        # TODO: Implement success response if required
    except Exception as e:
        logger.exception(e)
        metrics.add_metric(name="ErrorCount", unit=MetricUnit.Count, value=1)
        # TODO: Implement error response if required
```

Le générateur configure automatiquement plusieurs fonctionnalités :

1. Intégration d'AWS Lambda Powertools pour l'observabilité
2. Collecte de métriques  
3. Validation de types avec `@event_parser`

### Observabilité avec AWS Lambda Powertools

#### Journalisation

Le générateur configure la journalisation structurée avec AWS Lambda Powertools.

```python
def lambda_handler(event: EventBridgeModel, context: LambdaContext):
    logger.info("Received event", extra={"event": event.model_dump()})
```

:::tip
Il est recommandé de définir un ID de corrélation pour toutes les requêtes uniques afin de faciliter le débogage et le monitoring. Consultez la documentation [aws powertools logger](https://docs.powertools.aws.dev/lambda/python/2.22.0/core/logger/#setting-a-correlation-id) pour les bonnes pratiques.
:::

Le logger inclut automatiquement :

- Les requêtes d'événements
- Les informations de contexte Lambda  
- Les indicateurs de cold start

#### Tracing

Le tracing AWS X-Ray est configuré automatiquement. Vous pouvez ajouter des sous-segments personnalisés :

```python
def lambda_handler(event: EventBridgeModel, context: LambdaContext):
    # Crée un nouveau sous-segment
    with tracer.provider.in_subsegment("function-subsegment"):
        # Votre logique ici
        return ....
```

#### Métriques

Les métriques CloudWatch sont collectées automatiquement pour chaque requête. Vous pouvez ajouter des métriques personnalisées :

```python
def lambda_handler(event: EventBridgeModel, context: LambdaContext):
    metrics.add_metric(name="NewMetric", unit=MetricUnit.Count, value=1)
    return ...
```

Les métriques par défaut incluent :

- Nombre d'invocations
- Taux de succès/échec  
- Métriques de cold start

### Validation de types

Si vous avez choisi un `eventSource` lors de la génération, votre fonction est instrumentée avec [`@event_parser` d'AWS Lambda Powertools](https://docs.powertools.aws.dev/lambda/python/latest/utilities/parser/). Exemple :

```python {3}
@event_parser(model=EventBridgeModel)
def lambda_handler(event: EventBridgeModel, context: LambdaContext):
    event.detail_type # <- typage fort avec autocomplétion IDE
```

Ceci permet de définir des modèles de données avec [Pydantic](https://docs.pydantic.dev/latest/), similaire à <Link path="guides/fastapi">Fast API</Link>.

:::tip
Pour des données personnalisées dans des événements (ex: flux DynamoDB ou EventBridge), utilisez [Envelopes](https://docs.powertools.aws.dev/lambda/python/latest/utilities/parser/#envelopes) pour assurer le typage.
:::

Si vous ne souhaitez pas typer votre événement, sélectionnez `Any` comme `eventSource`.

## Bundling

Le générateur configure automatiquement le packaging Python pour les déploiements Lambda avec [uv](https://docs.astral.sh/uv/) :

<NxCommands commands={['run <project-name>:bundle']} />

:::note
Ceci package l'intégralité du projet. Pour réduire la taille, vous pouvez séparer les fonctions dans plusieurs projets Python générés avec <Link path="guides/python-project">`py#project`</Link>.
:::

Ce processus utilise :

1. [`uv export`](https://docs.astral.sh/uv/reference/cli/#uv-export) pour exporter les dépendances dans `requirements.txt`
2. [`uv pip install`](https://docs.astral.sh/uv/reference/cli/#uv-pip-install) pour installer les dépendances pour la plateforme cible (`x86_64-manylinux2014`)

:::note
Si vous utilisez une [architecture ARM](https://docs.aws.amazon.com/lambda/latest/dg/foundation-arch.html), modifiez la cible de bundling en `aarch64-manylinux2014`.
:::

## Déploiement de votre fonction

<Snippet name="lambda-function/deploying-your-function" parentHeading="Déploiement de votre fonction" />