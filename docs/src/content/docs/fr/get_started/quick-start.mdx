---
title: "Guide de D√©marrage Rapide"
description: "Un d√©marrage rapide sur l'utilisation de @aws/nx-plugin."
---

import { Steps } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import Snippet from '@components/snippet.astro';
import CreateNxWorkspaceCommand from '@components/create-nx-workspace-command.astro';
import PackageManagerShortCommand from '@components/package-manager-short-command.astro';
import InstallCommand from '@components/install-command.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import Infrastructure from '@components/infrastructure.astro';

Ce guide vous explique les bases de l'installation et de l'utilisation de `@aws/nx-plugin` pour d√©velopper rapidement des projets sur AWS.

:::tip
Pour un tutoriel plus approfondi sur la cr√©ation d'une application full-stack, consultez le <Link path="get_started/tutorials/dungeon-game/overview">Tutoriel de l'Aventure du Donjon</Link>.
:::

## Pr√©requis

Les d√©pendances globales suivantes sont n√©cessaires avant de continuer :

<Snippet name="prerequisites" />

## √âtape 1 : Initialiser un nouvel espace de travail Nx

Ex√©cutez la commande suivante pour cr√©er un espace de travail Nx avec le gestionnaire de paquets de votre choix :

<CreateNxWorkspaceCommand workspace="my-project" />

:::tip
Vous serez invit√© √† choisir votre fournisseur d'infrastructure as code (IaC), soit [CDK](https://docs.aws.amazon.com/cdk/) soit [Terraform](https://developer.hashicorp.com/terraform). Vous pouvez ignorer cette √©tape en ajoutant `--iacProvider` √† la commande, par exemple :

<Infrastructure>
<Fragment slot="cdk">
<CreateNxWorkspaceCommand workspace="my-project" iacProvider="CDK" />
</Fragment>
<Fragment slot="terraform">
<CreateNxWorkspaceCommand workspace="my-project" iacProvider="Terraform" />
</Fragment>
</Infrastructure>
:::

Une fois termin√©, acc√©dez au r√©pertoire du projet :

```sh
cd my-project
```

## √âtape 2 : Utiliser les g√©n√©rateurs pour structurer votre projet

Dans ce guide rapide, nous ajouterons une API tRPC, un site React, une authentification Cognito et une infrastructure CDK ou Terraform. Selon votre type de projet, vous pouvez choisir n'importe quelle combinaison de g√©n√©rateurs pour d√©marrer rapidement. Consultez les __Guides__ dans la barre de navigation √† gauche pour voir toutes les options disponibles.

### Ajouter une API tRPC

<RunGenerator generator="ts#trpc-api" requiredParameters={{ name: 'demo-api', auth: 'IAM' }} />

Ceci cr√©era l'API dans le dossier `packages/demo-api`.

### Ajouter un site React

<RunGenerator generator="ts#react-website" requiredParameters={{ name: 'demo-website' }} />

Ceci g√©n√®re un nouveau site React dans `packages/demo-website`.

### Ajouter l'authentification Cognito

<RunGenerator generator="ts#react-website#auth" requiredParameters={{ project: '@my-project/demo-website', cognitoDomain: 'my-demo' }} />

Ceci configure l'infrastructure n√©cessaire et le code React pour ajouter l'authentification Cognito √† votre site.

### Connecter le frontend au backend

<RunGenerator generator="connection" requiredParameters={{ sourceProject: '@my-project/demo-website', targetProject: '@my-project/demo-api' }} />

Ceci configure les fournisseurs n√©cessaires pour permettre √† votre site d'appeler votre API tRPC.

### Ajouter l'infrastructure

Ajoutez le projet d'infrastructure selon votre fournisseur IaC choisi.

<Infrastructure>
<Fragment slot="cdk">
<RunGenerator generator="ts#infra" requiredParameters={{ name: 'infra' }} />

Ceci configure une application CDK que vous pouvez utiliser pour d√©ployer votre infrastructure sur AWS.
</Fragment>
<Fragment slot="terraform">
<RunGenerator generator="terraform#project" requiredParameters={{ name: 'infra' }} />

Ceci configure un projet Terraform que vous pouvez utiliser pour d√©ployer votre infrastructure sur AWS.
</Fragment>
</Infrastructure>

## √âtape 3 : Ex√©cuter votre site et API localement

Utilisez la commande suivante pour d√©marrer les serveurs de d√©veloppement locaux pour votre site et ses APIs connect√©es :

<NxCommands commands={['run demo-website:serve-local']} />

Votre site sera disponible √† l'adresse `http://localhost:4200`.

Les modifications apport√©es √† votre site et √† votre API seront refl√©t√©es en temps r√©el gr√¢ce au rechargement automatique des serveurs.

## √âtape 4 : D√©finir les ressources cloud et d√©ployer sur AWS

<Infrastructure>
<Fragment slot="cdk">
Ouvrez `packages/infra/src/stacks/application-stack.ts` et ajoutez le code suivant :

```typescript
import * as cdk from 'aws-cdk-lib';
import { DemoApi, DemoWebsite, UserIdentity } from ':my-project/common-constructs';
import { Construct } from 'constructs';

export class ApplicationStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    const identity = new UserIdentity(this, 'identity');
    const api = new DemoApi(this, 'api', {
      integrations: DemoApi.defaultIntegrations(this).build(),
    });
    api.grantInvokeAccess(identity.identityPool.authenticatedRole);

    new DemoWebsite(this, 'website');
  }
}
```

C'est tout le code CDK n√©cessaire pour d√©ployer notre application full-stack.
</Fragment>
<Fragment slot="terraform">
Ouvrez `packages/infra/src/main.tf` et ajoutez le code suivant :

```hcl
# Include metrics tracking for @aws/nx-plugin usage
module "metrics" {
  source = "../../common/terraform/src/metrics"
}

# Deploy user identity
module "user_identity" {
  source = "../../common/terraform/src/core/user-identity"
}

# Deploy API
module "demo_api" {
  source = "../../common/terraform/src/app/apis/demo-api"
}

# Grant authenticated users access to invoke the API
resource "aws_iam_policy" "api_invoke_policy" {
  name        = "DemoApiInvokePolicy"
  description = "Policy to allow authenticated users to invoke the API"

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Effect = "Allow"
        Action = "execute-api:Invoke"
        Resource = "${module.demo_api.api_execution_arn}/*/*"
      }
    ]
  })
}

resource "aws_iam_role_policy_attachment" "authenticated_api_access" {
  role       = module.user_identity.authenticated_role_name
  policy_arn = aws_iam_policy.api_invoke_policy.arn
}

# Deploy website
provider "aws" {
  alias  = "us_east_1"
  region = "us-east-1"
}

module "demo_website" {
  source = "../../common/terraform/src/app/static-websites/demo-website"

  providers = {
    aws.us_east_1 = aws.us_east_1
  }

  depends_on = [module.user_identity, module.demo_api]
}
```

C'est tout le code Terraform n√©cessaire pour d√©ployer notre application full-stack.
</Fragment>
</Infrastructure>

### Construire et d√©ployer l'infrastructure

Ex√©cutez ensuite la commande suivante pour construire votre projet :

<PackageManagerShortCommand commands={["build"]} />

:::tip
Si vous rencontrez des erreurs de linting, vous pouvez ex√©cuter la commande suivante pour les corriger automatiquement.

<PackageManagerShortCommand commands={["lint"]} />
:::

Initialisez votre infrastructure :

<Infrastructure>
<Fragment slot="cdk">
<NxCommands commands={['run infra:bootstrap']} />

:::tip
Le bootstrapping CDK est requis √† la fois pour votre r√©gion AWS cible et pour `us-east-1` afin de permettre le d√©ploiement du WebACL AWS WAF pour le site.
:::
</Fragment>
<Fragment slot="terraform">
<NxCommands commands={['run infra:bootstrap']} />

:::tip
Le bootstrapping Terraform cr√©e un bucket S3 pour stocker vos fichiers d'√©tat Terraform. Cette op√©ration ne doit √™tre effectu√©e qu'une fois par combinaison compte AWS/r√©gion.
:::
</Fragment>
</Infrastructure>

D√©ployez votre projet :

<Infrastructure>
<Fragment slot="cdk">
<NxCommands commands={['run infra:deploy "my-project-sandbox/*"']} />
</Fragment>
<Fragment slot="terraform">
<NxCommands commands={['run infra:apply']} />

:::tip
Cette commande ex√©cutera d'abord `terraform plan` pour afficher les modifications pr√©vues, puis appliquera ces changements pour d√©ployer votre infrastructure.
:::
</Fragment>
</Infrastructure>

## √âtape 5 : Tester le site avec les ressources cloud d√©ploy√©es

<Steps>
1. R√©cup√©rez le fichier `runtime-config.json` :

    <NxCommands commands={['run demo-website:load:runtime-config']} />

2. D√©marrez le serveur local du site

    <NxCommands commands={['run demo-website:serve']} />
</Steps>

Votre site sera disponible √† l'adresse `http://localhost:4200` et pointera vers les ressources d√©ploy√©es pour l'API et l'authentification.

---

F√©licitations ! üéâ Vous avez d√©ploy√© avec succ√®s une application full-stack en utilisant `@aws/nx-plugin` !