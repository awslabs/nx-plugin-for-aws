---
title: "Jeu de Donjon IA"
description: "Un guide pas √† pas pour construire un jeu d'aventure de donjon aliment√© par l'IA en utilisant le @aws/nx-plugin."
---



import { Aside, Code, FileTree, Steps, Tabs, TabItem } from '@astrojs/starlight/components';
import { Image } from 'astro:assets';
import Drawer from '@components/drawer.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import InstallCommand from '@components/install-command.astro';
import E2ECode from '@components/e2e-code.astro';
import E2EDiff from '@components/e2e-diff.astro';

import dungeonAdventureArchitecturePng from '@assets/dungeon-game-architecture.png'
import dungeonAdventureErPng from '@assets/dungeon-adventure-er.png'
import baselineWebsitePng from '@assets/baseline-website.png'
import baselineGamePng from '@assets/baseline-game.png'
import nxGraphPng from '@assets/nx-graph.png'
import gameSelectPng from '@assets/game-select.png'
import gameConversationPng from '@assets/game-conversation.png'

## Module 4 : Impl√©mentation de l'interface utilisateur

Pour commencer √† construire l'interface utilisateur, nous devons configurer notre serveur de d√©veloppement local pour pointer vers notre sandbox d√©ploy√©e. Ex√©cutez la commande suivante :

<NxCommands commands={["run @dungeon-adventure/game-ui:load:runtime-config"]} />

Cette commande r√©cup√©rera le fichier `runtime-config.json` d√©ploy√© et le stockera localement dans le dossier `packages/game-ui/public`.

Maintenant nous pouvons d√©marrer le serveur de d√©veloppement avec la commande suivante :

<NxCommands commands={["run @dungeon-adventure/game-ui:serve"]} />

Vous pouvez ensuite ouvrir le site local dans un navigateur. Vous serez invit√© √† vous connecter et √† suivre les √©tapes pour cr√©er un nouvel utilisateur. Une fois termin√©, vous devriez voir le site de base :

<Image src={baselineWebsitePng} alt="baseline-website.png" width="800" height="600" />

<Aside type="caution">
_Nous garderons le serveur de d√©veloppement en cours d'ex√©cution pendant tout le reste de ce module car il rechargera automatiquement les modifications._
</Aside>

### Cr√©er une nouvelle route '/game'

D√©montrons les capacit√©s de `@tanstack/react-router` en cr√©ant une nouvelle route typ√©e. Pour ce faire, cr√©ez simplement un fichier vide √† l'emplacement suivant : `packages/game-ui/src/routes/game/index.tsx`. Surveillez attentivement les logs du serveur de d√©veloppement :

```bash
‚ôªÔ∏è  Regenerating routes...
üü° Updating /Users/dimecha/dungeon-adventure/packages/game-ui/src/routes/game/index.tsx
üü° Updating /Users/dimecha/dungeon-adventure/packages/game-ui/src/routeTree.gen.ts
‚úÖ Processed routes in 27ms
```

Le `@tanstack/react-router` a automatiquement configur√© votre nouvelle route. Vous remarquerez que le fichier cr√©√© contient d√©j√† le chemin de la route :

```tsx
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/game/')({
  component: RouteComponent,
})

function RouteComponent() {
  return <div>Hello "/game/"!</div>
}
```

Maintenant, si vous naviguez vers `http://localhost:4200/game`, vous verrez votre nouvelle page s'afficher !

<Image src={baselineGamePng} alt="baseline-game.png" width="800" height="600" />

Mettons √©galement √† jour le fichier `index.tsx` pour charger notre nouvelle route `/game` par d√©faut. Notez que lorsque vous modifiez le champ `to`, vous avez une liste de routes typ√©es disponibles.

<E2EDiff before="dungeon-adventure/4/routes/index.tsx.old.template" after="dungeon-adventure/4/routes/index.tsx.template" lang="tsx" />

Enfin, nous pouvons supprimer le dossier `packages/game-ui/src/routes/welcome/` qui n'est plus n√©cessaire.

### Mises √† jour du layout

Le layout par d√©faut est plus adapt√© √† une application SaaS qu'√† un jeu. Nous allons reconfigurer le layout et le th√®me pour √©voquer un style de jeu m√©di√©val.

Apportons les modifications suivantes dans `packages/game-ui/src` :

<Tabs>
<TabItem label="config.ts">
<E2EDiff before="dungeon-adventure/4/config.ts.old.template" after="dungeon-adventure/4/config.ts.template" lang="typescript" />
</TabItem>
<TabItem label="components/AppLayout/index.tsx">
<E2ECode path="dungeon-adventure/4/AppLayout/index.tsx.template" lang="tsx" />
</TabItem>
<TabItem label="styles.css">
<E2ECode path="dungeon-adventure/4/styles.css.template" lang="css" />
</TabItem>
</Tabs>

Maintenant supprimons les fichiers `packages/game-ui/src/components/AppLayout/navitems.ts` et `packages/game-ui/src/hooks/useAppLayout.tsx` qui ne sont plus utilis√©s.

### Pages du jeu

Cr√©ons les pages du jeu qui appelleront nos APIs et finaliseront notre impl√©mentation :

<Tabs>
<TabItem label="index.tsx">
<E2ECode path="dungeon-adventure/4/routes/game/index.tsx.template" lang="tsx" />
</TabItem>
<TabItem label="$playerName.tsx">

<E2ECode path="dungeon-adventure/4/routes/game/$playerName.tsx.template" lang="tsx" />

<Aside type="tip">
La syntaxe `$playerName` indique √† `@tanstack/react-router` de traiter `playerName` comme un [param√®tre de chemin](https://tanstack.com/router/v1/docs/framework/react/guide/path-params). De plus, nous impl√©mentons la m√©thode `validateSearch` qui garantit que le param√®tre de requ√™te `genre` est typ√© selon notre enum de genres.
</Aside>
</TabItem>
</Tabs>

Apr√®s ces modifications, votre serveur de d√©veloppement local (http://localhost:4200/) devrait maintenant afficher votre jeu pr√™t √† √™tre jou√© !

<Drawer title="Construction et d√©ploiement" trigger="Vous pouvez √©galement construire & d√©ployer votre code sur Cloudfront si vous pr√©f√©rez.">

Pour construire votre code, ex√©cutez la commande suivante :

<NxCommands commands={['run-many --target build --all']} />

Maintenant d√©ployez votre application :

<NxCommands commands={['run @dungeon-adventure/infra:deploy dungeon-adventure-infra-sandbox']} />

Une fois d√©ploy√©, acc√©dez √† votre URL Cloudfront disponible dans les sorties du d√©ploiement CDK.

</Drawer>

<Image src={gameSelectPng} alt="game-select.png" width="500" height="400" />
<div style="margin-top: -100px; margin-left: 100px;">
<Image src={gameConversationPng} alt="game-conversation.png" width="500" height="400" />
</div>

F√©licitations. Vous avez construit et d√©ploy√© votre Jeu d'Aventure M√©di√©vale ! üéâüéâüéâ