---
title: "Construire l'Interface Utilisateur"
description: "Un guide pas √† pas pour construire un jeu d'aventure de donjon aliment√© par une IA agentique en utilisant le @aws/nx-plugin."
---

import { Aside, Code, FileTree, Steps, Tabs, TabItem } from '@astrojs/starlight/components';
import { Image } from 'astro:assets';
import Drawer from '@components/drawer.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import InstallCommand from '@components/install-command.astro';
import E2ECode from '@components/e2e-code.astro';
import E2EDiff from '@components/e2e-diff.astro';

import dungeonAdventureArchitecturePng from '@assets/dungeon-game-architecture.png'
import dungeonAdventureErPng from '@assets/dungeon-adventure-er.png'
import baselineWebsitePng from '@assets/baseline-website.png'
import baselineGamePng from '@assets/baseline-game.png'
import nxGraphPng from '@assets/nx-graph.png'
import gameSelectPng from '@assets/game-select.png'
import gameConversationPng from '@assets/game-conversation.png'

## T√¢che 1 : Configurer le serveur de d√©veloppement local

Pour commencer √† d√©velopper l'interface utilisateur, nous devons configurer notre serveur de d√©veloppement local pour pointer vers notre sandbox d√©ploy√©e. Ex√©cutez la commande suivante :

<NxCommands commands={["run @dungeon-adventure/game-ui:load:runtime-config"]} />

Cette commande r√©cup√©rera le fichier `runtime-config.json` d√©ploy√© et le stockera localement dans le dossier `packages/game-ui/public`.

Pour d√©marrer le serveur de d√©veloppement, ex√©cutez la commande suivante :

<NxCommands commands={["run @dungeon-adventure/game-ui:serve"]} />

Ouvrez le site local dans un navigateur. Vous serez invit√© √† vous connecter et √† suivre les √©tapes pour cr√©er un nouvel utilisateur. Une fois termin√©, vous devriez voir le site de base :

<Image src={baselineWebsitePng} alt="baseline-website.png" width="800" height="600" />

<Aside type="caution">
Nous recommandons de garder le serveur de d√©veloppement en fonctionnement pendant le reste de ce module, car il rechargera automatiquement toutes les modifications apport√©es.
</Aside>

:::tip
Vous pouvez ex√©cuter des commandes Nx √† la place pour d√©marrer les serveurs API locaux connect√©s, vous permettant d'it√©rer simultan√©ment sur votre API tRPC et votre site web. <NxCommands commands={["run @dungeon-adventure/game-ui:serve-local"]} /> 
:::

## T√¢che 2 : Cr√©er une nouvelle route '/game'

D√©montrons les capacit√©s de `@tanstack/react-router` en cr√©ant une nouvelle route typ√©e. 
Pour ce faire, cr√©ez un fichier vide √† l'emplacement suivant : `packages/game-ui/src/routes/game/index.tsx`. Vous remarquerez que le fichier est imm√©diatement mis √† jour.

Le routeur `@tanstack/react-router` configure automatiquement votre nouvelle route et le fichier que vous venez de cr√©er contient d√©j√† le chemin de la route :

```tsx
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/game/')({
  component: RouteComponent,
})

function RouteComponent() {
  return <div>Hello "/game/"!</div>
}
```

Si vous naviguez vers `http://localhost:4200/game`, vous verrez votre nouvelle page s'afficher.

<Image src={baselineGamePng} alt="baseline-game.png" width="800" height="600" />

Mettez √† jour le fichier `index.tsx` pour charger notre nouvelle route `/game` par d√©faut. Lorsque vous mettez √† jour le champ `to`, vous avez une liste de routes typ√©es parmi lesquelles choisir.

<Tabs>
<TabItem label="routes/index.tsx">
<E2EDiff before="dungeon-adventure/4/routes/index.tsx.old.template" after="dungeon-adventure/4/routes/index.tsx.template" lang="tsx" />
</TabItem>
</Tabs>

Vous pouvez supprimer le dossier `packages/game-ui/src/routes/welcome/` qui n'est plus n√©cessaire.

## T√¢che 3 : Mettre √† jour le layout

Le layout par d√©faut configur√© est plus similaire √† une application SaaS d'entreprise qu'√† un jeu. 
Pour reconfigurer le layout et le reth√©matiser pour √©voquer un style m√©di√©val de donjon, apportez les modifications suivantes dans `packages/game-ui/src` :

<Tabs>
<TabItem label="config.ts">
<E2EDiff before="dungeon-adventure/4/config.ts.old.template" after="dungeon-adventure/4/config.ts.template" lang="typescript" />
</TabItem>
<TabItem label="components/AppLayout/index.tsx">
<E2ECode path="dungeon-adventure/4/AppLayout/index.tsx.template" lang="tsx" />
</TabItem>
<TabItem label="styles.css">
<E2ECode path="dungeon-adventure/4/styles.css.template" lang="css" />
</TabItem>
</Tabs>

Supprimez le fichier `packages/game-ui/src/hooks/useAppLayout.tsx` qui n'est plus utilis√©.

## T√¢che 4 : Int√©grer l'Agent Narratif

Cr√©ons un hook pour initialiser un client permettant d'interagir avec notre Agent Narratif.

<Tabs>
<TabItem label="hooks/useStoryAgent.tsx">
<E2ECode path="dungeon-adventure/4/hooks/useStoryAgent.tsx.template" lang="tsx" />
</TabItem>
</Tabs>

Ce hook effectue les actions suivantes :

- R√©cup√®re l'ARN de l'agent depuis `runtime-config.json`,
- Construit l'URL d'invocation Runtime d'AgentCore √† partir de l'ARN,
- Invoque l'Agent avec le token JWT de l'utilisateur connect√© et un ID de session al√©atoire, et
- Retourne un it√©rateur asynchrone pour consommer les messages stream√©s de l'agent.

:::tip
L'int√©gration avec notre Game API est d√©j√† configur√©e, car nous avons utilis√© le g√©n√©rateur `api-connection`. Si vous souhaitez une exp√©rience similaire pour les agents, +1 [cette issue GitHub](https://github.com/awslabs/nx-plugin-for-aws/issues/326).
:::

## T√¢che 5 : Cr√©er les pages du jeu

Pour cr√©er les pages du jeu qui appelleront nos APIs et finaliser l'impl√©mentation du jeu, mettez √† jour les fichiers suivants dans `packages/game-ui/src/routes/game` :

<Tabs>
<TabItem label="index.tsx">
<E2ECode path="dungeon-adventure/4/routes/game/index.tsx.template" lang="tsx" />
</TabItem>
<TabItem label="$playerName.tsx">

<E2ECode path="dungeon-adventure/4/routes/game/$playerName.tsx.template" lang="tsx" />

<Aside type="tip">
La syntaxe `$playerName` indique √† `@tanstack/react-router` de traiter `playerName` comme un [param√®tre de chemin](https://tanstack.com/router/v1/docs/framework/react/guide/path-params). De plus, nous impl√©mentons la m√©thode `validateSearch` qui garantit que le param√®tre de requ√™te `genre` est fortement typ√© selon notre enum de genres.
</Aside>
</TabItem>
</Tabs>

Apr√®s ces modifications, votre serveur de d√©veloppement local (http://localhost:4200/) devrait maintenant afficher votre jeu pr√™t √† √™tre jou√©.

<Drawer title="Construction et d√©ploiement" trigger="Vous pouvez √©galement construire & d√©ployer votre code sur Cloudfront si vous pr√©f√©rez.">

## T√¢che 6 : Construire et d√©ployer

### Construire votre code
Pour construire votre code, ex√©cutez la commande suivante :

<NxCommands commands={['run-many --target build --all']} />

### D√©ployer votre application
Pour d√©ployer votre application, ex√©cutez la commande suivante :

<NxCommands commands={['run @dungeon-adventure/infra:deploy dungeon-adventure-infra-sandbox/*']} />

Une fois d√©ploy√©, acc√©dez √† votre URL Cloudfront. Pour trouver cette URL, inspectez les sorties du d√©ploiement CDK.

</Drawer>

<Image src={gameSelectPng} alt="game-select.png" width="500" height="400" />
<div style="margin-top: -100px; margin-left: 100px;">
<Image src={gameConversationPng} alt="game-conversation.png" width="500" height="400" />
</div>

F√©licitations. Vous avez construit et d√©ploy√© votre Jeu d'aventure en donjon agentique ! üéâüéâüéâ