---
title: Python Lambda Functions
description: Reference documentation for Python Lambda Functions
---

import { FileTree } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import RunGenerator from '@components/run-generator.astro';
import GeneratorParameters from '@components/generator-parameters.astro';
import Infrastructure from '@components/infrastructure.astro';
import Snippet from '@components/snippet.astro';
import NxCommands from '@components/nx-commands.astro';

The Python Lambda Function generator provides the ability to add a lambda function to an existing python project.

This generator creates a new python lambda handler with AWS CDK or Terraform infrastructure setup. The generated backend uses AWS Lambda for serverless deployment, with optional type-safety using the [Parser from AWS Lambda Powertools](https://docs.powertools.aws.dev/lambda/python/latest/utilities/parser/). It sets up [AWS Lambda Powertools](https://docs.powertools.aws.dev/lambda/python/latest/) for observability, including logging, AWS X-Ray tracing and Cloudwatch Metrics.

## Usage

### Generate a Lambda Function

You can generate a new Lambda Function in two ways:

<RunGenerator generator="py#lambda-function" />

### Options

<GeneratorParameters generator="py#lambda-function" />

## Generator Output

The generator will add the following files to your project:

<FileTree>

- \<module-name>
  - \<lambda-function>.py Function implementation

</FileTree>

If the `functionPath` option is provided, the generater will add the necessary files to the specified path:

<FileTree>

- \<module-name>
  - \<custom-path>
    - \<function-name>.py Function implementation

</FileTree>

### Infrastructure

<Snippet name="shared-constructs" />

The generator creates infrastructure as code for deploying your function based on your selected `iacProvider`:

<Infrastructure>
<Fragment slot="cdk">
The generator creates CDK constructs which can be used to deploy your function, which reside in the `packages/common/constructs` directory.
</Fragment>
<Fragment slot="terraform">
The generator creates a Terraform module which can be used to deploy your function, which resides in the `packages/common/terraform/src/app/lambda-functions/<function-name>` directory.
</Fragment>
</Infrastructure>

## Implementing your Function

The main function implementation is in `<function-name>.py`. Here's an example:

```python
import os

from aws_lambda_powertools import Logger, Metrics, Tracer
from aws_lambda_powertools.metrics import MetricUnit
from aws_lambda_powertools.utilities.parser import event_parser
from aws_lambda_powertools.utilities.parser.models import EventBridgeModel
from aws_lambda_powertools.utilities.typing import LambdaContext

os.environ["POWERTOOLS_METRICS_NAMESPACE"] = "Foo"
os.environ["POWERTOOLS_SERVICE_NAME"] = "Foo"

logger: Logger = Logger()
metrics: Metrics = Metrics()
tracer: Tracer = Tracer()

@tracer.capture_lambda_handler
@metrics.log_metrics
@event_parser(model=EventBridgeModel)
def lambda_handler(event: EventBridgeModel, context: LambdaContext):
    logger.info("Received event", extra={"event": event.model_dump() })
    metrics.add_metric(name="InvocationCount", unit=MetricUnit.Count, value=1)

    try:
        # TODO: Implement
        metrics.add_metric(name="SuccessCount", unit=MetricUnit.Count, value=1)
        # TODO: Implement success response if required
    except Exception as e:
        logger.exception(e)
        metrics.add_metric(name="ErrorCount", unit=MetricUnit.Count, value=1)
        # TODO: Implement error response if required
```

The generator sets up several features automatically:

1. AWS Lambda Powertools integration for observability
2. Metrics collection
3. Type-safety using `@event_parser`

### Observability with AWS Lambda Powertools

#### Logging

The generator configures structured logging using AWS Lambda Powertools.

```python
def lambda_handler(event: EventBridgeModel, context: LambdaContext):
    logger.info("Received event", extra={"event": event.model_dump()})
```

:::tip
It is recommended to set the correlation id for all unique requests for easier debugging and monitoring. Please refer to the [aws powertools logger](https://docs.powertools.aws.dev/lambda/python/2.22.0/core/logger/#setting-a-correlation-id) documentation for correlation id best practices.
:::

The logger automatically includes:

- Event requests
- Lambda context information
- Cold start indicators

#### Tracing

AWS X-Ray tracing is configured automatically. You can add custom subsegments to your traces:

```python
def lambda_handler(event: EventBridgeModel, context: LambdaContext):
    # Creates a new subsegment
    with tracer.provider.in_subsegment("function-subsegment"):
        # Your logic here
        return ....
```

#### Metrics

CloudWatch metrics are collected automatically for each request. You can add custom metrics:

```python
def lambda_handler(event: EventBridgeModel, context: LambdaContext):
    metrics.add_metric(name="NewMetric", unit=MetricUnit.Count, value=1)
    return ...
```

Default metrics include:

- Invocation counts
- Success/failure counts
- Cold start metrics

### Type Safety

If you chose an `eventSource` when generating your lambda function, your function is instrumented with [`@event_parser` from AWS Lambda Powertools](https://docs.powertools.aws.dev/lambda/python/latest/utilities/parser/). For example:

```python {3}
@event_parser(model=EventBridgeModel)
def lambda_handler(event: EventBridgeModel, context: LambdaContext):
    event.detail_type # <- type-safe with IDE autocompletion
```

This allows you to define data models using [Pydantic](https://docs.pydantic.dev/latest/), in a similar manner to working with <Link path="guides/fastapi">Fast API</Link>.

:::tip
If you have custom data nested within an event, for example a DynamoDB stream or EventBridge event, you may benefit from using [Envelopes](https://docs.powertools.aws.dev/lambda/python/latest/utilities/parser/#envelopes) to provide type-safety for that custom data.
:::

If you do not wish to type your event, you can just select `Any` for your `eventSource`.

## Bundling

The generator automatically configures Python bundling for Lambda deployment packages using [uv](https://docs.astral.sh/uv/):

<NxCommands commands={['run <project-name>:bundle']} />

:::note
This bundles the whole project as the deployment package. To minimise deployment size, you may wish to split multiple lambda functions over multiple Python projects generated with the <Link path="guides/python-project">`py#project`</Link> generator.
:::

This process uses:

1. [`uv export`](https://docs.astral.sh/uv/reference/cli/#uv-export) to export your Python dependencies to a `requirements.txt` file
2. [`uv pip install`](https://docs.astral.sh/uv/reference/cli/#uv-pip-install) to install dependencies for the target platform (`x86_64-manylinux2014`) for Lambda deployment

:::note
If you change your [lambda architecture to ARM](https://docs.aws.amazon.com/lambda/latest/dg/foundation-arch.html), you will need to edit your bundle target to use the `aarch64-manylinux2014` target.
:::

## Deploying your Function

<Snippet name="lambda-function/deploying-your-function" parentHeading="Deploying your Function" />
