---
title: Deploying your Function
---
import Infrastructure from '@components/infrastructure.astro';

This generator creates CDK or Terraform infrastructure as code based on your selected `iacProvider`. You can use this to deploy your function.

<Infrastructure>
<Fragment slot="cdk">
This generator creates a CDK construct for deploying your function in the `common/constructs` folder. You can use this in a CDK application:

```typescript {1, 6}
import { MyProjectMyFunction } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    // Add the function to your stack
    const fn = new MyProjectMyFunction(this, 'MyFunction');
  }
}
```

This sets up:

1. AWS Lambda function
2. CloudWatch log group
3. X-Ray tracing configuration
4. CloudWatch metrics namespace

This function can then be used as a target for any lambda [event source](https://docs.powertools.aws.dev/lambda/typescript/latest/utilities/parser/):

:::note
Ensure the event source matches the selected `eventSource` option to ensure the event is properly handled within your handler function.
:::

The example below demonstrates the CDK code for invoking your lambda function on a schedule using EventBridge:

```typescript
import { Rule, Schedule } from 'aws-cdk-lib/aws-events';
import { LambdaFunction } from 'aws-cdk-lib/aws-events-targets';
import { MyProjectMyFunction } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    // Add the function to your stack
    const fn = new MyProjectMyFunction(this, 'MyFunction');

    // Add the function to an EventBridge scheduled rule
    const eventRule = new Rule(this, 'MyFunctionScheduleRule', {
      schedule: Schedule.cron({ minute: '15' }),
      targets: [new LambdaFunction(fn)],
    });
  }
}
```
</Fragment>
<Fragment slot="terraform">
This generator creates a Terraform module for deploying your function in the `common/terraform` folder. You can use this in a Terraform configuration:

```hcl {2}
module "my_project_my_function" {
  source = "../../common/terraform/src/app/lambda-functions/my-project-my-function"

  # Environment variables for the Lambda function
  env = {
    SOME_VARIABLE = "some value"
  }

  # Additional IAM policies if needed
  additional_iam_policy_statements = [
    # Add any additional permissions your function needs
  ]
}
```

This sets up:

1. AWS Lambda function
2. CloudWatch log group
3. X-Ray tracing configuration
4. CloudWatch metrics namespace

This function can then be used as a target for any lambda event source. The example below demonstrates the Terraform code for invoking your lambda function on a schedule using EventBridge:

```hcl
# EventBridge rule for scheduled execution
resource "aws_cloudwatch_event_rule" "my_function_schedule" {
  name                = "my-function-schedule"
  description         = "Trigger my function every 15 minutes"
  schedule_expression = "cron(15 * * * ? *)"
}

# EventBridge target
resource "aws_cloudwatch_event_target" "lambda_target" {
  rule      = aws_cloudwatch_event_rule.my_function_schedule.name
  target_id = "MyFunctionTarget"
  arn       = module.my_project_my_function.function_arn
}

# Permission for EventBridge to invoke the Lambda function
resource "aws_lambda_permission" "allow_eventbridge" {
  statement_id  = "AllowExecutionFromEventBridge"
  action        = "lambda:InvokeFunction"
  function_name = module.my_project_my_function.function_name
  principal     = "events.amazonaws.com"
  source_arn    = aws_cloudwatch_event_rule.my_function_schedule.arn
}
```

:::note
Ensure the event source matches the selected `eventSource` option to ensure the event is properly handled within your handler function.
:::
</Fragment>
</Infrastructure>