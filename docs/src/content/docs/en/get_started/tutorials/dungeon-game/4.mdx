---
title: Build the UI
description: A walkthrough of how to build an agentic AI-powered dungeon adventure game using the @aws/nx-plugin.
---

import { Aside, Code, FileTree, Steps, Tabs, TabItem } from '@astrojs/starlight/components';
import { Image } from 'astro:assets';
import Drawer from '@components/drawer.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import InstallCommand from '@components/install-command.astro';
import E2ECode from '@components/e2e-code.astro';
import E2EDiff from '@components/e2e-diff.astro';

import dungeonAdventureArchitecturePng from '@assets/dungeon-game-architecture.png'
import dungeonAdventureErPng from '@assets/dungeon-adventure-er.png'
import baselineWebsitePng from '@assets/baseline-website.png'
import baselineGamePng from '@assets/baseline-game.png'
import nxGraphPng from '@assets/nx-graph.png'
import gameSelectPng from '@assets/game-select.png'
import gameConversationPng from '@assets/game-conversation.png'

## Task 1: Configure local dev server

To start building the UI, we will need to configure our local dev server to point to our deployed sandbox. To do this, run the following command:

<NxCommands commands={["run @dungeon-adventure/game-ui:load:runtime-config"]} />

This command will pull down the `runtime-config.json` that is deployed and store it locally within the `packages/game-ui/public` folder.

To start the dev server, run the following command:

<NxCommands commands={["run @dungeon-adventure/game-ui:serve"]} />

Open your local website in a browser, where you will be prompted to log in and follow the prompts to create a new user. Once completed, you should see the baseline website:

<Image src={baselineWebsitePng} alt="baseline-website.png" width="800" height="600" />

<Aside type="caution">
We recommend keeping the dev server running throughout the remainder of this module as it will automatically hot-reload any changes we make.
</Aside>

:::tip
You can run Nx commands instead to start any connected API local servers, allowing you to iterate on both your tRPC API and your website together. <NxCommands commands={["run @dungeon-adventure/game-ui:serve-local"]} /> 
:::

## Task 2: Create a new '/game' route

Let's showcase the capabilities of `@tanstack/react-router` by creating a new type-safe route. 
To do this, create an empty file at the following location: `packages/game-ui/src/routes/game/index.tsx`. You will notice the file is immediately updated.

The `@tanstack/react-router` automatically configures your new route and the file you just created is already populated with the route path:

```tsx
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/game/')({
  component: RouteComponent,
})

function RouteComponent() {
  return <div>Hello "/game/"!</div>
}
```

If you navigate to `http://localhost:4200/game`, you will see your new page has been rendered.

<Image src={baselineGamePng} alt="baseline-game.png" width="800" height="600" />

Update the `index.tsx` file to load our new `/game` route by default. When you update the `to` field, you have a list of type-safe routes to choose from.

<Tabs>
<TabItem label="routes/index.tsx">
<E2EDiff before="dungeon-adventure/4/routes/index.tsx.old.template" after="dungeon-adventure/4/routes/index.tsx.template" lang="tsx" />
</TabItem>
</Tabs>

You can delete the `packages/game-ui/src/routes/welcome/` folder as this is no longer required.

## Task 3: Update the layout

The default layout that is configured is similar to a SaaS style business application than a game. 
To reconfigure the layout and re-theme it to be more like a dungeon style game, make the following changes to `packages/game-ui/src`:

<Tabs>
<TabItem label="config.ts">
<E2EDiff before="dungeon-adventure/4/config.ts.old.template" after="dungeon-adventure/4/config.ts.template" lang="typescript" />
</TabItem>
<TabItem label="components/AppLayout/index.tsx">
<E2ECode path="dungeon-adventure/4/AppLayout/index.tsx.template" lang="tsx" />
</TabItem>
<TabItem label="styles.css">
<E2ECode path="dungeon-adventure/4/styles.css.template" lang="css" />
</TabItem>
</Tabs>

Delete the `packages/game-ui/src/hooks/useAppLayout.tsx` file as it is unused.

## Task 4: Integrate the Story Agent

Let us create a hook to initialise a client for interacting with our Story Agent.

<Tabs>
<TabItem label="hooks/useStoryAgent.tsx">
<E2ECode path="dungeon-adventure/4/hooks/useStoryAgent.tsx.template" lang="tsx" />
</TabItem>
</Tabs>

This hook:

- Retrieves the Agent ARN from `runtime-config.json`,
- Constructs the AgentCore Runtime invocation URL from the ARN,
- Invokes the Agent with the signed-in user's JWT token, and a random session ID, and
- Returns an async iterator for consumption of streamed agent message chunks.

:::tip
Integration with our Game API is already configured, as we used the `api-connection` generator. If you would like a similar experience for agents, +1 [this GitHub issue](https://github.com/awslabs/nx-plugin-for-aws/issues/326).
:::

## Task 5: Create the Game pages

To create the Game pages which will call our APIs and finish our game implementation, update the following files in `packages/game-ui/src/routes/game`:

<Tabs>
<TabItem label="index.tsx">
<E2ECode path="dungeon-adventure/4/routes/game/index.tsx.template" lang="tsx" />
</TabItem>
<TabItem label="$playerName.tsx">

<E2ECode path="dungeon-adventure/4/routes/game/$playerName.tsx.template" lang="tsx" />

<Aside type="tip">
The `$playerName` syntax will instruct `@tanstack/react-router` to treat `playerName` as a [path param](https://tanstack.com/router/v1/docs/framework/react/guide/path-params). Additionally, we implement the `validateSearch` method which ensures that the `genre` query parameter is strongly typed to our genre enum.
</Aside>
</TabItem>
</Tabs>

Once you make these changes, your local dev server (http://localhost:4200/) should now have your game ready to play.

<Drawer title="Build and Deploy" trigger="You can also build & deploy your code to Cloudfront if you prefer.">

## Task 6: Build and deploy

### Build your code
To build your code, run the following command:

<NxCommands commands={['run-many --target build --all']} />

### Deploy your application
To deploy your application, run the following command:

<NxCommands commands={['run @dungeon-adventure/infra:deploy dungeon-adventure-infra-sandbox/*']} />

Once deployed, navigate to your Cloudfront URL. To find this URL, inspect the CDK deploy outputs.

</Drawer>

<Image src={gameSelectPng} alt="game-select.png" width="500" height="400" />
<div style="margin-top: -100px; margin-left: 100px;">
<Image src={gameConversationPng} alt="game-conversation.png" width="500" height="400" />
</div>

Congratulations. You have built and deployed your Agentic Dungeon Adventure Game!  ðŸŽ‰ðŸŽ‰ðŸŽ‰
