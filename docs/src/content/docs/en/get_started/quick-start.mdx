---
title: Quick Start Guide
description: A quick start on how to use @aws/nx-plugin.
---
import { Steps } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import Snippet from '@components/snippet.astro';
import CreateNxWorkspaceCommand from '@components/create-nx-workspace-command.astro';
import InstallCommand from '@components/install-command.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import Infrastructure from '@components/infrastructure.astro';

This guide walks you through the basics of installing and using `@aws/nx-plugin` to rapidly build projects on AWS.

:::tip
For a more in-depth tutorial for building a full-stack application, check out the <Link path="get_started/tutorials/dungeon-game/overview">Dungeon Adventure Tutorial</Link>.
:::

## Prerequisites

The following global dependencies are needed before proceeding:

<Snippet name="prerequisites" />

## Step 1: Initialize a New Nx Workspace

Run the following command to create an Nx workspace with the package manager of your choice:

<CreateNxWorkspaceCommand workspace="my-project" />

:::tip
You will be prompted for your preferred infrastructure as code (IaC) provider, either [CDK](https://docs.aws.amazon.com/cdk/) or [Terraform](https://developer.hashicorp.com/terraform). You can skip the prompt by running the command with `--iacProvider`, ie:

<Infrastructure>
<Fragment slot="cdk">
<CreateNxWorkspaceCommand workspace="my-project" iacProvider="CDK" />
</Fragment>
<Fragment slot="terraform">
<CreateNxWorkspaceCommand workspace="my-project" iacProvider="Terraform" />
</Fragment>
</Infrastructure>
:::

Once complete, navigate to the project directory:

```sh
cd my-project
```

## Step 2: Use Generators to Scaffold your Project

We'll add a tRPC API, React Website, Cognito Authentication, and CDK or Terraform Infrastructure in this quick-start guide. Depending on the type of project you're building, you can choose any combination of generators to quickly bootstrap your project. Check out the __Guides__ in the navigation bar to the left to see the full list of options.

### Add a tRPC API

<RunGenerator generator="ts#trpc-api" requiredParameters={{ name: 'demo-api', auth: 'IAM' }} />

This will create the API inside the `packages/demo-api` folder.

### Add a React Website

<RunGenerator generator="ts#react-website" requiredParameters={{ name: 'demo-website' }} />

This scaffolds a new React website in `packages/demo-website`.

### Add Cognito Authentication

<RunGenerator generator="ts#react-website#auth" requiredParameters={{ project: '@my-project/demo-website', cognitoDomain: 'my-demo' }} />

This sets up the necessary infrastructure and React code to add Cognito Authentication to your website.

### Connect Frontend to Backend

<RunGenerator generator="api-connection" requiredParameters={{ sourceProject: '@my-project/demo-website', targetProject: '@my-project/demo-api' }} />

This configures the necessary providers to ensure your website can call your tRPC API.

### Add Infrastructure

Add the infrastructure project based on your chosen IAC provider.

<Infrastructure>
<Fragment slot="cdk">
<RunGenerator generator="ts#infra" requiredParameters={{ name: 'infra' }} />

This configures a CDK App which you can use to deploy your infrastructure on AWS.
</Fragment>
<Fragment slot="terraform">
<RunGenerator generator="terraform#project" requiredParameters={{ name: 'infra' }} />

This configures a Terraform project which you can use to deploy your infrastructure on AWS.
</Fragment>
</Infrastructure>

## Step 3: Run your Website and API Locally

Use the following command to start local dev servers for your website and its connected APIs:

<NxCommands commands={['run demo-website:serve-local']} />

Your website will be available at `http://localhost:4200`.

Changes to both your website and API will be reflected in real-time as both the local website and API servers will hot-reload.

## Step 4: Define Cloud Resources and Deploy to AWS

<Infrastructure>
<Fragment slot="cdk">
Open `packages/infra/src/stacks/application-stack.ts` and add the following code:

```typescript
import * as cdk from 'aws-cdk-lib';
import { DemoApi, DemoWebsite, UserIdentity } from ':my-project/common-constructs';
import { Construct } from 'constructs';

export class ApplicationStack extends cdk.Stack {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    const identity = new UserIdentity(this, 'identity');
    const api = new DemoApi(this, 'api', {
      integrations: DemoApi.defaultIntegrations(this).build(),
    });
    api.grantInvokeAccess(identity.identityPool.authenticatedRole);

    new DemoWebsite(this, 'website');
  }
}
```

This is all the CDK we need to write to deploy our full stack application.
</Fragment>
<Fragment slot="terraform">
Open `packages/infra/src/main.tf` and add the following code:

```hcl
# Include metrics tracking for @aws/nx-plugin usage
module "metrics" {
  source = "../../common/terraform/src/metrics"
}

# Deploy user identity
module "user_identity" {
  source = "../../common/terraform/src/core/user-identity"
}

# Deploy API
module "demo_api" {
  source = "../../common/terraform/src/app/apis/demo-api"
}

# Grant authenticated users access to invoke the API
resource "aws_iam_policy" "api_invoke_policy" {
  name        = "DemoApiInvokePolicy"
  description = "Policy to allow authenticated users to invoke the API"

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Effect = "Allow"
        Action = "execute-api:Invoke"
        Resource = "${module.demo_api.api_execution_arn}/*/*"
      }
    ]
  })
}

resource "aws_iam_role_policy_attachment" "authenticated_api_access" {
  role       = module.user_identity.authenticated_role_name
  policy_arn = aws_iam_policy.api_invoke_policy.arn
}

# Deploy website
provider "aws" {
  alias  = "us_east_1"
  region = "us-east-1"
}

module "demo_website" {
  source = "../../common/terraform/src/app/static-websites/demo-website"

  providers = {
    aws.us_east_1 = aws.us_east_1
  }

  depends_on = [module.user_identity, module.demo_api]
}
```

This is all the Terraform we need to write to deploy our full stack application.
</Fragment>
</Infrastructure>

### Build and Deploy the Infrastructure

Next, run the following command to build your project:

<NxCommands commands={['run-many --target build --all']} />

:::tip
If you encounter any lint errors, you can run the following command to automatically fix them.

<NxCommands commands={['run-many --target lint --configuration=fix --all']} />
:::

Bootstrap your infrastructure:

<Infrastructure>
<Fragment slot="cdk">
<NxCommands commands={['run infra:bootstrap']} />

:::tip
CDK bootstrapping is required for both your target deployment AWS region, and `us-east-1` to allow deployment of the AWS WAF WebACL for the website.
:::
</Fragment>
<Fragment slot="terraform">
<NxCommands commands={['run infra:bootstrap']} />

:::tip
Terraform bootstrapping creates an S3 bucket to store your Terraform state files. This only needs to be done once per AWS account/region combination.
:::
</Fragment>
</Infrastructure>

Deploy your project:

<Infrastructure>
<Fragment slot="cdk">
<NxCommands commands={['run infra:deploy my-project-sandbox/*']} />
</Fragment>
<Fragment slot="terraform">
<NxCommands commands={['run infra:apply']} />

:::tip
This command will first run `terraform plan` to show you what changes will be made, then apply those changes to deploy your infrastructure.
:::
</Fragment>
</Infrastructure>

## Step 5: Test the Website with Deployed Cloud Resources

<Steps>
1. Fetch the `runtime-config.json` file:

    <NxCommands commands={['run demo-website:load:runtime-config']} />

2. Start the local website server

    <NxCommands commands={['run demo-website:serve']} />
</Steps>

Your website will be available at `http://localhost:4200`, and will point to the resources you deployed for the API and authentication.

---

Congratulations! ðŸŽ‰ You have successfully built and deployed a full-stack application using `@aws/nx-plugin`!
