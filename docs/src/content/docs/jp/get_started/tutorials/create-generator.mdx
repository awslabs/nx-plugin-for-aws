---
title: "ジェネレーターの作成"
description: "@aws/nx-pluginを使用してジェネレーターを構築する方法のチュートリアル。"
---

import { Aside, Code, FileTree, Steps, Tabs, TabItem } from '@astrojs/starlight/components';
import { Image } from 'astro:assets';
import Drawer from '@components/drawer.astro';
import Link from '@components/link.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import InstallCommand from '@components/install-command.astro';
import dungeonAdventureArchitecturePng from '@assets/dungeon-game-architecture.png'
import dungeonAdventureErPng from '@assets/dungeon-adventure-er.png'
import baselineWebsitePng from '@assets/baseline-website.png'
import baselineGamePng from '@assets/baseline-game.png'
import nxGraphPng from '@assets/nx-graph.png'
import gameSelectPng from '@assets/game-select.png'
import gameConversationPng from '@assets/game-conversation.png'

## ジェネレータを構築する

新しいジェネレータを作成しましょう。目的は、tRPC APIの新しい手順を生成することです。

### プラグインをチェックアウトする

まず、プラグインをクローンします：

```bash
git clone git@github.com:awslabs/nx-plugin-for-aws.git
```

次に、インストールとビルドを行います：

```bash
cd nx-plugin-for-aws
pnpm i
pnpm nx run-many --target build --all
```

### 空のジェネレータを作成する

`packages/nx-plugin/src/trpc/procedure`に新しいジェネレータを作成します。スキーマとジェネレータのエントリーポイントから始めます：

<FileTree>
  - packages/nx-plugin/src/trpc/procedure
    - schema.json ジェネレータの入力を定義
    - schema.d.ts スキーマに一致するTypeScriptインターフェース
    - generator.ts Nxが実行するジェネレータ関数
</FileTree>

以下の内容を各ファイルに追加します。

<Tabs>
  <TabItem label="schema.json">
    ```json
    {
      "$schema": "https://json-schema.org/schema",
      "$id": "tRPCProcedure",
      "title": "tRPC APIに手順を追加",
      "type": "object",
      "properties": {
        "project": {
          "type": "string",
          "description": "tRPC API プロジェクト",
          "x-prompt": "手順を追加するtRPC APIプロジェクトを選択",
          "x-dropdown": "projects",
          "x-priority": "important"
        },
        "procedure": {
          "description": "新しい手順の名前",
          "type": "string",
          "x-prompt": "新しい手順に何という名前を付けますか？",
          "x-priority": "important",
        },
        "type": {
          "description": "生成する手順の種類",
          "type": "string",
          "x-prompt": "どのような種類の手順を生成しますか？",
          "x-priority": "important",
          "default": "query",
          "enum": ["query", "mutation"]
        }
      },
      "required": ["project", "procedure"]
    }
    ```
  </TabItem>
  <TabItem label="schema.d.ts">
    ```ts
    export interface TrpcProcedureSchema {
      project: string;
      procedure: string;
      type: 'query' | 'mutation';
    }
    ```
  </TabItem>
  <TabItem label="generator.ts">
    ```ts
    import { Tree } from '@nx/devkit';
    import { TrpcProcedureSchema } from './schema';

    export const trpcProcedureGenerator = async (tree: Tree, options: TrpcProcedureSchema) => {

    };

    export default trpcProcedureGenerator;

    ```
  </TabItem>
</Tabs>

:::note
ジェネレータには`Tree`と、スキーマで定義したオプションが入力として渡されます。`Tree`は基本的に仮想ファイルシステムで、プロジェクトファイルの読み取りと書き込みができます。ユーザーが「ドライラン」モードでジェネレータを実行した場合、直接ファイルシステムに触れたくありません。
:::

次に、`packages/nx-plugin/generators.json`を更新してジェネレータを接続します：

```json
 ...
  "generators": {
    ...
    "ts#trpc-api#procedure": {
      "factory": "./src/trpc/procedure/generator",
      "schema": "./src/trpc/procedure/schema.json",
      "description": "tRPC APIに手順を追加"
    }
  },
...
```

（以下、同様に翻訳を続けます）