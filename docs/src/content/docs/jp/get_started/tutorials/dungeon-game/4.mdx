---
title: AI ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã‚²ãƒ¼ãƒ 
description: '@aws/nx-pluginã‚’ä½¿ç”¨ã—ã¦AIãƒ‘ãƒ¯ãƒ¼ãƒ‰ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã‚¢ãƒ‰ãƒ™ãƒ³ãƒãƒ£ãƒ¼ã‚²ãƒ¼ãƒ ã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã€‚'
---

import { Aside, Code, FileTree, Steps, Tabs, TabItem } from '@astrojs/starlight/components';
import { Image } from 'astro:assets';
import Drawer from '@components/drawer.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import InstallCommand from '@components/install-command.astro';
import dungeonAdventureArchitecturePng from '@assets/dungeon-game-architecture.png'
import dungeonAdventureErPng from '@assets/dungeon-adventure-er.png'
import baselineWebsitePng from '@assets/baseline-website.png'
import baselineGamePng from '@assets/baseline-game.png'
import nxGraphPng from '@assets/nx-graph.png'
import gameSelectPng from '@assets/game-select.png'
import gameConversationPng from '@assets/game-conversation.png'

## ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«4: UIã®å®Ÿè£…

UIã®æ§‹ç¯‰ã‚’é–‹å§‹ã™ã‚‹ã«ã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã«å‘ã‘ã‚‹ã‚ˆã†ã«è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã®ãŸã‚ã«ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š

<NxCommands commands={["run @dungeon-adventure/game-ui:load:runtime-config"]} />

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸ`runtime-config.json`ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã€`packages/game-ui/public`ãƒ•ã‚©ãƒ«ãƒ€å†…ã«ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã—ã¾ã™ã€‚

æ¬¡ã«ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã§ãã¾ã™ï¼š

<NxCommands commands={["run @dungeon-adventure/game-ui:serve"]} />

ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ­ãƒ¼ã‚«ãƒ«ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã‚’é–‹ãã¨ã€ãƒ­ã‚°ã‚¤ãƒ³ã‚’æ±‚ã‚ã‚‰ã‚Œã€æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã™ã‚‹ãŸã‚ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚å®Œäº†ã™ã‚‹ã¨ã€åŸºæœ¬çš„ãªã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

<Image src={baselineWebsitePng} alt="baseline-website.png" width="800" height="600" />

<Aside type="caution">
_ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®æ®‹ã‚Šã®éƒ¨åˆ†ã§ã¯ã€å¤‰æ›´ã‚’åŠ ãˆã‚‹ã¨è‡ªå‹•çš„ã«ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ãŸã‚ã€é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’å®Ÿè¡Œã—ç¶šã‘ã¾ã™ã€‚_
</Aside>

### æ–°ã—ã„ '/game' ãƒ«ãƒ¼ãƒˆã®ä½œæˆ

`@tanstack/react-router`ã®æ©Ÿèƒ½ã‚’ç´¹ä»‹ã™ã‚‹ãŸã‚ã«ã€æ–°ã—ã„å‹å®‰å…¨ãªãƒ«ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚ã“ã‚Œã‚’è¡Œã†ã«ã¯ã€æ¬¡ã®å ´æ‰€ã«ç©ºã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã ã‘ã§ã™ï¼š`packages/game-ui/src/routes/game/index.tsx`ã€‚é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®ãƒ­ã‚°ã«æ³¨ç›®ã—ã¦ãã ã•ã„ï¼š

```bash
â™»ï¸  ãƒ«ãƒ¼ãƒˆã‚’å†ç”Ÿæˆä¸­...
ğŸŸ¡ /Users/dimecha/dungeon-adventure/packages/game-ui/src/routes/game/index.tsx ã‚’æ›´æ–°ä¸­
ğŸŸ¡ /Users/dimecha/dungeon-adventure/packages/game-ui/src/routeTree.gen.ts ã‚’æ›´æ–°ä¸­
âœ… 27msã§ãƒ«ãƒ¼ãƒˆã‚’å‡¦ç†ã—ã¾ã—ãŸ
```

`@tanstack/react-router`ã¯è‡ªå‹•çš„ã«æ–°ã—ã„ãƒ«ãƒ¼ãƒˆã‚’è¨­å®šã—ã€ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã™ã§ã«ãƒ«ãƒ¼ãƒˆãƒ‘ã‚¹ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ï¼š

```tsx
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/game/')({
  component: RouteComponent,
})

function RouteComponent() {
  return <div>Hello "/game/"!</div>
}
```

`http://localhost:4200/game`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€æ–°ã—ã„ãƒšãƒ¼ã‚¸ãŒãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹ã®ãŒç¢ºèªã§ãã¾ã™ï¼

<Image src={baselineGamePng} alt="baseline-game.png" width="800" height="600" />

ã¾ãŸã€`index.tsx`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ã—ã¦ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æ–°ã—ã„`/game`ãƒ«ãƒ¼ãƒˆã‚’èª­ã¿è¾¼ã‚€ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚`to`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ›´æ–°ã™ã‚‹ã¨ã€å‹å®‰å…¨ãªãƒ«ãƒ¼ãƒˆã®ãƒªã‚¹ãƒˆã‹ã‚‰é¸æŠã§ãã‚‹ã“ã¨ã«æ³¨ç›®ã—ã¦ãã ã•ã„ã€‚

```diff lang="tsx"
// packages/game-ui/src/routes/index.tsx
import { createFileRoute, Navigate } from '@tanstack/react-router';

export const Route = createFileRoute('/')({
+  component: () => <Navigate to="/game" />,
});

```

æœ€å¾Œã«ã€`packages/game-ui/src/routes/welcome/`ãƒ•ã‚©ãƒ«ãƒ€ã¯ä¸è¦ã«ãªã£ãŸã®ã§å‰Šé™¤ã§ãã¾ã™ã€‚

### ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®æ›´æ–°

è¨­å®šã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¯ã€ã‚²ãƒ¼ãƒ ã¨ã„ã†ã‚ˆã‚Šã‚‚SaaSå½¢å¼ã®ãƒ“ã‚¸ãƒã‚¹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«è¿‘ã„ã‚‚ã®ã§ã™ã€‚ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å†è¨­å®šã—ã€ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã®ã‚²ãƒ¼ãƒ ã«è¿‘ã„ãƒ†ãƒ¼ãƒã«å¤‰æ›´ã—ã¦ã„ãã¾ã™ã€‚

`packages/game-ui/src`ã«ä»¥ä¸‹ã®å¤‰æ›´ã‚’åŠ ãˆã¾ã—ã‚‡ã†ï¼š

<Tabs>
<TabItem label="config.ts">
```diff lang="typescript"
// packages/game-ui/src/config.ts
export default {
+  applicationName: 'Dungeon Adventure',
-  logo: 'data:image/svg+xml;base64,PCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KDTwhLS0gVXBsb2FkZWQgdG86IFNWRyBSZXBvLCB3d3cuc3ZncmVwby5jb20sIFRyYW5zZm9ybWVkIGJ5OiBTVkcgUmVwbyBNaXhlciBUb29scyAtLT4KPHN2ZyBmaWxsPSIjMjQ4YmFlIiB3aWR0aD0iODAwcHgiIGhlaWdodD0iODAwcHgiIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHN0cm9rZT0iIzI0OGJhZSI+Cg08ZyBpZD0iU1ZHUmVwb19iZ0NhcnJpZXIiIHN0cm9rZS13aWR0aD0iMCIvPgoNPGcgaWQ9IlNWR1JlcG9fdHJhY2VyQ2FycmllciIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+Cg08ZyBpZD0iU1ZHUmVwb19pY29uQ2FycmllciI+Cg08dGl0bGU+aW9uaWNvbnMtdjVfbG9nb3M8L3RpdGxlPgoNPHBhdGggZD0iTTQxMC42NiwxODAuNzJoMHEtNy42Ny0yLjYyLTE1LjQ1LTQuODgsMS4yOS01LjI1LDIuMzgtMTAuNTZjMTEuNy01Ni45LDQuMDUtMTAyLjc0LTIyLjA2LTExNy44My0yNS0xNC40OC02NiwuNjEtMTA3LjM2LDM2LjY5cS02LjEsNS4zNC0xMS45NSwxMS0zLjktMy43Ni04LTcuMzZjLTQzLjM1LTM4LjU4LTg2LjgtNTQuODMtMTEyLjg4LTM5LjY5LTI1LDE0LjUxLTMyLjQzLDU3LjYtMjEuOSwxMTEuNTNxMS41OCw4LDMuNTUsMTUuOTNjLTYuMTUsMS43NS0xMi4wOSwzLjYyLTE3Ljc3LDUuNkM0OC40NiwxOTguOSwxNiwyMjYuNzMsMTYsMjU1LjU5YzAsMjkuODIsMzQuODQsNTkuNzIsODcuNzcsNzcuODVxNi40NCwyLjE5LDEzLDQuMDdRMTE0LjY0LDM0NiwxMTMsMzU0LjY4Yy0xMCw1My0yLjIsOTUuMDcsMjIuNzUsMTA5LjQ5LDI1Ljc3LDE0Ljg5LDY5LS40MSwxMTEuMTQtMzcuMzFxNS00LjM4LDEwLTkuMjUsNi4zMiw2LjExLDEzLDExLjg2YzQwLjgsMzUuMTgsODEuMDksNDkuMzksMTA2LDM0LjkzLDI1Ljc1LTE0Ljk0LDM0LjEyLTYwLjE0LDIzLjI1LTExNS4xM3EtMS4yNS02LjMtMi44OC0xMi44Niw0LjU2LTEuMzUsOC45My0yLjc5YzU1LTE4LjI3LDkwLjgzLTQ3LjgxLDkwLjgzLTc4QzQ5NiwyMjYuNjIsNDYyLjUsMTk4LjYxLDQxMC42NiwxODAuNzJabS0xMjktODEuMDhjMzUuNDMtMzAuOTEsNjguNTUtNDMuMTEsODMuNjUtMzQuMzloMGMxNi4wNyw5LjI5LDIyLjMyLDQ2Ljc1LDEyLjIyLDk1Ljg4cS0xLDQuOC0yLjE2LDkuNTdhNDg3LjgzLDQ4Ny44MywwLDAsMC02NC4xOC0xMC4xNiw0ODEuMjcsNDgxLjI3LDAsMCwwLTQwLjU3LTUwLjc1UTI3NiwxMDQuNTcsMjgxLjY0LDk5LjY0Wk0xNTcuNzMsMjgwLjI1cTYuNTEsMTIuNiwxMy42MSwyNC44OSw3LjIzLDEyLjU0LDE1LjA3LDI0LjcxYTQzNS4yOCw0MzUuMjgsMCwwLDEtNDQuMjQtNy4xM0MxNDYuNDEsMzA5LDE1MS42MywyOTQuNzUsMTU3LjczLDI4MC4yNVptMC00OC4zM2MtNi0xNC4xOS0xMS4wOC0yOC4xNS0xNS4yNS00MS42MywxMy43LTMuMDcsMjguMy01LjU4LDQzLjUyLTcuNDhxLTcuNjUsMTEuOTQtMTQuNzIsMjQuMjNUMTU3LjcsMjMxLjkyWm0xMC45LDI0LjE3cTkuNDgtMTkuNzcsMjAuNDItMzguNzhoMHExMC45My0xOSwyMy4yNy0zNy4xM2MxNC4yOC0xLjA4LDI4LjkyLTEuNjUsNDMuNzEtMS42NXMyOS41Mi41Nyw0My43OSwxLjY2cTEyLjIxLDE4LjA5LDIzLjEzLDM3dDIwLjY5LDM4LjZRMzM0LDI3NS42MywzMjMsMjk0LjczaDBxLTEwLjkxLDE5LTIzLDM3LjI0Yy0xNC4yNSwxLTI5LDEuNTUtNDQsMS41NXMtMjkuNDctLjQ3LTQzLjQ2LTEuMzhxLTEyLjQzLTE4LjE5LTIzLjQ2LTM3LjI5VDE2OC42LDI1Ni4wOVpNMzQwLjc1LDMwNXE3LjI1LTEyLjU4LDEzLjkyLTI1LjQ5aDBhNDQwLjQxLDQ0MC40MSwwLDAsMSwxNi4xMiw0Mi4zMkE0MzQuNDQsNDM0LjQ0LDAsMCwxLDMyNiwzMjkuNDhRMzMzLjYyLDMxNy4zOSwzNDAuNzUsMzA1Wm0xMy43Mi03My4wN3EtNi42NC0xMi42NS0xMy44MS0yNWgwcS03LTEyLjE4LTE0LjU5LTI0LjA2YzE1LjMxLDEuOTQsMzAsNC41Miw0My43Nyw3LjY3QTQzOS44OSw0MzkuODksMCwwLDEsMzU0LjQ3LDIzMS45M1pNMjU2LjIzLDEyNC40OGgwYTQzOS43NSw0MzkuNzUsMCwwLDEsMjguMjUsMzQuMThxLTI4LjM1LTEuMzUtNTYuNzQsMEMyMzcuMDcsMTQ2LjMyLDI0Ni42MiwxMzQuODcsMjU2LjIzLDEyNC40OFpNMTQ1LjY2LDY1Ljg2YzE2LjA2LTkuMzIsNTEuNTcsNCw4OSwzNy4yNywyLjM5LDIuMTMsNC44LDQuMzYsNy4yLDYuNjdBNDkxLjM3LDQ5MS4zNywwLDAsMCwyMDEsMTYwLjUxYTQ5OS4xMiw0OTkuMTIsMCwwLDAtNjQuMDYsMTBxLTEuODMtNy4zNi0zLjMtMTQuODJoMEMxMjQuNTksMTA5LjQ2LDEzMC41OCw3NC42MSwxNDUuNjYsNjUuODZaTTEyMi4yNSwzMTcuNzFxLTYtMS43MS0xMS44NS0zLjcxYy0yMy40LTgtNDIuNzMtMTguNDQtNTYtMjkuODFDNDIuNTIsMjc0LDM2LjUsMjYzLjgzLDM2LjUsMjU1LjU5YzAtMTcuNTEsMjYuMDYtMzkuODUsNjkuNTItNTVxOC4xOS0yLjg1LDE2LjUyLTUuMjFhNDkzLjU0LDQ5My41NCwwLDAsMCwyMy40LDYwLjc1QTUwMi40Niw1MDIuNDYsMCwwLDAsMTIyLjI1LDMxNy43MVptMTExLjEzLDkzLjY3Yy0xOC42MywxNi4zMi0zNy4yOSwyNy44OS01My43NCwzMy43MmgwYy0xNC43OCw1LjIzLTI2LjU1LDUuMzgtMzMuNjYsMS4yNy0xNS4xNC04Ljc1LTIxLjQ0LTQyLjU0LTEyLjg1LTg3Ljg2cTEuNTMtOCwzLjUtMTZhNDgwLjg1LDQ4MC44NSwwLDAsMCw2NC42OSw5LjM5LDUwMS4yLDUwMS4yLDAsMCwwLDQxLjIsNTFDMjM5LjU0LDQwNS44MywyMzYuNDksNDA4LjY1LDIzMy4zOCw0MTEuMzhabTIzLjQyLTIzLjIyYy05LjcyLTEwLjUxLTE5LjQyLTIyLjE0LTI4Ljg4LTM0LjY0cTEzLjc5LjU0LDI4LjA4LjU0YzkuNzgsMCwxOS40Ni0uMjEsMjktLjY0QTQzOS4zMyw0MzkuMzMsMCwwLDEsMjU2LjgsMzg4LjE2Wm0xMjQuNTIsMjguNTljLTIuODYsMTUuNDQtOC42MSwyNS43NC0xNS43MiwyOS44Ni0xNS4xMyw4Ljc4LTQ3LjQ4LTIuNjMtODIuMzYtMzIuNzItNC0zLjQ0LTgtNy4xMy0xMi4wNy0xMWE0ODQuNTQsNDg0LjU0LDAsMCwwLDQwLjIzLTUxLjIsNDc3Ljg0LDQ3Ny44NCwwLDAsMCw2NS0xMC4wNXExLjQ3LDUuOTQsMi42LDExLjY0aDBDMzgzLjgxLDM3Ny41OCwzODQuNSwzOTkuNTYsMzgxLjMyLDQxNi43NVptMTcuNC0xMDIuNjRoMGMtMi42Mi44Ny01LjMyLDEuNzEtOC4wNiwyLjUzYTQ4My4yNiw0ODMuMjYsMCwwLDAtMjQuMzEtNjAuOTQsNDgxLjUyLDQ4MS41MiwwLDAsMCwyMy4zNi02MC4wNmM0LjkxLDEuNDMsOS42OCwyLjkzLDE0LjI3LDQuNTIsNDQuNDIsMTUuMzIsNzEuNTIsMzgsNzEuNTIsNTUuNDNDNDc1LjUsMjc0LjE5LDQ0Ni4yMywyOTguMzMsMzk4LjcyLDMxNC4xMVoiLz4KDTxwYXRoIGQ9Ik0yNTYsMjk4LjU1YTQzLDQzLDAsMSwwLTQyLjg2LTQzQTQyLjkxLDQyLjkxLDAsMCwwLDI1NiwyOTguNTVaIi8+Cg08L2c+Cg08L3N2Zz4=',
};
```
</TabItem>
<TabItem label="components/AppLayout/index.tsx">
```tsx
// packages/game-ui/src/components/AppLayout/index.tsx
import { useAuth } from 'react-oidc-context';
import * as React from 'react';
import Config from '../../config';
import { TopNavigation } from '@cloudscape-design/components';
import { Outlet } from '@tanstack/react-router';

/**
 * ã‚¢ãƒ—ãƒªã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å®šç¾©ã—ã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’å«ã¿ã¾ã™ã€‚
 */
const AppLayout: React.FC = () => {
  const { user, removeUser, signoutRedirect, clearStaleState } = useAuth();

  return (
    <>
      <TopNavigation
        identity={{
          href: '/',
          title: Config.applicationName,
        }}
        utilities={[
          {
            type: 'menu-dropdown',
            text: `${user?.profile?.['cognito:username']}`,
            iconName: 'user-profile-active',
            onItemClick: (e) => {
              if (e.detail.id === 'signout') {
                removeUser();
                signoutRedirect({
                  post_logout_redirect_uri: window.location.origin,
                  extraQueryParams: {
                    redirect_uri: window.location.origin,
                    response_type: 'code',
                  },
                });
                clearStaleState();
              }
            },
            items: [{ id: 'signout', text: 'ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆ' }],
          },
        ]}
      />
      <Outlet />
    </>
  );
};
export default AppLayout;
```
</TabItem>
<TabItem label="styles.css">
```css
// packages/game-ui/src/styles.css

/* ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ã‚¤ãƒ« */
:root {
  --primary-color: rgba(252, 214, 112, 1);
  --secondary-color: rgba(252, 214, 112, 0.8);
  --background-dark: #161d26;
  --background-light: #2a2c3c;
  --text-light: #e1e1e6;
  --text-dark: #1f2937;
}

div#root {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

html,
body {
  margin: 0;
  padding: 0;
  min-height: 100vh;
  width: 100%;
  font-family:
    -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue',
    Arial, sans-serif;
  background: var(--background-dark);
  color: var(--text-dark);
}

/* ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒŠã¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ */
.game-interface {
  margin: 2rem;
  min-height: 100%;
  flex-grow: 1;
  display: flex;
  flex-direction: column;
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ« */
.game-header {
  text-align: center;
  margin-bottom: 2rem;
  padding: 1rem;
}

.game-header h1 {
  font-size: 2.5rem;
  font-weight: bold;
  background: linear-gradient(45deg, #ffd700, #ff6b6b);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
  margin: 0;
}

/* ä¿å­˜ã•ã‚ŒãŸã‚²ãƒ¼ãƒ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.saved-games {
  margin-bottom: 2rem;
}

.saved-games h2,
.new-game h2 {
  font-size: 1.5rem;
  margin-bottom: 1rem;
  color: var(--text-light);
}

.game-list {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.game-session {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  padding: 1rem;
  cursor: pointer;
  transition: all 0.3s ease;
  width: 100%;
  text-align: left;
}

.game-session:hover {
  transform: translateY(-2px);
  background: rgba(255, 255, 255, 0.15);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.player-name {
  font-weight: 600;
  margin-bottom: 0.25rem;
  color: var(--text-light);
}

.genre-name {
  font-size: 0.875rem;
  color: rgba(255, 255, 255, 0.7);
}

/* æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.new-game {
  margin-top: 2rem;
}

.game-setup {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

span[data-style='generating'] {
  color: rgba(252, 214, 112, 1) !important;
}

.name-input,
.action-input {
  width: 100%;
  padding: 0.75rem;
  /* background: rgba(255, 255, 255, 0.1); */
  border: 2px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  /* color: var(--text-light); */
  font-size: 1rem;
}

.name-input:focus,
.action-input:focus {
  outline: none;
  border-color: var(--primary-color);
  /* background: rgba(255, 255, 255, 0.15); */
}

.genre-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
}

.genre-button {
  background: rgba(255, 255, 255, 0.1);
  border: 2px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  padding: 1rem;
  color: var(--text-light);
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.genre-button:hover {
  background: rgba(252, 214, 112, 1);
  color: var(--text-dark);
  border-color: var(--primary-color);
  transform: translateY(-2px);
}

/* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ */
.messages-area {
  flex: 1;
  overflow-y: auto;
  margin-bottom: 1rem;
  align-content: flex-end;
}

.messages-container {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  padding: 1rem;
}

.message {
  padding: 1rem;
  border-radius: 8px;
  max-width: 80%;
  line-height: 1.5;
}

.message.assistant {
  background: var(--secondary-color);
  border-left: 4px solid var(--primary-color);
  margin-right: auto;
  word-wrap: break-word;
  white-space: pre-wrap;
  margin: 0 !important;
}

.message.user {
  background: rgba(220, 220, 220, 0.7);
  border-right: 4px solid rgba(220, 220, 220, 0.7);
  margin-left: auto;
}

/* å…¥åŠ›ã‚¨ãƒªã‚¢ */
.input-area {
  padding: 1rem;
  position: sticky;
  bottom: 0;
}

/* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° */
.messages-area::-webkit-scrollbar {
  width: 6px;
}

.messages-area::-webkit-scrollbar-track {
  background: transparent;
}

.messages-area::-webkit-scrollbar-thumb {
  background-color: rgba(255, 255, 255, 0.3);
  border-radius: 3px;
}

/* Firefoxã®å ´åˆ */
.messages-area {
  scrollbar-width: thin;
  scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
}
```
</TabItem>
</Tabs>

æ¬¡ã«ã€`packages/game-ui/src/components/AppLayout/navitems.ts`ã¨`packages/game-ui/src/hooks/useAppLayout.tsx`ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„ã®ã§å‰Šé™¤ã—ã¾ã—ã‚‡ã†ã€‚

### ã‚²ãƒ¼ãƒ ãƒšãƒ¼ã‚¸

APIã‚’å‘¼ã³å‡ºã—ã€ã‚²ãƒ¼ãƒ å®Ÿè£…ã‚’å®Œæˆã•ã›ã‚‹ã‚²ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ï¼š

<Tabs>
<TabItem label="index.tsx">
```tsx
// packages/game-ui/src/routes/game/index.tsx
import { FormField, Spinner } from '@cloudscape-design/components';
import { useInfiniteQuery, useMutation } from '@tanstack/react-query';
import { createFileRoute, useNavigate } from '@tanstack/react-router';
import {
  createRef,
  LegacyRef,
  MutableRefObject,
  useEffect,
  useMemo,
  useState,
} from 'react';
import { useGameApi } from '../../hooks/useGameApi';
import { IAction, IGame } from ':dungeon-adventure/game-api-schema';

type IGameState = Omit<IGame, 'lastUpdated'> & { actions: IAction[] };

export const Route = createFileRoute('/game/')({
  component: RouteComponent,
});

// ç”»é¢ä¸Šã§è¦ç´ ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ãƒ•ãƒƒã‚¯
export function useIsVisible(ref: MutableRefObject<any>) {
  const [isIntersecting, setIntersecting] = useState(false);

  useEffect(() => {
    const observer = new IntersectionObserver(([entry]) =>
      setIntersecting(entry.isIntersecting),
    );

    ref.current && observer.observe(ref.current);
    return () => {
      observer.disconnect();
    };
  }, [ref]);

  return isIntersecting;
}

function RouteComponent() {
  const [playerName, setPlayerName] = useState('');
  const navigate = useNavigate();
  const ref = createRef();
  const isLastGameVisible = useIsVisible(ref);

  const gameApi = useGameApi();
  const saveGameMutation = useMutation(gameApi.games.save.mutationOptions());

  const {
    data: gamesPages,
    fetchNextPage,
    hasNextPage,
    isFetchingNextPage,
  } = useInfiniteQuery(
    gameApi.games.query.infiniteQueryOptions(
      { limit: 10 },
      { getNextPageParam: ({ cursor }) => cursor },
    ),
  );
  const games = useMemo(() => {
    return gamesPages?.pages.flatMap((page) => page.items) || [];
  }, [gamesPages]);

  // æœ€å¾Œã®ã‚²ãƒ¼ãƒ ãŒè¡¨ç¤ºã•ã‚Œã€ã•ã‚‰ã«ã‚²ãƒ¼ãƒ ãŒã‚ã‚‹å ´åˆã¯æ¬¡ã®ãƒšãƒ¼ã‚¸ã‚’å–å¾—
  useEffect(() => {
    if (isLastGameVisible && hasNextPage && !isFetchingNextPage) {
      fetchNextPage();
    }
  }, [isFetchingNextPage, hasNextPage, fetchNextPage, isLastGameVisible]);

  const playerAlreadyExists = (playerName?: string) => {
    return !!games?.find((s) => s.playerName === playerName);
  };

  // æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’ä½œæˆ
  const handleStartGame = async (
    playerName: string,
    genre: IGameState['genre'],
  ) => {
    if (playerAlreadyExists(playerName)) {
      return;
    }
    try {
      await saveGameMutation.mutateAsync({
        playerName,
        genre,
      });

      await handleLoadGame(playerName, genre);
    } catch (error) {
      console.error('Failed to start game:', error);
    }
  };

  // æ—¢å­˜ã®ã‚²ãƒ¼ãƒ ã‚’èª­ã¿è¾¼ã‚€
  const handleLoadGame = async (
    playerName: string,
    genre: IGameState['genre'],
  ) => {
    await navigate({
      to: '/game/$playerName',
      params: { playerName },
      search: { genre },
    });
  };

  return (
    <div className="game-interface">
      <header className="game-header">
        <h1>AI ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã‚¢ãƒ‰ãƒ™ãƒ³ãƒãƒ£ãƒ¼</h1>
      </header>

      {/* æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
      <div className="new-game">
        <h2>æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹</h2>
        <div className="game-setup">
          <FormField
            errorText={
              playerAlreadyExists(playerName)
                ? `${playerName} ã¯ã™ã§ã«å­˜åœ¨ã—ã¾ã™`
                : undefined
            }
          >
            <input
              type="text"
              placeholder="åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
              className="name-input"
              onChange={(e) => setPlayerName(e.target.value)}
              onKeyDown={(e) => {
                if (e.key === 'Enter') {
                  const input = e.currentTarget;
                  handleStartGame(input.value, 'medieval');
                }
              }}
            />
          </FormField>
          <div className="genre-grid">
            {(['zombie', 'superhero', 'medieval'] as const).map((genre) => (
              <button
                key={genre}
                className="genre-button"
                onClick={() => {
                  const playerName = document.querySelector('input')?.value;
                  if (playerName) {
                    handleStartGame(playerName, genre);
                  }
                }}
              >
                {genre === 'zombie' ? 'ã‚¾ãƒ³ãƒ“' : 
                 genre === 'superhero' ? 'ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ’ãƒ¼ãƒ­ãƒ¼' : 
                 genre === 'medieval' ? 'ä¸­ä¸–' : 
                 genre.charAt(0).toUpperCase() + genre.slice(1)}
              </button>
            ))}
          </div>
        </div>
      </div>

      {/* ä¿å­˜ã•ã‚ŒãŸã‚²ãƒ¼ãƒ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
      {games && games.length > 0 && (
        <div className="saved-games">
          <h2>ã‚²ãƒ¼ãƒ ã‚’ç¶šã‘ã‚‹</h2>
          <div className="game-list">
            {games.map((game, idx) => (
              <button
                key={game.playerName}
                ref={
                  idx === games.length - 1
                    ? (ref as LegacyRef<HTMLButtonElement>)
                    : undefined
                }
                onClick={() => handleLoadGame(game.playerName, game.genre)}
                className="game-session"
              >
                <div className="player-name">{game.playerName}</div>
                <div className="genre-name">
                  {game.genre === 'zombie' ? 'ã‚¾ãƒ³ãƒ“' : 
                   game.genre === 'superhero' ? 'ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ’ãƒ¼ãƒ­ãƒ¼' : 
                   game.genre === 'medieval' ? 'ä¸­ä¸–' : 
                   game.genre.charAt(0).toUpperCase() + game.genre.slice(1)}
                </div>
              </button>
            ))}
            {isFetchingNextPage && <Spinner data-style="generating" size="big" />}
          </div>
        </div>
      )}
    </div>
  );
}
```
</TabItem>
<TabItem label="$playerName.tsx">

```tsx title="packages/game-ui/src/routes/game/$playerName.tsx"
import { PromptInput, Spinner } from '@cloudscape-design/components';
import { useMutation, useQuery } from '@tanstack/react-query';
import { createFileRoute } from '@tanstack/react-router';
import { useEffect, useRef, useState } from 'react';
import { useGameApi } from '../../hooks/useGameApi';
import { useStoryApiClient } from '../../hooks/useStoryApiClient';
import type { IAction, IGame } from ':dungeon-adventure/game-api-schema';

type IGameState = Omit<IGame, 'lastUpdated'> & { actions: IAction[] };

export const Route = createFileRoute('/game/$playerName')({
  component: RouteComponent,
  validateSearch: (search: Record<string, unknown>) => {
    return {
      genre: search.genre as IGameState['genre'],
    };
  },
});

function RouteComponent() {
  const { playerName } = Route.useParams();
  const { genre } = Route.useSearch();

  const [currentInput, setCurrentInput] = useState('');
  const [streamingContent, setStreamingContent] = useState('');

  const messagesEndRef = useRef<HTMLDivElement>(null);

  const gameApi = useGameApi();
  const storyApi = useStoryApiClient();
  const saveActionMutation = useMutation(
    gameApi.actions.save.mutationOptions(),
  );
  const gameActionsQuery = useQuery(
    gameApi.actions.query.queryOptions({ playerName, limit: 100 }),
  );

  // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒãªã„å ´åˆã¯æ–°ã—ã„ã‚²ãƒ¼ãƒ ãªã®ã§ã€åˆæœŸã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ç”Ÿæˆ
  useEffect(() => {
    if (
      !gameActionsQuery.isLoading &&
      gameActionsQuery.data?.items &&
      gameActionsQuery.data?.items.length === 0
    ) {
      generateStory({
        playerName,
        genre,
        actions: [],
      });
    }
  }, [gameActionsQuery.data?.items, gameActionsQuery.isLoading]);

  const generateStoryMutation = useMutation({
    mutationFn: async ({ playerName, genre, actions }: IGameState) => {
      let content = '';
      for await (const chunk of storyApi.generateStory({
        playerName,
        genre,
        actions,
      })) {
        content += chunk;
        // ãƒãƒ£ãƒ³ã‚¯ã‚’ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å½¢å¼ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
        setStreamingContent(content);
      }

      return content;
    },
  });

  // æœ€å¾Œã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  };

  // gameActionsQueryãŒãƒ•ã‚§ãƒƒãƒã•ã‚Œã‚‹ã‹ã€ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒå¤‰æ›´ã•ã‚Œã‚‹ãŸã³ã«ä¸€ç•ªä¸‹ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
  useEffect(() => {
    scrollToBottom();
  }, [streamingContent, gameActionsQuery]);

  // ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’é€²ã‚ã‚‹
  const generateStory = async ({ playerName, genre, actions }: IGameState) => {
    try {
      const content = await generateStoryMutation.mutateAsync({
        playerName,
        genre,
        actions,
      });

      // ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®å¿œç­”ã‚’ä¿å­˜
      await saveActionMutation.mutateAsync({
        playerName,
        role: 'assistant',
        content,
      });

      await gameActionsQuery.refetch();

      setStreamingContent('');
    } catch (error) {
      console.error('Failed to generate story:', error);
    }
  };

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã‚’é€ä¿¡ã—ãŸã¨ãã«ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’é€²ã‚ã‚‹
  const handleSubmitAction = async () => {
    if (!currentInput.trim()) return;

    const userAction: IAction = {
      playerName,
      role: 'user' as const,
      content: currentInput,
      timestamp: new Date().toISOString(),
    };

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä¿å­˜
    await saveActionMutation.mutateAsync(userAction);
    await gameActionsQuery.refetch();

    setCurrentInput('');

    // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç”Ÿæˆ
    await generateStory({
      genre,
      playerName,
      actions: [...(gameActionsQuery.data?.items ?? []), userAction],
    });
  };

  return (
    <div className="game-interface">
      <div className="messages-area">
        <div className="messages-container">
          {gameActionsQuery.data?.items
            .concat(
              streamingContent.length > 0
                ? [
                    {
                      playerName,
                      role: 'assistant',
                      content: streamingContent,
                      timestamp: new Date().toISOString(),
                    },
                  ]
                : [],
            )
            .map((action, i) => (
              <div
                key={i}
                className={`message ${
                  action.role === 'assistant' ? 'assistant' : 'user'
                }`}
              >
                {action.content}
              </div>
            ))}
          {generateStoryMutation.isPending && streamingContent.length === 0 && (
            <Spinner data-style="generating" size="big" />
          )}
          <div ref={messagesEndRef} />
        </div>
      </div>
      <div className="input-area">
        <PromptInput
          onChange={({ detail }) => setCurrentInput(detail.value)}
          value={currentInput}
          actionButtonAriaLabel="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡"
          actionButtonIconName="send"
          ariaLabel="ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¥åŠ›"
          placeholder="ä½•ã‚’ã—ã¾ã™ã‹ï¼Ÿ"
          onAction={handleSubmitAction}
        />
      </div>
    </div>
  );
}
```

<Aside type="tip">
`$playerName`æ§‹æ–‡ã¯`@tanstack/react-router`ã«`playerName`ã‚’[ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿](https://tanstack.com/router/v1/docs/framework/react/guide/path-params)ã¨ã—ã¦æ‰±ã†ã‚ˆã†æŒ‡ç¤ºã—ã¾ã™ã€‚ã•ã‚‰ã«ã€`validateSearch`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã§ã€`genre`ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒç§ãŸã¡ã®ã‚¸ãƒ£ãƒ³ãƒ«åˆ—æŒ™å‹ã«å¼·ãå‹ä»˜ã‘ã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚
</Aside>
</TabItem>
</Tabs>

ã“ã‚Œã‚‰ã®å¤‰æ›´ã‚’è¡Œã†ã¨ã€ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ï¼ˆ http://localhost:4200/ ï¼‰ã§ã‚²ãƒ¼ãƒ ã‚’ãƒ—ãƒ¬ã‚¤ã™ã‚‹æº–å‚™ãŒæ•´ã„ã¾ã™ï¼

<Drawer title="ãƒ“ãƒ«ãƒ‰ã¨ãƒ‡ãƒ—ãƒ­ã‚¤" trigger="ã‚³ãƒ¼ãƒ‰ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦Cloudfront ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚">

ã‚³ãƒ¼ãƒ‰ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã«ã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š

<NxCommands commands={['run-many --target build --all']} />

æ¬¡ã«ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ï¼š

<NxCommands commands={['run @dungeon-adventure/infra:deploy dungeon-adventure-infra-sandbox']} />

ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Œäº†ã—ãŸã‚‰ã€cdk deployã®å‡ºåŠ›ã‚’ç¢ºèªã—ã¦Cloudfront URLã«ç§»å‹•ã—ã¾ã™ã€‚

</Drawer>

<Image src={gameSelectPng} alt="game-select.png" width="500" height="400" />
<div style="margin-top: -100px; margin-left: 100px;">
<Image src={gameConversationPng} alt="game-conversation.png" width="500" height="400" />
</div>

ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ã€‚ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã‚¢ãƒ‰ãƒ™ãƒ³ãƒãƒ£ãƒ¼ã‚²ãƒ¼ãƒ ã‚’æ§‹ç¯‰ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã—ãŸï¼ ğŸ‰ğŸ‰ğŸ‰
