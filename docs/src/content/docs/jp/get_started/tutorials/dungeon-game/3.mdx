---
title: "ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå‹AIãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã‚²ãƒ¼ãƒ "
description: "@aws/nx-pluginã‚’ä½¿ç”¨ã—ãŸã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå‹AIæ­è¼‰ã®ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³å†’é™ºã‚²ãƒ¼ãƒ ã®ä½œã‚Šæ–¹ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«"
---



import { Aside, Code, FileTree, Steps, Tabs, TabItem } from '@astrojs/starlight/components';
import { Image } from 'astro:assets';
import Drawer from '@components/drawer.astro';
import Link from '@components/link.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import InstallCommand from '@components/install-command.astro';
import E2ECode from '@components/e2e-code.astro';
import E2EDiff from '@components/e2e-diff.astro';

import dungeonAdventureArchitecturePng from '@assets/dungeon-game-architecture.png'
import dungeonAdventureErPng from '@assets/dungeon-adventure-er.png'
import baselineWebsitePng from '@assets/baseline-website.png'
import baselineGamePng from '@assets/baseline-game.png'
import nxGraphPng from '@assets/nx-graph.png'
import gameSelectPng from '@assets/game-select.png'
import gameConversationPng from '@assets/game-conversation.png'

## ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«3: ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å®Ÿè£…

<Aside type="caution">
AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§å¯¾è±¡ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®[Strandsãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¢ãƒ‡ãƒ«](https://strandsagents.com/latest/documentation/docs/user-guide/concepts/model-providers/amazon-bedrock/)ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚æ‰‹é †ã¯[ã“ã¡ã‚‰ã®ã‚¬ã‚¤ãƒ‰](https://docs.aws.amazon.com/bedrock/latest/userguide/model-access-modify.html)ã«å¾“ã£ã¦ãã ã•ã„ã€‚åŸ·ç­†æ™‚ç‚¹ã§ã¯Anthropic Claude Sonnet 4ãŒè©²å½“ã—ã¾ã™ã€‚
</Aside>

ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯[Strands](https://strandsagents.com/)ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã€`Game`ã¨ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç”¨ã®`Action`ãƒªã‚¹ãƒˆã‚’å—ã‘å–ã‚Šã€ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’é€²è¡Œã•ã›ã¾ã™ã€‚ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªMCPã‚µãƒ¼ãƒãƒ¼ã¨é€£æºã—ã¦ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ‰€æŒã‚¢ã‚¤ãƒ†ãƒ ã‚’ç®¡ç†ã™ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚

:::note
æœ¬ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯ç°¡ç•¥åŒ–ã®ãŸã‚ã€å„å‘¼ã³å‡ºã—ãŒå®Œå…¨ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ã‚’å«ã‚€ç‹¬ç«‹ã—ãŸã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨ãªã‚‹ã€Œã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ã€ãªå®Ÿè£…ã¨ã—ã¾ã™ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯[Bedrock AgentCore Memory](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/memory.html)ã¨ã®çµ±åˆã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚Strandsã¨AgentCore Memoryã®é€£æºã«é–¢ã™ã‚‹è©³ç´°ã¯[ã“ã¡ã‚‰](https://github.com/aws/bedrock-agentcore-sdk-python/tree/main/src/bedrock_agentcore/memory/integrations/strands)ã‚’ã”è¦§ãã ã•ã„ã€‚
:::

### ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè£…

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè£…ã—ã¾ã—ã‚‡ã†ã€‚`packages/story/dungeon_adventure_story/agent`å†…ã®ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ã—ã¾ã™ï¼š

<Tabs>
  <TabItem label="main.py">
<E2ECode lang="python" path="dungeon-adventure/3/main.py.template" />
  </TabItem>
  <TabItem label="agent.py">
<E2ECode lang="python" path="dungeon-adventure/3/agent.py.template" />
  </TabItem>
</Tabs>

ã“ã®å®Ÿè£…ã§ã¯ä»¥ä¸‹ã‚’æ§‹æˆã—ã¾ã™ï¼š

- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‹ã‚‰ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã€ã‚¸ãƒ£ãƒ³ãƒ«ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æŠ½å‡º
- SigV4èªè¨¼ã§MCPã‚µãƒ¼ãƒãƒ¼ã‚’å‘¼ã³å‡ºã™ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®æ§‹ç¯‰
- ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¨MCPã‚µãƒ¼ãƒãƒ¼ãƒ„ãƒ¼ãƒ«ã‚’å‚™ãˆãŸã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æ§‹ç¯‰

### ãƒ‡ãƒ—ãƒ­ã‚¤ã¨ãƒ†ã‚¹ãƒˆ

ã¾ãšã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ï¼š

<NxCommands commands={['run-many --target build --all']} />

<Aside type="tip">
ãƒªãƒ³ã‚¿ãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§è‡ªå‹•ä¿®æ­£å¯èƒ½ã§ã™ã€‚

<NxCommands commands={['run-many --target lint --configuration=fix --all']} />
</Aside>

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã™ï¼š

<NxCommands commands={['deploy infra dungeon-adventure-infra-sandbox/*']} />

ãƒ‡ãƒ—ãƒ­ã‚¤ã¯ç´„2åˆ†ã§å®Œäº†ã—ã¾ã™ã€‚

ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Œäº†ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå‡ºåŠ›ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼ˆä¸€éƒ¨ã®å€¤ã¯ç·¨é›†æ¸ˆã¿ï¼‰ï¼š

```bash
dungeon-adventure-infra-sandbox-Application
dungeon-adventure-infra-sandbox-Application: deploying... [2/2]

 âœ…  dungeon-adventure-infra-sandbox-Application

âœ¨  Deployment time: 354s

Outputs:
dungeon-adventure-infra-sandbox-Application.ElectroDbTableTableNameXXX = dungeon-adventure-infra-sandbox-Application-ElectroDbTableXXX-YYY
dungeon-adventure-infra-sandbox-Application.GameApiEndpointXXX = https://xxx.execute-api.region.amazonaws.com/prod/
dungeon-adventure-infra-sandbox-Application.GameUIDistributionDomainNameXXX = xxx.cloudfront.net
dungeon-adventure-infra-sandbox-Application.InventoryMcpArn = arn:aws:bedrock-agentcore:region:xxxxxxx:runtime/dungeonadventureventoryMcpServerXXXX-YYYY
dungeon-adventure-infra-sandbox-Application.StoryAgentArn = arn:aws:bedrock-agentcore:region:xxxxxxx:runtime/dungeonadventurecationStoryAgentXXXX-YYYY
dungeon-adventure-infra-sandbox-Application.UserIdentityUserIdentityIdentityPoolIdXXX = region:xxx
dungeon-adventure-infra-sandbox-Application.UserIdentityUserIdentityUserPoolIdXXX = region_xxx
```

ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã®æ–¹æ³•ã§APIã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™ï¼š
<ul>
<li>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚µãƒ¼ãƒãƒ¼ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§èµ·å‹•ã—`curl`ã§å‘¼ã³å‡ºã™</li>
<li>JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã¿APIã‚’curlã§å‘¼ã³å‡ºã™</li>
</ul>

<Tabs>
  <TabItem label="Local">
  ãƒ­ãƒ¼ã‚«ãƒ«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ï¼š
    <NxCommands highlights={['arn:aws:bedrock-agentcore:region:xxxxxxx:runtime/dungeonadventureventoryMcpServerXXXX-YYYY', 'region']} env={{PORT: '9999', INVENTORY_MCP_ARN:"arn:aws:bedrock-agentcore:region:xxxxxxx:runtime/dungeonadventureventoryMcpServerXXXX-YYYY", AWS_REGION: '<region>'}} commands={["run dungeon_adventure.story:agent-serve"]} />

    :::caution
    ä¸Šè¨˜ã®`InventoryMcpArn`ã«ã¯CDKãƒ‡ãƒ—ãƒ­ã‚¤å‡ºåŠ›å€¤ã‚’ä½¿ç”¨ã—ã€`AWS_REGION`ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚
    :::

    ã‚µãƒ¼ãƒãƒ¼èµ·å‹•å¾Œï¼ˆå‡ºåŠ›ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ï¼‰ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å‘¼ã³å‡ºã—ã¾ã™ï¼š

    ```bash
    curl -N -X POST http://127.0.0.1:9999/invocations \
      -d '{"genre":"superhero", "actions":[], "playerName":"UnnamedHero"}' \
      -H "Content-Type: application/json" \
      -H "X-Amzn-Bedrock-AgentCore-Runtime-Session-Id: abcdefghijklmnopqrstuvwxyz-123456789"
    ```
  </TabItem>
  <TabItem label="Deployed">
    ãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã¿ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã«ã¯ã€Cognitoèªè¨¼ã§JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãšç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¾ã™ï¼š

    ```bash
    # CDKå‡ºåŠ›ã‹ã‚‰Cognito User Pool IDã¨Client IDã‚’è¨­å®š
    export POOL_ID="<UserPoolId from CDK outputs>"
    export CLIENT_ID="<UserPoolClientId from CDK outputs>"
    export REGION="<your-region>"
    ```

    ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ï¼š

    ```bash
    # ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
    aws cognito-idp admin-create-user \
      --user-pool-id $POOL_ID \
      --username "testuser" \
      --temporary-password "TempPass123!" \
      --region $REGION \
      --message-action SUPPRESS > /dev/null

    # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šï¼ˆã‚ˆã‚Šå®‰å…¨ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ç½®ãæ›ãˆã¦ãã ã•ã„ï¼‰
    aws cognito-idp admin-set-user-password \
      --user-pool-id $POOL_ID \
      --username "testuser" \
      --password "PermanentPass123!" \
      --region $REGION \
      --permanent > /dev/null

    # èªè¨¼å‡¦ç†ï¼ˆIDãƒˆãƒ¼ã‚¯ãƒ³å–å¾—ï¼‰
    export BEARER_TOKEN=$(aws cognito-idp initiate-auth \
      --client-id "$CLIENT_ID" \
      --auth-flow USER_PASSWORD_AUTH \
      --auth-parameters USERNAME='testuser',PASSWORD='PermanentPass123!' \
      --region $REGION | jq -r '.AuthenticationResult.IdToken')
    ```

    :::caution
    `POOL_ID`ã«ã¯CDKå‡ºåŠ›ã®`UserIdentityUserIdentityUserPoolIdXXX`ã‚’ä½¿ç”¨ã—ã€å¯¾å¿œã™ã‚‹Client IDã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚
    :::

    Bedrock AgentCoreãƒ©ãƒ³ã‚¿ã‚¤ãƒ URLã‚’ä½¿ç”¨ã—ã¦ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å‘¼ã³å‡ºã—ã¾ã™ï¼š

    ```bash
    # CDKå‡ºåŠ›ã‹ã‚‰Story Agent ARNã‚’è¨­å®š
    export AGENT_ARN="<StoryAgentArn from CDK outputs>"

    # ARNã‚’URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
    export ENCODED_ARN=$(echo $AGENT_ARN | sed 's/:/%3A/g' | sed 's/\//%2F/g')

    # å‘¼ã³å‡ºã—URLã‚’æ§‹ç¯‰
    export MCP_URL="https://bedrock-agentcore.$REGION.amazonaws.com/runtimes/$ENCODED_ARN/invocations?qualifier=DEFAULT"

    # ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå‘¼ã³å‡ºã—
    curl -N -X POST "$MCP_URL" \
      -H "authorization: Bearer $BEARER_TOKEN" \
      -H "Content-Type: application/json" \
      -H "X-Amzn-Bedrock-AgentCore-Runtime-Session-Id: abcdefghijklmnopqrstuvwxyz-123456789" \
      -d '{"genre":"superhero", "actions":[], "playerName":"UnnamedHero"}'
    ```

    :::note
    ARNã®URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã¯Bedrock AgentCore APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®æ­£ã—ã„ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¿…è¦ã§ã™ã€‚
    :::
  </TabItem>
</Tabs>

ã‚³ãƒãƒ³ãƒ‰ãŒæˆåŠŸã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚¤ãƒ™ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

```
data: {"init_event_loop": true}

data: {"start": true}

data: {"start_event_loop": true}

data: {"event": {"messageStart": {"role": "assistant"}}}

data: {"event": {"contentBlockDelta": {"delta": {"text": "Welcome"}, "contentBlockIndex": 0}}}

...
```

ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ã€‚Bedrock AgentCore Runtimeä¸Šã«åˆã‚ã¦ã®Strandsã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æ§‹ç¯‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã—ãŸï¼ ğŸ‰ğŸ‰ğŸ‰