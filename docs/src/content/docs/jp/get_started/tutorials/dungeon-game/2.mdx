---
title: "AIダンジョンゲーム"
description: "@aws/nx-pluginを使用してAIパワードのダンジョン冒険ゲームを構築する方法のチュートリアル。"
---

import { Aside, Code, FileTree, Steps, Tabs, TabItem } from '@astrojs/starlight/components';
import { Image } from 'astro:assets';
import Link from '@components/link.astro';
import Drawer from '@components/drawer.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import InstallCommand from '@components/install-command.astro';
import dungeonAdventureArchitecturePng from '@assets/dungeon-game-architecture.png'
import dungeonAdventureErPng from '@assets/dungeon-adventure-er.png'
import baselineWebsitePng from '@assets/baseline-website.png'
import baselineGamePng from '@assets/baseline-game.png'
import nxGraphPng from '@assets/nx-graph.png'
import gameSelectPng from '@assets/game-select.png'
import gameConversationPng from '@assets/game-conversation.png'

## モジュール2: ゲームAPIの実装

ゲームAPIを実装していきます。合計4つのAPIを作成する必要があります：

1. `createGame` - 新しいゲームインスタンスを作成します。
2. `queryGames` - 以前に保存されたゲームのページネーションされたリストを返します。
3. `saveAction` - 特定のゲームのアクションを保存します。
4. `queryActions` - ゲームに関連するすべてのアクションのページネーションされたリストを返します。

### APIスキーマ

[Zod](https://zod.dev/)を使用して、`packages/game-api/schema/src`プロジェクト内にAPIの入力と出力のスキーマを定義します：

<Tabs>
  <TabItem label="types/action.ts">
```typescript
import { z } from 'zod';

export const ActionSchema = z.object({
  playerName: z.string(),
  timestamp: z.string().datetime(),
  role: z.enum(['assistant', 'user']),
  content: z.string(),
});

export type IAction = z.TypeOf<typeof ActionSchema>;
```
  </TabItem>
  <TabItem label="types/common.ts">
```typescript
import { z } from 'zod';

export const QueryInputSchema = z.object({
  cursor: z.string().optional(),
  limit: z.number().optional().default(100),
});

export const createPaginatedQueryOutput = <ItemType extends z.ZodTypeAny>(
  itemSchema: ItemType,
) => {
  return z.object({
    items: z.array(itemSchema),
    cursor: z.string().nullable(),
  });
};

export type IQueryInput = z.TypeOf<typeof QueryInputSchema>;
```
  </TabItem>
  <TabItem label="types/game.ts">
```typescript
import { z } from 'zod';

export const GameSchema = z.object({
  playerName: z.string(),
  genre: z.enum(['zombie', 'superhero', 'medieval']),
  lastUpdated: z.string().datetime(),
});

export type IGame = z.TypeOf<typeof GameSchema>;
```
  </TabItem>
  <TabItem label="index.ts">
```diff lang="typescript"
-export * from './procedures/echo.js';
+export * from './types/action.js';
+export * from './types/common.js';
+export * from './types/game.js';
```
  </TabItem>
</Tabs>

`./procedures/echo.ts`ファイルは削除できます。このプロジェクトでは使用しません。

<Aside type="tip">
上記のように、Zodで定義した各スキーマに対して、`z.TypeOf`構文を使用してインターフェースもエクスポートしています。これにより、重複作業なくZodの定義をTypeScriptインターフェースに変換できます！
</Aside>

（以下、同様に翻訳を続けます。全文を翻訳するには文字数制限のため複数回に分けて翻訳する必要があります。）