---
title: "ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå‹AIãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã‚²ãƒ¼ãƒ "
description: "@aws/nx-pluginã‚’ä½¿ç”¨ã—ãŸã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå‹AIæ­è¼‰ã®ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³å†’é™ºã‚²ãƒ¼ãƒ ã®ä½œã‚Šæ–¹ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«"
---



import { Aside, Code, FileTree, Steps, Tabs, TabItem } from '@astrojs/starlight/components';
import { Image } from 'astro:assets';
import Link from '@components/link.astro';
import Drawer from '@components/drawer.astro';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import InstallCommand from '@components/install-command.astro';
import E2EDiff from '@components/e2e-diff.astro';
import E2ECode from '@components/e2e-code.astro';

import dungeonAdventureArchitecturePng from '@assets/dungeon-game-architecture.png'
import dungeonAdventureErPng from '@assets/dungeon-adventure-er.png'
import baselineWebsitePng from '@assets/baseline-website.png'
import baselineGamePng from '@assets/baseline-game.png'
import nxGraphPng from '@assets/nx-graph.png'
import gameSelectPng from '@assets/game-select.png'
import gameConversationPng from '@assets/game-conversation.png'

## ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«2: Game APIã¨Inventory MCPã‚µãƒ¼ãƒãƒ¼ã®å®Ÿè£…

ã¾ãšGame APIã®å®Ÿè£…ã‹ã‚‰å§‹ã‚ã¾ã™ã€‚ã“ã‚Œã«ã¯åˆè¨ˆ5ã¤ã®APIã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

1. `createGame` - æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
2. `queryGames` - ä¿å­˜æ¸ˆã¿ã‚²ãƒ¼ãƒ ã®ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ä»˜ããƒªã‚¹ãƒˆã‚’è¿”ã™
3. `saveAction` - æŒ‡å®šã—ãŸã‚²ãƒ¼ãƒ ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä¿å­˜
4. `queryActions` - ã‚²ãƒ¼ãƒ ã«é–¢é€£ã™ã‚‹å…¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ä»˜ããƒªã‚¹ãƒˆã‚’è¿”ã™
5. `queryInventory` - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªå†…ã‚¢ã‚¤ãƒ†ãƒ ã®ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ä»˜ããƒªã‚¹ãƒˆã‚’è¿”ã™

### APIã‚¹ã‚­ãƒ¼ãƒ

APIã®å…¥åŠ›ã¨å‡ºåŠ›ã‚’å®šç¾©ã™ã‚‹ãŸã‚ã€Zodã‚’ä½¿ç”¨ã—ã¦`packages/game-api/src/schema`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«ã‚¹ã‚­ãƒ¼ãƒã‚’ä½œæˆã—ã¾ã™ï¼š

<Tabs>
  <TabItem label="action.ts">
<E2ECode lang="typescript" path="dungeon-adventure/2/schema/action.ts.template" />
  </TabItem>
  <TabItem label="common.ts">
<E2ECode lang="typescript" path="dungeon-adventure/2/schema/common.ts.template" />
  </TabItem>
  <TabItem label="game.ts">
<E2ECode lang="typescript" path="dungeon-adventure/2/schema/game.ts.template" />
  </TabItem>
  <TabItem label="inventory.ts">
<E2ECode lang="typescript" path="dungeon-adventure/2/schema/inventory.ts.template" />
  </TabItem>
  <TabItem label="index.ts">
<E2EDiff lang="typescript" before="dungeon-adventure/2/schema/index.ts.old.template" after="dungeon-adventure/2/schema/index.ts.template" />
  </TabItem>
</Tabs>

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½¿ç”¨ã—ãªã„`packages/game-api/src/schema/echo.ts`ãƒ•ã‚¡ã‚¤ãƒ«ã¯å‰Šé™¤ã§ãã¾ã™ã€‚

<Aside type="tip">
ä¸Šè¨˜ã®ã‚ˆã†ã«ã€Zodã§å®šç¾©ã™ã‚‹å„ã‚¹ã‚­ãƒ¼ãƒã«å¯¾ã—ã¦`z.TypeOf`æ§‹æ–‡ã‚’ä½¿ç”¨ã—ã¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€Typescriptã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’é‡è¤‡ãªãç”Ÿæˆã§ãã¾ã™ï¼
</Aside>

### ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ¢ãƒ‡ãƒªãƒ³ã‚°

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ERå›³ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š

<Image class="centered-image white-bg" src={dungeonAdventureErPng} alt="dungeon-adventure-er.png" width="400" height="300" />

{/* Generated from the following PlantUML: */}
{/*
@startuml Game API Entity Relationship Diagram

!theme plain

skinparam linetype ortho
skinparam roundcorner 10

entity "Game" as game {
  + playerName : string <<PK>>
  --
  genre : string
  lastUpdated : string
}

entity "Action" as action {
  + playerName : string <<PK>>
  + timestamp : string <<SK>>
  --
  role : string
  content : string
}

entity "Item" as item {
  + playerName : string <<PK>>
  + itemName : string
  --
  emoji : string (optional)
  lastUpdated : string
  quantity : number
}

game ||--o{ action
game ||--o{ item

@enduml
*/}

DynamoDBãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã€[ElectroDB](https://electrodb.dev/en/core-concepts/introduction/)ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã¾ãšæ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§`electrodb`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼š

<InstallCommand pkg="electrodb @aws-sdk/client-dynamodb" />

<Aside>
ã™ã¹ã¦ã®ä¾å­˜é–¢ä¿‚ã¯ãƒ«ãƒ¼ãƒˆ`package.json`ã«è¿½åŠ ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯`@aws/nx-plugin`ãŒ[å˜ä¸€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒãƒªã‚·ãƒ¼](https://nx.dev/concepts/decisions/dependency-management#single-version-policy)ã«å¾“ã£ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚è©³ç´°ã¯<Link path="guides/typescript-project#dependencies">tsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¬ã‚¤ãƒ‰</Link>ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
</Aside>

æ¬¡ã«ã€`packages/game-api/src/entities`ãƒ•ã‚©ãƒ«ãƒ€å†…ã«ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ElectroDBã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’å®šç¾©ã—ã¾ã™ï¼š

<Tabs>
  <TabItem label="action.ts">
<E2ECode lang="typescript" path="dungeon-adventure/2/entities/action.ts.template" />
  </TabItem>
  <TabItem label="game.ts">
<E2ECode lang="typescript" path="dungeon-adventure/2/entities/game.ts.template" />
  </TabItem>
  <TabItem label="inventory.ts">
<E2ECode lang="typescript" path="dungeon-adventure/2/entities/inventory.ts.template" />
  </TabItem>
</Tabs>

ElectroDBã¯ã‚¿ã‚¤ãƒ—å®šç¾©ã ã‘ã§ãªãã€ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãªã©ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¨­å®šã‚‚å¯èƒ½ã§ã™ã€‚ã¾ãŸDynamoDBã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã§ã‚ã‚‹[ã‚·ãƒ³ã‚°ãƒ«ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ](https://electrodb.dev/en/core-concepts/single-table-relationships/)ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚

<Aside>
ElectroDBã¯[ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³](https://electrodb.dev/en/modeling/collections/)ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ãŒã€ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯ç°¡ç•¥åŒ–ã®ãŸã‚ä½¿ç”¨ã—ã¾ã›ã‚“ã€‚
</Aside>

MCPã‚µãƒ¼ãƒãƒ¼ãŒã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã¨é€£æºã§ãã‚‹ã‚ˆã†ã€`packages/game-api/src/index.ts`ã§ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼š

<Tabs>
<TabItem label="packages/game-api/src/index.ts">
<E2EDiff lang="typescript" before="dungeon-adventure/2/index.ts.old.template" after="dungeon-adventure/2/index.ts.template" />
</TabItem>
</Tabs>

:::note
ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’å…±æœ‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã™ã‚Œã°ã€MCPã‚µãƒ¼ãƒãƒ¼ãŒAPIã«ä¾å­˜ã›ãšã«æ¸ˆã‚€ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
:::

### tRPCã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¸ã®DynamoDBã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¿½åŠ 

å„ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ã§DynamoDBã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆçµŒç”±ã§å˜ä¸€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ¸¡ã›ã‚‹ã‚ˆã†è¨­å®šã—ã¾ã™ã€‚`packages/game-api/src`å†…ã§ä»¥ä¸‹ã®å¤‰æ›´ã‚’å®Ÿæ–½ï¼š

<Tabs>
  <TabItem label="middleware/dynamodb.ts">
<E2ECode lang="typescript" path="dungeon-adventure/2/middleware/dynamodb.ts.template" />

`DynamoDBClient`ã‚’ä½œæˆã—ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«æ³¨å…¥ã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³
  </TabItem>
  <TabItem label="middleware/index.ts">
<E2EDiff lang="typescript" before="dungeon-adventure/2/middleware/index.ts.old.template" after="dungeon-adventure/2/middleware/index.ts.template" />

`IMiddlewareContext`ã«`IDynamoDBContext`ã‚’è¿½åŠ 
  </TabItem>
  <TabItem label="init.ts">
<E2EDiff lang="typescript" before="dungeon-adventure/2/init.ts.old.template" after="dungeon-adventure/2/init.ts.template" />

DynamoDBãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’åˆæœŸåŒ–

<Aside>
`concat`APIã¯ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ã«ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’ãƒã‚¤ãƒ³ãƒ‰ã—ã¾ã™ã€‚è©³ç´°ã¯[concatã‚¬ã‚¤ãƒ‰](https://trpc.io/docs/server/middlewares#concat)ã‚’å‚ç…§ã€‚
</Aside>
  </TabItem>
</Tabs>

### ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ã®å®šç¾©

APIãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã€`packages/game-api/src/procedures`å†…ã§ä»¥ä¸‹ã®å¤‰æ›´ã‚’å®Ÿæ–½ï¼š

#### ã‚¯ã‚¨ãƒª

<Tabs>
  <TabItem label="query-actions.ts">
<E2ECode lang="typescript" path="dungeon-adventure/2/procedures/query-actions.ts.template" />
  </TabItem>
  <TabItem label="query-games.ts">
<E2ECode lang="typescript" path="dungeon-adventure/2/procedures/query-games.ts.template" />
  </TabItem>
  <TabItem label="query-inventory.ts">
<E2ECode lang="typescript" path="dungeon-adventure/2/procedures/query-inventory.ts.template" />
  </TabItem>
</Tabs>

#### ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

<Tabs>
  <TabItem label="save-action.ts">
<E2ECode lang="typescript" path="dungeon-adventure/2/procedures/save-action.ts.template" />
  </TabItem>
  <TabItem label="save-game.ts">
<E2ECode lang="typescript" path="dungeon-adventure/2/procedures/save-game.ts.template" />
  </TabItem>
</Tabs>

ä½¿ç”¨ã—ãªã„`echo.ts`ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`packages/game-api/src/procedures`å†…ï¼‰ã¯å‰Šé™¤å¯èƒ½ã§ã™ã€‚

### ãƒ«ãƒ¼ã‚¿ãƒ¼è¨­å®š

ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ã‚’APIã«æ¥ç¶šã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ï¼š

<Tabs>
  <TabItem label="packages/game-api/src/router.ts">
<E2EDiff lang="typescript" before="dungeon-adventure/2/router.ts.old.template" after="dungeon-adventure/2/router.ts.template" />
</TabItem>
</Tabs>

### Inventory MCPã‚µãƒ¼ãƒãƒ¼

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®MCPã‚µãƒ¼ãƒãƒ¼ã‚’ä½œæˆï¼š

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç”¨ã«ä»¥ä¸‹ã®ãƒ„ãƒ¼ãƒ«ã‚’å®šç¾©ï¼š
- `list-inventory-items`: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç¾åœ¨ã®ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã‚¢ã‚¤ãƒ†ãƒ ã‚’å–å¾—
- `add-to-inventory`: ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã«ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ 
- `remove-from-inventory`: ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã‹ã‚‰ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰Šé™¤

æ™‚é–“ç¯€ç´„ã®ãŸã‚ã€å…¨ã¦ã®ãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã§å®šç¾©ï¼š

<Tabs>
  <TabItem label="packages/inventory/src/mcp-server/server.ts">
<E2EDiff lang="typescript" before="dungeon-adventure/2/mcp/server.ts.old.template" after="dungeon-adventure/2/mcp/server.ts.template" />
</TabItem>
</Tabs>

ãƒ„ãƒ¼ãƒ«æ•°ãŒå¢—ãˆãŸå ´åˆã¯ã€åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¯èƒ½ã§ã™ã€‚

`packages/inventory/src/mcp-server`å†…ã®æœªä½¿ç”¨`tools`ã¨`resources`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯å‰Šé™¤å¯èƒ½ã€‚

### ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£

æœ€å¾Œã«DynamoDBãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã—ã€Game APIã‹ã‚‰ã®æ“ä½œæ¨©é™ã‚’ä»˜ä¸ã™ã‚‹ãŸã‚ã€`packages/infra/src`ã‚’æ›´æ–°ï¼š

<Tabs>
  <TabItem label="constructs/electrodb-table.ts">
<E2ECode lang="typescript" path="dungeon-adventure/2/constructs/electrodb-table.ts.template" />
  </TabItem>
  <TabItem label="stacks/application-stack.ts">
<E2EDiff lang="typescript" before="dungeon-adventure/1/application-stack.ts.template" after="dungeon-adventure/2/stacks/application-stack.ts.template" />

:::note
å„ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ãŒå€‹åˆ¥ã®Lambdaé–¢æ•°ã§å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€æœ€å°æ¨©é™ã®åŸå‰‡ã«å¾“ã„ã€ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ã®å®Ÿè£…ã«åŸºã¥ã„ã¦å¿…è¦ãªèª­ã¿æ›¸ãæ¨©é™ã®ã¿ã‚’ä»˜ä¸ã§ãã¾ã™ã€‚
:::
  </TabItem>
</Tabs>

### ãƒ‡ãƒ—ãƒ­ã‚¤ã¨ãƒ†ã‚¹ãƒˆ

ã¾ãšã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‚’ãƒ“ãƒ«ãƒ‰ï¼š

<NxCommands commands={['run-many --target build --all']} />

<Aside type="tip">
ãƒªãƒ³ã‚¿ãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§è‡ªå‹•ä¿®æ­£å¯èƒ½ï¼š

<NxCommands commands={['run-many --target lint --configuration=fix --all']} />
</Aside>

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ï¼š

<NxCommands commands={['run @dungeon-adventure/infra:deploy dungeon-adventure-infra-sandbox/*']} />

åˆå›ãƒ‡ãƒ—ãƒ­ã‚¤ã¯ç´„8åˆ†ã‹ã‹ã‚Šã¾ã™ã€‚ä»¥é™ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¯ç´„2åˆ†ã§ã™ã€‚

:::tip
Lambdaé–¢æ•°ã®ã‚³ãƒ¼ãƒ‰å¤‰æ›´ã‚’ç¹°ã‚Šè¿”ã™å ´åˆã€`--hotswap`ãƒ•ãƒ©ã‚°ä»˜ãã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã¨é«˜é€ŸåŒ–ï¼ˆ2-3ç§’ï¼‰å¯èƒ½ï¼š

<NxCommands commands={['run @dungeon-adventure/infra:deploy dungeon-adventure-infra-sandbox/* --hotswap']} />
:::

ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†å¾Œã€ä»¥ä¸‹ã®ã‚ˆã†ãªå‡ºåŠ›ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼ˆä¸€éƒ¨å€¤ã¯ãƒã‚¹ã‚¯æ¸ˆã¿ï¼‰ï¼š

```bash
dungeon-adventure-sandbox-Application
dungeon-adventure-sandbox-Application: deploying... [2/2]

 âœ…  dungeon-adventure-sandbox-Application

âœ¨  Deployment time: 354s

Outputs:
dungeon-adventure-sandbox-Application.ElectroDbTableTableNameXXX = dungeon-adventure-sandbox-Application-ElectroDbTableXXX-YYY
dungeon-adventure-sandbox-Application.GameApiEndpointXXX = https://xxx.execute-api.region.amazonaws.com/prod/
dungeon-adventure-sandbox-Application.GameUIDistributionDomainNameXXX = xxx.cloudfront.net
dungeon-adventure-sandbox-Application.StoryApiEndpointXXX = https://xxx.execute-api.region.amazonaws.com/prod/
dungeon-adventure-sandbox-Application.UserIdentityUserIdentityIdentityPoolIdXXX = region:xxx
dungeon-adventure-sandbox-Application.UserIdentityUserIdentityUserPoolIdXXX = region_xxx
```

APIãƒ†ã‚¹ãƒˆæ–¹æ³•ï¼š
<ul>
<li>tRPCãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’ãƒ­ãƒ¼ã‚«ãƒ«èµ·å‹•ã—`curl`ã§APIå‘¼ã³å‡ºã—</li>
<li>
<Drawer title="Sigv4å¯¾å¿œcurl" trigger="ãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã¿APIã‚’sigv4å¯¾å¿œcurlã§å‘¼ã³å‡ºã™">

<Tabs>
  <TabItem label="Bash/Linux/macOS">
`.bashrc`ã«ä»¥ä¸‹ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¿½åŠ ï¼ˆ`source`ã§åæ˜ ï¼‰ã¾ãŸã¯ç›´æ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«è²¼ã‚Šä»˜ã‘ï¼š
```bash
// ~/.bashrc
acurl () {
    REGION=$1
    SERVICE=$2
    shift; shift;
    curl --aws-sigv4 "aws:amz:$REGION:$SERVICE" --user "$(aws configure get aws_access_key_id):$(aws configure get aws_secret_access_key)" -H "X-Amz-Security-Token: $(aws configure get aws_session_token)" "$@"
}
```

sigv4èªè¨¼curlãƒªã‚¯ã‚¨ã‚¹ãƒˆä¾‹ï¼š

###### API Gateway
```bash
acurl ap-southeast-2 execute-api -X GET https://xxx
```

###### ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°Lambdaé–¢æ•°URL
```bash
acurl ap-southeast-2 lambda -N -X POST https://xxx
```
  </TabItem>
  <TabItem label="Windows PowerShell">
PowerShellãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã¾ãŸã¯ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«é–¢æ•°è¿½åŠ ï¼š
```powershell
function acurl {
    param(
        [Parameter(Mandatory=$true)][string]$Region,
        [Parameter(Mandatory=$true)][string]$Service,
        [Parameter(ValueFromRemainingArguments=$true)][string[]]$CurlArgs
    )

    $AccessKey = aws configure get aws_access_key_id
    $SecretKey = aws configure get aws_secret_access_key
    $SessionToken = aws configure get aws_session_token

    & curl --aws-sigv4 "aws:amz:$Region`:$Service" --user "$AccessKey`:$SecretKey" -H "X-Amz-Security-Token: $SessionToken" @CurlArgs
}
```

sigv4èªè¨¼curlãƒªã‚¯ã‚¨ã‚¹ãƒˆä¾‹ï¼š

###### API Gateway
```powershell
acurl ap-southeast-2 execute-api -X GET https://xxx
```

###### ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°Lambdaé–¢æ•°URL
```powershell
acurl ap-southeast-2 lambda -N -X POST https://xxx
```
  </TabItem>
</Tabs>

</Drawer>
</li>
</ul>


<Tabs>
  <TabItem label="ãƒ­ãƒ¼ã‚«ãƒ«">
    ãƒ­ãƒ¼ã‚«ãƒ«`game-api`ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼š

    <NxCommands highlights={['dungeon-adventure-infra-sandbox-Application-ElectroDbTableXXX-YYY']} env={{TABLE_NAME:"dungeon-adventure-infra-sandbox-Application-ElectroDbTableXXX-YYY"}} commands={["run @dungeon-adventure/game-api:serve"]} />

    <Aside type="caution">
    `dungeon-adventure-infra-sandbox-Application.ElectroDbTableTableNameXXX`ã®CDKãƒ‡ãƒ—ãƒ­ã‚¤å‡ºåŠ›å€¤ã§ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’ç½®æ›
    </Aside>

    ã‚µãƒ¼ãƒãƒ¼èµ·å‹•å¾Œã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å‘¼ã³å‡ºã—ï¼š

    ```bash
    curl -X GET 'http://localhost:2022/games.query?input=%7B%7D'
    ```
  </TabItem>
  <TabItem label="ãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã¿">
```bash "https://xxx.execute-api.ap-southeast-2.amazonaws.com/prod/" "ap-southeast-2"
acurl ap-southeast-2 execute-api -X GET 'https://xxx.execute-api.ap-southeast-2.amazonaws.com/prod/games.query?input=%7B%7D'
```
    <Aside type="caution">
    `dungeon-adventure-infra-sandbox-Application.GameApiGameApiEndpointXXX`ã®CDKãƒ‡ãƒ—ãƒ­ã‚¤å‡ºåŠ›å€¤ã§ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’ç½®æ›ã—ã€ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’é©åˆ‡ã«è¨­å®š
    </Aside>
  </TabItem>
</Tabs>

:::note
ãƒ†ã‚¹ãƒˆç”¨ã«æ¸¡ã™`%7B%7D`ã¯URIã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸç©ºã®JSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ`{}`ï¼‰ã§ã™
:::

ã‚³ãƒãƒ³ãƒ‰ãŒæˆåŠŸã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã‚Šã¾ã™ï¼š

```json
{"result":{"data":{"items":[],"cursor":null}}}
```

ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼tRPCã‚’ä½¿ç”¨ã—ãŸæœ€åˆã®APIã‚’æ§‹ç¯‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã—ãŸï¼ ğŸ‰ğŸ‰ğŸ‰