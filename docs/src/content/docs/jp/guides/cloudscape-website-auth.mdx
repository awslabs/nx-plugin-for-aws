---
title: "CloudScapeウェブサイト認証"
description: "CloudScapeウェブサイト認証のリファレンスドキュメント"
---



import { FileTree } from '@astrojs/starlight/components';
import Link from '@components/link.astro';
import RunGenerator from '@components/run-generator.astro';
import GeneratorParameters from '@components/generator-parameters.astro';
import NxCommands from '@components/nx-commands.astro';
import schema from '../../../../../../packages/nx-plugin/src/cloudscape-website/cognito-auth/schema.json';

CloudScape Website Authenticationジェネレータは、[Amazon Cognito](https://aws.amazon.com/cognito/)を使用してCloudScapeウェブサイトに認証機能を追加します。

このジェネレータは、Cognitoユーザープールと関連するIdentity Pool、ユーザーログインフローを処理するホスト型UI、およびCloudScapeウェブサイトとの統合を設定するCDKインフラストラクチャを構成します。

## 使用方法

### CloudScapeウェブサイトに認証を追加

CloudScapeウェブサイトに認証を追加する方法は2通りです:

<RunGenerator generator="ts#cloudscape-website#auth" />

### オプション

<GeneratorParameters schema={schema} />

## ジェネレータの出力内容

Reactウェブサイトに以下の変更が加えられます:

<FileTree>
  - src
    - components
      - CognitoAuth
        - index.tsx メイン認証コンポーネント
    - main.tsx CognitoAuthコンポーネントを組み込むよう更新
</FileTree>

`packages/common/constructs`に以下のインフラストラクチャコードが生成されます:

<FileTree>
  - src
    - core
      - user-identity.ts ユーザープールとIdentity Poolを定義するコンストラクト
</FileTree>

## インフラストラクチャの使用方法

`UserIdentity`コンストラクトをウェブサイトコンストラクトの**前に**宣言する必要があります:

```ts title="packages/infra/src/stacks/application-stack.ts" {3,9}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite, UserIdentity } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    new UserIdentity(this, 'Identity');

    new MyWebsite(this, 'MyWebsite');
  }
}
```

`UserIdentity`コンストラクトは、ウェブサイトが認証用に正しいCognitoユーザープールを指すことを保証する<Link path="guides/cloudscape-website#runtime-configuration">ランタイム設定</Link>を自動的に追加します。

### 認証ユーザーへのアクセス権付与

API呼び出し権限などの特定のアクションを認証ユーザーに許可するには、Identity Poolの認証済みロールにIAMポリシーステートメントを追加します:

```ts title="packages/infra/src/stacks/application-stack.ts" {12}
import { Stack } from 'aws-cdk-lib';
import { Construct } from 'constructs';
import { MyWebsite, UserIdentity, MyApi } from ':my-scope/common-constructs';

export class ApplicationStack extends Stack {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    const identity = new UserIdentity(this, 'Identity');
    const api = new MyApi(this, 'MyApi');

    api.grantInvokeAccess(identity.identityPool.authenticatedRole);

    new MyWebsite(this, 'MyWebsite');
  }
}
```