---
title: "TypeScriptのMCPサーバー"
description: "大規模言語モデルにコンテキストを提供するためのTypeScript Model Context Protocol (MCP)サーバーを生成"
---



import { FileTree } from '@astrojs/starlight/components';
import RunGenerator from '@components/run-generator.astro';
import NxCommands from '@components/nx-commands.astro';
import Link from '@components/link.astro';
import Snippet from '@components/snippet.astro';
import GeneratorParameters from '@components/generator-parameters.astro';

大規模言語モデル（LLM）にコンテキストを提供するTypeScript [Model Context Protocol（MCP）](https://modelcontextprotocol.io/) サーバーを生成し、オプションで[Amazon Bedrock AgentCore](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/)にデプロイします。

## MCPとは？

[Model Context Protocol（MCP）](https://modelcontextprotocol.io/) は、AIアシスタントが外部ツールやリソースと相互作用するためのオープンスタンダードです。LLMが以下を一貫した方法で行えるようにします：

- アクション実行や情報取得のためのツール（関数）を実行
- コンテキストやデータを提供するリソースにアクセス

## 使用方法

### MCPサーバーの生成

TypeScript MCPサーバーは2つの方法で生成できます：

<RunGenerator generator="ts#mcp-server" />

:::tip
最初に<Link path="/guides/typescript-project">`ts#project`</Link>ジェネレータを使用して、MCPサーバーを追加するプロジェクトを作成してください。
:::

### オプション

<GeneratorParameters generator="ts#mcp-server" />

## ジェネレータの出力

ジェネレータは既存のTypeScriptプロジェクトに以下のファイルを追加します：

<FileTree>
  - your-project/
    - src/
      - mcp-server/ （カスタム名を指定した場合はそれ）
        - index.ts サーバーのエクスポート
        - server.ts メインサーバー定義
        - stdio.ts STDIOトランスポートのエントリポイント（簡易ローカルMCPサーバー用）
        - http.ts ストリーミング可能なHTTPトランスポートのエントリポイント（MCPサーバーホスティング用）
        - tools/
          - add.ts サンプルツール
        - resources/
          - sample-guidance.ts サンプルリソース
        - Dockerfile MCPサーバーホスティング用エントリポイント（`computeType`が`BedrockAgentCoreRuntime`の場合）
    - package.json binエントリとMCP依存関係を更新
    - project.json MCPサーバーserveターゲットを更新
</FileTree>

:::note
`computeType`に`BedrockAgentCoreRuntime`を選択した場合、MCPサーバーをデプロイするCDKコンストラクトも生成されます。
:::

## MCPサーバーの操作

### ツールの追加

ツールはAIアシスタントが呼び出せるアクション実行関数です。`server.ts`ファイルに新しいツールを追加できます：

```typescript
server.tool("toolName", "ツールの説明",
  { param1: z.string(), param2: z.number() }, // Zodを使用した入力スキーマ
  async ({ param1, param2 }) => {
    // ツールの実装
    return {
      content: [{ type: "text", text: "結果" }]
    };
  }
);
```

:::caution
MCP SDKは現在Zod v3のみをサポートしています。他のジェネレータでZod v4を使用できるようにするため、Zod v3の依存関係は`zod-v3`としてインストールされます。MCPツールスキーマでは以下のようにZodをインポートする必要があります：

```ts
import { z } from 'zod-v3';
```

[MCP SDKのこの問題](https://github.com/modelcontextprotocol/typescript-sdk/issues/164)が解決され次第、追加の`zod-v3`依存関係を削除し、`zod`から直接インポートできるようになります。
:::

### リソースの追加

リソースはAIアシスタントにコンテキストを提供します。ファイルからの静的リソースや動的リソースを追加できます：

```typescript
const exampleContext = '返されるコンテキスト';

server.resource('resource-name', 'example://resource', async (uri) => ({
  contents: [{ uri: uri.href, text: exampleContext }],
}));

// 動的リソース
server.resource('dynamic-resource', 'dynamic://resource', async (uri) => {
  const data = await fetchSomeData();
  return {
    contents: [{ uri: uri.href, text: data }],
  };
});
```

## AIアシスタントとの連携設定

<Snippet name="mcp/configuration" parentHeading="AIアシスタントとの連携設定" />

## MCPサーバーの実行

### STDIO

MCPサーバーをテスト・使用する最も簡単な方法は、AIアシスタントと連携設定することです（上記参照）。

[STDIOトランスポート](https://modelcontextprotocol.io/docs/concepts/transports#standard-input%2Foutput-stdio)で直接サーバーを実行するには、`<your-server-name>-serve-stdio`ターゲットを使用します：

<NxCommands commands={['run your-project:your-server-name-serve-stdio']} />

このコマンドは`tsx --watch`を使用し、ファイル変更時に自動でサーバーを再起動します。

### ストリーミング可能なHTTP

[ストリーミング可能なHTTPトランスポート](https://modelcontextprotocol.io/docs/concepts/transports#streamable-http)でローカル実行するには、`<your-server-name>-serve-http`ターゲットを使用します：

<NxCommands commands={['run your-project:your-server-name-serve-http']} />

このコマンドは`tsx --watch`を使用し、ファイル変更時に自動でサーバーを再起動します。

## Bedrock AgentCore Runtimeへのデプロイ

`computeType`に`BedrockAgentCoreRuntime`を選択した場合、[Amazon Bedrock AgentCore Runtime](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/agents-tools-runtime.html)にMCPサーバーをデプロイするCDKコンストラクトが生成されます。

CDKアプリケーションでこのコンストラクトを使用できます：

```ts {6}
import { MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    // スタックにMCPサーバーを追加
    new MyProjectMcpServer(this, 'MyProjectMcpServer');
  }
}
```

:::caution
[Docker](https://www.docker.com/)がビルドとデプロイに必要です。以下のようなエラーを避けるため、Dockerがインストールされ起動していることを確認してください：

```
ERROR: Cannot connect to the Docker daemon at unix://path/to/docker.sock.
```
:::

### 認証設定

#### IAM

デフォルトではMCPサーバーはIAM認証で保護されます。引数なしでデプロイします：

```ts {5}
import { MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    new MyProjectMcpServer(this, 'MyProjectMcpServer');
  }
}
```

#### Cognito JWT認証

JWT認証を設定するには、MCPサーバーコンストラクトに`authorizerConfiguration`プロパティを渡します。以下はCognitoユーザープールとクライアントでMCPサーバーを保護する例です：

```ts {14-17}
import { MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    const userPool = new UserPool(this, 'UserPool');
    const client = userPool.addClient('Client', {
      authFlows: {
        userPassword: true,
      },
    });

    new MyProjectMcpServer(this, 'MyProjectMcpServer', {
      authorizerConfiguration: {
        customJWTAuthorizer: {
          discoveryUrl: `https://cognito-idp.${Stack.of(userPool).region}.amazonaws.com/${userPool.userPoolId}/.well-known/openid-configuration`,
          allowedClients: [client.userPoolClientId],
        },
      },
    });
  }
}
```

### バンドルターゲット

Bedrock AgentCore Runtime向けにMCPサーバーをビルドするため、プロジェクトに`<your-mcp-server>-bundle`ターゲットが追加されます。このターゲットは：

- [`esbuild`](https://esbuild.github.io/)でMCPサーバーを単一JavaScriptファイルにバンドル（ストリーミングHTTP MCPサーバー用エントリポイントとして`http.ts`を使用）
- [MCPプロトコル契約](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/runtime-service-contract.html#mcp-protocol-contract)に従いポート`8000`で動作するバンドル済みサーバーを実行する`Dockerfile`からDockerイメージをビルド

:::tip
Dockerイメージはタグ（例：`my-scope-my-project-mcp-server:latest`）でビルドされ、CDKコンストラクトの`Dockerfile`がこれを継承します。これによりMCPサーバープロジェクトと`Dockerfile`を同じ場所に配置できます。
:::