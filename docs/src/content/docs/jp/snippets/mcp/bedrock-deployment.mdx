---
title: "MCPベドロック デプロイメント"
---



import Link from '@components/link.astro'

### CDKコンストラクト

`computeType`に`BedrockAgentCoreRuntime`を選択した場合、[Amazon Bedrock AgentCore Runtime](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/agents-tools-runtime.html)にMCPサーバーをデプロイするためのCDKコンストラクトが生成されます。

このCDKコンストラクトはCDKアプリケーションで使用できます：

```ts {6}
import { MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    // スタックにMCPサーバーを追加
    new MyProjectMcpServer(this, 'MyProjectMcpServer');
  }
}
```

:::caution
[Docker](https://www.docker.com/)はMCPサーバーのビルドとデプロイに必要です。以下のエラーを防ぐため、Dockerがインストールされ起動していることを確認してください：

```
ERROR: Cannot connect to the Docker daemon at unix://path/to/docker.sock.
```
:::

### 認証

#### IAM

デフォルトではMCPサーバーはIAM認証で保護されます。引数なしでデプロイ可能です：

```ts {5}
import { MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    new MyProjectMcpServer(this, 'MyProjectMcpServer');
  }
}
```

`grantInvoke`メソッドを使用して、Bedrock AgentCore Runtime上のMCPを起動する権限を付与できます。例えば<Link path="/guides/py-strands-agent">`py#strands-agent`</Link>ジェネレータで作成したエージェントにMCPサーバーを呼び出す権限を付与する場合：

```ts {8}
import { MyProjectAgent, MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    const agent = new MyProjectAgent(this, 'MyProjectAgent');
    const mcpServer = new MyProjectMcpServer(this, 'MyProjectMcpServer');

    mcpServer.agentCoreRuntime.grantInvoke(agent.agentCoreRuntime);
  }
}
```

#### Cognito JWT認証

JWT認証を設定するには、MCPサーバーコンストラクトに`authorizerConfiguration`プロパティを渡します。以下はCognitoユーザープールとクライアントでMCPサーバーを保護する例です：

```ts {14-17}
import { MyProjectMcpServer } from ':my-scope/common-constructs';

export class ExampleStack extends Stack {
  constructor(scope: Construct, id: string) {
    const userPool = new UserPool(this, 'UserPool');
    const client = userPool.addClient('Client', {
      authFlows: {
        userPassword: true,
      },
    });

    new MyProjectMcpServer(this, 'MyProjectMcpServer', {
      authorizerConfiguration: {
        customJWTAuthorizer: {
          discoveryUrl: `https://cognito-idp.${Stack.of(userPool).region}.amazonaws.com/${userPool.userPoolId}/.well-known/openid-configuration`,
          allowedClients: [client.userPoolClientId],
        },
      },
    });
  }
}
```