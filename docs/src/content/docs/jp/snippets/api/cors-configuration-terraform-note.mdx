---
title: "CORS設定 Terraform"
---

import Link from '@components/link.astro';

:::note
ソリューションに Terraform ウェブサイトモジュールが含まれている場合、その CloudFront ドメイン名を使用して CORS を制限できます。
CloudFront ドメイン名 `<domain_name>` が与えられた場合、API をデプロイするための Terraform モジュール内に以下を追加します
- HTTP API の場合、`cors_allow_origins` プロパティを `["http://localhost:4200", "http://localhost:4300", "https://<domain name>"]` に設定します。これにより、API ゲートウェイの CORS がこのディストリビューションとローカルホストに制限されます。
- REST API の場合、`ALLOWED_ORIGINS` 環境変数を `"https://<domain_name>"` に設定します。これにより、AWS Lambda 統合において CloudFront ディストリビューションが（ローカルホスト以外の）唯一許可される CORS オリジンとして設定されます。なお、この制限はプリフライト OPTIONS には適用されません - この問題の優先順位付けを支援するために、[この GitHub issue](https://github.com/awslabs/nx-plugin-for-aws/issues/377) に +1 をお願いします。

```hcl {4,7}
module "my_api" {
  source = "../../common/terraform/src/app/apis/my-api"

  cors_allow_origins = ["http://localhost:4200", "http://localhost:4300", "https://<domain name>"] // Only required for HTTP API

  env = {
    ALLOWED_ORIGINS = "https://<domain name>" // Only required for REST API
    ENVIRONMENT = var.environment
    LOG_LEVEL   = "INFO"
  }
}
```
`MyWebsite` コンストラクトは、<Link path="/guides/react-website">`ts#react-website` ジェネレーター</Link>を使用して生成できます
:::